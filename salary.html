<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Management - Dreamex Datalab HSE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* External styles.css content embedded directly */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --text-color: #333;
            --bg-color: #f5f6fa;
            --sidebar-width: 250px;
            /* Theme Colors */
            --blue: #3498db;
            --green: #2ecc71;
            --purple: #9b59b6;
            --orange: #e67e22;
            --red: #e74c3c;
            
            /* Default Values */
            --accent-color: var(--blue);
            --font-family: 'Inter', system-ui, -apple-system, sans-serif;
            --base-font-size: 0.9rem; /* Standardized, reduced from 14px */
            --font-scale: 1;
            
            /* Theme-specific variables */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
        }

        /* Dark theme */
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #404040;
        }

        /* High contrast mode */
        [data-contrast="high"] {
            --text-primary: #000000;
            --text-secondary: #000000;
            --bg-primary: #ffffff;
            --bg-secondary: #ffffff;
            --border-color: #000000;
        }

        [data-theme="dark"][data-contrast="high"] {
            --text-primary: #ffffff;
            --text-secondary: #ffffff;
            --bg-primary: #000000;
            --bg-secondary: #000000;
            --border-color: #ffffff;
        }

        /* Layout density */
        [data-density="comfortable"] {
            --spacing-unit: 1rem;
            --padding-sm: 0.5rem;
            --padding-md: 1rem;
            --padding-lg: 1.5rem;
        }

        [data-density="compact"] {
            --spacing-unit: 0.75rem;
            --padding-sm: 0.25rem;
            --padding-md: 0.75rem;
            --padding-lg: 1rem;
        }

        [data-density="spacious"] {
            --spacing-unit: 1.5rem;
            --padding-sm: 0.75rem;
            --padding-md: 1.5rem;
            --padding-lg: 2rem;
        }

        /* Animation settings */
        [data-reduced-motion="none"] {
            --transition-speed: 0.2s;
        }

        [data-reduced-motion="reduced"] {
            --transition-speed: 0.4s;
        }

        [data-reduced-motion="minimal"] {
            --transition-speed: 0s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--base-font-size);
            line-height: calc(1.5 * var(--font-scale));
            color: var(--text-primary);
            background-color: var(--bg-primary);
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
    .sidebar {width:var(--sidebar-width); background:var(--primary-color); color:#fff; padding:1rem; position:fixed; height:100vh; overflow-y:auto; z-index:1000; transition:transform .3s ease; top:0; left:0;}
    .sidebar.collapsed {transform:translateX(-100%);} 
    /* label spans not needed for slide-out behavior, but keep mini/full optional */
    .logo h2 span.mini-title { display:none; }

        .logo h2 {
            text-align: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .menu {
            list-style: none;
            margin-top: 2rem;
        }

        .menu li {
            margin-bottom: 0.5rem;
        }

        .menu a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .menu a i {
            margin-right: 10px;
        }

        .menu a:hover, .menu a.active {
            background-color: var(--secondary-color);
        }

        .menu-dropdown .submenu {
            display: none;
            list-style: none;
            margin-left: 2rem;
            margin-top: 0.5rem;
        }

        .menu-dropdown:hover .submenu {
            display: block;
        }

        /* Feature-based visibility */
        [data-feature]:not(.menu-visible){display:none !important;} 
        .menu-dropdown:not(.menu-visible){display:none !important;} 
        
        /* Hide ALL menu items by default during loading - only for sidebar menu */
        .sidebar.menu-loading .menu-item, 
        .sidebar.menu-loading .menu-dropdown, 
        .sidebar.menu-loading li[data-feature], 
        .sidebar.menu-loading [data-feature] {
            display:none !important;
        } 
        .menu-loading [data-feature]{
            display:none !important;
        } 
        .menu-loading .menu-dropdown{
            display:none !important;
        }

        /* Hide all menu items with data-feature attributes by default */
        [data-feature] {
            display: none !important;
        }

        /* Only show menu items that have been explicitly authorized */
        [data-feature].menu-visible {
            display: block !important;
        }

        /* Ensure parent dropdowns without data-feature are hidden if they have no visible children */
        .menu-dropdown:not([data-feature]) {
            display: none !important;
        }

        .menu-dropdown:not([data-feature]).menu-visible {
            display: block !important;
        }

        /* Main Content Styles */
    .main-content {flex:1; margin-left:var(--sidebar-width); padding:0.5rem; width:calc(100% - var(--sidebar-width)); box-sizing:border-box; transition:margin-left .3s ease, width .3s ease; padding-top:4rem;}
    .main-content.sidebar-collapsed {margin-left:0; width:100%;}

        /* Top Navigation Styles */
    .top-nav {display:flex; justify-content:space-between; align-items:center; padding:.5rem .75rem; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,.1); margin-bottom:.3rem; position:fixed; top:.25rem; right:.5rem; left:calc(var(--sidebar-width) + .5rem); height:50px; min-height:50px; z-index:100; transition:left .3s ease;}
    .top-nav.sidebar-collapsed { left:.5rem; }

        .top-nav-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-toggle-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
            font-size: 1.1rem;
            color: #2c3e50;
        }

        .sidebar-toggle-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .header-company-logo {
            height: 32px;
            width: auto;
            border-radius: 4px;
            object-fit: contain;
        }

        .header-logo-placeholder {
            height: 32px;
            width: 32px;
            background: #f0f0f0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }

        .company-name-header {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .top-nav-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-left: auto;
        }

        /* Form Container Styles */
        .form-container {
            width: 100%;
            max-width: none;
            padding: 1.5rem;
            margin: 0;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Content Container */
        .content {
            width: 100%;
            margin: 0;
            padding: 1.5rem;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Notification Styles */
        .notifications {
            position: relative;
            display: flex;
            align-items: center;
        }

        .notification-btn {
            background: none;
            border: none;
            cursor: pointer;
            position: relative;
            font-size: 1.2rem;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
        }

        .notification-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            width: 300px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .notification-dropdown.show {
            display: block;
        }

        .notification-header {
            padding: 1rem;
            border-bottom: 1px solid #ddd;
        }

        .notification-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .notification-actions h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .notification-link {
            text-decoration: none;
            color: #3498db;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .notification-link:hover {
            background: #f8f9fa;
            color: #2980b9;
        }

        .mark-all-read {
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 0.85rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .mark-all-read:hover {
            background: #f8f9fa;
        }

        .notification-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }

        .notification-item:hover {
            background-color: #f5f5f5;
        }

        /* User Profile Styles */
        .user-profile {
            position: relative;
            display: flex;
            align-items: center;
        }

        .profile-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            display: flex;
            align-items: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .profile-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
            transform: scale(1.05);
        }

        .profile-btn img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: border-color 0.2s ease, opacity 0.2s ease;
        }

        .profile-btn:hover img {
            border-color: rgba(52, 152, 219, 0.5);
        }

        .profile-btn img.loading {
            opacity: 0.7;
        }

        .profile-btn img.error {
            border-color: rgba(231, 76, 60, 0.5);
        }

        .profile-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: #fff;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            z-index: 1000;
        }

        .profile-dropdown.show {
            display: block;
        }

        .profile-dropdown ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .profile-dropdown ul li {
            padding: 0;
        }

        .profile-dropdown ul li a {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: #333;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .profile-dropdown ul li a:hover {
            background-color: #f8f9fa;
        }

        .profile-dropdown ul li a i {
            margin-right: 10px;
            width: 16px;
            color: #666;
        }

        /* User Profile Dropdown Styles */
        .user-info {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-color);
        }

        .admin-crown-icon {
            color: #ffd700; 
            margin-left: 0.5rem;
            font-size: 0.9rem;
            vertical-align: middle;
            animation: crown-glow 2s ease-in-out infinite alternate;
        }

        @keyframes crown-glow {
            from {
                text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            }
            to {
                text-shadow: 0 0 10px rgba(255, 215, 0, 0.8), 0 0 15px rgba(255, 215, 0, 0.6);
            }
        }

        .user-email {
            font-size: 0.9rem;
            color: #666;
        }

        .user-status {
            margin-top: 0.25rem;
        }

        .divider {
            height: 1px;
            background-color: #eee;
            margin: 0.5rem 0;
        }

        /* Profile Dropdown Status Badge */
        .user-status .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        /* Content Styles */
        .content {
            margin-top: 1rem; 
            padding: 0.75rem; 
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.75rem; 
        }

        .data-table th,
        .data-table td {
            padding: 0.5rem 0.75rem; 
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 0.25rem;
        }

        .btn {
            padding: var(--padding-sm) var(--padding-md);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all var(--transition-speed);
        }

        .btn-edit {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-approve {
            background-color: #27ae60;
            color: white;
        }

        .btn-decline {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }

        .btn-icon {
            padding: 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            color: white;
        }

        .btn-icon i {
            font-size: 0.9rem;
        }

        .btn-icon.btn-approve {
            background-color: #2ecc71;
        }

        .btn-icon.btn-approve:hover {
            background-color: #27ae60;
        }

        .btn-icon.btn-decline {
            background-color: #e74c3c;
        }

        .btn-icon.btn-decline:hover {
            background-color: #c0392b;
        }

        .btn-icon.btn-export {
            background-color: #9b59b6;
        }

        .btn-icon.btn-export:hover {
            background-color: #8e44ad;
        }

        .btn-icon.btn-delete {
            background-color: #e74c3c;
        }

        .btn-icon.btn-delete:hover {
            background-color: #c0392b;
        }

        .btn-icon:not(:last-child) {
            margin-right: 0.25rem;
        }

        /* Form Styles */
        .form-container {
            width: 100%;
            max-width: none;
            margin: 1.5rem 0; 
            padding: 1.5rem; 
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: var(--spacing-unit);
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            margin-top: 2rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Login Page Styles */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 20px;
        }

        .login-box {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-header h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .login-header p {
            color: var(--text-color);
            opacity: 0.8;
        }

        .login-form .form-group {
            margin-bottom: 1.5rem;
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon input {
            padding-left: 40px;
            width: 100%;
            height: 45px;
        }

        .input-with-icon i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            opacity: 0.5;
        }

        .btn-login {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            height: 45px;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .btn-login:hover {
            background-color: var(--secondary-color);
        }

        .error-message {
            color: var(--accent-color);
            text-align: center;
            margin-top: 1rem;
            display: none;
        }

        /* Role Badge Styles */
        .role-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .role-guest {
            background-color: #95a5a6;
            color: white;
        }

        .role-standard {
            background-color: #3498db;
            color: white;
        }

        .role-editor {
            background-color: #2ecc71;
            color: white;
        }

        .role-admin {
            background-color: #e67e22;
            color: white;
        }

        .role-superuser {
            background-color: #9b59b6;
            color: white;
        }

        /* Form Hint Style */
        .form-hint {
            color: #666;
            font-size: 0.8rem;
            margin-top: 4px;
            display: block;
        }

        /* Content Header with Button */
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        /* User Table Status Styles */
        .status-active {
            background-color: #2ecc71;
            color: white;
        }

        .status-inactive {
            background-color: #95a5a6;
            color: white;
        }

        /* Modal Header Styles */
        .modal-header {
            border-bottom: 1px solid #ddd;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        /* Modal Footer Styles */
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            gap: 0.85rem;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-start; 
            background: rgba(255, 255, 255, 0.95);
            position: sticky;
            bottom: 0;
            z-index: 2;
            box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.03);
        }

        .modal-footer .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
        }

        /* Color coding for different action buttons */
        .btn-edit {
            background-color: #3b82f6; 
            color: white;
            box-shadow: 0 2px 5px rgba(59, 130, 246, 0.3);
        }

        .btn-edit:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background-color: #10b981; 
            color: white;
            box-shadow: 0 2px 5px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover {
            background-color: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background-color: #ef4444; 
            color: white;
            box-shadow: 0 2px 5px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.4);
        }

        .btn-delete {
            background-color: #f43f5e; 
            color: white;
            box-shadow: 0 2px 5px rgba(244, 63, 94, 0.3);
        }

        .btn-delete:hover {
            background-color: #e11d48;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(244, 63, 94, 0.4);
        }

        .btn-secondary {
            background-color: #6b7280; 
            color: white;
            box-shadow: 0 2px 5px rgba(107, 114, 128, 0.3);
        }

        .btn-secondary:hover {
            background-color: #4b5563;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(107, 114, 128, 0.4);
        }

        /* New warning color button - Yellow/Amber */
        .btn-warning {
            background-color: #f59e0b;
            color: white;
            box-shadow: 0 2px 5px rgba(245, 158, 11, 0.3);
        }

        .btn-warning:hover {
            background-color: #d97706;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4);
        }

        /* New info color button - Light blue */
        .btn-info {
            background-color: #0ea5e9;
            color: white;
            box-shadow: 0 2px 5px rgba(14, 165, 233, 0.3);
        }

        .btn-info:hover {
            background-color: #0284c7;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(14, 165, 233, 0.4);
        }

        /* Disabled button styling */
        .btn:disabled,
        .btn.btn-disabled {
            opacity: 1; 
            cursor: pointer; 
            pointer-events: auto; 
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn:disabled:hover,
        .btn.btn-disabled:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn.btn-success:disabled,
        .btn.btn-success.btn-disabled {
            background-color: #10b981; 
            color: #ffffff;
        }

        /* Add tooltip styling for disabled buttons */
        .btn.btn-disabled::before {
            content: attr(title);
            position: absolute;
            background-color: rgba(51, 51, 51, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .btn.btn-disabled::after {
            content: "";
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: rgba(51, 51, 51, 0.9) transparent transparent transparent;
            opacity: 0;
            transition: opacity 0.3s;
        }

        /* Additional critical styles for salary management */

        /* Tab Layout Styles */
        .content-tabs {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tab-navigation {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 0.5rem;
            gap: 0.25rem;
        }

        .tab-nav-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.2s ease;
        }

        .tab-nav-btn:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab-nav-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-content {
            padding: 2rem;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Salary specific styles */
        .interview-container {
            width: 100%;
            margin: 0;
        }

        .page-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: #fff;
            padding: 0.55rem 0.75rem;
            border-radius: 0;
            margin: 0.35rem 0 0.5rem 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 10px 28px rgba(0,0,0,0.18), 0 6px 16px rgba(0,0,0,0.14);
            font-size: 0.9rem;
        }

        .page-header i {
            font-size: 1rem;
        }

        .header-main {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .page-header h1 {
            color: #fff;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 0.9rem;
            margin: 0;
            font-weight: 600;
        }

        .page-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Add New Button */
        .btn-add-new {
            background: none;
            border: none;
            color: #fff;
            padding: 0.4rem;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .btn-add-new:hover {
            color: rgba(255,255,255,0.8);
            transform: scale(1.1);
        }

        .page-title {
            font-size: 0.9rem;
            color: #fff;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-weight: 600;
        }

        .page-subtitle {
            color: #6c757d;
            font-size: 1.1rem;
            margin: 0;
        }

        .stats-bar {
            display: flex;
            gap: 1.5rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e9ecef;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #495057;
            font-weight: 500;
        }

        .stat-number {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .loading-container {
            text-align: center;
            padding: 3rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-container {
            text-align: center;
            padding: 3rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            color: #dc3545;
        }

        .candidates-table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            background: #f8f9fa;
            padding: 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            margin: 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .refresh-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .refresh-btn:hover {
            background: #218838;
        }

        .refresh-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .candidates-table {
            width: 100%;
            border-collapse: collapse;
        }

        .candidates-table th,
        .candidates-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .candidates-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .candidates-table tbody tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-interviewed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-hired {
            background: #d4edda;
            color: #155724;
        }

        .btn-action {
            padding: 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 0.25rem;
            font-size: 0.8rem;
        }

        .btn-view {
            background: #17a2b8;
            color: white;
        }

        .btn-view:hover {
            background: #138496;
        }

        .btn-edit {
            background: #007bff;
            color: white;
        }

        .btn-edit:hover {
            background: #0056b3;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .d-none {
            display: none !important;
        }

        /* Modal Styles */
        .applicant-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .applicant-modal-content {
            background: white;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .applicant-modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .applicant-modal-title {
            margin: 0;
            color: #2c3e50;
            font-size: 1.25rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
            padding: 0.5rem;
        }

        .close-modal:hover {
            color: #dc3545;
        }

        .applicant-modal-body {
            padding: 1.5rem;
        }

        /* Form styles for modal */
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-control:focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        /* Enhanced responsive design */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 0.25rem;
            }
            
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 999;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            /* Mobile adjustments for staff-style header */
            .page-header { padding: 0.65rem 0.75rem; }
            
            .candidates-table {
                font-size: 0.9rem;
            }
            
            .candidates-table th,
            .candidates-table td {
                padding: 0.5rem;
            }
            
            .tab-navigation {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .tab-nav-btn {
                flex: none;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }

            .sidebar-toggle-btn {
                display: block;
            }

            .company-name-header {
                font-size: 1rem;
            }

            .header-company-logo, .header-logo-placeholder {
                width: 36px;
                height: 36px;
            }
        }

        @media (max-width: 480px) {
            .company-name-header {
                font-size: 0.9rem;
                max-width: 120px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .header-company-logo, .header-logo-placeholder {
                width: 32px;
                height: 32px;
            }
        }
    </style>
    <style>
        /* File Preview Modal Styles */
        .file-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .file-preview-content {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90vh;
            width: auto;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .file-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 1rem;
        }

        .file-preview-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .close-preview {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .close-preview:hover {
            color: #dc3545;
            background: #f8f9fa;
        }

        .file-preview-body {
            flex: 1;
            overflow: auto;
            min-height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            min-height: 500px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
        }

        .preview-error {
            text-align: center;
            padding: 2rem;
            color: #dc3545;
        }

        .file-preview-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
            margin-top: 1rem;
        }

        .preview-action-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .preview-download-btn {
            background: #28a745;
            color: white;
            border: none;
        }

        .preview-download-btn:hover {
            background: #218838;
        }

        .preview-open-btn {
            background: #007bff;
            color: white;
            border: none;        }

        .preview-open-btn:hover {
            background: #0056b3;
        }

        .interview-container { /* Renamed to salary-container conceptually, but class kept for CSS consistency */
            width: 100%;
            margin: 0;
        }

    /* Removed legacy white header & large title styles (conflicted with gradient staff-style header) */

        .page-subtitle {
            color: #6c757d;
            font-size: 1.1rem;
            margin: 0;
        }

        .stats-bar {
            display: flex;
            gap: 1.5rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e9ecef;
            flex-wrap: wrap; /* Allow stats to wrap on smaller screens */
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #495057;
            font-weight: 500;
        }

        .stat-number {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .loading-container {
            text-align: center;
            padding: 3rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-container {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            color: #c53030;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .candidates-table-container { /* Reused class name for salary table container */
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            background: #f8f9fa;
            padding: 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .refresh-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.2s;
        }

        .refresh-btn:hover {
            background: #0056b3;
        }

        .refresh-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .candidates-table { /* Reused class name for salary table */
            width: 100%;
            border-collapse: collapse;
        }

        .candidates-table th,
        .candidates-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .candidates-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .candidates-table tbody tr:hover {
            background: #f8f9fa;
        }

        .candidate-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #007bff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 0.75rem;
        }

        .candidate-info {
            display: flex;
            align-items: center;
        }

        .candidate-details {
            flex: 1;
        }

        .candidate-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.25rem;
        }

        .candidate-email {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Offer Statuses (example) */
        .status-offer-pending { background: #fff3cd; color: #856404; }
        .status-offer-sent { background: #d1ecf1; color: #0c5460; }
        .status-offer-viewed { background: #cce5ff; color: #004085; }
        .status-offer-accepted { background: #d4edda; color: #155724; }
        .status-offer-declined { background: #f8d7da; color: #721c24; }
        .status-offer-rescinded { background: #e9ecef; color: #495057; }
        .status-offer-expired { background: #f5c6cb; color: #721c24; }


        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-interviewed {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-hired {
            background: #d1ecf1;
            color: #0c5460;
        }        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .files-column {
            max-width: 150px;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.5rem;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 0.25rem;
            font-size: 0.85rem;
            border: 1px solid #dee2e6;
            transition: all 0.2s;
        }

        .file-item:hover {
            background: #e9ecef;
            border-color: #007bff;
        }

        .file-item:last-child {
            margin-bottom: 0;
        }

        .file-icon {
            color: #007bff;
            font-size: 0.9rem;
        }

        .file-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #2c3e50;
        }

        .file-link {
            text-decoration: none;
            color: inherit;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
        }

        .file-link:hover {
            color: #007bff;
        }

        .download-btn {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .download-btn:hover {
            background: #e9ecef;
        }

        .no-files {
            color: #6c757d;
            font-style: italic;
            font-size: 0.85rem;
            text-align: center;
        }

        .btn-action {
            padding: 0.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-view {
            background: #007bff;
            color: white;
        }

        .btn-view:hover {
            background: #0056b3;
        }

        .btn-edit {
            background: #28a745;
            color: white;
        }

        .btn-edit:hover {
            background: #1e7e34;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #dee2e6;
        }

        .real-time-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #28a745;
            font-size: 0.9rem;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
            }
        }

        .last-updated {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 0.5rem;
        }        /* Responsive Design */
        @media (max-width: 768px) {
            .page-header {
                padding: 1.5rem;
            }

            .stats-bar {
                flex-direction: column;
                gap: 0.75rem;
            }

            .candidates-table {
                font-size: 0.9rem;
            }

            .candidates-table th,
            .candidates-table td {
                padding: 0.75rem 0.5rem;
            }

            .files-column {
                max-width: 120px;
            }

            .file-item {
                font-size: 0.75rem;
            }

            /* Hide phone column on very small screens */
            .candidates-table th:nth-child(4),
            .candidates-table td:nth-child(4) {
                display: none;
            }
        }

        /* Tab Layout Styles */
        .content-tabs {
            margin-top: 0;
        }

        .tab-navigation {
            display: flex;
            background: white;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 0;
            border-bottom: 1px solid #e9ecef;
        }

        .tab-nav-btn {
            flex: 1;
            padding: 1rem 2rem;
            border: none;
            background: none;
            color: #6c757d;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            position: relative;
            transition: all 0.2s;
            border-radius: 12px 12px 0 0;
        }

        .tab-nav-btn:hover {
            color: #007bff;
            background: #f8f9fa;
        }

        .tab-nav-btn.active {
            color: #007bff;
            background: white;
            border-bottom: 3px solid #007bff;
        }

        .tab-content {
            background: white;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive tab styles */
        @media (max-width: 768px) {
            .tab-nav-btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
                flex-direction: column;
                gap: 0.25rem;
            }

            .tab-nav-btn i {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .tab-navigation {
                flex-direction: column;
            }

            .tab-nav-btn {
                flex-direction: row;
                justify-content: flex-start;
                padding: 1rem;
                border-radius: 0;
            }

            .tab-nav-btn.active {
                border-bottom: none;
                border-left: 3px solid #007bff;
            }
        }        /* Button styles for job management placeholder */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }        /* Jobs specific styles (reused for offers) */
        .job-title-cell { /* Offer specific: Candidate Name cell */
            min-width: 200px;
        }

        .job-salary { /* Offer specific: Offered Salary */
            color: #28a745;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .application-count { /* Offer specific: e.g. Offer Version Count */
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .application-count-badge {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .job-actions { /* Offer Actions */
            display: flex;
            gap: 0.25rem;
        }

        /* Status badges for jobs (reused for offers) */
        .status-active { /* e.g. status-offer-pending */
            background: #d4edda;
            color: #155724;
        }

        .status-closed { /* e.g. status-offer-accepted / status-offer-declined */
            background: #f8d7da;
            color: #721c24;
        }

        .status-draft { /* e.g. status-offer-draft */
            background: #fff3cd;
            color: #856404;
        }        /* Job filter indicator styles (reused for offers) */
        .job-filter-indicator {
            background: #e3f2fd;
            color: #1976d2;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .job-filter-indicator button {
            background: none;
            border: none;
            color: #1976d2;
            cursor: pointer;
            padding: 0;
            margin-left: 0.25rem;
            font-size: 0.9rem;
        }        .job-filter-indicator button:hover {
            color: #1565c0;
        }

        /* Applicants Tab Styles (reused for Accepted/Declined Offers) */
        .applicant-controls-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .selected-job-info { /* Reused for selected offer info */
            flex: 1;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
        }

        .selected-job-title { /* Reused for selected offer title */
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0 0 0.5rem 0;
        }

        .selected-job-details { /* Reused for selected offer details */
            color: #6c757d;
            margin: 0;
            font-size: 0.9rem;
        }

        .applicants-table { /* Reused for accepted/declined offers table */
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .applicants-table th {
            background: #f8f9fa;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #e9ecef;
            white-space: nowrap;
            font-size: 0.85rem;
        }

        .applicants-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
            font-size: 0.85rem;
        }

        .applicants-table tbody tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }

        .applicant-name { /* Candidate Name in offer context */
            font-weight: 600;
            color: #2c3e50;
        }

        .no-applicants { /* Reused for no offers message */
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .no-applicants i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .no-applicants h3 {
            margin: 0 0 0.5rem 0;
            color: #495057;
        }

        .no-applicants p {
            margin: 0;
            opacity: 0.8;
        }

        .status-reviewed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-shortlisted {
            background: #fff3cd;
            color: #856404;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .action-btn {
            padding: 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 0.125rem;
        }

        /* Action button variants */
        .btn-view {
            background-color: #e6f3ff;
            color: #0066cc;
        }

        .btn-view:hover {
            background-color: #cce6ff;
            transform: translateY(-1px);
        }

        .btn-edit {
            background-color: #fff3e0;
            color: #ff9800;
        }

        .btn-edit:hover {
            background-color: #ffe0b3;
            transform: translateY(-1px);
        }

        .btn-info {
            background-color: #e8f5e8;
            color: #4caf50;
        }

        .btn-info:hover {
            background-color: #d4f3d4;
            transform: translateY(-1px);
        }

        .btn-mail {
            background-color: #f3e5f5;
            color: #9c27b0;
        }

        .btn-mail:hover {
            background-color: #e1bee7;
            transform: translateY(-1px);
        }

        .btn-hire {
            background-color: #e8f5e8;
            color: #2e7d32;
            font-weight: bold;
        }

        .btn-hire:hover {
            background-color: #c8e6c9;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(46, 125, 50, 0.2);
        }

        .btn-hire:disabled {
            background-color: #f5f5f5;
            color: #9e9e9e;
            cursor: not-allowed;
            transform: none;
        }

        .btn-sm {
            font-size: 0.8rem;
            padding: 0.375rem 0.75rem;
        }

        /* Mobile responsive for applicant controls */
        @media (max-width: 768px) {
            .applicant-controls-row {
                flex-direction: column;
                gap: 1rem;
            }

            .selected-job-info {
                order: 1;
            }

            .applicants-table {
                font-size: 0.8rem;
            }

            .applicants-table th,
            .applicants-table td {
                padding: 0.5rem 0.25rem;
            }            /* Stack action buttons vertically on mobile */
            .action-buttons {
                flex-direction: column;
                gap: 0.25rem;
            }
        }

        /* Applicant Modal Styles (reused for Offer Modal, needs adaptation) */
        .applicant-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .applicant-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .applicant-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #dee2e6;
        }

        .applicant-modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .close-modal:hover {
            color: #dc3545;
            background: #f8f9fa;
        }

        .applicant-modal-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .applicant-info-section {
            margin-bottom: 1.5rem;
        }

        .applicant-info-section h4 {
            color: #495057;
            margin: 0 0 1rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .applicant-info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .applicant-info-label {
            font-weight: 500;
            color: #6c757d;
        }

        .applicant-info-value {
            color: #2c3e50;
        }        .status-update-section {
            grid-column: 1 / -1;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
        }

        .form-control {
            padding: 0.5rem;
            border: 1px solid #ced4da;            border-radius: 4px;
            font-size: 0.9rem;
            background: white;
            color: #495057;
        }

        .form-control:focus {
            border-color: #007bff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        /* Schedule Modal Form Styles (reused, may need adaptation for offers) */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #495057;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
            background: white;
            color: #495057;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #007bff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }        /* Interviewer Dropdown Styling (reused, may need adaptation) */
        #interviewerSelect {
            appearance: none;
            padding-right: 2.5rem;
            position: relative;
            background-color: #fff;
        }

        #interviewerSelect::after {
            content: '';
            position: absolute;
            right: 0.75rem;
            top: 50%;
            width: 0.75rem;
            height: 0.75rem;
            border-right: 2px solid #6b7280;
            border-bottom: 2px solid #6b7280;
            transform: translateY(-70%) rotate(45deg);
            pointer-events: none;
        }

        #interviewerSelect:focus::after {
            border-color: #0066cc;
        }

        /* User Selection Container */
        .user-selection-wrapper {
            width: 100%;
            margin-bottom: 1rem;
        }

        .user-input-container {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .selected-interviewers {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 20px;
        }

        .interviewer-tag {
            display: inline-flex;
            align-items: center;
            background: #e3f2fd;
            color: #1565c0;
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            border: 1px solid #bbdefb;
            gap: 0.5rem;
        }

        .interviewer-tag .remove-interviewer {
            background: none;
            border: none;
            color: #1565c0;
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
            margin: 0;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .interviewer-tag .remove-interviewer:hover {
            background: #1565c0;
            color: white;
        }        .empty-interviewers-message {
            color: #6c757d;
            font-style: italic;
            font-size: 0.875rem;
            padding: 0.5rem 0;
        }

        /* Existing Interviews Display (reused, may need adaptation) */
        .loading-interviews {
            text-align: center;
            padding: 1rem;
            color: #6c757d;
            font-style: italic;
        }

        .no-existing-interviews {
            text-align: center;
            padding: 1rem;
            color: #6c757d;
            font-style: italic;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #dee2e6;
        }

        .existing-interview-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
        }

        .existing-interview-item:hover {
            background: #e9ecef;
            border-color: #ced4da;
        }

        .interview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .interview-date-time {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1rem;
        }

        .interview-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-weight: 500;
        }

        .interview-status.scheduled {
            background: #d4edda;
            color: #155724;
        }

        .interview-status.completed {
            background: #cce5ff;
            color: #004085;
        }

        .interview-status.cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .detail-content {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .detail-item {
            display: inline-flex;
            align-items: center;
            padding: 0 1rem 0.25rem 0;
        }

        .detail-label {
            font-weight: 500;
            padding-right: 0.75rem;
            min-width: 80px;
        }

        .action-container {
            padding-top: 0.75rem;
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            border-radius: 4px;
        }

        /* Schedule Status Badges (reused, may need adaptation) */
        .schedule-status {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }        .schedule-status.scheduled {
            background: #d4edda;
            color: #155724;
        }

        .schedule-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .schedule-status.expired {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .schedule-status.completed {
            background: #cce5ff;
            color: #004085;
        }

        /* Schedule Column Styles (reused, may need adaptation) */
        .schedule-column {
            min-width: 150px;
        }

        .schedule-column .btn {
            font-size: 0.8rem;
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .schedule-column .btn-primary {
            background: #007bff;
            color: white;
        }        .schedule-column .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        /* Evaluation Modal Styles (reused, may need adaptation) */
        .evaluation-form {
            margin-top: 1rem;
        }

        .evaluation-criteria {
            margin: 1.5rem 0;
        }

        .criteria-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .criteria-item label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #495057;
        }

        .rating-group {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .rating-stars {
            display: flex;
            gap: 0.25rem;
            margin-right: 1rem;
        }

        .star {
            font-size: 1.5rem;
            color: #dee2e6;
            cursor: pointer;
            transition: color 0.2s;
            user-select: none;
        }

        .star:hover,
        .star.active {
            color: #ffc107;
        }

        .star.active ~ .star {
            color: #dee2e6;
        }

        .rating-label {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .criteria-notes {
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .evaluation-candidate-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        /* Button Styles for Evaluation */
        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }

        .btn-info {
            background-color: #4A90E2;
            border: none;
            color: white;
            transition: background-color 0.2s ease;
        }

        .btn-info:hover {
            background-color: #357ABD;
        }

        /* Custom Table Styles for Offer Management */
        .offers-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .jobs-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #e9ecef;
            white-space: nowrap;
        }

        /* Ensure salary grid table spans full available width */
        .jobs-table {
            width: 100%;
            table-layout: auto; /* allow columns to expand */
        }

        /* Widen Job Title column specifically for the salary grid */
        #salaryGridTable th:first-child,
        #salaryGridTable td:first-child {
            width: 280px; /* increased width for single-line titles */
            max-width: 400px;
            white-space: nowrap;
            text-align: left; /* override earlier center alignment */
        }

        /* Ensure job title cell never wraps */
        #salaryGridTable .job-title-cell {
            white-space: nowrap;
        }

        /* Wrapper should also stretch */
        .table-container {
            width: 100%;
            overflow-x: auto; /* safeguard if columns exceed viewport */
        }

        /* Make the tab content area full-width inside its container */
        #salaryGridTabContent {
            width: 100%;
        }

        .jobs-table th:first-child {
            width: 40px;
            text-align: center;
        }

        .jobs-table td {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }        .jobs-table tbody tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }

        .jobs-table tbody tr {
            transition: background-color 0.2s ease;
        }

        .job-title-cell { /* Candidate Name for offers */
            font-weight: 600;
            color: #2c3e50;
        }

        .job-code { /* Offer ID or Code */
            font-family: 'Courier New', monospace;
            background: #e9ecef;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #495057;
        }

        .search-export-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .search-wrapper {
            position: relative;
            flex: 1;
            min-width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 0.75rem 0.75rem 2.5rem;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            pointer-events: none;
        }

        .loading-state {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        .d-none {
            display: none !important;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 1.5rem;
            gap: 1rem;
        }

        .pagination-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #495057;
            padding: 0.5rem 0.75rem;
        }

        .metric-value {
            font-weight: 600;
            color: #007bff;
        }

        .notes-section {
            margin-top: 2rem;
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .notes-section h5 {
            margin: 0 0 1rem 0;
            color: #495057;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .note-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #007bff;
        }

        .note-item:last-child {
            margin-bottom: 0;
        }

        .note-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .note-evaluator {
            font-weight: 600;
            color: #2c3e50;
        }

        .note-date {
            font-size: 0.85rem;
            color: #6c757d;
        }

        .note-content {
            color: #495057;
            line-height: 1.5;
        }

        .no-evaluations {
            text-align: center;
            padding: 3rem 2rem;
            color: #6c757d;
        }

        .no-evaluations i {
            font-size: 3rem;
            color: #dee2e6;
            margin-bottom: 1rem;
        }

        .no-evaluations h4 {
            margin: 0 0 0.5rem 0;
            color: #495057;
        }

        @media (max-width: 768px) {
            .evaluation-rank-content {
                margin: 1rem;
                max-width: calc(100% - 2rem);
            }
            
            .evaluation-metrics {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .applicant-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
    <!-- GitHub Pages Fix Script removed since file is empty -->
</head>
<body>
    <!-- File Preview Modal (reused) -->
    <div id="filePreviewModal" class="file-preview-modal">
        <div class="file-preview-content">
            <div class="file-preview-header">
                <h3 class="file-preview-title" id="previewTitle">File Preview</h3>
                <button class="close-preview" onclick="closeFilePreview()">&times;</button>
            </div>
            <div class="file-preview-body" id="previewBody">
                <!-- Preview content will be inserted here -->
            </div>
            <div class="file-preview-actions">
                <button class="preview-action-btn preview-download-btn" id="previewDownloadBtn">
                    <i class="fas fa-download"></i>
                    Download
                </button>
                <button class="preview-action-btn preview-open-btn" id="previewOpenBtn">
                    <i class="fas fa-external-link-alt"></i>
                    Open in New Tab
                </button>
            </div>
        </div>
    </div>

    <!-- Salary Grade Modal (adapted from Applicant Modal) -->
    <div id="salaryGradeModal" class="applicant-modal">
        <div class="applicant-modal-content" style="max-width: 700px;"> <!-- Wider modal for more fields -->
            <div class="applicant-modal-header">
                <h3 class="applicant-modal-title" id="salaryGradeModalTitle">Add New Salary Grade</h3>
                <button class="close-modal" onclick="closeSalaryGradeModal()">&times;</button>
            </div>
            <form id="salaryGradeForm">
                <div class="applicant-modal-body">
                    <input type="hidden" id="salaryGradeId">
                    <div class="form-group">
                        <label for="modalJobTitle">Job Title <span class="required">*</span></label>
                        <select id="modalJobTitle" class="form-control" required>
                            <option value="">Select Job Title...</option>
                            <!-- Job titles will be populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modalDepartment">Department <span class="required">*</span></label>
                        <select id="modalDepartment" class="form-control" required>
                            <option value="">Select Department...</option>
                            <!-- Departments will be populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modalSalaryGrade">Salary Grade / Level <span class="required">*</span></label>
                        <input type="text" id="modalSalaryGrade" class="form-control" placeholder="e.g., Grade A, Level 3" required>
                    </div>
                    <div class="form-group">
                        <label for="modalCurrency">Currency <span class="required">*</span></label>
                        <select id="modalCurrency" class="form-control" required>
                            <option value="USD">USD - US Dollar</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="GBP">GBP - British Pound</option>
                            <option value="CAD">CAD - Canadian Dollar</option>
                            <option value="AUD">AUD - Australian Dollar</option>
                            <option value="GNF">GNF - Guinean Franc</option>
                            <!-- Add more currencies as needed -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modalMinSalary">Min Salary <span class="required">*</span></label>
                        <input type="number" id="modalMinSalary" class="form-control" placeholder="e.g., 50000" required step="100">
                    </div>
                    <div class="form-group">
                        <label for="modalMidSalary">Midpoint Salary</label>
                        <input type="number" id="modalMidSalary" class="form-control" placeholder="e.g., 65000" step="100">
                    </div>
                    <div class="form-group">
                        <label for="modalMaxSalary">Max Salary <span class="required">*</span></label>
                        <input type="number" id="modalMaxSalary" class="form-control" placeholder="e.g., 80000" required step="100">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="modalSalaryNotes">Notes</label>
                        <textarea id="modalSalaryNotes" class="form-control" rows="3" placeholder="Additional notes about this salary grade..."></textarea>
                    </div>
                </div>
                <div style="text-align: right; padding: 1rem 2rem; border-top: 1px solid #dee2e6;">
                    <button type="button" class="btn btn-secondary" onclick="closeSalaryGradeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveSalaryGradeBtn">Save Salary Grade</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Salary Band Modal -->
    <div id="salaryBandModal" class="applicant-modal">
        <div class="applicant-modal-content" style="max-width: 760px;"> <!-- Slightly wider for tag input -->
            <div class="applicant-modal-header">
                <h3 class="applicant-modal-title" id="salaryBandModalTitle">Add Salary Band</h3>
                <button class="close-modal" onclick="closeSalaryBandModal()">&times;</button>
            </div>
            <form id="salaryBandForm">
                <div class="applicant-modal-body">
                    <input type="hidden" id="salaryBandId">
                    <div class="form-group">
                        <label for="bandNameInput">Band Name <span class="required">*</span></label>
                        <input type="text" id="bandNameInput" class="form-control" placeholder="e.g., Senior Technical Band" required>
                    </div>
                    <div class="form-group" style="grid-column:1 / -1;">
                        <label>Job Titles in Band <span class="required">*</span></label>
                        <div style="display:flex;gap:.5rem;align-items:flex-start;">
                            <select id="bandJobTitleDropdown" class="form-control" style="flex:1;">
                                <option value="">Select a job title to add...</option>
                                <!-- Job titles will be populated by JS -->
                            </select>
                            <button type="button" id="addJobTitleBtn" class="btn btn-secondary" style="white-space:nowrap;">Add Title</button>
                        </div>
                        <div id="bandJobTitlesContainer" class="tag-input-container" style="display:flex;flex-wrap:wrap;gap:.4rem;padding:.5rem;border:1px solid #ced4da;border-radius:6px;min-height:52px; background:#fff;margin-top:.5rem;">
                            <!-- Tags inserted here -->
                        </div>
                        <small style="color:#666;display:block;margin-top:.3rem;">Select job titles from the dropdown and click "Add Title". Click a tag's × to remove. Duplicates ignored.</small>
                    </div>
                    <div class="form-group">
                        <label for="bandCurrencySelect">Currency <span class="required">*</span></label>
                        <select id="bandCurrencySelect" class="form-control" required>
                            <option value="USD">USD - US Dollar</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="GBP">GBP - British Pound</option>
                            <option value="CAD">CAD - Canadian Dollar</option>
                            <option value="AUD">AUD - Australian Dollar</option>
                            <option value="GNF">GNF - Guinean Franc</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bandMinSalary">Min Salary <span class="required">*</span></label>
                        <input type="number" id="bandMinSalary" class="form-control" placeholder="e.g., 50000" required step="100">
                    </div>
                    <div class="form-group">
                        <label for="bandMidSalary">Midpoint Salary</label>
                        <input type="number" id="bandMidSalary" class="form-control" placeholder="e.g., 65000" step="100">
                    </div>
                    <div class="form-group">
                        <label for="bandMaxSalary">Max Salary <span class="required">*</span></label>
                        <input type="number" id="bandMaxSalary" class="form-control" placeholder="e.g., 80000" required step="100">
                    </div>
                    <div class="form-group" style="grid-column:1 / -1;">
                        <label for="bandNotes">Notes</label>
                        <textarea id="bandNotes" class="form-control" rows="3" placeholder="Optional notes about this salary band..."></textarea>
                    </div>
                </div>
                <div style="text-align:right;padding:1rem 2rem;border-top:1px solid #dee2e6;">
                    <button type="button" class="btn btn-secondary" onclick="closeSalaryBandModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveSalaryBandBtn">Save Salary Band</button>
                </div>
            </form>
        </div>
    </div>

    <div class="app-container">
        <!-- Sidebar Menu -->
        <nav class="sidebar menu-loading">
            <div class="logo">
                <h2>Dreamex Datalab</h2>
            </div>
            <ul class="menu" id="roleBasedMenu">
                <li class="menu-item" data-feature="home_view" data-requires-permission="home_view">
                    <a href="index.html"><i class="fas fa-home"></i> Home</a>
                </li>
                <li class="menu-dropdown" data-feature="health_view" data-requires-permission="health_view">
                    <a href="#"><i class="fas fa-medkit"></i> Health</a>
                    <ul class="submenu">
                        <li data-feature="health_assessment_view" data-requires-permission="health_assessment_view">
                            <a href="health-assessment.html">Assessment</a>
                        </li>
                        <li data-feature="health_consultation_view" data-requires-permission="health_consultation_view">
                            <a href="health-consultation.html">Consultation</a>
                        </li>
                        <li data-feature="medical_folder_view" data-requires-permission="medical_folder_view">
                            <a href="medical-folder.html">Medical Folder</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="safety_view" data-requires-permission="safety_view">
                    <a href="#"><i class="fas fa-shield-alt"></i> Safety</a>
                    <ul class="submenu">
                        <li data-feature="training_view" data-requires-permission="training_view"><a href="trainingboard.html">Training</a></li>
                        <li data-feature="risk_view" data-requires-permission="risk_view"><a href="riskboard.html">Risk Management</a></li>
                        <li data-feature="jsa_view" data-requires-permission="jsa_view"><a href="jsaboard.html">Job Safety Analysis</a></li>
                        <li data-feature="ptw_view" data-requires-permission="ptw_view"><a href="ptwboard.html">Permit to Work</a></li>
                        <li data-feature="incident_view" data-requires-permission="incident_view"><a href="incidentboard.html">Incident Reports</a></li>
                        <li data-feature="inspection_view" data-requires-permission="inspection_view"><a href="inspectionboard.html">Inspection</a></li>
                        <li data-feature="audit_view" data-requires-permission="audit_view"><a href="auditboard.html">Audit</a></li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="fuel_management" data-requires-permission="fuel_management">
                    <a href="#"><i class="fas fa-gas-pump"></i> Fuel Management</a>
                    <ul class="submenu">
                        <li data-feature="vessel_offloading" data-requires-permission="vessel_offloading"><a href="vessel-offloading.html">Vessel Offloading</a></li>
                        <li data-feature="fuel_storage" data-requires-permission="fuel_storage"><a href="fuelstor.html">Fuel Storage Status</a></li>
                        <li data-feature="tank_transfer" data-requires-permission="tank_transfer"><a href="tank-transfer.html">Tank-to-Tank Transfer</a></li>
                        <li data-feature="truck_loading" data-requires-permission="truck_loading"><a href="fuel-truck-loading.html">Fuel Truck Loading</a></li>
                        <li data-feature="quality_analysis" data-requires-permission="quality_analysis"><a href="fuel-quality-analysis.html">Fuel Quality Analysis</a></li>
                        <li data-feature="fuel_distribution" data-requires-permission="fuel_distribution"><a href="fueldist.html">Fuel Distribution</a></li>
                        <li data-feature="fuel_consumption_analysis" data-requires-permission="fuel_consumption_analysis"><a href="fuelanalys.html">Consumption Analysis</a></li>
                        <li data-feature="fuel_daily_report" data-requires-permission="fuel_daily_report"><a href="fueldaily.html">Daily Fuel Report</a></li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="environment_view" data-requires-permission="environment_view">
                    <a href="#"><i class="fas fa-leaf"></i> Environment</a>
                    <ul class="submenu">
                        <li data-feature="water_view" data-requires-permission="water_view"><a href="waterboard.html">Water Quality</a></li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="security_view" data-requires-permission="security_view">
                    <a href="#"><i class="fas fa-lock"></i> Security</a>
                    <ul class="submenu">
                        <li data-feature="access_view" data-requires-permission="access_view"><a href="accessboard.html">Access Request</a></li>
                        <li data-feature="access_daily_view" data-requires-permission="access_daily_view"><a href="accessdaily.html">Daily Access Control</a></li>
                        <li data-feature="removal_view" data-requires-permission="removal_view"><a href="removalboard.html">Property Removal</a></li>
                    
						<li data-feature="security_level_evaluation_view" data-requires-permission="security_level_evaluation_view"><a href="seclevel.html">Security Level Evaluation</a></li></ul>
                </li>
                <li class="menu-dropdown" data-feature="logistics_view" data-requires-permission="logistics_view">
                    <a href="#"><i class="fas fa-truck"></i> Logistics</a>
                    <ul class="submenu">
                        <li data-feature="fleet_view" data-requires-permission="fleet_view"><a href="fleet.html">Fleet Management</a></li>
                        <li data-feature="travel_view" data-requires-permission="travel_view"><a href="travel.html">Travel Requests</a></li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="accommodation_view" data-requires-permission="accommodation_view">
                    <a href="#"><i class="fas fa-bed"></i> Accommodation</a>
                    <ul class="submenu">
                        <li data-feature="camp_view" data-requires-permission="camp_view"><a href="camp.html">Camp Management</a></li>
                        <li data-feature="camp_settings_view" data-requires-permission="camp_settings_view"><a href="campset.html">Camp Settings</a></li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="hr_view" data-requires-permission="hr_view">
                    <a href="#"><i class="fas fa-users"></i> HR</a>
                    <ul class="submenu">
                        <li data-feature="human_hr_view" data-requires-permission="human_hr_view"><a href="human-hr.html"><i class="fas fa-user-tie"></i> Human HR</a></li>
                        <li data-feature="staff_management_view" data-requires-permission="staff_management_view"><a href="staff.html">Staffing</a></li>
                        <li data-feature="authority_to_recruit_view" data-requires-permission="authority_to_recruit_view"><a href="recruit.html">Authority to Recruit</a></li>
                        <li data-feature="job_advertising_view" data-requires-permission="job_advertising_view"><a href="jobpost.html">Job Advertising</a></li>
                        <li data-feature="screening_view" data-requires-permission="screening_view"><a href="jobscreen.html">Screening</a></li>
                        <li data-feature="interview_view" data-requires-permission="interview_view"><a href="interview.html">Interview</a></li>
                        <li data-feature="offer_view" data-requires-permission="offer_view"><a href="offer.html">Offer Management</a></li>
                        <li data-feature="contract_view" data-requires-permission="contract_view"><a href="contract.html">Contract Management</a></li>
                        <li data-feature="onboarding_view" data-requires-permission="onboarding_view"><a href="onboard.html">Onboarding</a></li>
                        <li data-feature="salary_management_view" data-requires-permission="salary_management_view"><a href="salary.html" class="active">Salary Management</a></li>
                        <li data-feature="chart_view" data-requires-permission="chart_view"><a href="chart.html">Chart Setup</a></li>
                        <li data-feature="chartboard_view" data-requires-permission="chartboard_view"><a href="chartboard.html">Org Chart</a></li>
                        <li data-feature="kpi_dashboard_view" data-requires-permission="kpi_dashboard_view"><a href="kpi.html">KPI</a></li>
                        <li data-feature="action_plan_view" data-requires-permission="action_plan_view"><a href="actionplan.html"><i class="fas fa-tasks"></i> Action Plan Board</a></li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="project_management_view" data-requires-permission="project_management_view">
                    <a href="#"><i class="fas fa-project-diagram"></i> Project Management</a>
                    <ul class="submenu">
                        <li data-feature="project_dashboard_view" data-requires-permission="project_dashboard_view"><a href="project-dashboard.html">Project Dashboard</a></li>
                        <li data-feature="project_create_view" data-requires-permission="project_create_view"><a href="project-create.html">Create Project</a></li>
                        <li data-feature="project_list_view" data-requires-permission="project_list_view"><a href="project-list.html">Project List</a></li>
                        <li data-feature="task_management_view" data-requires-permission="task_management_view"><a href="tasks.html">Task Management</a></li>
                        <li data-feature="milestone_tracking_view" data-requires-permission="milestone_tracking_view"><a href="milestones.html">Milestone Tracking</a></li>
                        <li data-feature="resource_allocation_view" data-requires-permission="resource_allocation_view"><a href="resources.html">Resource Allocation</a></li>
                        <li data-feature="project_reports_view" data-requires-permission="project_reports_view"><a href="project-reports.html">Project Reports</a></li>
                        <li data-feature="gantt_chart_view" data-requires-permission="gantt_chart_view"><a href="gantt-chart.html">Gantt Chart</a></li>
                    </ul>
                </li>
                <li data-feature="communication_view" data-requires-permission="communication_view"><a href="info.html"><i class="fas fa-comments"></i> Communication</a></li>
                <li class="menu-dropdown" data-feature="settings_view" data-requires-permission="settings_view">
                    <a href="#"><i class="fas fa-cog"></i> Settings</a>
                    <ul class="submenu">
                        <li data-feature="account_settings_view" data-requires-permission="account_settings_view"><a href="account.html">Account Settings</a></li>
                        <li data-feature="company_management_view" data-requires-permission="company_management_view"><a href="companymanagement.html">Company Management</a></li>
                        <li data-feature="approval_settings_view" data-requires-permission="approval_settings_view"><a href="approval-settings.html">Approval Flow Settings</a></li>
                        <li data-feature="field_setup_view" data-requires-permission="field_setup_view"><a href="fieldsetup.html">Field Setup</a></li>
                        <li data-feature="preferences_view" data-requires-permission="preferences_view"><a href="preferences.html">Preferences</a></li>
                        <li data-feature="notification_settings_view" data-requires-permission="notification_settings_view"><a href="notification-settings.html">Notification Settings</a></li>
                        <li data-feature="audit_log_view" data-requires-permission="audit_log_view"><a href="auditlog.html"><i class="fas fa-history"></i> Audit Log</a></li>
                        <li data-feature="user_management_view" data-requires-permission="user_management_view"><a href="users.html">User & Role Management</a></li>
                        <li data-feature="role_permissions_view" data-requires-permission="role_permissions_view"><a href="roles.html">Role Permissions</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Navigation (reused) -->
            <header class="top-nav">
                <div class="top-nav-left">
                    <button id="sidebarToggle" class="sidebar-toggle-btn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <img id="headerCompanyLogo" class="header-company-logo" src="" alt="Company Logo">
                    <div id="headerLogoPlaceholder" class="header-logo-placeholder">
                        <i class="fas fa-building"></i>
                    </div>
                    <span id="headerCompanyName" class="company-name-header"></span>
                </div>
                <div class="top-nav-right">
                    <div class="notifications">
                        <button id="notificationBtn" class="notification-btn">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">0</span>
                        </button>
                        <div class="notification-dropdown">
                            <div class="notification-header">
                                <h3>Notifications</h3>
                                <button class="mark-all-read">Mark all as read</button>
                            </div>
                            <div class="notification-list">
                                <!-- Notifications will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                    <div class="user-profile">
                        <button id="userProfileBtn" class="profile-btn">
                            <img id="userAvatar" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMzNDk4ZGIiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0yMCAyMXYtMmE0IDQgMCAwIDAtNC00SDhhNCA0IDAgMCAwLTQgNHYyIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo8L3N2Zz4K" alt="User Avatar">
                        </button>
                        <div class="profile-dropdown">
                            <ul>
                                <li><a href="account.html"><i class="fas fa-user"></i> Account Settings</a></li>
                                <li><a href="#"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>
            <!-- Page Content -->
            <div class="content">
                <div class="interview-container"> <!-- Class name kept for CSS consistency -->
                    <!-- Page Header -->
                    <div class="page-header">
                        <div style="display: flex; align-items: center; gap: 0.6rem;">
                            <i class="fas fa-coins"></i>
                            <span>Salary Management</span>
                        </div>
                        <div class="page-actions">
                            <button type="button" class="btn-add-new" onclick="openSalaryGradeModal()" title="Add New Salary Grade">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Content Tabs Layout -->
                    <div class="content-tabs">
                        <!-- Tab Navigation -->
                        <div class="tab-navigation">
                            <button class="tab-nav-btn active" id="salaryGridTabBtn" onclick="switchToTab('salaryGrid')">
                                <i class="fas fa-table"></i>
                                Salary Grid
                            </button>
                            <button class="tab-nav-btn" id="salaryBandsTabBtn" onclick="switchToTab('salaryBands')">
                                <i class="fas fa-layer-group"></i>
                                Salary Bands
                            </button>
                        </div>

                        <!-- Salary Grid Tab Content -->
                        <div class="tab-content active" id="salaryGridTabContent">
                            <div class="tab-controls">
                                <div class="search-export-row">
                                    <div class="search-wrapper">
                                        <i class="fas fa-search search-icon"></i>
                                        <input type="text" class="search-input" id="salaryGridSearchInput" placeholder="Search by job title, department, grade..." oninput="filterSalaryGrid()">
                                    </div>
                                    <div>
                                        <button class="btn btn-secondary" id="exportSalaryGridBtn" aria-label="Export Salary Grid" title="Export Salary Grid" onclick="exportSalaryGrid()" style="display:inline-flex;align-items:center;justify-content:center;width:42px;height:42px;padding:0;">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                                <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 12px; margin: 16px 0; border-radius: 4px;">
                                    <p style="margin: 0; color: #1565c0; font-weight: 500;">
                                        <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                                        This is a read-only view of all job titles with their salary information. To modify salary data, use the <strong>Salary Bands</strong> tab to create bands that automatically populate this grid.
                                    </p>
                                </div>
                            </div>
                            <div class="table-container">
                                <div class="loading-state" id="salaryGridLoadingState">
                                    <div class="spinner"></div>
                                    <p>Loading salary grades...</p>
                                </div>
                                <table class="jobs-table" id="salaryGridTable" style="display: none;"> <!-- Reusing .jobs-table for styling -->
                                    <thead>
                                        <tr>
                                            <th>Job Title</th>
                                            <th>Department</th>
                                            <th>Salary Grade</th>
                                            <th>Min Salary</th>
                                            <th>Mid Salary</th>
                                            <th>Max Salary</th>
                                            <th>Currency</th>
                                            <th>Last Updated</th>
                                            <th>Data Source</th>
                                        </tr>
                                    </thead>
                                    <tbody id="salaryGridTableBody">
                                        <!-- Salary grades will be populated here -->
                                    </tbody>
                                </table>
                                <div class="empty-state d-none" id="salaryGridEmptyState">
                                    <i class="fas fa-dollar-sign"></i>
                                    <h3>No Salary Grades Defined</h3>
                                    <p>Start by adding salary grades for different job roles.</p>
                                </div>
                                <div class="pagination d-none" id="salaryGridPagination">
                                    </div>
                            </div>
                        </div>

                        <!-- Salary Bands Tab Content -->
                        <div class="tab-content" id="salaryBandsTabContent">
                            <div class="tab-controls">
                                <div class="search-export-row" style="justify-content: space-between; align-items:center;">
                                    <div class="search-wrapper">
                                        <i class="fas fa-search search-icon"></i>
                                        <input type="text" class="search-input" id="salaryBandsSearchInput" placeholder="Search by band name or job title..." oninput="filterSalaryBands()">
                                    </div>
                                    <div style="display:flex; gap:.5rem;">
                                        <button class="btn btn-secondary" id="addSalaryBandBtn" title="Add Salary Band" onclick="openSalaryBandModal()" style="display:inline-flex;align-items:center;justify-content:center;width:42px;height:42px;padding:0;">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <button class="btn btn-secondary" id="exportSalaryBandsBtn" aria-label="Export Salary Bands" title="Export Salary Bands" onclick="exportSalaryBands()" style="display:inline-flex;align-items:center;justify-content:center;width:42px;height:42px;padding:0;">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-container">
                                <div class="loading-state" id="salaryBandsLoadingState" style="display:none;">
                                    <div class="spinner"></div>
                                    <p>Loading salary bands...</p>
                                </div>
                                <table class="jobs-table" id="salaryBandsTable" style="display:none;">
                                    <thead>
                                        <tr>
                                            <th>Band Name</th>
                                            <th>Job Titles</th>
                                            <th>Min Salary</th>
                                            <th>Mid Salary</th>
                                            <th>Max Salary</th>
                                            <th>Currency</th>
                                            <th>Last Updated</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="salaryBandsTableBody"></tbody>
                                </table>
                                <div class="empty-state d-none" id="salaryBandsEmptyState">
                                    <i class="fas fa-layer-group"></i>
                                    <h3>No Salary Bands Defined</h3>
                                    <p>Create bands to group related job titles under shared salary ranges.</p>
                                </div>
                                <div class="pagination d-none" id="salaryBandsPagination"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase Scripts (reused) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

    <script>
        // Firebase Configuration (reused)
        const firebaseConfig = {
            apiKey: "AIzaSyCUTmTn0rRBb0M-UkQJxnUMrWqXYU_BgIc",
            authDomain: "users-8be65.firebaseapp.com",
            databaseURL: "https://users-8be65-default-rtdb.firebaseio.com",
            projectId: "users-8be65",
            storageBucket: "users-8be65.firebasestorage.app",
            messagingSenderId: "829083030831",
            appId: "1:829083030831:web:36a370e62691e560bc3dda"
        };

        // Initialize Firebase (reused)
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        const storage = firebase.storage();

        // Company context for profile management
        let companyContext = null;
        let currentCompany = null;

        // Role-based authentication system (similar to riskboard.html)
        class SalaryAuthManager {
            constructor() {
                this.currentUser = null;
                this.init();
            }

            init() {
                console.log('🔧 Initializing SalaryAuthManager...');
                firebase.auth().onAuthStateChanged(async (user) => {
                    if (user) {
                        console.log('✅ User authenticated:', user.email);
                        this.currentUser = await this.loadUserData(user);
                        await this.initializeUIAfterAuth();
                    } else {
                        console.log('❌ User not authenticated, redirecting to login');
                        window.location.href = 'login.html';
                    }
                });
            }

            async loadUserData(user) {
                try {
                    const userSnapshot = await database.ref(`users/${user.uid}`).once('value');
                    if (userSnapshot.exists()) {
                        const userData = userSnapshot.val();
                        return {
                            uid: user.uid,
                            email: user.email,
                            displayName: user.displayName || userData.name || user.email.split('@')[0],
                            companyId: userData.companyId || userData.company,
                            role: userData.role,
                            ...userData
                        };
                    }
                    return user;
                } catch (error) {
                    console.error('Error loading user data:', error);
                    return user;
                }
            }

            async initializeUIAfterAuth() {
                if (!this.currentUser) {
                    console.warn('No user -> redirect login');
                    location.href = 'login.html';
                    return;
                }
                console.log('✅ User:', this.currentUser.email);

                this.loadUserRole(this.currentUser);
                this.loadUserCompany();

                // Add small delay to ensure DOM is fully ready
                setTimeout(() => {
                    console.log('🔄 Starting UI updates...');
                    this.updateUIForAuthenticatedUser();
                    this.updateMenuVisibility();
                    this.bindProfileDropdown();
                    
                    // Initialize salary page functionality after authentication
                    this.initializeSalaryPageAfterAuth();
                    console.log('✅ UI initialization complete');
                }, 100);
            }

            loadUserRole(user) {
                // Implementation for loading user role
                console.log('👤 User role:', user.role);
            }

            loadUserCompany() {
                // Implementation for loading company data
                if (this.currentUser?.companyId) {
                    companyContext = this.currentUser.companyId;
                    loadCompanyData();
                }
            }

            updateUIForAuthenticatedUser() {
                updateUIForAuthenticatedUser(this.currentUser);
            }

            bindProfileDropdown() {
                console.log('🔗 bindProfileDropdown called');
                const btn = document.getElementById('userProfileBtn');
                const dd = document.querySelector('.profile-dropdown');
                console.log('🔍 Elements found:', { btn: !!btn, dropdown: !!dd });
                if (btn && dd) {
                    console.log('✅ Binding profile dropdown events');
                    btn.addEventListener('click', e => {
                        console.log('🖱️ Profile button clicked');
                        e.stopPropagation();
                        dd.classList.toggle('show');
                        console.log('📋 Dropdown toggled, show class:', dd.classList.contains('show'));
                    });
                    document.addEventListener('click', e => {
                        if (!btn.contains(e.target)) {
                            dd.classList.remove('show');
                            console.log('🖱️ Clicked outside, hiding dropdown');
                        }
                    });
                    const logoutLink = dd.querySelector('a[href="#"]:has(.fa-sign-out-alt)') || dd.querySelector('.fa-sign-out-alt')?.closest('a');
                    if (logoutLink) {
                        logoutLink.addEventListener('click', e => {
                            e.preventDefault();
                            this.logout();
                        });
                    }
                } else {
                    console.error('❌ Missing elements for profile dropdown:', { btn, dd });
                }
            }

            logout() {
                firebase.auth().signOut().then(() => {
                    window.location.href = 'login.html';
                }).catch((error) => {
                    console.error('Logout error:', error);
                });
            }

            resetMenuVisibility() {
                document.querySelectorAll('[data-feature]').forEach(i => i.classList.remove('menu-visible'));
                document.querySelectorAll('.menu-dropdown').forEach(d => d.classList.remove('menu-visible'));
            }

            async updateMenuVisibility() {
                console.log('🎯 Starting feature-based menu authorization for salary.html...');
                const sidebar = document.querySelector('.sidebar');
                if (!this.currentUser) {
                    console.log('⚠️ No authenticated user - applying fallback menu visibility');
                    this.applyFallbackMenuVisibility();
                    sidebar?.classList.remove('menu-loading');
                    return;
                }
                const companyId = this.currentUser.companyId;
                const userRole = this.currentUser.role;
                console.log('👤 User:', this.currentUser.email, 'Company ID:', companyId, 'Role:', userRole);
                if (!companyId) {
                    console.log('⚠️ No company ID - applying fallback menu visibility');
                    this.applyFallbackMenuVisibility();
                    sidebar?.classList.remove('menu-loading');
                    return;
                }

                // STEP 1: Apply company feature-based authorization
                console.log('🏢 STEP 1: Applying company feature authorization...');
                const authorizedPages = await this.applyFeatureBasedMenuVisibility(companyId);

                // STEP 2: Filter by user role permissions within authorized features
                if (userRole && authorizedPages && authorizedPages.length > 0) {
                    console.log('👤 STEP 2: Applying role-based filtering within authorized features...');
                    await this.applyRoleBasedFiltering(companyId, userRole, authorizedPages);
                } else {
                    console.log('⚠️ STEP 2: No authorized pages or role - applying fallback menu visibility');
                    this.applyFallbackMenuVisibility();
                    sidebar?.classList.remove('menu-loading');
                }
            }

            // Fallback: Show all menu items for development/testing
            applyFallbackMenuVisibility() {
                console.log('🔧 Applying fallback menu visibility (showing all items)...');
                this.resetMenuVisibility();
                
                // Show all menu items
                document.querySelectorAll('li[data-feature]').forEach(item => {
                    item.classList.add('menu-visible');
                });
                
                // Show all dropdown menus
                document.querySelectorAll('li.menu-dropdown').forEach(dropdown => {
                    dropdown.classList.add('menu-visible');
                });
                
                console.log('✅ Fallback menu visibility applied - all items visible');
            }

            async applyFeatureBasedMenuVisibility(companyId) {
                try {
                    console.log('🔧 Applying feature-based menu visibility for company:', companyId);
                    const database = firebase.database();
                    const featuresSnapshot = await database.ref('/platformFeatures').once('value');
                    if (!featuresSnapshot.exists()) {
                        console.log('⚠️ No platform features found - applying fallback');
                        this.applyFallbackMenuVisibility();
                        return [];
                    }
                    const featuresData = featuresSnapshot.val();
                    const companySnapshot = await database.ref(`/companies/${companyId}`).once('value');
                    const companyData = companySnapshot.val();
                    if (!companyData) {
                        console.error('❌ Company data not found - applying fallback');
                        this.applyFallbackMenuVisibility();
                        return [];
                    }
                    const subscribed = companyData.selectedFeatures || [];
                    console.log('🏢 Company subscribed features:', subscribed);
                    if (subscribed.length === 0) {
                        console.log('⚠️ Company has no subscribed features - applying fallback');
                        this.applyFallbackMenuVisibility();
                        return [];
                    }
                    const authorizedPages = [];
                    subscribed.forEach(fid => {
                        const f = featuresData[fid];
                        if (f && f.status === 'active' && f.authorizedPages) {
                            console.log(`📦 Adding pages from feature "${f.name}":`, f.authorizedPages);
                            authorizedPages.push(...f.authorizedPages);
                        } else {
                            console.log(`⚠️ Feature ${fid} not found or inactive`);
                        }
                    });
                    console.log('🔐 All authorized pages from company features:', authorizedPages);
                    const authorizedFeatures = new Set();
                    authorizedPages.forEach(p => {
                        if (p.feature) authorizedFeatures.add(p.feature);
                    });
                    console.log('🎯 Authorized features for salary.html:', Array.from(authorizedFeatures));
                    this.resetMenuVisibility();
                    let visibleCount = 0;
                    document.querySelectorAll('li[data-feature]').forEach(item => {
                        const feature = item.getAttribute('data-feature');
                        const isDropdownContainer = item.classList.contains('menu-dropdown');

                        if (isDropdownContainer) {
                            return; // Handle dropdowns separately after all items are processed
                        }

                        if (authorizedFeatures.has(feature)) {
                            item.classList.add('menu-visible');
                            visibleCount++;
                            console.log(`✅ Feature authorized - showing menu item: ${feature}`);
                        } else {
                            console.log(`❌ Feature not authorized - hiding menu item: ${feature}`);
                        }
                    });
                    // Handle dropdown menus - show if they have visible children
                    document.querySelectorAll('li.menu-dropdown').forEach(drop => {
                        const feature = drop.getAttribute('data-feature');
                        const hasVisible = [...drop.querySelectorAll('.submenu li[data-feature]')].some(li => li.classList.contains('menu-visible'));
                        if (hasVisible || authorizedFeatures.has(feature)) {
                            drop.classList.add('menu-visible');
                            console.log(`✅ Showing dropdown menu: ${feature} (has visible children or directly authorized)`);
                        } else {
                            console.log(`❌ Hiding dropdown menu: ${feature} (no visible children and not authorized)`);
                        }
                    });
                    console.log(`🎯 Company feature authorization completed - ${visibleCount} items initially visible`);
                    // Return authorized pages for role-based filtering
                    return authorizedPages;
                } catch (e) {
                    console.error('❌ Error applying feature-based menu visibility:', e);
                    console.log('🔧 Applying fallback menu visibility due to error');
                    this.applyFallbackMenuVisibility();
                    return [];
                }
            }

            // Apply role-based filtering within company authorized features
            async applyRoleBasedFiltering(companyId, userRole, authorizedPages) {
                try {
                    console.log('👤 Applying role-based filtering for role:', userRole);

                    // Get user role permissions from company
                    const database = firebase.database();
                    const permissionsRef = database.ref(`companies/${companyId}/roles/${userRole}/permissions`);
                    const permissionsSnapshot = await permissionsRef.once('value');

                    if (!permissionsSnapshot.exists()) {
                        console.log(`⚠️ No permissions found for role ${userRole} in company ${companyId}`);

                        // CRITICAL: If user is administrator but no permissions found, provide full access as fallback
                        if (userRole === 'administrator') {
                            console.log('🔑 ADMINISTRATOR FALLBACK - Skipping role filtering (keeping all company features visible)');
                            this.showSidebarAfterAuth();
                            return;
                        }

                        // For other roles without permissions, hide all items with permission requirements
                        console.log('❌ No valid permissions found - filtering out items requiring permissions');
                        this.hideItemsRequiringPermissions();
                        this.showSidebarAfterAuth();
                        return;
                    }

                    const permissions = permissionsSnapshot.val();
                    console.log('✅ Loaded role permissions:', permissions);

                    // Apply permission-based filtering
                    this.filterMenuByPermissions(permissions);

                } catch (error) {
                    console.error('❌ Error applying role-based filtering:', error);
                    // Don't hide everything on error - keep company features visible
                    this.showSidebarAfterAuth();
                }
            }

            // Filter menu items based on user permissions
            filterMenuByPermissions(permissions) {
                console.log('🔍 Filtering menu items by user permissions...');

                const menuItemsWithPermissions = document.querySelectorAll('li.menu-visible[data-requires-permission]');
                let hiddenCount = 0;

                menuItemsWithPermissions.forEach(item => {
                    const feature = item.getAttribute('data-feature');
                    const requiredPermission = item.getAttribute('data-requires-permission');

                    // Check if user has the required permission
                    const hasPermission = this.checkFeaturePermission(permissions, feature, requiredPermission);

                    if (!hasPermission) {
                        item.classList.remove('menu-visible');
                        hiddenCount++;
                        console.log(`❌ Hiding menu item (no permission): ${feature} (requires ${requiredPermission})`);
                    } else {
                        console.log(`✅ Keeping menu item (has permission): ${feature}`);
                    }
                });

                // Re-evaluate dropdown visibility after permission filtering
                document.querySelectorAll('li.menu-dropdown.menu-visible').forEach(dropdown => {
                    const hasVisibleChildren = [...dropdown.querySelectorAll('.submenu li[data-feature]')].some(li => li.classList.contains('menu-visible'));

                    if (!hasVisibleChildren) {
                        dropdown.classList.remove('menu-visible');
                        hiddenCount++;
                        console.log(`❌ Hiding dropdown (no visible children after permission filtering): ${dropdown.getAttribute('data-feature')}`);
                    }
                });

                console.log(`🎯 Role-based filtering completed - ${hiddenCount} items hidden due to lack of permissions`);

                // Show sidebar after all filtering is complete
                this.showSidebarAfterAuth();

                // Safeguard: if nothing visible, fallback to showing all (dev parity with riskboard fallback pattern)
                if (!document.querySelector('[data-feature].menu-visible')) {
                    console.warn('⚠️ No menu items visible after permission filtering – applying fallback menu visibility');
                    this.applyFallbackMenuVisibility();
                }
            }

            // Check if user has permission for a specific feature
            checkFeaturePermission(permissions, feature, requiredPermission) {
                if (!permissions || !feature) return false;
                const featurePermissions = permissions[feature];
                if (!featurePermissions) {
                    return false;
                }
                // Primary pattern: object with .view boolean (riskboard style)
                if (featurePermissions && featurePermissions.view === true) return true;
                // Legacy direct boolean
                if (featurePermissions === true) return true;
                // Direct flag match
                if (requiredPermission && featurePermissions[requiredPermission] === true) return true;
                return false;
            }

            // Hide menu items that require permissions (for users without role permissions)
            hideItemsRequiringPermissions() {
                console.log('🔒 Hiding all menu items that require permissions...');

                const itemsRequiringPermissions = document.querySelectorAll('li.menu-visible[data-requires-permission]');
                let hiddenCount = 0;

                itemsRequiringPermissions.forEach(item => {
                    const feature = item.getAttribute('data-feature');
                    const requiresPermission = item.getAttribute('data-requires-permission');

                    item.classList.remove('menu-visible');
                    hiddenCount++;
                    console.log(`❌ Hiding menu item (requires permission): ${feature} (${requiresPermission})`);
                });

                console.log(`🔒 Hidden ${hiddenCount} items requiring permissions`);
            }

            // Show sidebar and remove loading state after authentication and filtering
            showSidebarAfterAuth() {
                const sidebar = document.querySelector('.sidebar');
                if (sidebar) {
                    sidebar.classList.remove('menu-loading');
                    console.log('✅ Sidebar loading state removed - menu authorization complete');
                }
            }

            // Initialize salary page functionality after authentication
            async initializeSalaryPageAfterAuth() {
                console.log('🔧 Initializing salary page after authentication...');
                try {
                    // Initialize salary page specific functionality
                    await initializeSalaryPage();
                    console.log('✅ Salary page initialization complete');
                } catch (error) {
                    console.error('❌ Error initializing salary page:', error);
                }
            }
        }

        // Initialize the role-based authentication system
        const salaryAuthManager = new SalaryAuthManager();

        // Initialize company context
        async function initializeCompanyContext() {
            try {
                const user = firebase.auth().currentUser;
                if (user) {
                    // Get user's company context from database
                    const userSnapshot = await database.ref(`users/${user.uid}`).once('value');
                    if (userSnapshot.exists()) {
                        const userData = userSnapshot.val();
                        companyContext = userData.companyId || userData.company || 'default';
                        console.log('Company context initialized:', companyContext);
                        
                        // Load company data
                        await loadCompanyData();
                    }
                }
            } catch (error) {
                console.error('Error initializing company context:', error);
                companyContext = 'default';
            }
        }

        // Load company data and update header
        async function loadCompanyData() {
            try {
                if (!companyContext || companyContext === 'default') {
                    // Set default company info
                    updateCompanyHeader('Dreamex Datalab', null);
                    return;
                }

                // Try to load company data from database
                const companySnapshot = await database.ref(`companies/${companyContext}`).once('value');
                if (companySnapshot.exists()) {
                    currentCompany = companySnapshot.val();
                    console.log('✅ Company data found:', currentCompany.companyName);
                    
                    // Update company logo and name in header
                    updateCompanyHeader(currentCompany.companyName, currentCompany.logoUrl || currentCompany.logo);
                    
                    // Update page title if needed
                    const title = document.title;
                    if (title.includes('Dreamex Datalab HSE')) {
                        document.title = title.replace('Dreamex Datalab HSE', `${currentCompany.companyName} HSE`);
                        console.log('✅ Page title updated');
                    }
                } else {
                    console.log('ℹ️ No company data found, using default');
                    updateCompanyHeader('Dreamex Datalab', null);
                }
            } catch (error) {
                console.error('Error loading company data:', error);
                updateCompanyHeader('Dreamex Datalab', null);
            }
        }

        // Update company header with logo and name
        function updateCompanyHeader(companyName, logoUrl) {
            const headerLogo = document.getElementById('headerCompanyLogo');
            const headerLogoPlaceholder = document.getElementById('headerLogoPlaceholder');
            const headerCompanyName = document.getElementById('headerCompanyName');

            console.log('Header elements found:', {
                logo: headerLogo ? '✅' : '❌',
                placeholder: headerLogoPlaceholder ? '✅' : '❌',
                companyName: headerCompanyName ? '✅' : '❌'
            });

            // Update company name
            if (headerCompanyName) {
                headerCompanyName.textContent = companyName || 'Dreamex Datalab';
                console.log('✅ Company name updated:', headerCompanyName.textContent);
            }

            // Update logo or show placeholder
            if (logoUrl) {
                console.log('✅ Company logo URL found:', logoUrl);
                
                if (headerLogo) {
                    headerLogo.src = logoUrl;
                    headerLogo.style.display = 'block';
                    headerLogo.classList.add('visible');
                    console.log('✅ Company logo displayed');
                }
                
                if (headerLogoPlaceholder) {
                    headerLogoPlaceholder.style.display = 'none';
                    console.log('✅ Logo placeholder hidden');
                }
            } else {
                console.log('ℹ️ No company logo URL, showing placeholder');
                // Show placeholder if no logo
                if (headerLogoPlaceholder) {
                    headerLogoPlaceholder.style.display = 'flex';
                    console.log('✅ Logo placeholder shown');
                }
                
                if (headerLogo) {
                    headerLogo.style.display = 'none';
                    console.log('✅ Company logo hidden');
                }
            }
        }

        // DOM Elements for Salary Management
        // Note: Stats elements removed to match staff management header style

        // Salary Grid Tab Elements
        const salaryGridLoadingState = document.getElementById('salaryGridLoadingState');
        const salaryGridTable = document.getElementById('salaryGridTable');
        const salaryGridTableBody = document.getElementById('salaryGridTableBody');
        const salaryGridEmptyState = document.getElementById('salaryGridEmptyState');
        const salaryGridPagination = document.getElementById('salaryGridPagination');
        const salaryGradeForm = document.getElementById('salaryGradeForm');
        const salaryGradeModal = document.getElementById('salaryGradeModal');
        const salaryGradeModalTitle = document.getElementById('salaryGradeModalTitle');
        const salaryGradeIdInput = document.getElementById('salaryGradeId');

        // State for salary data
        let allSalaryGrades = {};
        let currentSalaryTab = 'salaryGrid';
        let editingSalaryGradeId = null;

        // Initialize the page
        async function initializeSalaryPage() {
            // Initialize company context early
            await initializeCompanyContext();
            
            // Only show loading state for salaryGrid tab (since others don't have loading states)
            if (currentSalaryTab === 'salaryGrid') {
                showLoadingState(currentSalaryTab);
            }
            await loadSalaryGrades();
            await populateDropdowns();
            
            // Set up real-time listeners for live updates
            setupRealTimeOrgChartListener();
            setupRealTimeSalaryBandsListener();
            
            // Note: User profile initialization is now handled by SalaryAuthManager
        }

        // Initialize basic page functionality (non-authentication dependent)
        function initializeBasicPage() {
            console.log('🔧 Initializing basic page functionality...');
            
            // Initialize sidebar toggle functionality
            initializeSidebarToggle();
            
            // Set up tab switching functionality
            setupTabSwitching();
            
            // Initialize modal functionality
            setupModalFunctionality();
            
            console.log('✅ Basic page initialization complete');
        }

        function setupTabSwitching() {
            // Setup tab navigation if elements exist
            const tabButtons = document.querySelectorAll('.tab-nav-btn');
            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabName = button.id.replace('TabBtn', '');
                    switchToTab(tabName);
                });
            });
        }

        function setupModalFunctionality() {
            // Setup modal close functionality
            const modals = document.querySelectorAll('.applicant-modal');
            modals.forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        }

        function showLoadingState(tabName) {
            // Only show loading state if the elements exist (mainly for salaryGrid)
            const loadingElement = document.getElementById(`${tabName}LoadingState`);
            const tableElement = document.getElementById(`${tabName}Table`);
            const emptyElement = document.getElementById(`${tabName}EmptyState`);
            const paginationElement = document.getElementById(`${tabName}Pagination`);
            
            if (loadingElement) {
                loadingElement.style.display = 'block';
            }
            if (tableElement) {
                tableElement.style.display = 'none';
            }
            if (emptyElement) {
                emptyElement.classList.add('d-none');
            }
            if (paginationElement) {
                paginationElement.classList.add('d-none');
            }
        }

        function hideLoadingState(tabName) {
            const loadingElement = document.getElementById(`${tabName}LoadingState`);
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
        }        function showEmptyState(tabName, show = true) {
            const emptyStateEl = document.getElementById(`${tabName}EmptyState`);
            const tableEl = document.getElementById(`${tabName}Table`);
            
            if (show) {
                if (emptyStateEl) {
                    emptyStateEl.classList.remove('d-none');
                    emptyStateEl.style.display = 'block';
                }
                if (tableEl) {
                    tableEl.style.display = 'none';
                }
            } else {
                if (emptyStateEl) {
                    emptyStateEl.classList.add('d-none');
                    emptyStateEl.style.display = 'none';
                }
                if (tableEl) {
                    tableEl.style.display = 'table';
                }
            }        }        // Tab switching functionality
        function switchToTab(tabName) {
            try {
                // Update current tab
                currentSalaryTab = tabName;
                
                // Remove active classes from all tabs and content
                document.querySelectorAll('.tab-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Add active classes to selected tab
                const tabBtn = document.getElementById(`${tabName}TabBtn`);
                const tabContent = document.getElementById(`${tabName}TabContent`);
                
                if (tabBtn && tabContent) {
                    tabBtn.classList.add('active');
                    tabContent.classList.add('active');
                    
                    // Load data for specific tabs
                    if (tabName === 'salaryGrid') {
                        loadSalaryGrades();
                    } else if (tabName === 'salaryBands') {
                        loadSalaryBands();
                    }
                } else {
                    console.error('Tab elements not found:', {
                        tabBtn: !!tabBtn,
                        tabContent: !!tabContent,
                        tabName: tabName
                    });
                }
            } catch (error) {
                console.error('Error switching tabs:', error);
            }
        }

        /* ================= Salary Bands Logic ================= */
        let allSalaryBands = {}; // id -> band object
        let editingSalaryBandId = null;
        const salaryBandModal = document.getElementById('salaryBandModal');
        const salaryBandForm = document.getElementById('salaryBandForm');
        const salaryBandModalTitle = document.getElementById('salaryBandModalTitle');
        const bandJobTitlesContainer = document.getElementById('bandJobTitlesContainer');
        const bandJobTitleDropdown = document.getElementById('bandJobTitleDropdown');
        const addJobTitleBtn = document.getElementById('addJobTitleBtn');

        function getBandJobTitles() {
            return Array.from(bandJobTitlesContainer.querySelectorAll('.tag'))
                .map(tag => tag.getAttribute('data-value'));
        }

        function addBandJobTitleTag(title) {
            if (!title) return;
            title = title.trim();
            if (!title) return;
            // prevent duplicates (case-insensitive)
            const existing = getBandJobTitles().map(t => t.toLowerCase());
            if (existing.includes(title.toLowerCase())) return;
            const span = document.createElement('span');
            span.className = 'tag';
            span.setAttribute('data-value', title);
            span.style.cssText = 'background:#3498db;color:#fff;padding:4px 8px;border-radius:16px;display:inline-flex;align-items:center;gap:6px;font-size:.75rem;font-weight:500;';
            span.innerHTML = `<span>${escapeHtml(title)}</span><button type="button" aria-label="Remove" style="background:transparent;border:none;color:#fff;font-size:14px;cursor:pointer;line-height:1;padding:0 2px;">&times;</button>`;
            span.querySelector('button').addEventListener('click', () => {
                span.remove();
                // Refresh dropdown when a tag is removed
                loadJobTitlesForBands();
            });
            bandJobTitlesContainer.appendChild(span);
            
            // Refresh dropdown when a tag is added
            loadJobTitlesForBands();
        }

        // Add event listener for dropdown and button
        addJobTitleBtn && addJobTitleBtn.addEventListener('click', () => {
            const selectedTitle = bandJobTitleDropdown.value;
            if (selectedTitle) {
                addBandJobTitleTag(selectedTitle);
                bandJobTitleDropdown.value = ''; // Reset dropdown
            }
        });

        // Also allow Enter key on dropdown
        bandJobTitleDropdown && bandJobTitleDropdown.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const selectedTitle = bandJobTitleDropdown.value;
                if (selectedTitle) {
                    addBandJobTitleTag(selectedTitle);
                    bandJobTitleDropdown.value = '';
                }
            }
        });

        async function loadJobTitlesForBands() {
            try {
                if (!companyContext) await initializeCompanyContext();
                const companyPath = companyContext || 'default';
                
                // Load from the specific orgChart path you provided
                const snapshot = await database.ref(`companies/${companyPath}/orgChart`).once('value');
                
                if (snapshot.exists()) {
                    const orgData = snapshot.val();
                    const jobTitles = new Set(); // Use Set to avoid duplicates
                    
                    // Iterate through all orgChart entries to find jobTitle fields
                    Object.values(orgData).forEach(entry => {
                        if (entry.jobTitle && typeof entry.jobTitle === 'string') {
                            jobTitles.add(entry.jobTitle.trim());
                        }
                    });
                    
                    // Get already assigned job titles from existing salary bands
                    const assignedJobTitles = new Set();
                    const bandsSnapshot = await database.ref(`companies/${companyPath}/salaryBands`).once('value');
                    
                    if (bandsSnapshot.exists()) {
                        const bandsData = bandsSnapshot.val();
                        Object.values(bandsData).forEach(band => {
                            if (band.jobTitles && Array.isArray(band.jobTitles)) {
                                band.jobTitles.forEach(title => {
                                    if (typeof title === 'string') {
                                        assignedJobTitles.add(title.trim());
                                    }
                                });
                            }
                        });
                    }
                    
                    // Filter out job titles that are already assigned to bands
                    // Exception: When editing a band, allow its own job titles to appear
                    const availableJobTitles = Array.from(jobTitles).filter(title => {
                        if (!assignedJobTitles.has(title)) {
                            return true; // Not assigned to any band, so it's available
                        }
                        
                        // If we're editing a band, allow its own job titles to appear
                        if (editingSalaryBandId && allSalaryBands[editingSalaryBandId]) {
                            const currentBand = allSalaryBands[editingSalaryBandId];
                            return currentBand.jobTitles && currentBand.jobTitles.includes(title);
                        }
                        
                        return false; // Already assigned to another band
                    });
                    
                    // Populate dropdown
                    if (bandJobTitleDropdown) {
                        bandJobTitleDropdown.innerHTML = '<option value="">Select a job title to add...</option>';
                        
                        // Sort job titles alphabetically
                        availableJobTitles.sort();
                        
                        availableJobTitles.forEach(title => {
                            const option = document.createElement('option');
                            option.value = title;
                            option.textContent = title;
                            bandJobTitleDropdown.appendChild(option);
                        });
                        
                        console.log(`✅ Loaded ${availableJobTitles.length} available job titles for salary bands (${assignedJobTitles.size} already assigned)`);
                        
                        // Show a message if no job titles are available
                        if (availableJobTitles.length === 0) {
                            const option = document.createElement('option');
                            option.value = '';
                            option.textContent = 'All job titles are already assigned to bands';
                            option.disabled = true;
                            bandJobTitleDropdown.appendChild(option);
                        }
                    }
                } else {
                    console.log('ℹ️ No orgChart data found');
                    if (bandJobTitleDropdown) {
                        bandJobTitleDropdown.innerHTML = '<option value="">No job titles available</option>';
                    }
                }
            } catch (error) {
                console.error('Error loading job titles for bands:', error);
                if (bandJobTitleDropdown) {
                    bandJobTitleDropdown.innerHTML = '<option value="">Error loading job titles</option>';
                }
            }
        }

        async function loadSalaryBands() {
            showLoadingState('salaryBands');
            try {
                if (!companyContext) await initializeCompanyContext();
                const companyPath = companyContext || 'default';
                const snapshot = await database.ref(`companies/${companyPath}/salaryBands`).once('value');
                if (snapshot.exists()) {
                    allSalaryBands = snapshot.val();
                    renderSalaryBands(Object.values(allSalaryBands));
                    console.log(`✅ Loaded ${Object.keys(allSalaryBands).length} salary bands for company: ${companyPath}`);
                } else {
                    allSalaryBands = {};
                    showEmptyState('salaryBands', true);
                    console.log('ℹ️ No salary bands found');
                }
            } catch (err) {
                console.error('Error loading salary bands:', err);
                showEmptyState('salaryBands', true);
            } finally {
                hideLoadingState('salaryBands');
            }
        }

        function renderSalaryBands(bands) {
            const tbody = document.getElementById('salaryBandsTableBody');
            tbody.innerHTML = '';
            if (!bands || bands.length === 0) {
                showEmptyState('salaryBands', true);
                return;
            }
            showEmptyState('salaryBands', false);
            bands.forEach(band => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${escapeHtml(band.bandName)}</td>
                    <td>${(band.jobTitles || []).map(j=>`<span style=\"display:inline-block;background:#eee;border-radius:12px;padding:2px 8px;margin:2px;font-size:.65rem;\">${escapeHtml(j)}</span>`).join('')}</td>
                    <td>${escapeHtml(band.currency)} ${parseFloat(band.minSalary).toLocaleString()}</td>
                    <td>${band.midSalary ? `${escapeHtml(band.currency)} ${parseFloat(band.midSalary).toLocaleString()}` : 'N/A'}</td>
                    <td>${escapeHtml(band.currency)} ${parseFloat(band.maxSalary).toLocaleString()}</td>
                    <td>${escapeHtml(band.currency)}</td>
                    <td>${new Date(band.lastUpdated || band.createdAt).toLocaleDateString()}</td>
                    <td class="action-buttons">
                        <button class="btn-action btn-edit" onclick="editSalaryBand('${band.id}')" title="Edit"><i class='fas fa-edit'></i></button>
                        <button class="btn-action btn-delete" onclick="deleteSalaryBand('${band.id}')" title="Delete"><i class='fas fa-trash'></i></button>
                    </td>`;
            });
        }

        function openSalaryBandModal(bandId = null) {
            salaryBandForm.reset();
            bandJobTitlesContainer.querySelectorAll('.tag').forEach(t=>t.remove());
            document.getElementById('salaryBandId').value='';
            editingSalaryBandId = bandId;
            
            // Load job titles when opening modal
            loadJobTitlesForBands();
            
            if (bandId && allSalaryBands[bandId]) {
                const band = allSalaryBands[bandId];
                salaryBandModalTitle.textContent = 'Edit Salary Band';
                document.getElementById('bandNameInput').value = band.bandName;
                document.getElementById('bandCurrencySelect').value = band.currency;
                document.getElementById('bandMinSalary').value = band.minSalary;
                document.getElementById('bandMidSalary').value = band.midSalary || '';
                document.getElementById('bandMaxSalary').value = band.maxSalary;
                document.getElementById('bandNotes').value = band.notes || '';
                (band.jobTitles || []).forEach(addBandJobTitleTag);
                document.getElementById('salaryBandId').value = bandId;
            } else {
                salaryBandModalTitle.textContent = 'Add Salary Band';
            }
            salaryBandModal.style.display='flex';
        }

        function closeSalaryBandModal() {
            salaryBandModal.style.display='none';
            editingSalaryBandId = null;
        }

        function editSalaryBand(id){ openSalaryBandModal(id); }

        salaryBandForm && salaryBandForm.addEventListener('submit', async (e)=>{
            e.preventDefault();
            if (!companyContext) await initializeCompanyContext();
            const companyPath = companyContext || 'default';
            const id = document.getElementById('salaryBandId').value || database.ref().child(`companies/${companyPath}/salaryBands`).push().key;
            const now = new Date().toISOString();
            const band = {
                id,
                bandName: document.getElementById('bandNameInput').value.trim(),
                jobTitles: getBandJobTitles(),
                currency: document.getElementById('bandCurrencySelect').value,
                minSalary: parseFloat(document.getElementById('bandMinSalary').value),
                midSalary: document.getElementById('bandMidSalary').value ? parseFloat(document.getElementById('bandMidSalary').value): null,
                maxSalary: parseFloat(document.getElementById('bandMaxSalary').value),
                notes: document.getElementById('bandNotes').value.trim(),
                lastUpdated: now,
                createdAt: editingSalaryBandId ? allSalaryBands[editingSalaryBandId].createdAt : now,
                companyId: companyPath
            };
            if (!band.bandName) return alert('Band name required');
            if (!band.jobTitles.length) return alert('Add at least one job title');
            if (band.minSalary >= band.maxSalary) return alert('Min Salary must be less than Max Salary');
            if (band.midSalary && (band.midSalary < band.minSalary || band.midSalary > band.maxSalary)) return alert('Midpoint must be between Min and Max');
            try {
                await database.ref(`companies/${companyPath}/salaryBands/${id}`).set(band);
                console.log('✅ Salary band saved');
                closeSalaryBandModal();
                loadSalaryBands();
                // Refresh job titles dropdown for future band creations
                loadJobTitlesForBands();
                alert(editingSalaryBandId ? 'Salary band updated!' : 'Salary band added!');
            } catch (err) {
                console.error('Error saving salary band:', err);
                alert('Error saving salary band');
            }
        });

        async function deleteSalaryBand(id){
            if (!confirm('Delete this salary band?')) return;
            try {
                if (!companyContext) await initializeCompanyContext();
                const companyPath = companyContext || 'default';
                await database.ref(`companies/${companyPath}/salaryBands/${id}`).remove();
                console.log('✅ Salary band deleted');
                loadSalaryBands();
                // Refresh job titles dropdown to make deleted band's job titles available again
                loadJobTitlesForBands();
                alert('Salary band deleted');
            } catch (err){
                console.error('Error deleting band:', err);
                alert('Error deleting band');
            }
        }

        function filterSalaryBands(){
            const term = document.getElementById('salaryBandsSearchInput').value.trim().toLowerCase();
            const bands = Object.values(allSalaryBands);
            const filtered = bands.filter(b =>
                b.bandName.toLowerCase().includes(term) ||
                (b.jobTitles || []).some(j => j.toLowerCase().includes(term))
            );
            renderSalaryBands(filtered);
        }

        function exportSalaryBands(){
            const bands = Object.values(allSalaryBands);
            if (!bands.length) return alert('No salary bands to export');
            const headers = ['Band Name','Job Titles','Min Salary','Mid Salary','Max Salary','Currency','Created At','Last Updated'];
            const rows = bands.map(b => [
                b.bandName,
                (b.jobTitles||[]).join('; '),
                b.minSalary,
                b.midSalary || '',
                b.maxSalary,
                b.currency,
                b.createdAt,
                b.lastUpdated
            ]);
            const csv = [headers, ...rows].map(r => r.map(val => '"'+String(val).replace(/"/g,'""')+'"').join(',')).join('\n');
            const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'salary_bands.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function populateDropdowns() {
            const jobTitleSelect = document.getElementById('modalJobTitle');
            const departmentSelect = document.getElementById('modalDepartment');

            // Ensure company context is available
            if (!companyContext) {
                await initializeCompanyContext();
            }
            
            const companyPath = companyContext || 'default';

            // Populate Job Titles prioritizing orgChart entries
            try {
                jobTitleSelect.innerHTML = '<option value="">Loading job titles...</option>';

                // 1. Collect job titles from orgChart nodes
                const orgChartSnapshot = await database.ref(`companies/${companyPath}/orgChart`).once('value');
                const collectedTitles = new Set();
                if (orgChartSnapshot.exists()) {
                    orgChartSnapshot.forEach(roleNode => {
                        const nodeVal = roleNode.val();
                        // nodeVal.jobTitle direct
                        if (nodeVal && nodeVal.jobTitle) {
                            collectedTitles.add(nodeVal.jobTitle);
                        }
                        // nested children iteration if any
                        if (nodeVal && nodeVal.children) {
                            Object.values(nodeVal.children).forEach(child => {
                                if (child && child.jobTitle) collectedTitles.add(child.jobTitle);
                            });
                        }
                    });
                }

                // 2. Also include specific path example provided (if direct id key exists)
                // This ensures explicit path like orgChart/<id>/jobTitle is captured even if structure differs
                // (Already covered by iteration above if path structure standard)

                // 3. Fallback hierarchical sources if orgChart empty
                if (collectedTitles.size === 0) {
                    const companyJobTitlesSnapshot = await database.ref(`companies/${companyPath}/fieldOptions/job-title`).once('value');
                    if (companyJobTitlesSnapshot.exists()) {
                        companyJobTitlesSnapshot.forEach(childSnapshot => {
                            const job = childSnapshot.val();
                            if (job && job.label && job.enabled !== false) collectedTitles.add(job.label);
                        });
                        console.log(`ℹ️ Loaded job titles from fieldOptions/job-title for company ${companyPath}`);
                    } else {
                        const userRoleJobTitlesSnapshot = await database.ref(`companies/${companyPath}/fieldOptions/user-role`).once('value');
                        if (userRoleJobTitlesSnapshot.exists()) {
                            userRoleJobTitlesSnapshot.forEach(childSnapshot => {
                                const job = childSnapshot.val();
                                if (job && job.label && job.enabled !== false) collectedTitles.add(job.label);
                            });
                            console.log(`ℹ️ Loaded job titles from fieldOptions/user-role for company ${companyPath}`);
                        } else {
                            const globalJobTitlesSnapshot = await database.ref('fieldOptions/job-title').once('value');
                            if (globalJobTitlesSnapshot.exists()) {
                                globalJobTitlesSnapshot.forEach(childSnapshot => {
                                    const job = childSnapshot.val();
                                    if (job && job.label && job.enabled !== false) collectedTitles.add(job.label);
                                });
                                console.log('ℹ️ Loaded global job titles (final fallback)');
                            }
                        }
                    }
                } else {
                    console.log(`✅ Loaded ${collectedTitles.size} job titles from orgChart for company ${companyPath}`);
                }

                // 4. Render options
                if (collectedTitles.size > 0) {
                    const sorted = Array.from(collectedTitles).sort((a,b)=>a.localeCompare(b));
                    jobTitleSelect.innerHTML = '<option value="">Select Job Title...</option>' +
                        sorted.map(t=>`<option value="${t.replace(/"/g,'&quot;')}">${t}</option>`).join('');
                } else {
                    jobTitleSelect.innerHTML = '<option value="">No job titles available</option>';
                }
            } catch (error) {
                console.error('Error loading job titles (orgChart first):', error);
                jobTitleSelect.innerHTML = '<option value="">Error loading job titles</option>';
            }

            // Populate Departments from company-specific path
            try {
                // Try company-specific departments first
                const companyDepartmentsSnapshot = await database.ref(`companies/${companyPath}/fieldOptions/department`).once('value');
                if (companyDepartmentsSnapshot.exists()) {
                    departmentSelect.innerHTML = '<option value="">Select Department...</option>';
                    companyDepartmentsSnapshot.forEach(childSnapshot => {
                        const dept = childSnapshot.val();
                        const option = document.createElement('option');
                        option.value = dept.label || childSnapshot.key;
                        option.textContent = dept.label || childSnapshot.key;
                        departmentSelect.appendChild(option);
                    });
                    console.log(`✅ Loaded departments from company: ${companyPath}`);
                } else {
                    // Fallback to global departments if company-specific don't exist
                    const globalDepartmentsSnapshot = await database.ref('fieldOptions/department').once('value');
                    if (globalDepartmentsSnapshot.exists()) {
                        departmentSelect.innerHTML = '<option value="">Select Department...</option>';
                        globalDepartmentsSnapshot.forEach(childSnapshot => {
                            const dept = childSnapshot.val();
                            const option = document.createElement('option');
                            option.value = dept.label || childSnapshot.key;
                            option.textContent = dept.label || childSnapshot.key;
                            departmentSelect.appendChild(option);
                        });
                        console.log(`ℹ️ Loaded departments from global (fallback for ${companyPath})`);
                    } else {
                        departmentSelect.innerHTML = '<option value="">No departments available</option>';
                        console.log(`⚠️ No departments found for company: ${companyPath}`);
                    }
                }
            } catch (error) { 
                console.error("Error loading departments:", error);
                departmentSelect.innerHTML = '<option value="">Error loading departments</option>';
            }
        }

        async function loadSalaryGrades() {
            showLoadingState('salaryGrid');
            try {
                // Ensure company context is initialized
                if (!companyContext) {
                    await initializeCompanyContext();
                }
                
                const companyPath = companyContext || 'default';
                
                // Load both orgChart job titles and existing salary grades and bands
                const [orgSnapshot, gradesSnapshot, bandsSnapshot] = await Promise.all([
                    database.ref(`companies/${companyPath}/orgChart`).once('value'),
                    database.ref(`companies/${companyPath}/salaryGrades`).once('value'),
                    database.ref(`companies/${companyPath}/salaryBands`).once('value')
                ]);
                
                // Get all job titles from orgChart
                const allJobTitles = new Set();
                if (orgSnapshot.exists()) {
                    const orgData = orgSnapshot.val();
                    Object.values(orgData).forEach(entry => {
                        if (entry.jobTitle && typeof entry.jobTitle === 'string') {
                            allJobTitles.add(entry.jobTitle.trim());
                        }
                    });
                }
                
                // Get existing salary grades
                const existingGrades = gradesSnapshot.exists() ? gradesSnapshot.val() : {};
                allSalaryGrades = existingGrades;
                
                // Get salary bands for auto-fill
                const salaryBands = bandsSnapshot.exists() ? bandsSnapshot.val() : {};
                
                // Create comprehensive salary grid data
                const salaryGridData = [];
                
                // Add all job titles with their salary information
                allJobTitles.forEach(jobTitle => {
                    // Check if job title already has a salary grade
                    const existingGrade = Object.values(existingGrades).find(grade => 
                        grade.jobTitle && grade.jobTitle.toLowerCase() === jobTitle.toLowerCase()
                    );
                    
                    if (existingGrade) {
                        // Use existing salary grade
                        salaryGridData.push(existingGrade);
                    } else {
                        // Check if job title is in any salary band for auto-fill
                        const matchingBand = Object.values(salaryBands).find(band => 
                            band.jobTitles && band.jobTitles.some(title => 
                                title.toLowerCase() === jobTitle.toLowerCase()
                            )
                        );
                        
                        if (matchingBand) {
                            // Auto-fill from salary band
                            const autoFilledGrade = {
                                id: `autofill_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                                jobTitle: jobTitle,
                                department: 'Auto-filled from Band',
                                grade: matchingBand.bandName,
                                currency: matchingBand.currency,
                                minSalary: matchingBand.minSalary,
                                midSalary: matchingBand.midSalary,
                                maxSalary: matchingBand.maxSalary,
                                notes: `Auto-filled from salary band: ${matchingBand.bandName}`,
                                isAutoFilled: true,
                                bandId: Object.keys(salaryBands).find(key => salaryBands[key] === matchingBand),
                                lastUpdated: matchingBand.lastUpdated || matchingBand.createdAt,
                                createdAt: new Date().toISOString()
                            };
                            salaryGridData.push(autoFilledGrade);
                        } else {
                            // Create placeholder entry for job title without salary info
                            const placeholderGrade = {
                                id: `placeholder_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                                jobTitle: jobTitle,
                                department: 'Not Set',
                                grade: 'Not Assigned',
                                currency: 'USD',
                                minSalary: null,
                                midSalary: null,
                                maxSalary: null,
                                notes: 'No salary information available',
                                isPlaceholder: true,
                                lastUpdated: null,
                                createdAt: new Date().toISOString()
                            };
                            salaryGridData.push(placeholderGrade);
                        }
                    }
                });
                
                // Sort by job title for consistent display
                salaryGridData.sort((a, b) => a.jobTitle.localeCompare(b.jobTitle));
                
                // Store data for filtering
                allSalaryGridData = salaryGridData;
                
                renderSalaryGrid(salaryGridData);
                console.log(`✅ Loaded ${salaryGridData.length} job titles with salary information for company: ${companyPath}`);
                
            } catch (error) {
                console.error("Error loading salary grades:", error);
                showEmptyState('salaryGrid', true);
            } finally {
                hideLoadingState('salaryGrid');
            }
        }

        function renderSalaryGrid(grades) {
            salaryGridTableBody.innerHTML = '';
            if (!grades || grades.length === 0) {
                salaryGridTableBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 2rem; color: #666;">
                            <i class="fas fa-briefcase fa-2x" style="display: block; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p style="margin: 0; font-size: 1.1rem;">No salary data available</p>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Create salary bands to automatically populate this grid</p>
                        </td>
                    </tr>
                `;
                showEmptyState('salaryGrid', true);
                return;
            }
            showEmptyState('salaryGrid', false);

            grades.forEach(grade => {
                const row = salaryGridTableBody.insertRow();
                
                // Determine row styling based on data source
                let rowClass = '';
                let titlePrefix = '';
                
                if (grade.isAutoFilled) {
                    rowClass = 'style="background-color: #e8f5e8;"'; // Light green for auto-filled
                    titlePrefix = '🔗 '; // Link icon for band-linked
                } else if (grade.isPlaceholder) {
                    rowClass = 'style="background-color: #fff3cd;"'; // Light yellow for placeholder
                    titlePrefix = '⚠️ '; // Warning icon for missing data
                }
                
                // Format salary display
                const formatSalary = (amount, currency) => {
                    if (amount === null || amount === undefined) return 'Not Set';
                    return `${currency} ${parseFloat(amount).toLocaleString()}`;
                };
                
                // Only show view action for auto-filled entries, otherwise show read-only indicator
                let actionsHTML = '';
                if (grade.isAutoFilled && grade.bandId) {
                    actionsHTML = `<button class="btn-action btn-info" onclick="viewBandDetails('${grade.bandId}')" title="View Salary Band">
                        <i class="fas fa-eye"></i>
                    </button>`;
                } else {
                    actionsHTML = `<span style="color: #666; font-size: 0.8rem; font-style: italic;">Read Only</span>`;
                }
                
                row.innerHTML = `
                    <td ${rowClass}>${titlePrefix}${escapeHtml(grade.jobTitle)}</td>
                    <td ${rowClass}>${escapeHtml(grade.department)}</td>
                    <td ${rowClass}>${escapeHtml(grade.grade)}</td>
                    <td ${rowClass}>${formatSalary(grade.minSalary, grade.currency)}</td>
                    <td ${rowClass}>${formatSalary(grade.midSalary, grade.currency)}</td>
                    <td ${rowClass}>${formatSalary(grade.maxSalary, grade.currency)}</td>
                    <td ${rowClass}>${escapeHtml(grade.currency || 'USD')}</td>
                    <td ${rowClass}>${grade.lastUpdated ? new Date(grade.lastUpdated).toLocaleDateString() : 'N/A'}</td>
                    <td class="action-buttons" ${rowClass}>
                        ${actionsHTML}
                    </td>
                `;
            });
        }

        function openSalaryGradeModal(gradeId = null) {
            salaryGradeForm.reset();
            salaryGradeIdInput.value = '';
            editingSalaryGradeId = gradeId;

            if (gradeId && allSalaryGrades[gradeId]) {
                salaryGradeModalTitle.textContent = "Edit Salary Grade";
                const grade = allSalaryGrades[gradeId];
                document.getElementById('modalJobTitle').value = grade.jobTitle;
                document.getElementById('modalDepartment').value = grade.department;
                document.getElementById('modalSalaryGrade').value = grade.grade;
                document.getElementById('modalCurrency').value = grade.currency;
                document.getElementById('modalMinSalary').value = grade.minSalary;
                document.getElementById('modalMidSalary').value = grade.midSalary || '';
                document.getElementById('modalMaxSalary').value = grade.maxSalary;
                document.getElementById('modalSalaryNotes').value = grade.notes || '';
                salaryGradeIdInput.value = gradeId;
            } else {
                salaryGradeModalTitle.textContent = "Add New Salary Grade";
            }
            salaryGradeModal.style.display = 'flex';
        }

        function closeSalaryGradeModal() {
            salaryGradeModal.style.display = 'none';
            editingSalaryGradeId = null;
            // Remove readonly attribute when closing modal
            const jobTitleField = document.getElementById('modalJobTitle');
            if (jobTitleField) {
                jobTitleField.removeAttribute('readonly');
            }
        }

        salaryGradeForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Ensure company context is available
            if (!companyContext) {
                await initializeCompanyContext();
            }
            
            const companyPath = companyContext || 'default';
            const id = salaryGradeIdInput.value || database.ref().child(`companies/${companyPath}/salaryGrades`).push().key;
            const now = new Date().toISOString();

            const gradeData = {
                id: id,
                jobTitle: document.getElementById('modalJobTitle').value,
                department: document.getElementById('modalDepartment').value,
                grade: document.getElementById('modalSalaryGrade').value,
                currency: document.getElementById('modalCurrency').value,
                minSalary: parseFloat(document.getElementById('modalMinSalary').value),
                midSalary: document.getElementById('modalMidSalary').value ? parseFloat(document.getElementById('modalMidSalary').value) : null,
                maxSalary: parseFloat(document.getElementById('modalMaxSalary').value),
                notes: document.getElementById('modalSalaryNotes').value,
                lastUpdated: now,
                createdAt: editingSalaryGradeId ? allSalaryGrades[editingSalaryGradeId].createdAt : now,
                companyId: companyPath // Store company context
            };

            if (gradeData.minSalary >= gradeData.maxSalary) {
                alert("Min Salary must be less than Max Salary.");
                return;
            }
            if (gradeData.midSalary && (gradeData.midSalary < gradeData.minSalary || gradeData.midSalary > gradeData.maxSalary)) {
                alert("Midpoint Salary must be between Min and Max Salary.");
                return;
            }

            try {
                // Save to company-specific path
                await database.ref(`companies/${companyPath}/salaryGrades/${id}`).set(gradeData);
                console.log(`✅ Salary grade saved to company: ${companyPath}`);
                
                closeSalaryGradeModal();
                loadSalaryGrades(); // Refresh the grid
                alert(editingSalaryGradeId ? "Salary grade updated!" : "Salary grade added!");
            } catch (error) {
                console.error("Error saving salary grade:", error);
                alert("Error saving salary grade. See console for details.");
            }
        });

        function editSalaryGrade(gradeId) {
            alert('Salary grid is read-only. Please use the Salary Bands tab to manage salary information.');
            switchToTab('salaryBands');
        }

        async function deleteSalaryGrade(gradeId) {
            alert('Salary grid is read-only. Please use the Salary Bands tab to manage salary information.');
            switchToTab('salaryBands');
        }

        // Helper functions for enhanced salary grid functionality - DISABLED FOR READ-ONLY MODE
        function createSalaryGradeFromPlaceholder(jobTitle) {
            alert('Salary grid is read-only. Please use the Salary Bands tab to manage salary information.');
            // Switch to salary bands tab
            switchToTab('salaryBands');
        }

        async function convertAutoFilledToManual(bandId, jobTitle) {
            alert('Salary grid is read-only. Please use the Salary Bands tab to manage salary information.');
            // Switch to salary bands tab
            switchToTab('salaryBands');
        }

        async function viewBandDetails(bandId) {
            try {
                if (!companyContext) await initializeCompanyContext();
                const companyPath = companyContext || 'default';
                
                const bandSnapshot = await database.ref(`companies/${companyPath}/salaryBands/${bandId}`).once('value');
                if (!bandSnapshot.exists()) {
                    alert('Salary band not found');
                    return;
                }
                
                const band = bandSnapshot.val();
                const jobTitlesText = (band.jobTitles || []).join(', ');
                
                const message = `
Salary Band Details:

Band Name: ${band.bandName}
Job Titles: ${jobTitlesText}
Currency: ${band.currency}
Min Salary: ${band.currency} ${parseFloat(band.minSalary).toLocaleString()}
${band.midSalary ? `Mid Salary: ${band.currency} ${parseFloat(band.midSalary).toLocaleString()}` : ''}
Max Salary: ${band.currency} ${parseFloat(band.maxSalary).toLocaleString()}
${band.notes ? `Notes: ${band.notes}` : ''}

Would you like to edit this salary band?
                `;
                
                if (confirm(message)) {
                    // Switch to salary bands tab and open the edit modal
                    switchToTab('salaryBands');
                    setTimeout(() => {
                        openSalaryBandModal(bandId);
                    }, 100);
                }
            } catch (error) {
                console.error('Error viewing band details:', error);
                alert('Error loading band details');
            }
        }

        // Add real-time listener for orgChart changes
        function setupRealTimeOrgChartListener() {
            if (!companyContext) return;
            
            const companyPath = companyContext || 'default';
            const orgChartRef = database.ref(`companies/${companyPath}/orgChart`);
            
            orgChartRef.on('value', (snapshot) => {
                // Only refresh if we're currently on the salary grid tab
                if (currentSalaryTab === 'salaryGrid') {
                    console.log('🔄 OrgChart updated, refreshing salary grid...');
                    loadSalaryGrades();
                }
            });
        }

        // Add real-time listener for salary bands changes
        function setupRealTimeSalaryBandsListener() {
            if (!companyContext) return;
            
            const companyPath = companyContext || 'default';
            const bandsRef = database.ref(`companies/${companyPath}/salaryBands`);
            
            bandsRef.on('value', (snapshot) => {
                // Refresh salary grid when bands change (for auto-fill updates)
                if (currentSalaryTab === 'salaryGrid') {
                    console.log('🔄 Salary bands updated, refreshing salary grid...');
                    loadSalaryGrades();
                }
                // Also update the salary bands tab if it's active
                if (currentSalaryTab === 'salaryBands') {
                    loadSalaryBands();
                }
            });
        }

        // Store all salary grid data for filtering
        let allSalaryGridData = [];

        function filterSalaryGrid() {
            const searchTerm = document.getElementById('salaryGridSearchInput').value.toLowerCase().trim();
            
            if (!searchTerm) {
                // Show all data if no search term
                renderSalaryGrid(allSalaryGridData);
                return;
            }
            
            const filteredData = allSalaryGridData.filter(grade => {
                return (
                    grade.jobTitle.toLowerCase().includes(searchTerm) ||
                    grade.department.toLowerCase().includes(searchTerm) ||
                    grade.grade.toLowerCase().includes(searchTerm) ||
                    (grade.notes && grade.notes.toLowerCase().includes(searchTerm))
                );
            });
            
            renderSalaryGrid(filteredData);
        }

        function exportSalaryGrid() {
            const dataToExport = allSalaryGridData;
            if (!dataToExport.length) {
                alert('No salary data to export');
                return;
            }
            
            const headers = ['Job Title', 'Department', 'Salary Grade', 'Min Salary', 'Mid Salary', 'Max Salary', 'Currency', 'Data Source', 'Last Updated', 'Notes'];
            const rows = dataToExport.map(grade => [
                grade.jobTitle,
                grade.department,
                grade.grade,
                grade.minSalary || '',
                grade.midSalary || '',
                grade.maxSalary || '',
                grade.currency,
                grade.isAutoFilled ? 'Auto-filled from Band' : grade.isPlaceholder ? 'Placeholder' : 'Manual Entry',
                grade.lastUpdated || '',
                grade.notes || ''
            ]);
            
            const csv = [headers, ...rows].map(row => 
                row.map(val => '"' + String(val).replace(/"/g, '""') + '"').join(',')
            ).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `salary_grid_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // File Preview Modal functions (reused from offer.html)
        function openFile(url, fileName, fileType) {
            alert(`Preview file: ${fileName}`);
        }
        function closeFilePreview() {
            document.getElementById('filePreviewModal').style.display = 'none';
        }
        function downloadFile(url, fileName) {
            alert(`Download file: ${fileName}`);
        }

        // User Profile Dropdown functionality (reused from offer.html)
        function initializeUserProfile() {
            // Profile dropdown and sidebar toggle are now handled by SalaryAuthManager
            // This function is kept for backward compatibility
            console.log('ℹ️ User profile initialization handled by SalaryAuthManager');
            
            // Initialize sidebar toggle
            initializeSidebarToggle();
        }

        // Persistent collapsible sidebar (chartboard style)
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            const topNav = document.querySelector('.top-nav');
            if (sidebar) sidebar.classList.toggle('collapsed');
            if (mainContent) mainContent.classList.toggle('sidebar-collapsed');
            if (topNav) topNav.classList.toggle('sidebar-collapsed');
            const collapsed = sidebar && sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebarCollapsed', collapsed ? '1' : '0');
        }

        function restoreSidebarState() {
            const saved = localStorage.getItem('sidebarCollapsed');
            if (saved === '1') {
                const sidebar = document.querySelector('.sidebar');
                const mainContent = document.querySelector('.main-content');
                const topNav = document.querySelector('.top-nav');
                if (sidebar) sidebar.classList.add('collapsed');
                if (mainContent) mainContent.classList.add('sidebar-collapsed');
                if (topNav) topNav.classList.add('sidebar-collapsed');
            }
        }


        function initializeSidebarToggle() {
            restoreSidebarState();
            const sidebarToggle = document.getElementById('sidebarToggle');
            if (sidebarToggle) sidebarToggle.addEventListener('click', toggleSidebar);
        }

        function loadUserInitials() {
            // Authentication is now handled by SalaryAuthManager
            // This function is kept for backward compatibility
            console.log('ℹ️ Authentication handled by SalaryAuthManager');
        }

        async function updateUIForAuthenticatedUser(user) {
            const profileBtn = document.querySelector('.profile-btn');
            const profileDropdown = document.querySelector('.profile-dropdown ul');
            
            if (profileBtn && user) {
                // Initialize company context first
                await initializeCompanyContext();
                
                // Use centralized display methods
                const initials = getUserInitials(user);
                const displayName = getUserDisplayName(user);
                const email = getUserEmail(user);
                
                // Update profile image with loading state
                const profileImg = profileBtn.querySelector('img');
                if (profileImg) {
                    // Show loading state (optional - you can add a spinner class)
                    profileImg.style.opacity = '0.7';
                    
                    try {
                        // Try to get custom avatar from company-specific storage
                        const avatarUrl = await getUserAvatarUrl(user);
                        if (avatarUrl) {
                            profileImg.src = avatarUrl;
                            profileImg.alt = displayName + ' Avatar';
                            console.log('Profile picture loaded successfully');
                        } else {
                            // Generate initials avatar if no profile picture found
                            generateInitialsAvatar(displayName, profileImg);
                            console.log('Generated initials avatar for user');
                        }
                    } catch (error) {
                        console.error('Error loading profile picture:', error);
                        // Fallback to initials avatar on error
                        generateInitialsAvatar(displayName, profileImg);
                    } finally {
                        // Remove loading state
                        profileImg.style.opacity = '1';
                    }
                }
                
                // Update profile dropdown with user info and company context
                if (profileDropdown) {
                    const companyDisplayName = companyContext && companyContext !== 'default' ? companyContext : '';
                    const userInfoHtml = `
                        <li style="border-bottom: 1px solid #eee; padding: 12px 16px; background: #f8f9fa;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; background: #3498db; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">
                                    ${initials}
                                </div>
                                <div>
                                    <div style="font-weight: 600; color: #333; font-size: 14px; margin-bottom: 2px;">
                                        ${displayName}
                                    </div>
                                    <div style="color: #666; font-size: 12px;">
                                        ${email}
                                    </div>
                                    ${companyDisplayName ? `<div style="color: #888; font-size: 11px; margin-top: 2px;">${companyDisplayName}</div>` : ''}
                                </div>
                            </div>
                        </li>
                        <li><a href="account.html"><i class="fas fa-user"></i> Account Settings</a></li>
                        <li><a href="#"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                    `;
                    
                    profileDropdown.innerHTML = userInfoHtml;
                    
                    // Re-attach logout event listener
                    const logoutBtn = profileDropdown.querySelector('a[href="#"]');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            firebase.auth().signOut().then(() => {
                                window.location.href = 'login.html';
                            }).catch((error) => {
                                console.error('Logout error:', error);
                            });
                        });
                    }
                }
            }
        }

        function generateInitialsAvatar(name, imgElement) {
            if (!imgElement || !name) return;
            
            const initials = getInitials(name);
            const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c'];
            const backgroundColor = colors[name.length % colors.length];
            
            const svg = `
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="20" fill="${backgroundColor}"/>
                    <text x="20" y="25" text-anchor="middle" fill="white" font-size="14" font-weight="600" font-family="Arial, sans-serif">${initials}</text>
                </svg>
            `;
            
            imgElement.src = 'data:image/svg+xml;base64,' + btoa(svg);
            imgElement.alt = name + ' Avatar';
        }

        async function getUserAvatarUrl(user) {
            if (!user) return null;
            
            try {
                // Ensure company context is available
                if (!companyContext) {
                    await initializeCompanyContext();
                }
                
                const companyPath = companyContext || 'default';
                
                // Try multiple profile picture formats and paths
                const avatarPaths = [
                    `companies/${companyPath}/avatars/${user.uid}/profile.jpg`,
                    `companies/${companyPath}/avatars/${user.uid}/profile.png`,
                    `companies/${companyPath}/avatars/${user.uid}/profile.jpeg`,
                    `avatars/${user.uid}/profile.jpg`, // Fallback to global path
                    `avatars/${user.uid}/profile.png`,
                    `avatars/${user.uid}/profile.jpeg`
                ];
                
                // Try each path until we find a valid image
                for (const avatarPath of avatarPaths) {
                    try {
                        const avatarRef = storage.ref(avatarPath);
                        const downloadURL = await avatarRef.getDownloadURL();
                        console.log(`Profile picture found at: ${avatarPath}`);
                        return downloadURL;
                    } catch (pathError) {
                        // Continue to next path if this one fails
                        continue;
                    }
                }
                
                // No custom avatar found in any path
                return null;
            } catch (error) {
                console.error('Error getting user avatar URL:', error);
                return null;
            }
        }

        function getUserDisplayName(user) {
            if (!user) return 'User';
            return user.displayName || user.email?.split('@')[0] || 'User';
        }

        function getUserEmail(user) {
            if (!user) return '';
            return user.email || '';
        }

        function getUserInitials(user) {
            if (!user) return 'U';
            const displayName = getUserDisplayName(user);
            return getInitials(displayName);
        }

        function getInitials(name) {
            if (!name) return 'U';
            const words = name.split(' ').filter(word => word.length > 0);
            if (words.length === 1) {
                return words[0].substring(0, 2).toUpperCase();
            } else {
                return words.slice(0, 2).map(word => word.charAt(0)).join('').toUpperCase();
            }
        }

        // Function to upload profile picture (can be called from account settings)
        async function uploadProfilePicture(file, user) {
            if (!file || !user) return null;
            
            try {
                // Ensure company context is available
                if (!companyContext) {
                    await initializeCompanyContext();
                }
                
                const companyPath = companyContext || 'default';
                const fileExtension = file.name.split('.').pop().toLowerCase();
                
                // Validate file type
                if (!['jpg', 'jpeg', 'png'].includes(fileExtension)) {
                    throw new Error('Invalid file type. Please use JPG, JPEG, or PNG.');
                }
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    throw new Error('File size too large. Maximum size is 5MB.');
                }
                
                // Upload to company-specific path
                const uploadPath = `companies/${companyPath}/avatars/${user.uid}/profile.${fileExtension}`;
                const uploadRef = storage.ref(uploadPath);
                
                console.log('Uploading profile picture to:', uploadPath);
                const uploadTask = await uploadRef.put(file);
                const downloadURL = await uploadTask.ref.getDownloadURL();
                
                console.log('Profile picture uploaded successfully:', downloadURL);
                
                // Update the UI immediately
                const profileImg = document.querySelector('#userAvatar');
                if (profileImg) {
                    profileImg.src = downloadURL;
                }
                
                return downloadURL;
            } catch (error) {
                console.error('Error uploading profile picture:', error);
                throw error;
            }
        }

        // Function to delete profile picture
        async function deleteProfilePicture(user) {
            if (!user) return;
            
            try {
                if (!companyContext) {
                    await initializeCompanyContext();
                }
                
                const companyPath = companyContext || 'default';
                const extensions = ['jpg', 'jpeg', 'png'];
                
                // Try to delete all possible extensions
                for (const ext of extensions) {
                    try {
                        const deletePath = `companies/${companyPath}/avatars/${user.uid}/profile.${ext}`;
                        const deleteRef = storage.ref(deletePath);
                        await deleteRef.delete();
                        console.log('Deleted profile picture:', deletePath);
                    } catch (error) {
                        // File might not exist, continue
                    }
                }
                
                // Generate initials avatar after deletion
                const profileImg = document.querySelector('#userAvatar');
                if (profileImg) {
                    const displayName = getUserDisplayName(user);
                    generateInitialsAvatar(displayName, profileImg);
                }
            } catch (error) {
                console.error('Error deleting profile picture:', error);
                throw error;
            }
        }

        // Utility function to escape HTML (reused)
        function escapeHtml(text) {
            if (text === null || typeof text === 'undefined') return '';
            const div = document.createElement('div');
            div.textContent = String(text);
            return div.innerHTML;
        }

        // Initialize the page when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🔧 Initializing Salary Management page...');
            // The SalaryAuthManager is already initialized above and will handle authentication
            // Initialize basic page functionality that doesn't require authentication
            initializeBasicPage();
        });

        // Debug function to test tab switching
        window.testTabSwitch = function(tabName) {
            console.log('Testing tab switch to:', tabName);
            console.log('Current tab before switch:', currentSalaryTab);
            
            // Check if elements exist
            const tabBtn = document.getElementById(`${tabName}TabBtn`);
            const tabContent = document.getElementById(`${tabName}TabContent`);
            console.log('Tab button exists:', !!tabBtn);
            console.log('Tab content exists:', !!tabContent);
            
            // Call the switchToTab function
            switchToTab(tabName);
            
            console.log('Current tab after switch:', currentSalaryTab);
        };
    </script>

<script>
// Error handling for missing resources
window.addEventListener('error', function(e) {
  console.error('Resource loading error:', e.target.src || e.target.href);
  
  // Handle missing JS files
  if (e.target.tagName === 'SCRIPT') {
    console.warn('JavaScript file not found:', e.target.src);
  }
});

// All styles are now embedded directly in the HTML file
document.addEventListener('DOMContentLoaded', function() {
  console.log('Salary Management page loaded successfully with embedded styles');
});
</script>
</body>
</html>
