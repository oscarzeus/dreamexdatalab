<!-- CLEAN LOGIN SCRIPT SECTION FOR INDEX.HTML -->
<!-- Replace the broken script section in index.html (around line 864-1290) with this: -->

  <!-- Domain-specific login script - consolidated login system -->
  <script src="js/login.js"></script>

  <script type="module">
    // Import only the logout function from firebase-config.js
    import { logoutUser } from './js/firebase-config.js';
    
    // Make logoutUser available globally
    window.logoutUser = logoutUser;
    
    // Global functions for login modal
    window.loginModalFunctions = {
      openModal: function() {
        document.getElementById('loginModal').classList.add('active');
        document.body.style.overflow = 'hidden';
      },
      
      closeModal: function() {
        document.getElementById('loginModal').classList.remove('active');
        document.body.style.overflow = 'auto';
      },
      
      handleLogin: async function(email, password) {
        const spinner = document.getElementById('login-spinner');
        const errorMessage = document.getElementById('error-message');
        
        try {
          spinner.style.display = 'block';
          errorMessage.style.display = 'none';
          
          // Use the consolidated login system from js/login.js
          console.log('ðŸ”„ Using consolidated login system...');
          
          // Call the main handleLogin function from js/login.js
          await window.handleLogin(email, password);
          
          // Close modal on successful login
          this.closeModal();
          
        } catch (error) {
          console.error('Login error:', error);
          
          // Show error message
          errorMessage.textContent = error.message || 'An error occurred during login. Please try again.';
          errorMessage.style.display = 'block';
          
        } finally {
          spinner.style.display = 'none';
        }
      }
    };
  </script>

  <script>
    // Login Modal Management
    const loginModal = document.getElementById('loginModal');
    const loginButton = document.getElementById('loginButton');
    const mobileLoginButton = document.getElementById('mobileLoginButton');
    const closeLoginModal = document.getElementById('closeLoginModal');
    const loginForm = document.getElementById('login-form');
    const togglePassword = document.getElementById('togglePassword');
    
    // Open login modal
    function openLoginModal() {
      loginModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    // Close login modal
    function closeLoginModalFunc() {
      loginModal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }
    
    // Event listeners for login buttons
    loginButton.addEventListener('click', openLoginModal);
    mobileLoginButton.addEventListener('click', openLoginModal);
    closeLoginModal.addEventListener('click', closeLoginModalFunc);
    
    // Close modal when clicking outside
    loginModal.addEventListener('click', function(e) {
      if (e.target === loginModal) {
        closeLoginModalFunc();
      }
    });
    
    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && loginModal.classList.contains('active')) {
        closeLoginModalFunc();
      }
    });
    
    // Password toggle functionality
    togglePassword.addEventListener('click', function() {
      const passwordInput = document.getElementById('password');
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      
      // Toggle eye icon
      this.querySelector('i').classList.toggle('fa-eye');
      this.querySelector('i').classList.toggle('fa-eye-slash');
    });
    
    // Handle login form submission
    loginForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      // Use the consolidated login system
      await window.loginModalFunctions.handleLogin(email, password);
    });
  </script>
  <script src="js/user-display.js"></script>
