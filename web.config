<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <!-- URL Rewrite rules require the IIS URL Rewrite module. Reverse proxying requires ARR with proxy enabled. -->
    <rewrite>
      <rules>
        <!-- Proxy all /api/* requests to the Node backend on localhost:8080 -->
        <rule name="Proxy API to Node" stopProcessing="true">
          <match url="^api/(.*)" ignoreCase="true" />
          <action type="Rewrite" url="http://localhost:8080/{R:0}" logRewrittenUrl="true" />
        </rule>
        <!-- Proxy /health to the Node backend so uptime checks work over your domain -->
        <rule name="Proxy Health to Node" stopProcessing="true">
          <match url="^health$" ignoreCase="true" />
          <action type="Rewrite" url="http://localhost:8080/health" logRewrittenUrl="true" />
        </rule>
        <!-- Proxy Orange Money callback pages to Node (paths used by the backend) -->
        <rule name="Proxy Payment Success Page" stopProcessing="true">
          <match url="^payment/success\.html$" ignoreCase="true" />
          <action type="Rewrite" url="http://localhost:8080/payment/success.html" logRewrittenUrl="true" />
        </rule>
        <rule name="Proxy Payment Cancel Page" stopProcessing="true">
          <match url="^payment/cancel\.html$" ignoreCase="true" />
          <action type="Rewrite" url="http://localhost:8080/payment/cancel.html" logRewrittenUrl="true" />
        </rule>
      </rules>
    </rewrite>

    <!-- Optional: Do not cache API responses at IIS; caching is handled by the backend if needed -->
    <caching>
      <profiles>
        <remove extension=\"*\" />
        <add extension=\"*\" policy=\"DisableCache\" />
      </profiles>
    </caching>
  </system.webServer>
</configuration>
