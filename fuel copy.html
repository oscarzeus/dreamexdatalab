<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSE System - GHG Calculators</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">    <style>
        .calculator-container {
            width: 100%;
            max-width: none;
            margin: 90px 0 0 0;
            padding: 0;
        }
          .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 0 15px 15px 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .page-title h2 {
            margin-bottom: 5px;
            color: var(--text-primary);
            font-size: 2rem;
        }
        
        .page-title p {
            color: var(--text-secondary);
            margin-top: 0;
            font-size: 1.1rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }        .page-container {
            width: 100%;
            max-width: none;
            margin: 0;
            padding: 0 15px;
        }.page-title {
            text-align: left;
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
          .page-subtitle {
            text-align: left;
            color: #7f8c8d;
            font-size: 1em;
            margin-bottom: 40px;
        }
        
        .calculator-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 40px;
            overflow: hidden;
        }
          .calculator-header {
            color: white;
            text-align: left;
            padding: 25px 20px;
            background: rgba(0,0,0,0.1);
        }
          .calculator-title {
            font-size: 1.5em;
            margin: 0 0 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
          .calculator-description {
            font-size: 0.9em;
            margin: 0;
            opacity: 0.9;
        }
        
        .calculator-content {
            background: white;
            padding: 30px;
        }
        
        .methodology-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #2196f3;
        }
          .methodology-title {
            color: #1565c0;
            margin: 0 0 15px 0;
            font-size: 1.1em;
        }
        
        .methodology-content p {
            margin: 8px 0;
            color: #424242;
        }
        
        .form-container {
            display: grid;
            gap: 25px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 0;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
          .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.85em;
        }
          .form-input, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .quantity-input-group {
            display: flex;
            gap: 10px;
        }
        
        .quantity-input-group .form-input {
            flex: 2;
        }
        
        .quantity-input-group .form-select {
            flex: 1;
        }        .calculate-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            width: 100%;
        }
        
        .calculate-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
          .add-calculation-button {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(33, 150, 243, 0.3);
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .add-calculation-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(33, 150, 243, 0.4);
        }
        
        .calculation-form {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .calculation-form:hover {
            border-color: #667eea;
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }
        
        .calculation-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
        }
          .calculation-form-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #495057;
            margin: 0;
        }
          .remove-calculation-button {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
        }
        
        .remove-calculation-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }
          .calculation-counter {
            background: linear-gradient(45deg, #6f42c1, #5a2d91);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            margin-right: 10px;
            box-shadow: 0 2px 6px rgba(111, 66, 193, 0.3);
        }
        
        .calculations-summary {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            border-left: 5px solid #2196f3;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
          .summary-title {
            color: #1565c0;
            margin: 0 0 15px 0;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .summary-table thead tr {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .summary-table th,
        .summary-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .summary-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .summary-table tbody tr:hover {
            background-color: #e3f2fd;
            transition: background-color 0.2s ease;
        }
        
        .summary-total {
            background: linear-gradient(135d, #d4edda 0%, #c3e6cb 100%);
            font-weight: bold;
            border-top: 3px solid #28a745;
        }
        
        .results-section {
            margin-top: 30px;
            display: none;
        }
        
        .reference-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 40px;
            overflow: hidden;
        }
          .reference-header {
            color: white;
            text-align: left;
            padding: 25px 20px;
            background: rgba(0,0,0,0.1);
        }
          .reference-title {
            font-size: 1.4em;
            margin: 0 0 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .reference-content {
            background: white;
            padding: 30px;
            overflow-x: auto;
        }
        
        .reference-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .reference-table thead tr {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .reference-table th,
        .reference-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .reference-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .reference-table tbody tr:hover {
            background-color: #e3f2fd;
            transition: background-color 0.2s ease;
        }
        
        .note-section {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
            margin-top: 20px;
        }
          .note-title {
            color: #856404;
            margin: 0 0 10px 0;
            font-size: 1em;
            font-weight: 600;
        }
        
        .note-content {
            color: #856404;
        }
        
        .note-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .note-content li {
            margin: 5px 0;
        }
          @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .quantity-input-group {
                flex-direction: column;
            }
              .calculator-title {
                font-size: 1.2em;
            }
            
            .page-title {
                font-size: 1.6em;
            }
        }
        
        /* Info tooltip styles */
        .info-tooltip {
            display: inline-block;
            margin-left: 5px;
            color: #6c757d;
            cursor: help;
            transition: color 0.2s ease;
        }        .info-tooltip:hover {
            color: #007bff;
        }
        
        /* Navigation Styles */
        .calculator-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .nav-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            color: #495057;
            min-width: 200px;
        }
        
        .nav-button:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .nav-button.active {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .calculator-section {
            display: none;
        }
          .calculator-section.active {
            display: block;
        }
        
        /* Mobile Table Selector Dropdown Styles */
        .mobile-table-selector {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }
        
        .table-select-label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .table-select-dropdown {
            width: 100%;
            padding: 12px 16px;
            font-size: 14px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background-color: white;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .table-select-dropdown:hover {
            border-color: #0056b3;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
        }
        
        .table-select-dropdown:focus {
            outline: none;
            border-color: #0056b3;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .table-select-dropdown option {
            padding: 8px;
            background-color: white;
            color: #2c3e50;
        }
        
        /* Mobile Sub-Calculator Styles */
        .mobile-sub-calculator {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .mobile-sub-calculator .methodology-section {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-left: 4px solid #2196f3;
        }
        
        .mobile-sub-calculator .methodology-title {
            color: #1565c0;        }
    </style>
    <!-- GitHub Pages Fix Script -->
    <script src="github-pages-fix.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Left Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <h2>Dreamex Datalab</h2>
            </div>
            <ul class="menu" id="roleBasedMenu">
                <li data-feature="home_view"><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                <li class="menu-dropdown" data-feature="health_view">
                    <a href="#"><i class="fas fa-medkit"></i> Health</a>
                    <ul class="submenu">
                        <li data-feature="health_assessment_view"><a href="health-assessment.html">Assessment</a></li>
                        <li data-feature="health_consultation_view"><a href="health-consultation.html">Consultation</a></li>
                        <li data-feature="medical_folder_view"><a href="medical-folder.html">Medical Folder</a></li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="safety_view">
                    <a href="#"><i class="fas fa-shield-alt"></i> Safety</a>
                    <ul class="submenu">
                        <li data-feature="training_view"><a href="trainingboard.html">Training</a></li>
                        <li data-feature="risk_view"><a href="riskboard.html">Risk Management</a></li>
                        <li data-feature="jsa_view"><a href="jsaboard.html">Job Safety Analysis</a></li>
                        <li data-feature="ptw_view"><a href="ptwboard.html">Permit to Work</a></li>
                        <li data-feature="incident_view"><a href="incidentboard.html">Incident Reports</a></li>
                        <li data-feature="inspection_view"><a href="inspectionboard.html">Inspection</a></li>
                        <li data-feature="audit_view"><a href="auditboard.html">Audit</a></li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="environment_view">
                    <a href="#" class="active"><i class="fas fa-leaf"></i> Environment</a>
                    <ul class="submenu">
                        <li data-feature="water_view"><a href="waterboard.html">Water Quality</a></li>
                        <li data-feature="gaz_view"><a href="gaz.html">GHG Calculator</a></li>
                        <li data-feature="emissions_view"><a href="emissions.html">Emissions Reporting</a></li>
                        <li data-feature="waste_view"><a href="wasteboard.html">Waste Management</a></li>
                    </ul>
                </li>
                <li class="menu-dropdown" data-feature="security_view">
                    <a href="#"><i class="fas fa-lock"></i> Security</a>
                    <ul class="submenu">
                        <li data-feature="access_view"><a href="accessboard.html">Access Request</a></li>
                        <li data-feature="access_daily_view"><a href="accessdaily.html">Daily Access Control</a></li>
                        <li data-feature="removal_view"><a href="removalboard.html">Property Removal</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <!-- Top Navigation -->
            <header class="top-nav">
                <div class="top-nav-right">
                    <div class="notifications">
                        <button id="notificationBtn" class="notification-btn">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">0</span>
                        </button>
                        <div class="notification-dropdown">
                            <div class="notification-header">
                                <h3>Notifications</h3>
                                <button class="mark-all-read">Mark all as read</button>
                            </div>
                            <div class="notification-list">
                                <!-- Notifications will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                    <div class="user-profile">
                        <button id="userProfileBtn" class="profile-btn">
                            <img src="assets/default-avatar.png" alt="User Avatar">
                        </button>
                        <div class="profile-dropdown">
                            <ul>
                                <li><a href="account.html"><i class="fas fa-user"></i> Account Settings</a></li>
                                <li><a href="#"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- GHG Calculators Content -->
            <div class="calculator-container">                <div class="page-header">
                    <div class="page-title">
                        <h2><i class="fas fa-calculator"></i> GHG Emission Calculators</h2>
                        <p>Comprehensive greenhouse gas emission calculations for stationary and mobile combustion sources</p>
                    </div>
                </div>

                <div class="page-container">
        <p class="page-subtitle">Comprehensive greenhouse gas emission calculations for stationary and mobile combustion sources</p>        <!-- Scope-Based Navigation Menu -->
        <div class="scope-zones">
            <!-- Scope 1 Zone: Direct Emissions -->
            <div class="scope-zone scope-1">
                <div class="scope-header">
                    <h3 class="scope-title">🔥 Scope 1 - Direct Emissions</h3>
                    <p class="scope-description">Direct greenhouse gas emissions from sources owned or controlled by your organization</p>
                </div>
                <div class="scope-calculators">
                    <button class="nav-button scope-1-btn active" onclick="showCalculator('stationary')">🏭 Stationary Combustion</button>
                    <button class="nav-button scope-1-btn" onclick="showCalculator('mobile')">🚗 Mobile Combustion</button>
                </div>
            </div>

            <!-- Scope 2 Zone: Indirect Energy Emissions -->
            <div class="scope-zone scope-2">
                <div class="scope-header">
                    <h3 class="scope-title">⚡ Scope 2 - Indirect Energy Emissions</h3>
                    <p class="scope-description">Indirect emissions from purchased electricity, steam, heat, and cooling</p>
                </div>
                <div class="scope-calculators">
                    <button class="nav-button scope-2-btn" onclick="showCalculator('electricity')">⚡ Electricity #1</button>
                    <button class="nav-button scope-2-btn" onclick="showCalculator('electricity2')">⚡ Electricity #2</button>
                    <button class="nav-button scope-2-btn" onclick="showCalculator('steamheat')">🔥 Steam and Heat</button>
                </div>
            </div>

            <!-- Scope 3 Zone: Other Indirect Emissions -->
            <div class="scope-zone scope-3">
                <div class="scope-header">
                    <h3 class="scope-title">🌍 Scope 3 - Other Indirect Emissions</h3>
                    <p class="scope-description">All other indirect emissions from activities across your value chain</p>
                </div>
                <div class="scope-calculators">
                    <button class="nav-button scope-3-btn" onclick="showCalculator('transportation')">🚛 Transportation</button>
                    <button class="nav-button scope-3-btn" onclick="showCalculator('business-travel')">✈️ Business Travel</button>
                    <button class="nav-button scope-3-btn" onclick="showCalculator('waste')">🗑️ Waste</button>
                </div>
            </div>
        </div>
        
        <!-- Stationary Combustion Calculator -->
        <div class="calculator-section" id="stationary-calculator">
            <div class="calculator-header">
                <h1 class="calculator-title">🏭 Stationary Combustion GHG Calculator</h1>
                <p class="calculator-description">Calculate CO₂, CH₄, and N₂O emissions from stationary fuel combustion using EPA emission factors</p>
            </div>
            
            <div class="calculator-content">
                <div class="methodology-section">
                    <h3 class="methodology-title">📊 Data Source & Methodology</h3>
                    <div class="methodology-content">
                        <p><strong>Emission Factors:</strong> EPA GHG Emission Factors Hub (2025 version)</p>
                        <p><strong>Coverage:</strong> Direct CO₂, CH₄, and N₂O emissions from fuel combustion</p>
                        <p><strong>GWP Values:</strong> IPCC AR5 100-year values (CO₂=1, CH₄=28, N₂O=265)</p>
                        <p><strong>Calculation Methods:</strong> Energy-based and mass/volume-based approaches available</p>
                    </div>
                </div>
                
                <div id="stationaryCalculations">
                    <!-- Initial calculation form will be added here by JavaScript -->
                </div>
                
                <button type="button" class="add-calculation-button" onclick="addStationaryCalculation()">
                    ➕ Add Another Stationary Calculation
                </button>
                
                <div id="stationarySummary" class="calculations-summary" style="display: none;">
                    <h3 class="summary-title">
                        📊 Stationary Combustion Summary
                    </h3>
                    <div id="stationarySummaryContent"></div>
                </div>
            </div>
        </div>

    <script>
        // Navigation Functions
        function showCalculator(calculatorType) {
            // Hide all calculator sections
            const allCalculators = document.querySelectorAll('.calculator-section');
            allCalculators.forEach(calc => {
                calc.style.display = 'none';
                calc.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            const allButtons = document.querySelectorAll('.nav-button');
            allButtons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected calculator
            const targetCalculator = document.getElementById(`${calculatorType}-calculator`);
            if (targetCalculator) {
                targetCalculator.style.display = 'block';
                targetCalculator.classList.add('active');
            }
            
            // Set active button
            const activeButton = document.querySelector(`[onclick="showCalculator('${calculatorType}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
              // If mobile calculator is selected, show default Table 2
            if (calculatorType === 'mobile') {
                const mobileTableSelect = document.getElementById('mobileTableSelect');
                if (mobileTableSelect && !mobileTableSelect.value) {
                    mobileTableSelect.value = 'table2';
                    showMobileSubCalculator('table2');
                }
            }
            
            // Initialize electricity2 calculator if needed
            if (calculatorType === 'electricity2' && electricity2CalculationCount === 0) {
                addElectricity2Calculation();
            }
        }
        
        function showMobileSubCalculator(tableType) {
            // Hide all mobile sub-calculators
            const allSubCalculators = document.querySelectorAll('.mobile-sub-calculator');
            allSubCalculators.forEach(calc => {
                calc.style.display = 'none';
            });
            
            // Show selected sub-calculator
            if (tableType) {
                const targetSubCalculator = document.getElementById(`mobile-${tableType}`);
                if (targetSubCalculator) {
                    targetSubCalculator.style.display = 'block';
                }
                
                // Initialize the appropriate calculation if needed
                switch(tableType) {
                    case 'table2':
                        if (mobileCalculationCount === 0) {
                            addMobileCalculation();
                        }
                        break;
                    case 'table3':
                        if (typeof onRoadCalculationCount !== 'undefined' && onRoadCalculationCount === 0) {
                            addOnRoadCalculation();
                        }
                        break;
                    case 'table4':
                        if (typeof dieselAltFuelCalculationCount !== 'undefined' && dieselAltFuelCalculationCount === 0) {
                            addDieselAltFuelCalculation();
                        }
                        break;
                    case 'table5':
                        if (typeof nonRoadCalculationCounter !== 'undefined' && nonRoadCalculationCounter === 0) {
                            addNonRoadCalculation();
                        }
                        break;
                }
            }
        }

        // Unit conversion factors
        const unitConversions = {
            // Energy conversions (to mmBtu)
            energy: {
                'mmBtu': 1,
                'Btu': 0.000001,
                'MJ': 0.000947817,
                'GJ': 0.947817,
                'kWh': 0.003412,
                'MWh': 3.412,
                'therm': 0.1,
                'kcal': 0.000003968,
                'Mcal': 3.968
            },
            // Mass conversions for solid fuels (to short tons)
            mass_solid: {
                'short ton': 1,
                'long ton': 1.12,
                'metric ton': 1.10231,
                'lb': 0.0005,
                'kg': 0.00110231,
                'g': 0.00000110231
            },
            // Volume conversions for liquid fuels (to gallons)
            volume_liquid: {
                'gallon': 1,
                'liter': 0.264172,
                'barrel': 42,
                'cubic meter': 264.172,
                'cubic foot': 7.48052,
                'imperial gallon': 1.20095
            },
            // Volume conversions for gaseous fuels (to scf)
            volume_gas: {
                'scf': 1,
                'ccf': 100,
                'mcf': 1000,
                'cubic meter': 35.3147,
                'cubic foot': 1,
                'therm': 96.7 // approximate for natural gas
            }
        };        // Fuel data from the spreadsheet
        const fuelData = {
            // Coal and Coke (short tons)
            "Anthracite": { 
                energyBased: { co2: 103.69, ch4: 11, n2o: 1.6 },
                massBased: { co2: 2602, ch4: 276, n2o: 40, unit: "short ton" },
                ncv: 25.09, // mmBtu/short ton
                density: 0.85, // tons/m³
                defaultEF: { method: "energy", value: 103.69, unit: "kg CO₂/mmBtu" }
            },
            "Bituminous": { 
                energyBased: { co2: 93.28, ch4: 11, n2o: 1.6 },
                massBased: { co2: 2325, ch4: 274, n2o: 40, unit: "short ton" },
                ncv: 24.93, // mmBtu/short ton
                density: 0.75, // tons/m³
                defaultEF: { method: "energy", value: 93.28, unit: "kg CO₂/mmBtu" }
            },            "Sub-bituminous": { 
                energyBased: { co2: 97.17, ch4: 11, n2o: 1.6 },
                massBased: { co2: 1676, ch4: 190, n2o: 28, unit: "short ton" },
                ncv: 17.25, // mmBtu/short ton
                density: 0.65, // tons/m³
                defaultEF: { method: "energy", value: 97.17, unit: "kg CO₂/mmBtu" }
            },
            "Lignite": { 
                energyBased: { co2: 97.72, ch4: 11, n2o: 1.6 },
                massBased: { co2: 1389, ch4: 156, n2o: 23, unit: "short ton" },
                ncv: 14.21, // mmBtu/short ton
                density: 0.55, // tons/m³
                defaultEF: { method: "energy", value: 97.72, unit: "kg CO₂/mmBtu" }
            },
            "Mixed (Commercial Sector)": { 
                energyBased: { co2: 94.27, ch4: 11, n2o: 1.6 },
                massBased: { co2: 2016, ch4: 235, n2o: 34, unit: "short ton" }
            },
            "Mixed (Electric Power Sector)": { 
                energyBased: { co2: 95.52, ch4: 11, n2o: 1.6 },
                massBased: { co2: 1885, ch4: 217, n2o: 32, unit: "short ton" }
            },
            "Mixed (Industrial Coking)": { 
                energyBased: { co2: 93.9, ch4: 11, n2o: 1.6 },
                massBased: { co2: 2468, ch4: 289, n2o: 42, unit: "short ton" }
            },
            "Mixed (Industrial Sector)": { 
                energyBased: { co2: 94.67, ch4: 11, n2o: 1.6 },
                massBased: { co2: 2116, ch4: 246, n2o: 36, unit: "short ton" }
            },
            "Coal Coke": { 
                energyBased: { co2: 113.67, ch4: 11, n2o: 1.6 },
                massBased: { co2: 2819, ch4: 273, n2o: 40, unit: "short ton" }
            },
            
            // Other Fuels - Solid (short tons)
            "Municipal Solid Waste": { 
                energyBased: { co2: 90.7, ch4: 32, n2o: 4.2 },
                massBased: { co2: 902, ch4: 318, n2o: 42, unit: "short ton" }
            },
            "Petroleum Coke (Solid)": { 
                energyBased: { co2: 102.41, ch4: 32, n2o: 4.2 },
                massBased: { co2: 3072, ch4: 960, n2o: 126, unit: "short ton" }
            },
            "Plastics": { 
                energyBased: { co2: 75, ch4: 32, n2o: 4.2 },
                massBased: { co2: 2850, ch4: 1216, n2o: 160, unit: "short ton" }
            },
            "Tires": { 
                energyBased: { co2: 85.97, ch4: 32, n2o: 4.2 },
                massBased: { co2: 2407, ch4: 896, n2o: 118, unit: "short ton" }
            },
            
            // Biomass Fuels - Solid (short tons)
            "Agricultural Byproducts": { 
                energyBased: { co2: 118.17, ch4: 32, n2o: 4.2 },
                massBased: { co2: 975, ch4: 264, n2o: 35, unit: "short ton" }
            },
            "Peat": { 
                energyBased: { co2: 111.84, ch4: 32, n2o: 4.2 },
                massBased: { co2: 895, ch4: 256, n2o: 34, unit: "short ton" }
            },
            "Solid Byproducts": { 
                energyBased: { co2: 105.51, ch4: 32, n2o: 4.2 },
                massBased: { co2: 1096, ch4: 332, n2o: 44, unit: "short ton" }
            },
            "Wood and Wood Residuals": { 
                energyBased: { co2: 93.8, ch4: 7.2, n2o: 3.6 },
                massBased: { co2: 1640, ch4: 126, n2o: 63, unit: "short ton" }
            },
              // Natural Gas (scf)
            "Natural Gas": { 
                energyBased: { co2: 53.06, ch4: 1, n2o: 0.1 },
                massBased: { co2: 0.05444, ch4: 0.00103, n2o: 0.0001, unit: "scf" },
                ncv: 1.026, // mmBtu/1000 scf
                density: 0.717, // kg/m³ at STP
                defaultEF: { method: "energy", value: 53.06, unit: "kg CO₂/mmBtu" }
            },
            
            // Other Fuels - Gaseous (scf)
            "Blast Furnace Gas": { 
                energyBased: { co2: 274.32, ch4: 0.022, n2o: 0.1 },
                massBased: { co2: 0.02524, ch4: 0.000002, n2o: 0.000009, unit: "scf" }
            },
            "Coke Oven Gas": { 
                energyBased: { co2: 46.85, ch4: 0.48, n2o: 0.1 },
                massBased: { co2: 0.02806, ch4: 0.000288, n2o: 0.00006, unit: "scf" }
            },
            "Fuel Gas": { 
                energyBased: { co2: 59, ch4: 3, n2o: 0.6 },
                massBased: { co2: 0.08189, ch4: 0.004164, n2o: 0.000833, unit: "scf" }
            },
            "Propane Gas": { 
                energyBased: { co2: 61.46, ch4: 3, n2o: 0.6 },
                massBased: { co2: 0.15463, ch4: 0.007548, n2o: 0.00151, unit: "scf" }
            },
            
            // Biomass Fuels - Gaseous (scf)
            "Landfill Gas": { 
                energyBased: { co2: 52.07, ch4: 3.2, n2o: 0.63 },
                massBased: { co2: 0.025254, ch4: 0.001552, n2o: 0.000306, unit: "scf" }
            },
            "Other Biomass Gases": { 
                energyBased: { co2: 52.07, ch4: 3.2, n2o: 0.63 },
                massBased: { co2: 0.034106, ch4: 0.002096, n2o: 0.000413, unit: "scf" }
            },
              // Petroleum Products (gallons)
            "Asphalt and Road Oil": { 
                energyBased: { co2: 75.36, ch4: 3, n2o: 0.6 },
                massBased: { co2: 11.91, ch4: 0.47, n2o: 0.09, unit: "gallon" },
                ncv: 158.1, // mmBtu/1000 gallons
                density: 1.02, // kg/L
                defaultEF: { method: "mass", value: 11.91, unit: "kg CO₂/gallon" }
            },
            "Aviation Gasoline": { 
                energyBased: { co2: 69.25, ch4: 3, n2o: 0.6 },
                massBased: { co2: 8.31, ch4: 0.36, n2o: 0.07, unit: "gallon" },
                ncv: 120.0, // mmBtu/1000 gallons
                density: 0.72, // kg/L
                defaultEF: { method: "mass", value: 8.31, unit: "kg CO₂/gallon" }
            },
            "Butane": { 
                energyBased: { co2: 64.77, ch4: 3, n2o: 0.6 },
                massBased: { co2: 6.67, ch4: 0.31, n2o: 0.06, unit: "gallon" },
                ncv: 103.0, // mmBtu/1000 gallons
                density: 0.58, // kg/L
                defaultEF: { method: "mass", value: 6.67, unit: "kg CO₂/gallon" }
            },
            "Butylene": { 
                energyBased: { co2: 68.72, ch4: 3, n2o: 0.6 },
                massBased: { co2: 7.22, ch4: 0.32, n2o: 0.06, unit: "gallon" }
            },
            "Crude Oil": { 
                energyBased: { co2: 74.54, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.29, ch4: 0.41, n2o: 0.08, unit: "gallon" }
            },            "Distillate Fuel Oil No. 1": { 
                energyBased: { co2: 73.25, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.18, ch4: 0.42, n2o: 0.08, unit: "gallon" },
                ncv: 139.0, // mmBtu/1000 gallons
                density: 0.82, // kg/L
                defaultEF: { method: "mass", value: 10.18, unit: "kg CO₂/gallon" }
            },
            "Distillate Fuel Oil No. 2": { 
                energyBased: { co2: 73.96, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.21, ch4: 0.41, n2o: 0.08, unit: "gallon" },
                ncv: 138.1, // mmBtu/1000 gallons
                density: 0.85, // kg/L
                defaultEF: { method: "mass", value: 10.21, unit: "kg CO₂/gallon" }
            },
            "Distillate Fuel Oil No. 4": { 
                energyBased: { co2: 75.04, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.96, ch4: 0.44, n2o: 0.09, unit: "gallon" },
                ncv: 146.0, // mmBtu/1000 gallons
                density: 0.90, // kg/L
                defaultEF: { method: "mass", value: 10.96, unit: "kg CO₂/gallon" }
            },
            "Ethane": { 
                energyBased: { co2: 59.6, ch4: 3, n2o: 0.6 },
                massBased: { co2: 4.05, ch4: 0.2, n2o: 0.04, unit: "gallon" }
            },
            "Ethylene": { 
                energyBased: { co2: 65.96, ch4: 3, n2o: 0.6 },
                massBased: { co2: 3.83, ch4: 0.17, n2o: 0.03, unit: "gallon" }
            },
            "Heavy Gas Oils": { 
                energyBased: { co2: 74.92, ch4: 3, n2o: 0.6 },
                massBased: { co2: 11.09, ch4: 0.44, n2o: 0.09, unit: "gallon" }
            },
            "Isobutane": { 
                energyBased: { co2: 64.94, ch4: 3, n2o: 0.6 },
                massBased: { co2: 6.43, ch4: 0.3, n2o: 0.06, unit: "gallon" }
            },
            "Isobutylene": { 
                energyBased: { co2: 68.86, ch4: 3, n2o: 0.6 },
                massBased: { co2: 7.09, ch4: 0.31, n2o: 0.06, unit: "gallon" }
            },
            "Kerosene": { 
                energyBased: { co2: 75.2, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.15, ch4: 0.41, n2o: 0.08, unit: "gallon" }
            },
            "Kerosene-Type Jet Fuel": { 
                energyBased: { co2: 72.22, ch4: 3, n2o: 0.6 },
                massBased: { co2: 9.75, ch4: 0.41, n2o: 0.08, unit: "gallon" }
            },
            "Liquefied Petroleum Gases (LPG)": { 
                energyBased: { co2: 61.71, ch4: 3, n2o: 0.6 },
                massBased: { co2: 5.68, ch4: 0.28, n2o: 0.06, unit: "gallon" }
            },
            "Lubricants": { 
                energyBased: { co2: 74.27, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.69, ch4: 0.43, n2o: 0.09, unit: "gallon" }
            },
            "Motor Gasoline": { 
                energyBased: { co2: 70.22, ch4: 3, n2o: 0.6 },
                massBased: { co2: 8.78, ch4: 0.38, n2o: 0.08, unit: "gallon" }
            },
            "Naphtha (<401 deg F)": { 
                energyBased: { co2: 68.02, ch4: 3, n2o: 0.6 },
                massBased: { co2: 8.5, ch4: 0.38, n2o: 0.08, unit: "gallon" }
            },
            "Natural Gasoline": { 
                energyBased: { co2: 66.88, ch4: 3, n2o: 0.6 },
                massBased: { co2: 7.36, ch4: 0.33, n2o: 0.07, unit: "gallon" }
            },
            "Other Oil (>401 deg F)": { 
                energyBased: { co2: 76.22, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.59, ch4: 0.42, n2o: 0.08, unit: "gallon" }
            },
            "Pentanes Plus": { 
                energyBased: { co2: 70.02, ch4: 3, n2o: 0.6 },
                massBased: { co2: 7.7, ch4: 0.33, n2o: 0.07, unit: "gallon" }
            },
            "Petrochemical Feedstocks": { 
                energyBased: { co2: 71.02, ch4: 3, n2o: 0.6 },
                massBased: { co2: 8.88, ch4: 0.38, n2o: 0.08, unit: "gallon" }
            },
            "Propane": { 
                energyBased: { co2: 62.87, ch4: 3, n2o: 0.6 },
                massBased: { co2: 5.72, ch4: 0.27, n2o: 0.05, unit: "gallon" }
            },
            "Propylene": { 
                energyBased: { co2: 67.77, ch4: 3, n2o: 0.6 },
                massBased: { co2: 6.17, ch4: 0.27, n2o: 0.05, unit: "gallon" }
            },
            "Residual Fuel Oil No. 5": { 
                energyBased: { co2: 72.93, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.21, ch4: 0.42, n2o: 0.08, unit: "gallon" }
            },
            "Residual Fuel Oil No. 6": { 
                energyBased: { co2: 75.1, ch4: 3, n2o: 0.6 },
                massBased: { co2: 11.27, ch4: 0.45, n2o: 0.09, unit: "gallon" }
            },
            "Special Naphtha": { 
                energyBased: { co2: 72.34, ch4: 3, n2o: 0.6 },
                massBased: { co2: 9.04, ch4: 0.38, n2o: 0.08, unit: "gallon" }
            },
            "Unfinished Oils": { 
                energyBased: { co2: 74.54, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.36, ch4: 0.42, n2o: 0.08, unit: "gallon" }
            },
            "Used Oil": { 
                energyBased: { co2: 74, ch4: 3, n2o: 0.6 },
                massBased: { co2: 10.21, ch4: 0.41, n2o: 0.08, unit: "gallon" }
            },
            
            // Biomass Fuels - Liquid (gallons)
            "Biodiesel (100%)": { 
                energyBased: { co2: 73.84, ch4: 1.1, n2o: 0.11 },
                massBased: { co2: 9.45, ch4: 0.14, n2o: 0.01, unit: "gallon" }
            },
            "Ethanol (100%)": { 
                energyBased: { co2: 68.44, ch4: 1.1, n2o: 0.11 },
                massBased: { co2: 5.75, ch4: 0.09, n2o: 0.01, unit: "gallon" }
            },
            "Rendered Animal Fat": { 
                energyBased: { co2: 71.06, ch4: 1.1, n2o: 0.11 },
                massBased: { co2: 8.88, ch4: 0.14, n2o: 0.01, unit: "gallon" }
            },
            "Vegetable Oil": { 
                energyBased: { co2: 81.55, ch4: 1.1, n2o: 0.11 },
                massBased: { co2: 9.79, ch4: 0.13, n2o: 0.01, unit: "gallon" }
            },
            
            // Biomass Fuels - Kraft Pulping Liquor (mmBtu only)
            "North American Softwood": { 
                energyBased: { co2: 94.4, ch4: 1.9, n2o: 0.42 },
                massBased: null
            },
            "North American Hardwood": { 
                energyBased: { co2: 93.7, ch4: 1.9, n2o: 0.42 },
                massBased: null
            },
            "Bagasse": { 
                energyBased: { co2: 95.5, ch4: 1.9, n2o: 0.42 },
                massBased: null
            },
            "Bamboo": { 
                energyBased: { co2: 93.7, ch4: 1.9, n2o: 0.42 },
                massBased: null
            },            "Straw": { 
                energyBased: { co2: 95.1, ch4: 1.9, n2o: 0.42 },
                massBased: null
            }
        };        // Mobile Combustion Emission Factors - EPA Table 2 (2025 EPA GHG Emission Factors Hub)
        const mobileCombustionEF = {
            // Official EPA Table 2 Mobile Combustion CO2, CH4, and N2O Emission Factors (10 fuel types only)
            "Aviation Gasoline": { 
                co2: 8.31, 
                ch4: 0.27, 
                n2o: 0.26, 
                unit: "gallon", 
                description: "High-octane aviation gasoline for piston aircraft",
                source: "EPA 2025 Table 2",
                uncertainty: "±5%"
            },
            "Biodiesel (100%)": { 
                co2: 9.45, 
                ch4: 0.11, 
                n2o: 0.96, 
                unit: "gallon", 
                description: "100% biodiesel from renewable sources",
                source: "EPA 2025 Table 2",
                uncertainty: "±10%"
            },
            "Compressed Natural Gas (CNG)": { 
                co2: 0.05444, 
                ch4: 1.966, 
                n2o: 0.0275, 
                unit: "scf", 
                description: "Compressed natural gas for vehicles",
                source: "EPA 2025 Table 2",
                uncertainty: "±8%"
            },
            "Diesel Fuel": { 
                co2: 10.21, 
                ch4: 0.41, 
                n2o: 0.26, 
                unit: "gallon", 
                description: "Standard diesel fuel for vehicles",
                source: "EPA 2025 Table 2",
                uncertainty: "±3%"
            },
            "Ethanol (100%)": { 
                co2: 5.75, 
                ch4: 0.055, 
                n2o: 0.067, 
                unit: "gallon", 
                description: "100% ethanol fuel",
                source: "EPA 2025 Table 2",
                uncertainty: "±12%"
            },
            "Kerosene-Type Jet Fuel": { 
                co2: 9.75, 
                ch4: 0.00, 
                n2o: 0.31, 
                unit: "gallon", 
                description: "Kerosene-based jet fuel for aviation",
                source: "EPA 2025 Table 2",
                uncertainty: "±4%"
            },
            "Liquefied Natural Gas (LNG)": { 
                co2: 4.50, 
                ch4: 1.13, 
                n2o: 0.18, 
                unit: "gallon", 
                description: "Liquefied natural gas for transport",
                source: "EPA 2025 Table 2",
                uncertainty: "±7%"
            },
            "Liquefied Petroleum Gases (LPG)": { 
                co2: 5.68, 
                ch4: 0.19, 
                n2o: 0.16, 
                unit: "gallon", 
                description: "Propane gas for vehicles and equipment",
                source: "EPA 2025 Table 2",
                uncertainty: "±6%"
            },
            "Motor Gasoline": { 
                co2: 8.78, 
                ch4: 0.41, 
                n2o: 0.22, 
                unit: "gallon", 
                description: "Standard gasoline for road vehicles",
                source: "EPA 2025 Table 2",
                uncertainty: "±3%"
            },
            "Residual Fuel Oil": { 
                co2: 11.27, 
                ch4: 0.47, 
                n2o: 0.26, 
                unit: "gallon", 
                description: "Bunker fuel for marine vessels",                source: "EPA 2025 Table 2",
                uncertainty: "±5%"
            }        };        
        
        // Electricity Emission Factors for Calculator #2 - EPA eGRID2023 Table 6 (May 2025)
        const electricity2EmissionFactors = {
            "AKGD": {
                name: "ASCC Alaska Grid",
                co2: 899.0,
                ch4: 0.086,
                n2o: 0.012,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Alaska grid with high oil and gas generation"
            },
            "AKMS": {
                name: "ASCC Miscellaneous",
                co2: 519.4,
                ch4: 0.026,
                n2o: 0.004,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Alaska miscellaneous power generation"
            },
            "AZNM": {
                name: "WECC Southwest",
                co2: 740.8,
                ch4: 0.041,
                n2o: 0.006,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Arizona and New Mexico power generation"
            },
            "CAMX": {
                name: "WECC California",
                co2: 436.7,
                ch4: 0.025,
                n2o: 0.003,
                gridLoss: 4.1,
                unit: "MWh",
                description: "California grid with high renewable penetration"
            },
            "ERCT": {
                name: "ERCOT All",
                co2: 738.0,
                ch4: 0.043,
                n2o: 0.006,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Texas ERCOT grid"
            },
            "FRCC": {
                name: "FRCC All",
                co2: 801.9,
                ch4: 0.042,
                n2o: 0.005,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Florida Reliability Coordinating Council"
            },
            "HIMS": {
                name: "HICC Miscellaneous",
                co2: 1122.1,
                ch4: 0.146,
                n2o: 0.022,
                gridLoss: 4.4,
                unit: "MWh",
                description: "Hawaii miscellaneous power generation"
            },
            "HIOA": {
                name: "HICC Oahu",
                co2: 1489.4,
                ch4: 0.134,
                n2o: 0.021,
                gridLoss: 4.4,
                unit: "MWh",
                description: "Hawaii Oahu power generation"
            },
            "MROE": {
                name: "MRO East",
                co2: 1402.0,
                ch4: 0.116,
                n2o: 0.017,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Midwest Reliability Organization East"
            },
            "MROW": {
                name: "MRO West",
                co2: 920.0,
                ch4: 0.097,
                n2o: 0.014,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Midwest Reliability Organization West"
            },
            "NEWE": {
                name: "NPCC New England",
                co2: 537.2,
                ch4: 0.063,
                n2o: 0.008,
                gridLoss: 4.2,
                unit: "MWh",
                description: "New England power generation"
            },
            "NWPP": {
                name: "WECC Northwest",
                co2: 631.7,
                ch4: 0.054,
                n2o: 0.008,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Northwest power generation"
            },
            "NYCW": {
                name: "NPCC NYC/Westchester",
                co2: 974.7,
                ch4: 0.025,
                n2o: 0.003,
                gridLoss: 4.2,
                unit: "MWh",
                description: "New York City and Westchester County"
            },
            "NYLI": {
                name: "NPCC Long Island",
                co2: 1180.7,
                ch4: 0.140,
                n2o: 0.018,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Long Island power generation"
            },
            "NYUP": {
                name: "NPCC Upstate NY",
                co2: 241.0,
                ch4: 0.011,
                n2o: 0.001,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Upstate New York power generation"
            },
            "PRMS": {
                name: "Puerto Rico Miscellaneous",
                co2: 1543.0,
                ch4: 0.077,
                n2o: 0.012,
                gridLoss: 4.4,
                unit: "MWh",
                description: "Puerto Rico power generation"
            },
            "RFCE": {
                name: "RFC East",
                co2: 594.7,
                ch4: 0.036,
                n2o: 0.005,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Reliability First Corporation East"
            },
            "RFCM": {
                name: "RFC Michigan",
                co2: 962.1,
                ch4: 0.082,
                n2o: 0.011,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Reliability First Corporation Michigan"
            },
            "RFCW": {
                name: "RFC West",
                co2: 911.3,
                ch4: 0.071,
                n2o: 0.010,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Reliability First Corporation West"
            },
            "RMPA": {
                name: "WECC Rockies",
                co2: 1036.0,
                ch4: 0.090,
                n2o: 0.013,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Rocky Mountain power generation"
            },
            "SPNO": {
                name: "SPP North",
                co2: 861.9,
                ch4: 0.087,
                n2o: 0.012,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Southwest Power Pool North"
            },
            "SPSO": {
                name: "SPP South",
                co2: 891.1,
                ch4: 0.055,
                n2o: 0.008,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Southwest Power Pool South"
            },
            "SRMV": {
                name: "SERC Mississippi Valley",
                co2: 739.4,
                ch4: 0.032,
                n2o: 0.004,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC Mississippi Valley region"
            },
            "SRMW": {
                name: "SERC Midwest",
                co2: 1238.3,
                ch4: 0.132,
                n2o: 0.019,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC Midwest region"
            },
            "SRSO": {
                name: "SERC South",
                co2: 840.9,
                ch4: 0.055,
                n2o: 0.008,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC South region"
            },
            "SRTV": {
                name: "SERC Tennessee Valley",
                co2: 895.7,
                ch4: 0.079,
                n2o: 0.011,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC Tennessee Valley region"
            },
            "SRVC": {
                name: "SERC Virginia/Carolina",
                co2: 590.2,
                ch4: 0.045,
                n2o: 0.006,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC Virginia/Carolina region"
            },
            "US": {
                name: "US Average",
                co2: 771.5,
                ch4: 0.057,
                n2o: 0.008,
                gridLoss: 4.2,
                unit: "MWh",
                description: "United States national average"
            }
        };
        
        // Electricity Emission Factors - EPA eGRID2023 Table 6 (January 2025)
        const electricityEmissionFactors = {
            "AKGD": {
                name: "ASCC Alaska Grid",
                co2: 899.0,
                ch4: 0.086,
                n2o: 0.012,
                co2_nonBaseload: 1077.1,
                ch4_nonBaseload: 0.116,
                n2o_nonBaseload: 0.016,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Alaska grid with high oil and gas generation"
            },
            "AKMS": {
                name: "ASCC Miscellaneous",
                co2: 519.4,
                ch4: 0.026,
                n2o: 0.004,
                co2_nonBaseload: 1548.6,
                ch4_nonBaseload: 0.067,
                n2o_nonBaseload: 0.012,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Alaska miscellaneous generation"
            },
            "AZNM": {
                name: "WECC Southwest",
                co2: 740.8,
                ch4: 0.041,
                n2o: 0.006,
                co2_nonBaseload: 1260.4,
                ch4_nonBaseload: 0.067,
                n2o_nonBaseload: 0.009,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Arizona and New Mexico grid"
            },
            "CAMX": {
                name: "WECC California",
                co2: 436.7,
                ch4: 0.025,
                n2o: 0.003,
                co2_nonBaseload: 1034.0,
                ch4_nonBaseload: 0.051,
                n2o_nonBaseload: 0.007,
                gridLoss: 4.1,
                unit: "MWh",
                description: "California grid with high renewable penetration"
            },
            "ERCT": {
                name: "ERCOT All",
                co2: 738.0,
                ch4: 0.043,
                n2o: 0.006,
                co2_nonBaseload: 1264.9,
                ch4_nonBaseload: 0.076,
                n2o_nonBaseload: 0.010,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Texas ERCOT grid"
            },
            "FRCC": {
                name: "FRCC All",
                co2: 801.9,
                ch4: 0.042,
                n2o: 0.005,
                co2_nonBaseload: 1034.0,
                ch4_nonBaseload: 0.045,
                n2o_nonBaseload: 0.006,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Florida Reliability Coordinating Council"
            },
            "HIMS": {
                name: "HICC Miscellaneous",
                co2: 1122.1,
                ch4: 0.146,
                n2o: 0.022,
                co2_nonBaseload: 1596.4,
                ch4_nonBaseload: 0.170,
                n2o_nonBaseload: 0.027,
                gridLoss: 4.4,
                unit: "MWh",
                description: "Hawaii miscellaneous islands"
            },
            "HIOA": {
                name: "HICC Oahu",
                co2: 1489.4,
                ch4: 0.134,
                n2o: 0.021,
                co2_nonBaseload: 1753.4,
                ch4_nonBaseload: 0.159,
                n2o_nonBaseload: 0.025,
                gridLoss: 4.4,
                unit: "MWh",
                description: "Hawaii Oahu island grid"
            },
            "MROE": {
                name: "MRO East",
                co2: 1402.0,
                ch4: 0.116,
                n2o: 0.017,
                co2_nonBaseload: 1713.8,
                ch4_nonBaseload: 0.161,
                n2o_nonBaseload: 0.023,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Midwest Reliability Organization East"
            },
            "MROW": {
                name: "MRO West",
                co2: 920.0,
                ch4: 0.097,
                n2o: 0.014,
                co2_nonBaseload: 1776.6,
                ch4_nonBaseload: 0.180,
                n2o_nonBaseload: 0.026,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Midwest Reliability Organization West"
            },
            "NEWE": {
                name: "NPCC New England",
                co2: 537.2,
                ch4: 0.063,
                n2o: 0.008,
                co2_nonBaseload: 885.2,
                ch4_nonBaseload: 0.067,
                n2o_nonBaseload: 0.009,
                gridLoss: 4.2,
                unit: "MWh",
                description: "New England grid"
            },
            "NWPP": {
                name: "WECC Northwest",
                co2: 631.7,
                ch4: 0.054,
                n2o: 0.008,
                co2_nonBaseload: 1613.4,
                ch4_nonBaseload: 0.146,
                n2o_nonBaseload: 0.021,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Pacific Northwest grid with high hydro"
            },
            "NYCW": {
                name: "NPCC NYC/Westchester",
                co2: 974.7,
                ch4: 0.025,
                n2o: 0.003,
                co2_nonBaseload: 1008.9,
                ch4_nonBaseload: 0.020,
                n2o_nonBaseload: 0.002,
                gridLoss: 4.2,
                unit: "MWh",
                description: "New York City and Westchester County"
            },
            "NYLI": {
                name: "NPCC Long Island",
                co2: 1180.7,
                ch4: 0.140,
                n2o: 0.018,
                co2_nonBaseload: 1316.6,
                ch4_nonBaseload: 0.050,
                n2o_nonBaseload: 0.006,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Long Island grid"
            },
            "NYUP": {
                name: "NPCC Upstate NY",
                co2: 241.0,
                ch4: 0.011,
                n2o: 0.001,
                co2_nonBaseload: 909.1,
                ch4_nonBaseload: 0.041,
                n2o_nonBaseload: 0.005,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Upstate New York with high hydro/nuclear"
            },
            "PRMS": {
                name: "Puerto Rico Miscellaneous",
                co2: 1543.0,
                ch4: 0.077,
                n2o: 0.012,
                co2_nonBaseload: 1636.7,
                ch4_nonBaseload: 0.072,
                n2o_nonBaseload: 0.012,
                gridLoss: null,
                unit: "MWh",
                description: "Puerto Rico grid"
            },
            "RFCE": {
                name: "RFC East",
                co2: 594.7,
                ch4: 0.036,
                n2o: 0.005,
                co2_nonBaseload: 1175.5,
                ch4_nonBaseload: 0.077,
                n2o_nonBaseload: 0.010,
                gridLoss: 4.2,
                unit: "MWh",
                description: "ReliabilityFirst Corporation East"
            },
            "RFCM": {
                name: "RFC Michigan",
                co2: 962.1,
                ch4: 0.082,
                n2o: 0.011,
                co2_nonBaseload: 1508.1,
                ch4_nonBaseload: 0.144,
                n2o_nonBaseload: 0.020,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Michigan grid"
            },
            "RFCW": {
                name: "RFC West",
                co2: 911.3,
                ch4: 0.071,
                n2o: 0.010,
                co2_nonBaseload: 1757.3,
                ch4_nonBaseload: 0.161,
                n2o_nonBaseload: 0.023,
                gridLoss: 4.2,
                unit: "MWh",
                description: "ReliabilityFirst Corporation West"
            },
            "RMPA": {
                name: "WECC Rockies",
                co2: 1036.0,
                ch4: 0.090,
                n2o: 0.013,
                co2_nonBaseload: 1620.6,
                ch4_nonBaseload: 0.124,
                n2o_nonBaseload: 0.018,
                gridLoss: 4.1,
                unit: "MWh",
                description: "Rocky Mountain Power Area"
            },
            "SPNO": {
                name: "SPP North",
                co2: 861.9,
                ch4: 0.087,
                n2o: 0.012,
                co2_nonBaseload: 1892.1,
                ch4_nonBaseload: 0.188,
                n2o_nonBaseload: 0.027,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Southwest Power Pool North"
            },
            "SPSO": {
                name: "SPP South",
                co2: 891.1,
                ch4: 0.055,
                n2o: 0.008,
                co2_nonBaseload: 1508.4,
                ch4_nonBaseload: 0.095,
                n2o_nonBaseload: 0.013,
                gridLoss: 4.2,
                unit: "MWh",
                description: "Southwest Power Pool South"
            },
            "SRMV": {
                name: "SERC Mississippi Valley",
                co2: 739.4,
                ch4: 0.032,
                n2o: 0.004,
                co2_nonBaseload: 1145.5,
                ch4_nonBaseload: 0.061,
                n2o_nonBaseload: 0.008,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC Mississippi Valley"
            },
            "SRMW": {
                name: "SERC Midwest",
                co2: 1238.3,
                ch4: 0.132,
                n2o: 0.019,
                co2_nonBaseload: 1818.6,
                ch4_nonBaseload: 0.190,
                n2o_nonBaseload: 0.027,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC Midwest"
            },
            "SRSO": {
                name: "SERC South",
                co2: 840.9,
                ch4: 0.055,
                n2o: 0.008,
                co2_nonBaseload: 1386.0,
                ch4_nonBaseload: 0.096,
                n2o_nonBaseload: 0.014,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC South"
            },
            "SRTV": {
                name: "SERC Tennessee Valley",
                co2: 895.7,
                ch4: 0.079,
                n2o: 0.011,
                co2_nonBaseload: 1665.8,
                ch4_nonBaseload: 0.154,
                n2o_nonBaseload: 0.022,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC Tennessee Valley Authority"
            },
            "SRVC": {
                name: "SERC Virginia/Carolina",
                co2: 590.2,
                ch4: 0.045,
                n2o: 0.006,
                co2_nonBaseload: 1286.8,
                ch4_nonBaseload: 0.100,
                n2o_nonBaseload: 0.014,
                gridLoss: 4.2,
                unit: "MWh",
                description: "SERC Virginia and Carolina"
            },            "US": {
                name: "US Average",
                co2: 771.5,
                ch4: 0.057,
                n2o: 0.008,
                co2_nonBaseload: 1393.7,
                ch4_nonBaseload: 0.104,
                n2o_nonBaseload: 0.015,
                gridLoss: 4.2,
                unit: "MWh",
                description: "United States national average"
            }
        };        // Steam and Heat Emission Factors (EPA Table 7, GHG Emission Factors Hub 2025)
        // Values for steam and heat purchased from district energy systems
        const steamHeatEmissionFactors = {
            "steam_heat": {
                name: "Steam and Heat",
                co2: 66.33, // kg CO2/mmBtu
                ch4: 0.001250, // kg CH4/mmBtu (1.250 g CH4/mmBtu)
                n2o: 0.000125, // kg N2O/mmBtu (0.125 g N2O/mmBtu)
                description: "Steam or heat purchased from district energy systems",
                unit: "mmBtu",
                source: "EPA Table 7, GHG Emission Factors Hub 2025",
                note: "Emission factors assume natural gas fuel is used to generate steam or heat at 80% thermal efficiency. Factors represent combustion emissions only (tank-to-wheel) and do not include upstream emissions."
            }        };        // Transportation Emission Factors (EPA Table 8, GHG Emission Factors Hub 2025)
        // Values for upstream/downstream transportation and distribution
        const transportationEmissionFactors = {
            "heavy_duty_truck": {
                name: "Medium- and Heavy-Duty Truck",
                description: "Medium and heavy-duty trucks",
                transportMode: "Ground",
                fuelType: "Various",
                co2: 1.298, // kg CO2/vehicle-mile
                ch4: 0.0000115, // kg CH4/vehicle-mile (converted from 0.0115 g)
                n2o: 0.0000376, // kg N2O/vehicle-mile (converted from 0.0376 g)
                unit: "vehicle-mile",
                unitType: "vehicle",
                source: "EPA Table 8, GHG Emission Factors Hub 2025"
            },
            "passenger_car": {
                name: "Passenger Car",
                description: "Passenger car vehicle",
                transportMode: "Ground",
                fuelType: "Various",
                co2: 0.297, // kg CO2/vehicle-mile
                ch4: 0.0000059, // kg CH4/vehicle-mile (converted from 0.0059 g)
                n2o: 0.0000053, // kg N2O/vehicle-mile (converted from 0.0053 g)
                unit: "vehicle-mile",
                unitType: "vehicle",
                source: "EPA Table 8, GHG Emission Factors Hub 2025"
            },
            "light_duty_truck": {
                name: "Light-Duty Truck",
                description: "Light-duty truck vehicle",
                transportMode: "Ground",
                fuelType: "Various",
                co2: 0.394, // kg CO2/vehicle-mile
                ch4: 0.0000109, // kg CH4/vehicle-mile (converted from 0.0109 g)
                n2o: 0.0000088, // kg N2O/vehicle-mile (converted from 0.0088 g)
                unit: "vehicle-mile",
                unitType: "vehicle",
                source: "EPA Table 8, GHG Emission Factors Hub 2025"
            },
            "heavy_duty_truck_freight": {
                name: "Medium- and Heavy-Duty Truck (Freight)",
                description: "Medium and heavy-duty trucks for freight transport",
                transportMode: "Ground",
                fuelType: "Various",
                co2: 0.186, // kg CO2/short ton-mile
                ch4: 0.0000016, // kg CH4/short ton-mile (converted from 0.0016 g)
                n2o: 0.0000054, // kg N2O/short ton-mile (converted from 0.0054 g)
                unit: "short ton-mile",
                unitType: "freight",
                source: "EPA Table 8, GHG Emission Factors Hub 2025"
            },
            "rail": {
                name: "Rail",
                description: "Rail freight transport",
                transportMode: "Rail",
                fuelType: "Various",
                co2: 0.021, // kg CO2/short ton-mile
                ch4: 0.0000016, // kg CH4/short ton-mile (converted from 0.0016 g)
                n2o: 0.0000005, // kg N2O/short ton-mile (converted from 0.0005 g)
                unit: "short ton-mile",
                unitType: "freight",
                source: "EPA Table 8, GHG Emission Factors Hub 2025"
            },
            "waterborne": {
                name: "Waterborne Craft",
                description: "Waterborne transportation",
                transportMode: "Water",
                fuelType: "Various",
                co2: 0.077, // kg CO2/short ton-mile
                ch4: 0.0000310, // kg CH4/short ton-mile (converted from 0.0310 g)
                n2o: 0.0000020, // kg N2O/short ton-mile (converted from 0.0020 g)
                unit: "short ton-mile",
                unitType: "freight",
                source: "EPA Table 8, GHG Emission Factors Hub 2025"
            },
            "aircraft": {
                name: "Aircraft",
                description: "Aircraft freight transport",
                transportMode: "Air",
                fuelType: "Jet Fuel",
                co2: 1.086, // kg CO2/short ton-mile
                ch4: 0, // kg CH4/short ton-mile (0 per table)
                n2o: 0.0000334, // kg N2O/short ton-mile (converted from 0.0334 g)
                unit: "short ton-mile",
                unitType: "freight",
                source: "EPA Table 8, GHG Emission Factors Hub 2025"
            }        };

        // Transportation calculation management
        let transportationCalculationCount = 0;
        let transportationResults = [];

        // Business Travel Emission Factors (EPA Table 10, GHG Emission Factors Hub 2025)
        // Values for business travel by various transportation modes
        const businessTravelEmissionFactors = {
            "passenger_car_a": {
                co2: 0.297, // kg CO2/vehicle-mile
                ch4: 0.0059, // g CH4/vehicle-mile
                n2o: 0.0053, // g N2O/vehicle-mile
                unit: "vehicle-mile",
                unitType: "vehicle",
                transportMode: "Personal Vehicle",
                description: "Passenger Car Type A (average fuel efficiency)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "light_duty_truck_b": {
                co2: 0.394, // kg CO2/vehicle-mile
                ch4: 0.0109, // g CH4/vehicle-mile
                n2o: 0.0088, // g N2O/vehicle-mile
                unit: "vehicle-mile",
                unitType: "vehicle",
                transportMode: "Personal Vehicle",
                description: "Light-Duty Truck Type B (SUVs, pickup trucks)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "motorcycle": {
                co2: 0.368, // kg CO2/vehicle-mile
                ch4: 0.0888, // g CH4/vehicle-mile
                n2o: 0.0188, // g N2O/vehicle-mile
                unit: "vehicle-mile",
                unitType: "vehicle",
                transportMode: "Personal Vehicle",
                description: "Motorcycle for business travel",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "intercity_rail_nec": {
                co2: 0.023, // kg CO2/passenger-mile
                ch4: 0.0010, // g CH4/passenger-mile
                n2o: 0.0001, // g N2O/passenger-mile
                unit: "passenger-mile",
                unitType: "passenger",
                transportMode: "Rail",
                description: "Intercity Rail - Northeast Corridor (Amtrak high-speed)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "intercity_rail_other": {
                co2: 0.149, // kg CO2/passenger-mile
                ch4: 0.0120, // g CH4/passenger-mile
                n2o: 0.0040, // g N2O/passenger-mile
                unit: "passenger-mile",
                unitType: "passenger",
                transportMode: "Rail",
                description: "Intercity Rail - Other Routes (conventional Amtrak)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "intercity_rail_national": {
                co2: 0.096, // kg CO2/passenger-mile
                ch4: 0.0080, // g CH4/passenger-mile
                n2o: 0.0020, // g N2O/passenger-mile
                unit: "passenger-mile",
                unitType: "passenger",
                transportMode: "Rail",
                description: "Intercity Rail - National Average (weighted average)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "commuter_rail": {
                co2: 0.133, // kg CO2/passenger-mile
                ch4: 0.0105, // g CH4/passenger-mile
                n2o: 0.0026, // g N2O/passenger-mile
                unit: "passenger-mile",
                unitType: "passenger",
                transportMode: "Rail",
                description: "Commuter Rail (regional/suburban rail systems)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "transit_rail": {
                co2: 0.093, // kg CO2/passenger-mile
                ch4: 0.0075, // g CH4/passenger-mile
                n2o: 0.0010, // g N2O/passenger-mile
                unit: "passenger-mile",
                unitType: "passenger",
                transportMode: "Rail",
                description: "Transit Rail (subway, tram, light rail)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "bus": {
                co2: 0.066, // kg CO2/passenger-mile
                ch4: 0.0046, // g CH4/passenger-mile
                n2o: 0.0019, // g N2O/passenger-mile
                unit: "passenger-mile",
                unitType: "passenger",
                transportMode: "Bus",
                description: "Bus (intercity and local bus service)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "air_short_haul": {
                co2: 0.207, // kg CO2/passenger-mile
                ch4: 0.0064, // g CH4/passenger-mile
                n2o: 0.0066, // g N2O/passenger-mile
                unit: "passenger-mile",
                unitType: "passenger",
                transportMode: "Air Travel",
                description: "Air Travel - Short Haul (< 300 miles, domestic flights)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "air_medium_haul": {
                co2: 0.129, // kg CO2/passenger-mile
                ch4: 0.0006, // g CH4/passenger-mile
                n2o: 0.0041, // g N2O/passenger-mile
                unit: "passenger-mile",
                unitType: "passenger",
                transportMode: "Air Travel",
                description: "Air Travel - Medium Haul (300-2300 miles, domestic/regional)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            },
            "air_long_haul": {
                co2: 0.163, // kg CO2/passenger-mile
                ch4: 0.0006, // g CH4/passenger-mile
                n2o: 0.0052, // g N2O/passenger-mile
                unit: "passenger-mile",
                unitType: "passenger",
                transportMode: "Air Travel",
                description: "Air Travel - Long Haul (>= 2300 miles, international flights)",
                source: "EPA Table 10, GHG Emission Factors Hub 2025"
            }
        };

                // Business Travel calculation management
                let businessTravelCalculationCount = 0;
                let businessTravelResults = [];
        
                // Add a new business travel calculation
                function addBusinessTravelCalculation() {
                    businessTravelCalculationCount++;
                    const calculationsContainer = document.getElementById('businessTravelCalculations');
                    
                    const formHtml = `
                        <div class="calculation-form" id="businessTravelForm${businessTravelCalculationCount}">
                            <div class="calculation-form-header">
                                <h4 class="calculation-form-title">
                                    <span class="calculation-counter">${businessTravelCalculationCount}</span>
                                    Business Travel Calculation #${businessTravelCalculationCount}
                                </h4>
                                ${businessTravelCalculationCount > 1 ? `<button type="button" class="remove-calculation-button" onclick="removeBusinessTravelCalculation(${businessTravelCalculationCount})">🗑️ Remove</button>` : ''}
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="travelMode${businessTravelCalculationCount}">
                                    ✈️ Travel Mode:
                                    <span class="info-tooltip" id="travelEFTooltip${businessTravelCalculationCount}" title="Select a travel mode to see emission factors" onclick="showBusinessTravelEmissionFactors(${businessTravelCalculationCount})" style="cursor: pointer; color: #0066cc;">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <select class="form-select" id="travelMode${businessTravelCalculationCount}" onchange="updateBusinessTravelInputs(${businessTravelCalculationCount})">
                                    <option value="">-- Select Travel Mode --</option>
                                    <option value="passenger_car_a">Personal Car (Average)</option>
                                    <option value="light_duty_truck_b">Light-Duty Truck (SUV/Pickup)</option>
                                    <option value="motorcycle">Motorcycle</option>
                                    <option value="bus">Bus (Intercity/Local)</option>
                                    <option value="transit_rail">Transit Rail (Subway/Light Rail)</option>
                                    <option value="commuter_rail">Commuter Rail (Regional/Suburban)</option>
                                    <option value="intercity_rail_nec">Intercity Rail - Northeast Corridor</option>
                                    <option value="intercity_rail_other">Intercity Rail - Other Routes</option>
                                    <option value="air_short_haul">Air Travel - Short Haul (<300 miles)</option>
                                    <option value="air_medium_haul">Air Travel - Medium Haul (300-2300 miles)</option>
                                    <option value="air_long_haul">Air Travel - Long Haul (>=2300 miles)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="travelDistance${businessTravelCalculationCount}">📏 Distance Traveled:</label>
                                <input type="number" class="form-input" id="travelDistance${businessTravelCalculationCount}" step="any" min="0" placeholder="Enter distance traveled">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="distanceUnit${businessTravelCalculationCount}">📏 Distance Unit:</label>
                                <select class="form-select" id="distanceUnit${businessTravelCalculationCount}">
                                    <option value="miles">Miles</option>
                                    <option value="km">Kilometers</option>
                                </select>
                            </div>
                            
                            <button type="button" class="calculate-button" onclick="calculateBusinessTravelEmissions(${businessTravelCalculationCount})">🧮 Calculate Emissions</button>
                            
                            <div class="results-section" id="businessTravelResults${businessTravelCalculationCount}" style="display: none;">
                                <div id="businessTravelResultContent${businessTravelCalculationCount}"></div>
                            </div>
                        </div>
                    `;
                    
                    calculationsContainer.insertAdjacentHTML('beforeend', formHtml);
                    updateBusinessTravelTooltip(businessTravelCalculationCount);
                }
                
                function removeBusinessTravelCalculation(calculationId) {
                    const formElement = document.getElementById(`businessTravelForm${calculationId}`);
                    if (formElement) {
                        formElement.remove();
                        // Remove from results array
                        businessTravelResults = businessTravelResults.filter(result => result.id !== calculationId);
                        updateBusinessTravelSummary();
                    }
                }
                
                function calculateBusinessTravelEmissions(calculationId) {
                    const travelMode = document.getElementById(`travelMode${calculationId}`).value;
                    const distance = parseFloat(document.getElementById(`travelDistance${calculationId}`).value);
                    const distanceUnit = document.getElementById(`distanceUnit${calculationId}`).value;
        
                    if (!travelMode || isNaN(distance) || distance <= 0) {
                        alert('Please select a travel mode and enter a valid distance value.');
                        return;
                    }
                    
                    const modeData = businessTravelEmissionFactors[travelMode];
                    
                    // Convert distance to miles for calculation
                    const distanceConversions = {
                        'miles': 1,
                        'km': 0.621371 // Kilometers to miles
                    };
                    const convertedDistance = distance * distanceConversions[distanceUnit];
                    
                    // Calculate emissions
                    const co2_kg = convertedDistance * modeData.co2;
                    const ch4_g = convertedDistance * modeData.ch4;
                    const n2o_g = convertedDistance * modeData.n2o;
                    
                    // Convert CH4 and N2O from grams to kg for CO2e calculation
                    const ch4_kg = ch4_g / 1000;
                    const n2o_kg = n2o_g / 1000;
                    
                    // Calculate CO2e using IPCC AR5 GWP values
                    const ch4_co2e = ch4_kg * 28;  // CH4 GWP = 28
                    const n2o_co2e = n2o_kg * 265; // N2O GWP = 265
                    const co2e = co2_kg + ch4_co2e + n2o_co2e;
                    
                    // Store result for summary
                    const resultIndex = businessTravelResults.findIndex(r => r.id === calculationId);
                    const result = {
                        id: calculationId,
                        travelMode,
                        modeName: modeData.transportMode,
                        distance,
                        distanceUnit,
                        convertedDistance,
                        co2_kg,
                        ch4_g,
                        n2o_g,
                        co2e
                    };
                    
                    if (resultIndex >= 0) {
                        businessTravelResults[resultIndex] = result;
                    } else {
                        businessTravelResults.push(result);
                    }
                    
                    // Display results for this specific calculation
                    const resultsDiv = document.getElementById(`businessTravelResultContent${calculationId}`);
                    resultsDiv.innerHTML = `
                        <div class="results-content">
                            <h4>📊 Business Travel Results</h4>
                            
                            <div class="input-summary">
                                <h5>Input Data</h5>
                                <p><strong>Travel Mode:</strong> ${modeData.description}</p>
                                <p><strong>Distance:</strong> ${distance} ${distanceUnit} (${convertedDistance.toFixed(2)} miles)</p>
                            </div>
                            
                            <div class="emissions-breakdown">
                                <h5>Emissions Breakdown</h5>
                                <table class="results-table">
                                    <tr>
                                        <th>Gas</th>
                                        <th>Emissions</th>
                                        <th>CO₂e</th>
                                    </tr>
                                    <tr>
                                        <td>CO₂</td>
                                        <td>${co2_kg.toFixed(4)} kg</td>
                                        <td>${co2_kg.toFixed(4)} kg CO₂e</td>
                                    </tr>
                                    <tr>
                                        <td>CH₄</td>
                                        <td>${ch4_g.toFixed(4)} g</td>
                                        <td>${ch4_co2e.toFixed(4)} kg CO₂e</td>
                                    </tr>
                                    <tr>
                                        <td>N₂O</td>
                                        <td>${n2o_g.toFixed(4)} g</td>
                                        <td>${n2o_co2e.toFixed(4)} kg CO₂e</td>
                                    </tr>
                                    <tr class="total-row">
                                        <td colspan="2"><strong>Total CO₂e</strong></td>
                                        <td><strong>${co2e.toFixed(4)} kg CO₂e</strong></td>
                                    </tr>
                                </table>
                            </div>
                            
                            <div class="calculation-notes">
                                <h5>Calculation Notes</h5>
                                <ul>
                                    <li>CO₂e calculated using IPCC AR5 100-year GWP values: CO₂=1, CH₄=28, N₂O=265</li>
                                    <li>Emission factors from EPA Table 10: Business Travel</li>
                                    <li>Distance converted to miles for calculations: ${distanceUnit === 'km' ? `${distance} km = ${convertedDistance.toFixed(2)} miles` : 'No conversion needed'}</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    
                    // Show the results section
                    document.getElementById(`businessTravelResults${calculationId}`).style.display = 'block';
                    
                    // Update summary if multiple calculations exist
                    updateBusinessTravelSummary();
                }
                
                function updateBusinessTravelSummary() {
                    if (businessTravelResults.length === 0) {
                        document.getElementById('businessTravelSummary').style.display = 'none';
                        return;
                    }
                    
                    const summaryContent = document.getElementById('businessTravelSummaryContent');
                    const totalCO2e = document.getElementById('businessTravelTotalCO2e');
                    
                    let totalEmissions = 0;
                    let summaryHTML = '';
                    
                    businessTravelResults.forEach(result => {
                        totalEmissions += result.co2e;
                        summaryHTML += `
                            <div class="summary-item">
                                <h5>Calculation #${result.id}: ${result.modeName}</h5>
                                <p>${result.distance} ${result.distanceUnit} → ${result.co2e.toFixed(4)} kg CO₂e</p>
                            </div>
                        `;
                    });
                    
                    summaryContent.innerHTML = summaryHTML;
                    totalCO2e.textContent = totalEmissions.toFixed(4);
                    document.getElementById('businessTravelSummary').style.display = 'block';
                }
                
                function updateBusinessTravelTooltip(calculationId) {
                    const travelMode = document.getElementById(`travelMode${calculationId}`).value;
                    const tooltip = document.getElementById(`travelEFTooltip${calculationId}`);
                    
                    if (travelMode && businessTravelEmissionFactors[travelMode]) {
                        const data = businessTravelEmissionFactors[travelMode];
                        
                        tooltip.title = `${data.transportMode}
                        
        📊 EPA Table 10 Emission Factors:
        • CO₂: ${data.co2} kg/mile
        • CH₄: ${data.ch4} g/mile
        • N₂O: ${data.n2o} g/mile
        
        🚗 Mode Description: ${data.description}
        📄 Source: ${data.source}
        
        💡 Click for detailed calculation methodology and GWP factors`;
                        
                        tooltip.style.color = '#28a745';
                    } else {
                        tooltip.title = 'Select a travel mode to see emission factors';
                        tooltip.style.color = '#6c757d';
                    }
                }
        
                function showBusinessTravelEmissionFactors(calculationId) {
                    const travelMode = document.getElementById(`travelMode${calculationId}`).value;
                    
                    if (!travelMode || !businessTravelEmissionFactors[travelMode]) {
                        alert('Please select a travel mode first.');
                        return;
                    }
                    
                    const data = businessTravelEmissionFactors[travelMode];
                    const ch4CO2e = data.ch4 / 1000 * 28; // Convert g to kg, multiply by GWP
                    const n2oCO2e = data.n2o / 1000 * 265; // Convert g to kg, multiply by GWP
                    const totalCO2e = data.co2 + ch4CO2e + n2oCO2e;
        
                    // Create modal HTML
                    const modalContent = `
                        <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto;">
                            <h2 style="color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 10px;">
                                📊 EPA Business Travel Emission Factors - ${data.transportMode}
                            </h2>
                            
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <h3 style="margin-top: 0; color: #333;">✈️ Mode Information</h3>
                                <p><strong>Description:</strong> ${data.description}</p>
                                <p><strong>Unit Type:</strong> ${data.unitType === 'vehicle' ? 'Vehicle-based' : 'Passenger-based'}</p>
                                <p><strong>Measurement Unit:</strong> Per ${data.unit}</p>
                            </div>
        
                            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <h3 style="margin-top: 0; color: #856404;">ℹ️ Emission Factors</h3>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>CO₂: ${data.co2} kg/mile</li>
                                    <li>CH₄: ${data.ch4} g/mile</li>
                                    <li>N₂O: ${data.n2o} g/mile</li>
                                </ul>
                            </div>
        
                            <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <h3 style="margin-top: 0; color: #155724;">🌱 CO₂e Conversion</h3>
                                <p style="margin-bottom: 10px;">Total CO₂e per mile traveled:</p>
                                <ul style="margin: 0; padding-left: 20px;">
                                    <li>CO₂: ${data.co2} kg × 1 = ${data.co2.toFixed(4)} kg CO₂e</li>
                                    <li>CH₄: ${data.ch4} g ÷ 1000 × 28 = ${ch4CO2e.toFixed(4)} kg CO₂e</li>
                                    <li>N₂O: ${data.n2o} g ÷ 1000 × 265 = ${n2oCO2e.toFixed(4)} kg CO₂e</li>
                                    <li><strong>Total: ${totalCO2e.toFixed(4)} kg CO₂e/mile</strong></li>
                                </ul>
                            </div>
        
                            <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <h3 style="margin-top: 0; color: #1976d2;">📋 Calculation Notes</h3>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>All emission factors are standardized to per-mile basis</li>
                                    <li>CO₂e calculated using IPCC AR5 100-year GWP values</li>
                                    <li>CH₄ and N₂O values are converted from grams to kilograms (÷1000)</li>
                                    <li>Factors represent direct emissions from travel activities</li>
                                    <li>Source: ${data.source}</li>
                                </ul>
                            </div>
                        </div>                    `;
                    
                    showModal(modalContent);
                }

                // Function to display modal content
                function showModal(content) {
                    // Create modal overlay
                    const modal = document.createElement('div');
                    modal.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.5);
                        z-index: 10000;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 20px;
                        box-sizing: border-box;
                    `;
                    
                    // Create modal dialog
                    const modalDialog = document.createElement('div');
                    modalDialog.style.cssText = `
                        background: white;
                        border-radius: 12px;
                        max-width: 90%;
                        max-height: 90%;
                        overflow-y: auto;
                        padding: 20px;
                        position: relative;
                        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                    `;
                    
                    // Create close button
                    const closeButton = document.createElement('button');
                    closeButton.innerHTML = '✕';
                    closeButton.style.cssText = `
                        position: absolute;
                        top: 15px;
                        right: 15px;
                        background: #dc3545;
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 30px;
                        height: 30px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: bold;
                    `;
                    closeButton.onclick = () => modal.remove();
                    
                    // Set content and append elements
                    modalDialog.innerHTML = content;
                    modalDialog.appendChild(closeButton);
                    modal.appendChild(modalDialog);
                    document.body.appendChild(modal);
                    
                    // Close modal on outside click
                    modal.onclick = (e) => {
                        if (e.target === modal) modal.remove();
                    };
                }

        // Waste calculation management
        let wasteCalculationCount = 0;
        let wasteResults = [];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing calculators...');
            // Add initial calculation forms
            addStationaryCalculation();
            addMobileCalculation();
            addOnRoadCalculation();
            addDieselAltFuelCalculation();            console.log('Calling addElectricityCalculation...');            addElectricityCalculation();
            addElectricity2Calculation();
            addSteamHeatCalculation();
            addTransportationCalculation();
            addWasteCalculation();
            addBusinessTravelCalculation();
            
            console.log('All calculators initialized');
        });
        
        // Stationary calculation management
        let stationaryCalculationCount = 0;
        let stationaryResults = [];
          // Mobile calculation management
        let mobileCalculationCount = 0;
        let mobileResults = [];        // Electricity calculation management
        let electricityCalculationCount = 0;
        let electricityResults = [];
          // Electricity #2 calculation management
        let electricity2CalculationCount = 0;
        let electricity2Results = [];
        
        // Steam and Heat calculation management
        let steamHeatCalculationCount = 0;
        let steamHeatResults = [];
        
        function addStationaryCalculation() {
            stationaryCalculationCount++;
            const calculationsContainer = document.getElementById('stationaryCalculations');
            
            const formHtml = `
                <div class="calculation-form" id="stationaryForm${stationaryCalculationCount}">
                    <div class="calculation-form-header">
                        <h4 class="calculation-form-title">
                            <span class="calculation-counter">${stationaryCalculationCount}</span>
                            Stationary Calculation #${stationaryCalculationCount}
                        </h4>
                        ${stationaryCalculationCount > 1 ? `<button type="button" class="remove-calculation-button" onclick="removeStationaryCalculation(${stationaryCalculationCount})">🗑️ Remove</button>` : ''}
                    </div>
                    
                    <div class="form-container">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="calculationMethod${stationaryCalculationCount}">🔢 Calculation Method:</label>
                                <select class="form-select" id="calculationMethod${stationaryCalculationCount}" onchange="updateStationaryMethodAndTooltip(${stationaryCalculationCount})">>
                                    <option value="energy">Energy-Based (supports multiple energy units)</option>
                                    <option value="mass">Mass/Volume-Based (supports multiple units)</option>
                                </select>
                            </div>                            <div class="form-group">
                                <label class="form-label" for="fuelType${stationaryCalculationCount}">🛢️ Fuel Type:
                                    <span class="info-tooltip" id="stationaryEFTooltip${stationaryCalculationCount}" title="Select a fuel type to see emission factors" onclick="showStationaryEmissionFactors(${stationaryCalculationCount})" style="cursor: pointer; color: #0066cc;">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <select class="form-select" id="fuelType${stationaryCalculationCount}" onchange="updateStationaryTooltipAndAvailability(${stationaryCalculationCount})">>
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label" id="quantityLabel${stationaryCalculationCount}">⚖️ Fuel Quantity:</label>
                            <div class="quantity-input-group">
                                <input type="number" class="form-input" id="quantity${stationaryCalculationCount}" step="any" min="0" placeholder="Enter quantity">
                                <select class="form-select" id="unitSelect${stationaryCalculationCount}">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        
                        <button type="button" class="calculate-button" onclick="calculateStationaryEmissions(${stationaryCalculationCount})">🧮 Calculate Emissions</button>
                    </div>
                    
                    <div class="results-section" id="stationaryResults${stationaryCalculationCount}" style="display: none;">
                        <div id="stationaryResultContent${stationaryCalculationCount}"></div>
                    </div>
                </div>
            `;
            
            calculationsContainer.insertAdjacentHTML('beforeend', formHtml);
            
            // Populate fuel type dropdown for this calculation
            const fuelTypeSelect = document.getElementById(`fuelType${stationaryCalculationCount}`);
            for (const fuel in fuelData) {
                const option = document.createElement('option');
                option.value = fuel;
                option.textContent = fuel;
                fuelTypeSelect.appendChild(option);
            }
              // Initialize the form
            updateStationaryQuantityLabel(stationaryCalculationCount);
            checkStationaryMassBasedAvailability(stationaryCalculationCount);
            populateStationaryUnitOptions(stationaryCalculationCount);
            updateStationaryTooltip(stationaryCalculationCount);
        }
        
        function removeStationaryCalculation(calculationId) {
            const formElement = document.getElementById(`stationaryForm${calculationId}`);
            if (formElement) {
                formElement.remove();
                // Remove from results array
                stationaryResults = stationaryResults.filter(result => result.id !== calculationId);
                updateStationarySummary();
            }
        }
        
        function addMobileCalculation() {
            mobileCalculationCount++;
            const calculationsContainer = document.getElementById('mobileCalculations');
            
            const formHtml = `
                <div class="calculation-form" id="mobileForm${mobileCalculationCount}">
                    <div class="calculation-form-header">
                        <h4 class="calculation-form-title">
                            <span class="calculation-counter">${mobileCalculationCount}</span>
                            Mobile Calculation #${mobileCalculationCount}
                        </h4>
                        ${mobileCalculationCount > 1 ? `<button type="button" class="remove-calculation-button" onclick="removeMobileCalculation(${mobileCalculationCount})">🗑️ Remove</button>` : ''}
                    </div>
                    
                    <div class="form-container">                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="mobileMethod${mobileCalculationCount}">📏 Calculation Method:</label>                                <select class="form-select" id="mobileMethod${mobileCalculationCount}" onchange="updateMobileMethodUnits(${mobileCalculationCount})">
                                    <option value="volume-based">Volume-based (EPA Table 2)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="mobileFuel${mobileCalculationCount}">
                                    🛢️ Select Fuel Type:
                                    <span class="info-tooltip" id="mobileEFTooltip${mobileCalculationCount}" title="Select a fuel type to see emission factors" onclick="showMobileEmissionFactors(${mobileCalculationCount})" style="cursor: pointer; color: #0066cc;">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>                                <select class="form-select" id="mobileFuel${mobileCalculationCount}" onchange="updateMobileTooltip(${mobileCalculationCount})">
                                    <option value="">-- Select Fuel Type --</option>
                                    <option value="Aviation Gasoline">Aviation Gasoline</option>
                                    <option value="Biodiesel (100%)">Biodiesel (100%)</option>
                                    <option value="Compressed Natural Gas (CNG)">Compressed Natural Gas (CNG)</option>
                                    <option value="Diesel Fuel">Diesel Fuel</option>
                                    <option value="Ethanol (100%)">Ethanol (100%)</option>
                                    <option value="Kerosene-Type Jet Fuel">Kerosene-Type Jet Fuel</option>
                                    <option value="Liquefied Natural Gas (LNG)">Liquefied Natural Gas (LNG)</option>
                                    <option value="Liquefied Petroleum Gases (LPG)">Liquefied Petroleum Gases (LPG)</option>
                                    <option value="Motor Gasoline">Motor Gasoline</option>
                                    <option value="Residual Fuel Oil">Residual Fuel Oil</option>
                                </select>
                            </div>
                              <div class="form-group">
                                <label class="form-label" for="mobileUnit${mobileCalculationCount}">📏 Unit:</label>
                                <select class="form-select" id="mobileUnit${mobileCalculationCount}">
                                    <option value="gallons">Gallons (US)</option>
                                    <option value="liters">Liters</option>
                                    <option value="barrels">Barrels</option>
                                    <option value="kg" style="display:none;">Kilograms</option>
                                    <option value="tonnes" style="display:none;">Tonnes</option>
                                    <option value="TJ" style="display:none;">Terajoules (TJ)</option>
                                    <option value="GJ" style="display:none;">Gigajoules (GJ)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label" for="mobileQuantity${mobileCalculationCount}">🔢 Fuel Quantity:</label>
                            <input type="number" class="form-input" id="mobileQuantity${mobileCalculationCount}" step="any" min="0" placeholder="Enter fuel quantity">
                        </div>
                        
                        <button type="button" class="calculate-button" onclick="calculateMobileEmissions(${mobileCalculationCount})">🧮 Calculate Mobile Emissions</button>
                    </div>
                    
                    <div class="results-section" id="mobileResults${mobileCalculationCount}" style="display: none;">
                        <div id="mobileResultContent${mobileCalculationCount}"></div>
                    </div>
                </div>
            `;
            
            calculationsContainer.insertAdjacentHTML('beforeend', formHtml);
        }
        
        function removeMobileCalculation(calculationId) {
            const formElement = document.getElementById(`mobileForm${calculationId}`);
            if (formElement) {
                formElement.remove();
                // Remove from results array
                mobileResults = mobileResults.filter(result => result.id !== calculationId);
                updateMobileSummary();
            }        }
        
        // Electricity Calculator Functions
        function addElectricityCalculation() {
            electricityCalculationCount++;
            const calculationsContainer = document.getElementById('electricityCalculations');
            
            const formHtml = `
                <div class="calculation-form" id="electricityForm${electricityCalculationCount}">
                    <div class="calculation-form-header">
                        <h4 class="calculation-form-title">
                            <span class="calculation-counter">${electricityCalculationCount}</span>
                            Electricity Calculation #${electricityCalculationCount}
                        </h4>
                        ${electricityCalculationCount > 1 ? `<button type="button" class="remove-calculation-button" onclick="removeElectricityCalculation(${electricityCalculationCount})">🗑️ Remove</button>` : ''}
                    </div>
                    
                    <div class="form-container">
                        <div class="form-row">                            <div class="form-group">
                                <label class="form-label" for="electricityRegion${electricityCalculationCount}">
                                    🌍 eGRID Subregion:
                                    <span class="info-tooltip" id="electricityEFTooltip${electricityCalculationCount}" 
                                          title="Select a region to see emission factors" 
                                          onclick="showElectricityEmissionFactors(${electricityCalculationCount})" 
                                          style="cursor: pointer; color: #6c757d; margin-left: 8px; padding: 4px; border-radius: 4px; background: #f8f9fa; border: 1px solid #dee2e6; transition: all 0.2s ease;">
                                        <i class="fas fa-info-circle"></i> EPA Factors
                                    </span>
                                </label><select class="form-select" id="electricityRegion${electricityCalculationCount}" onchange="updateElectricityTooltip(${electricityCalculationCount})">
                                    <option value="">-- Select eGRID Subregion --</option>
                                    <option value="US">🇺🇸 US Average</option>
                                    <optgroup label="Alaska (ASCC)">
                                        <option value="AKGD">ASCC Alaska Grid</option>
                                        <option value="AKMS">ASCC Miscellaneous</option>
                                    </optgroup>
                                    <optgroup label="Western (WECC)">
                                        <option value="AZNM">WECC Southwest</option>
                                        <option value="CAMX">WECC California</option>
                                        <option value="NWPP">WECC Northwest</option>
                                        <option value="RMPA">WECC Rockies</option>
                                    </optgroup>
                                    <optgroup label="Texas (ERCOT)">
                                        <option value="ERCT">ERCOT All</option>
                                    </optgroup>
                                    <optgroup label="Florida (FRCC)">
                                        <option value="FRCC">FRCC All</option>
                                    </optgroup>
                                    <optgroup label="Hawaii (HICC)">
                                        <option value="HIMS">HICC Miscellaneous</option>
                                        <option value="HIOA">HICC Oahu</option>
                                    </optgroup>
                                    <optgroup label="Midwest (MRO)">
                                        <option value="MROE">MRO East</option>
                                        <option value="MROW">MRO West</option>
                                    </optgroup>
                                    <optgroup label="Northeast (NPCC)">
                                        <option value="NEWE">NPCC New England</option>
                                        <option value="NYCW">NPCC NYC/Westchester</option>
                                        <option value="NYLI">NPCC Long Island</option>
                                        <option value="NYUP">NPCC Upstate NY</option>
                                    </optgroup>
                                    <optgroup label="Mid-Atlantic (RFC)">
                                        <option value="RFCE">RFC East</option>
                                        <option value="RFCM">RFC Michigan</option>
                                        <option value="RFCW">RFC West</option>
                                    </optgroup>
                                    <optgroup label="South Central (SPP)">
                                        <option value="SPNO">SPP North</option>
                                        <option value="SPSO">SPP South</option>
                                    </optgroup>
                                    <optgroup label="Southeast (SERC)">
                                        <option value="SRMV">SERC Mississippi Valley</option>
                                        <option value="SRMW">SERC Midwest</option>
                                        <option value="SRSO">SERC South</option>
                                        <option value="SRTV">SERC Tennessee Valley</option>
                                        <option value="SRVC">SERC Virginia/Carolina</option>
                                    </optgroup>
                                    <optgroup label="Puerto Rico">
                                        <option value="PRMS">Puerto Rico Miscellaneous</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="electricityUnit${electricityCalculationCount}">📏 Unit:</label>
                                <select class="form-select" id="electricityUnit${electricityCalculationCount}">
                                    <option value="MWh">MWh (Megawatt-hours)</option>
                                    <option value="kWh">kWh (Kilowatt-hours)</option>
                                    <option value="GWh">GWh (Gigawatt-hours)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label" for="electricityQuantity${electricityCalculationCount}">⚡ Electricity Consumption:</label>
                            <input type="number" class="form-input" id="electricityQuantity${electricityCalculationCount}" step="any" min="0" placeholder="Enter electricity consumption">
                        </div>
                        
                        <button type="button" class="calculate-button" onclick="calculateElectricityEmissions(${electricityCalculationCount})">🧮 Calculate Electricity Emissions</button>
                    </div>
                    
                    <div class="results-section" id="electricityResults${electricityCalculationCount}" style="display: none;">
                        <div id="electricityResultContent${electricityCalculationCount}"></div>
                    </div>
                </div>
            `;
            
            calculationsContainer.insertAdjacentHTML('beforeend', formHtml);
            
            // Set default region to US Average
            document.getElementById(`electricityRegion${electricityCalculationCount}`).value = 'US';
            updateElectricityTooltip(electricityCalculationCount);
        }
        
        function removeElectricityCalculation(calculationId) {
            const formElement = document.getElementById(`electricityForm${calculationId}`);
            if (formElement) {
                formElement.remove();
                // Remove from results array
                electricityResults = electricityResults.filter(result => result.id !== calculationId);
                updateElectricitySummary();
            }
        }
        
        function calculateElectricityEmissions(calculationId) {
            const region = document.getElementById(`electricityRegion${calculationId}`).value;
            const quantity = parseFloat(document.getElementById(`electricityQuantity${calculationId}`).value);
            const selectedUnit = document.getElementById(`electricityUnit${calculationId}`).value;

            if (!region || isNaN(quantity) || quantity <= 0) {
                alert('Please select a region and enter a valid electricity consumption.');
                return;
            }

            const regionData = electricityEmissionFactors[region];
            
            // Convert quantity to MWh for calculation
            let convertedQuantity = quantity;
            let conversionFactor = 1;
            let conversionNote = '';

            switch(selectedUnit) {
                case 'kWh':
                    conversionFactor = 0.001;
                    convertedQuantity = quantity * conversionFactor;
                    conversionNote = `${quantity} kWh = ${convertedQuantity.toFixed(6)} MWh (conversion factor: ${conversionFactor})`;
                    break;
                case 'GWh':
                    conversionFactor = 1000;
                    convertedQuantity = quantity * conversionFactor;
                    conversionNote = `${quantity} GWh = ${convertedQuantity.toFixed(6)} MWh (conversion factor: ${conversionFactor})`;
                    break;
                case 'MWh':
                default:
                    conversionNote = 'No conversion needed (already in MWh)';
                    break;
            }

            // Calculate emissions (EPA factors are in lb/MWh, convert to kg)
            const lbToKg = 0.453592; // conversion factor
            const gToKg = 0.001; // conversion factor for CH4 and N2O

            // CO2 emissions (lb CO2/MWh -> kg CO2)
            const co2_kg = convertedQuantity * regionData.co2 * lbToKg;
            
            // CH4 emissions (lb CH4/MWh -> g CH4 -> kg CH4)
            const ch4_g = convertedQuantity * regionData.ch4 * lbToKg * 1000; // convert to grams
            const ch4_kg = ch4_g * gToKg;
            
            // N2O emissions (lb N2O/MWh -> g N2O -> kg N2O)
            const n2o_g = convertedQuantity * regionData.n2o * lbToKg * 1000; // convert to grams
            const n2o_kg = n2o_g * gToKg;

            // Calculate CO2e using IPCC AR5 GWP values
            const ch4_co2e = ch4_kg * 28;
            const n2o_co2e = n2o_kg * 265;
            const co2e = co2_kg + ch4_co2e + n2o_co2e;

            // Store result for summary
            const resultIndex = electricityResults.findIndex(r => r.id === calculationId);
            const result = {
                id: calculationId,
                region,
                regionName: regionData.name,
                quantity,
                unit: selectedUnit,
                convertedQuantity,
                co2_kg,
                ch4_g,
                n2o_g,
                co2e,
                conversionNote
            };

            if (resultIndex >= 0) {
                electricityResults[resultIndex] = result;
            } else {
                electricityResults.push(result);
            }

            // Display results for this specific calculation
            const resultsDiv = document.getElementById(`electricityResultContent${calculationId}`);
            resultsDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>⚡ Electricity Calculation #${calculationId} Results</h4>
                    <div style="background-color: #e1f5fe; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #01579b; margin-top: 0;">📊 Input Summary</h5>
                        <p><strong>eGRID Subregion:</strong> ${regionData.name} (${region})</p>
                        <p><strong>Input Consumption:</strong> ${quantity} ${selectedUnit}</p>
                        ${selectedUnit !== 'MWh' ? `<p><strong>Converted Consumption:</strong> ${convertedQuantity.toFixed(6)} MWh</p>` : ''}
                        <p><strong>Emission Factors Source:</strong> EPA eGRID2023 Table 6</p>
                    </div>
                    
                    <div style="background-color: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #2e7d32; margin-top: 0;">🎯 Final Results</h5>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="background-color: #c8e6c9;">
                                <th style="padding: 8px; border: 1px solid #81c784;">Emission Type</th>
                                <th style="padding: 8px; border: 1px solid #81c784; text-align: right;">Amount</th>
                                <th style="padding: 8px; border: 1px solid #81c784; text-align: left;">Unit</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>CO₂</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${co2_kg.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">kg</td>
                            </tr>
                            <tr style="background-color: #f1f8e9;">
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>CH₄</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${ch4_g.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">g</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>N₂O</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${n2o_g.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">g</td>
                            </tr>
                            <tr style="background-color: #4caf50; color: white;">
                                <td style="padding: 10px; border: 1px solid #388e3c;"><strong>Total CO₂e</strong></td>
                                <td style="padding: 10px; border: 1px solid #388e3c; text-align: right; font-size: 0.9em;"><strong>${co2e.toFixed(2)}</strong></td>
                                <td style="padding: 10px; border: 1px solid #388e3c; text-align: left; font-size: 0.9em;"><strong>kg CO₂e</strong></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="background-color: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #ef6c00; margin-top: 0;">🔬 Calculation Details</h5>
                        <p><strong>Emission Factors Applied (EPA eGRID2023):</strong></p>
                        <ul>
                            <li>CO₂: ${regionData.co2} lb/MWh → ${(regionData.co2 * lbToKg).toFixed(3)} kg/MWh</li>
                            <li>CH₄: ${regionData.ch4} lb/MWh → ${(regionData.ch4 * lbToKg * 1000).toFixed(3)} g/MWh</li>
                            <li>N₂O: ${regionData.n2o} lb/MWh → ${(regionData.n2o * lbToKg * 1000).toFixed(3)} g/MWh</li>
                        </ul>
                        
                        <p><strong>CO₂e Calculation (IPCC AR5 GWP):</strong></p>
                        <ul>
                            <li>CO₂: ${co2_kg.toFixed(3)} kg × 1 = ${co2_kg.toFixed(3)} kg CO₂e</li>
                            <li>CH₄: ${ch4_kg.toFixed(6)} kg × 28 = ${ch4_co2e.toFixed(3)} kg CO₂e</li>
                            <li>N₂O: ${n2o_kg.toFixed(6)} kg × 265 = ${n2o_co2e.toFixed(3)} kg CO₂e</li>
                        </ul>
                        
                        ${selectedUnit !== 'MWh' ? `<p><strong>Unit Conversion:</strong> ${conversionNote}</p>` : ''}
                        ${regionData.gridLoss ? `<p><strong>Grid Loss Factor:</strong> ${regionData.gridLoss}% (for informational purposes only)</p>` : ''}
                    </div>
                </div>
            `;

            // Show the results section for this calculation
            document.getElementById(`electricityResults${calculationId}`).style.display = 'block';

            // Update summary if multiple calculations exist
            updateElectricitySummary();
        }
        
        function updateElectricitySummary() {
            if (electricityResults.length === 0) {
                document.getElementById('electricitySummary').style.display = 'none';
                return;
            }

            const summaryContent = document.getElementById('electricitySummaryContent');
            const totalCO2e = document.getElementById('electricityTotalCO2e');

            let totalEmissions = 0;
            let summaryHTML = '';

            electricityResults.forEach((result, index) => {
                totalEmissions += result.co2e;
                summaryHTML += `
                    <div class="summary-item">
                        <h5>Calculation #${result.id}: ${result.regionName}</h5>
                        <p>${result.quantity} ${result.unit} → ${result.co2e.toFixed(2)} kg CO₂e</p>
                    </div>
                `;
            });

            summaryContent.innerHTML = summaryHTML;
            totalCO2e.textContent = totalEmissions.toFixed(2);
            document.getElementById('electricitySummary').style.display = 'block';
        }
          function updateElectricityTooltip(calculationId) {
            const region = document.getElementById(`electricityRegion${calculationId}`).value;
            const tooltip = document.getElementById(`electricityEFTooltip${calculationId}`);
            
            if (region && electricityEmissionFactors[region]) {
                const data = electricityEmissionFactors[region];
                const lbToKg = 0.453592;
                
                // Enhanced tooltip with more comprehensive information
                tooltip.title = `${data.name} (${region})
                
📊 EPA eGRID2023 Total Output Emission Factors:
• CO₂: ${data.co2} lb/MWh (${(data.co2 * lbToKg).toFixed(1)} kg/MWh)
• CH₄: ${data.ch4} lb/MWh (${(data.ch4 * lbToKg * 1000).toFixed(2)} g/MWh)
• N₂O: ${data.n2o} lb/MWh (${(data.n2o * lbToKg * 1000).toFixed(2)} g/MWh)

📍 ${data.description}
${data.gridLoss ? `⚠️ Grid Loss: ${data.gridLoss}%` : ''}

💡 Click info icon for detailed view with GWP factors and calculation notes
📄 Source: EPA eGRID2023 Summary Tables`;
                
                // Update icon style to indicate data is available
                tooltip.style.color = '#28a745';
                tooltip.innerHTML = '<i class="fas fa-info-circle"></i>';
            } else {
                tooltip.title = 'Select an eGRID subregion to see emission factors';
                tooltip.style.color = '#6c757d';
                tooltip.innerHTML = '<i class="fas fa-info-circle"></i>';
            }
        }
          function showElectricityEmissionFactors(calculationId) {
            const region = document.getElementById(`electricityRegion${calculationId}`).value;
            
            if (!region || !electricityEmissionFactors[region]) {
                alert('Please select an eGRID subregion first.');
                return;
            }
            
            const data = electricityEmissionFactors[region];
            const lbToKg = 0.453592;
            
            // Create a more comprehensive modal-style display
            const modalContent = `
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <h2 style="color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 10px;">
                        📊 EPA eGRID2023 Total Output Emission Factors
                    </h2>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #333;">🌍 ${data.name}</h3>
                        <p style="margin: 5px 0;"><strong>eGRID Code:</strong> ${region}</p>
                        <p style="margin: 5px 0;"><strong>Description:</strong> ${data.description}</p>
                    </div>
                    
                    <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #0066cc;">⚡ Emission Factors (Total Output)</h3>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                            <thead>
                                <tr style="background: #d1ecf1;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #bee5eb;">Gas</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">EPA Units<br>(lb/MWh)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">Metric Units<br>(kg or g/MWh)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">GWP Factor<br>(AR5)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #bee5eb;"><strong>CO₂</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">${data.co2}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">${(data.co2 * lbToKg).toFixed(1)} kg/MWh</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">1</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #bee5eb;"><strong>CH₄</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">${data.ch4}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">${(data.ch4 * lbToKg * 1000).toFixed(2)} g/MWh</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">28</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #bee5eb;"><strong>N₂O</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">${data.n2o}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">${(data.n2o * lbToKg * 1000).toFixed(2)} g/MWh</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #bee5eb;">265</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    ${data.gridLoss ? `
                    <div style="background: #fff3cd; padding: 10px; border-radius: 6px; margin: 15px 0;">
                        <p style="margin: 0;"><strong>⚠️ Grid Loss Factor:</strong> ${data.gridLoss}%</p>
                    </div>
                    ` : ''}
                    
                    <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="margin-top: 0; color: #155724;">📋 Calculation Notes</h4>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Total Output Emission Factors include all electricity generation sources</li>
                            <li>Factors represent combustion emissions only (tank-to-wheel)</li>
                            <li>Does not include upstream life-cycle emissions</li>
                            <li>CO₂e calculated using IPCC AR5 100-year GWP values</li>
                            <li>Data updated annually with ~2-year lag</li>
                        </ul>
                    </div>
                    
                    <div style="border-top: 1px solid #dee2e6; padding-top: 15px; font-size: 0.9em; color: #6c757d;">
                        <p style="margin: 5px 0;"><strong>Data Source:</strong> EPA eGRID2023 Summary Tables (January 2025)</p>
                        <p style="margin: 5px 0;"><strong>Reference:</strong> <a href="https://www.epa.gov/system/files/documents/2025-01/egrid2023_summary_tables.xlsx" target="_blank" style="color: #0066cc;">EPA eGRID2023 Summary Tables</a></p>
                        <p style="margin: 5px 0;"><strong>Standard:</strong> EPA eGRID methodology following 40 CFR Part 75</p>
                    </div>
                </div>
            `;
            
            // Create and show modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            const modalDialog = document.createElement('div');
            modalDialog.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 20px;
                max-width: 800px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                position: relative;
            `;
            
            const closeButton = document.createElement('button');
            closeButton.innerHTML = '✕';
            closeButton.style.cssText = `
                position: absolute;
                top: 15px;
                right: 15px;
                background: #dc3545;
                color: white;
                border: none;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
            `;
            closeButton.onclick = () => modal.remove();
            
            modalDialog.innerHTML = modalContent;
            modalDialog.appendChild(closeButton);
            modal.appendChild(modalDialog);
            document.body.appendChild(modal);
            
            // Close modal on outside click
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };        }

        // Electricity Calculator #2 Functions
        function addElectricity2Calculation() {
            electricity2CalculationCount++;
            const calculationsContainer = document.getElementById('electricity2Calculations');
            
            const formHtml = `
                <div class="calculation-form" id="electricity2Form${electricity2CalculationCount}">                    <div class="calculation-form-header">
                        <h4 class="calculation-form-title">
                            <span class="calculation-counter">2</span>
                            Electricity Calculation 2-${electricity2CalculationCount}
                        </h4>
                        ${electricity2CalculationCount > 1 ? `<button type="button" class="remove-calculation-button" onclick="removeElectricity2Calculation(${electricity2CalculationCount})">🗑️ Remove</button>` : ''}
                    </div> 
                    
                    <div class="form-container">
                        <div class="form-row">                            <div class="form-group">
                                <label class="form-label" for="electricity2Region${electricity2CalculationCount}">
                                    🌍 eGRID Subregion:
                                    <span class="info-tooltip" id="electricity2EFTooltip${electricity2CalculationCount}" 
                                          title="Select a region to see emission factors" 
                                          onclick="showElectricity2EmissionFactors(${electricity2CalculationCount})" 
                                          style="cursor: pointer; color: #6c757d; margin-left: 8px; padding: 4px; border-radius: 4px; background: #f8f9fa; border: 1px solid #dee2e6; transition: all 0.2s ease;">
                                        <i class="fas fa-info-circle"></i> EPA Factors
                                    </span>
                                </label><select class="form-select" id="electricity2Region${electricity2CalculationCount}" onchange="updateElectricity2Tooltip(${electricity2CalculationCount})">
                                    <option value="">-- Select eGRID Subregion --</option>
                                    <option value="US">🇺🇸 US Average</option>
                                    <optgroup label="Alaska (ASCC)">
                                        <option value="AKGD">ASCC Alaska Grid</option>
                                        <option value="AKMS">ASCC Miscellaneous</option>
                                    </optgroup>
                                    <optgroup label="Western (WECC)">
                                        <option value="AZNM">WECC Southwest</option>
                                        <option value="CAMX">WECC California</option>
                                        <option value="NWPP">WECC Northwest</option>
                                        <option value="RMPA">WECC Rockies</option>
                                    </optgroup>
                                    <optgroup label="Texas (ERCOT)">
                                        <option value="ERCT">ERCOT All</option>
                                    </optgroup>
                                    <optgroup label="Florida (FRCC)">
                                        <option value="FRCC">FRCC All</option>
                                    </optgroup>
                                    <optgroup label="Hawaii (HICC)">
                                        <option value="HIMS">HICC Miscellaneous</option>
                                        <option value="HIOA">HICC Oahu</option>
                                    </optgroup>
                                    <optgroup label="Midwest (MRO)">
                                        <option value="MROE">MRO East</option>
                                        <option value="MROW">MRO West</option>
                                    </optgroup>
                                    <optgroup label="Northeast (NPCC)">
                                        <option value="NEWE">NPCC New England</option>
                                        <option value="NYCW">NPCC NYC/Westchester</option>
                                        <option value="NYLI">NPCC Long Island</option>
                                        <option value="NYUP">NPCC Upstate NY</option>
                                    </optgroup>
                                    <optgroup label="Mid-Atlantic (RFC)">
                                        <option value="RFCE">RFC East</option>
                                        <option value="RFCM">RFC Michigan</option>
                                        <option value="RFCW">RFC West</option>
                                    </optgroup>
                                    <optgroup label="South Central (SPP)">
                                        <option value="SPNO">SPP North</option>
                                        <option value="SPSO">SPP South</option>
                                    </optgroup>
                                    <optgroup label="Southeast (SERC)">
                                        <option value="SRMV">SERC Mississippi Valley</option>
                                        <option value="SRMW">SERC Midwest</option>
                                        <option value="SRSO">SERC South</option>
                                        <option value="SRTV">SERC Tennessee Valley</option>
                                        <option value="SRVC">SERC Virginia/Carolina</option>
                                    </optgroup>
                                    <optgroup label="Puerto Rico">
                                        <option value="PRMS">Puerto Rico Miscellaneous</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="electricity2Unit${electricity2CalculationCount}">📏 Unit:</label>
                                <select class="form-select" id="electricity2Unit${electricity2CalculationCount}">
                                    <option value="MWh">MWh (Megawatt-hours)</option>
                                    <option value="kWh">kWh (Kilowatt-hours)</option>
                                    <option value="GWh">GWh (Gigawatt-hours)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label" for="electricity2Quantity${electricity2CalculationCount}">⚡ Electricity Consumption:</label>
                            <input type="number" class="form-input" id="electricity2Quantity${electricity2CalculationCount}" step="any" min="0" placeholder="Enter electricity consumption">
                        </div>
                        
                        <button type="button" class="calculate-button" onclick="calculateElectricity2Emissions(${electricity2CalculationCount})">🧮 Calculate Electricity Emissions</button>
                    </div>
                    
                    <div class="results-section" id="electricity2Results${electricity2CalculationCount}" style="display: none;">
                        <div id="electricity2ResultContent${electricity2CalculationCount}"></div>
                    </div>
                </div>
            `;
            
            calculationsContainer.insertAdjacentHTML('beforeend', formHtml);
            
            // Set default region to US Average
            document.getElementById(`electricity2Region${electricity2CalculationCount}`).value = 'US';
            updateElectricity2Tooltip(electricity2CalculationCount);
        }
        
        function removeElectricity2Calculation(calculationId) {
            const formElement = document.getElementById(`electricity2Form${calculationId}`);
            if (formElement) {
                formElement.remove();
                // Remove from results array
                electricity2Results = electricity2Results.filter(result => result.id !== calculationId);
                updateElectricity2Summary();
            }
        }        function calculateElectricity2Emissions(calculationId) {
            const region = document.getElementById(`electricity2Region${calculationId}`).value;
            const quantity = parseFloat(document.getElementById(`electricity2Quantity${calculationId}`).value);
            const selectedUnit = document.getElementById(`electricity2Unit${calculationId}`).value;

            if (!region || isNaN(quantity) || quantity <= 0) {
                alert('Please select a region and enter a valid electricity consumption.');
                return;
            }

            const regionData = electricityEmissionFactors[region];
            
            // Convert quantity to MWh for calculation
            let convertedQuantity = quantity;
            let conversionFactor = 1;
            let conversionNote = '';

            switch(selectedUnit) {
                case 'kWh':
                    conversionFactor = 0.001;
                    convertedQuantity = quantity * conversionFactor;
                    conversionNote = `${quantity} kWh = ${convertedQuantity.toFixed(6)} MWh (conversion factor: ${conversionFactor})`;
                    break;
                case 'GWh':
                    conversionFactor = 1000;
                    convertedQuantity = quantity * conversionFactor;
                    conversionNote = `${quantity} GWh = ${convertedQuantity.toFixed(6)} MWh (conversion factor: ${conversionFactor})`;
                    break;
                case 'MWh':
                default:
                    conversionNote = 'No conversion needed (already in MWh)';
                    break;
            }

            // Calculate emissions using non-baseload emission factors (EPA factors are in lb/MWh, convert to kg)
            const lbToKg = 0.453592; // conversion factor
            const gToKg = 0.001; // conversion factor for CH4 and N2O

            // CO2 emissions using non-baseload factors (lb CO2/MWh -> kg CO2)
            const co2_kg = convertedQuantity * regionData.co2_nonBaseload * lbToKg;
            
            // CH4 emissions using non-baseload factors (lb CH4/MWh -> g CH4 -> kg CH4)
            const ch4_g = convertedQuantity * regionData.ch4_nonBaseload * lbToKg * 1000; // convert to grams
            const ch4_kg = ch4_g * gToKg;
              // N2O emissions using non-baseload factors (lb N2O/MWh -> g N2O -> kg N2O)
            const n2o_g = convertedQuantity * regionData.n2o_nonBaseload * lbToKg * 1000; // convert to grams
            const n2o_kg = n2o_g * gToKg;            // Calculate CO2e using IPCC AR5 GWP values
            const ch4_co2e = ch4_kg * 28;
            const n2o_co2e = n2o_kg * 265;
            const co2e = co2_kg + ch4_co2e + n2o_co2e;

            // Store result for summary
            const resultIndex = electricity2Results.findIndex(r => r.id === calculationId);
            const result = {
                id: calculationId,
                region,
                regionName: regionData.name,
                quantity,
                unit: selectedUnit,
                convertedQuantity,
                co2_kg,
                ch4_g,
                n2o_g,
                co2e,
                conversionNote
            };

            if (resultIndex >= 0) {
                electricity2Results[resultIndex] = result;
            } else {
                electricity2Results.push(result);
            }            // Display results for this specific calculation
            const resultsDiv = document.getElementById(`electricity2ResultContent${calculationId}`);
            resultsDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>⚡ Electricity Calculation 2-${calculationId} Results</h4>
                    <div style="background-color: #e1f5fe; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #01579b; margin-top: 0;">📊 Input Summary</h5>
                        <p><strong>eGRID Subregion:</strong> ${regionData.name} (${region})</p>
                        <p><strong>Input Consumption:</strong> ${quantity} ${selectedUnit}</p>
                        ${selectedUnit !== 'MWh' ? `<p><strong>Converted Consumption:</strong> ${convertedQuantity.toFixed(6)} MWh</p>` : ''}
                        <p><strong>Emission Factors Source:</strong> EPA eGRID2023 Table 6 Non-baseload Factors</p>
                    </div>
                    
                    <div style="background-color: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #2e7d32; margin-top: 0;">🎯 Final Results</h5>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="background-color: #c8e6c9;">
                                <th style="padding: 8px; border: 1px solid #81c784;">Emission Type</th>
                                <th style="padding: 8px; border: 1px solid #81c784; text-align: right;">Amount</th>
                                <th style="padding: 8px; border: 1px solid #81c784; text-align: left;">Unit</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>CO₂</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${co2_kg.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">kg</td>
                            </tr>
                            <tr style="background-color: #f1f8e9;">
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>CH₄</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${ch4_g.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">g</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>N₂O</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${n2o_g.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">g</td>
                            </tr>
                            <tr style="background-color: #4caf50; color: white;">
                                <td style="padding: 10px; border: 1px solid #388e3c;"><strong>Total CO₂e</strong></td>
                                <td style="padding: 10px; border: 1px solid #388e3c; text-align: right; font-size: 0.9em;"><strong>${co2e.toFixed(2)}</strong></td>
                                <td style="padding: 10px; border: 1px solid #388e3c; text-align: left; font-size: 0.9em;"><strong>kg CO₂e</strong></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="background-color: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #ef6c00; margin-top: 0;">🔬 Calculation Details</h5>
                        <p><strong>Non-baseload Emission Factors Applied (EPA eGRID2023):</strong></p>
                        <ul>
                            <li>CO₂: ${regionData.co2_nonBaseload} lb/MWh → ${(regionData.co2_nonBaseload * lbToKg).toFixed(3)} kg/MWh</li>
                            <li>CH₄: ${regionData.ch4_nonBaseload} lb/MWh → ${(regionData.ch4_nonBaseload * lbToKg * 1000).toFixed(3)} g/MWh</li>
                            <li>N₂O: ${regionData.n2o_nonBaseload} lb/MWh → ${(regionData.n2o_nonBaseload * lbToKg * 1000).toFixed(3)} g/MWh</li>
                        </ul>
                        
                        <p><strong>CO₂e Calculation (IPCC AR5 GWP):</strong></p>
                        <ul>
                            <li>CO₂: ${co2_kg.toFixed(3)} kg × 1 = ${co2_kg.toFixed(3)} kg CO₂e</li>
                            <li>CH₄: ${ch4_kg.toFixed(6)} kg × 28 = ${ch4_co2e.toFixed(3)} kg CO₂e</li>
                            <li>N₂O: ${n2o_kg.toFixed(6)} kg × 265 = ${n2o_co2e.toFixed(3)} kg CO₂e</li>
                        </ul>
                        
                        ${selectedUnit !== 'MWh' ? `<p><strong>Unit Conversion:</strong> ${conversionNote}</p>` : ''}
                        ${regionData.gridLoss ? `<p><strong>Grid Loss Factor:</strong> ${regionData.gridLoss}% (for informational purposes only)</p>` : ''}
                    </div>
                </div>
            `;

            // Show the results section for this calculation
            document.getElementById(`electricity2Results${calculationId}`).style.display = 'block';

            // Update summary if multiple calculations exist
            updateElectricity2Summary();
        }
        
        function updateElectricity2Summary() {
            if (electricity2Results.length === 0) {
                document.getElementById('electricity2Summary').style.display = 'none';
                return;
            }

            const summaryContent = document.getElementById('electricity2SummaryContent');
            const totalCO2e = document.getElementById('electricity2TotalCO2e');

            let totalEmissions = 0;
            let summaryHTML = '';

            electricity2Results.forEach((result, index) => {
                totalEmissions += result.co2e;
                summaryHTML += `
                    <div class="summary-item">
                        <h5>Calculation #${result.id}: ${result.regionName}</h5>
                        <p>${result.quantity} ${result.unit} → ${result.co2e.toFixed(2)} kg CO₂e</p>
                    </div>
                `;
            });

            summaryContent.innerHTML = summaryHTML;
            totalCO2e.textContent = totalEmissions.toFixed(2);
            document.getElementById('electricity2Summary').style.display = 'block';
        }        function updateElectricity2Tooltip(calculationId) {
            const region = document.getElementById(`electricity2Region${calculationId}`).value;
            const tooltip = document.getElementById(`electricity2EFTooltip${calculationId}`);
            
            if (region && electricityEmissionFactors[region]) {
                const data = electricityEmissionFactors[region];
                const lbToKg = 0.453592;
                
                // Enhanced tooltip with more comprehensive information
                tooltip.title = `${data.name} (${region})
                
📊 EPA eGRID2023 Non-baseload Emission Factors:
• CO₂: ${data.co2_nonBaseload} lb/MWh (${(data.co2_nonBaseload * lbToKg).toFixed(1)} kg/MWh)
• CH₄: ${data.ch4_nonBaseload} lb/MWh (${(data.ch4_nonBaseload * lbToKg * 1000).toFixed(2)} g/MWh)
• N₂O: ${data.n2o_nonBaseload} lb/MWh (${(data.n2o_nonBaseload * lbToKg * 1000).toFixed(2)} g/MWh)

📍 ${data.description}
${data.gridLoss ? `⚠️ Grid Loss: ${data.gridLoss}%` : ''}

💡 Click info icon for detailed view with GWP factors and calculation notes
📄 Source: EPA eGRID2023 Summary Tables`;
                
                // Update icon style to indicate data is available
                tooltip.style.color = '#28a745';
                tooltip.innerHTML = '<i class="fas fa-info-circle"></i>';
            } else {
                tooltip.title = 'Select an eGRID subregion to see emission factors';
                tooltip.style.color = '#6c757d';
                tooltip.innerHTML = '<i class="fas fa-info-circle"></i>';
            }        }        function showElectricity2EmissionFactors(calculationId) {
            const region = document.getElementById(`electricity2Region${calculationId}`).value;
              if (!region || !electricityEmissionFactors[region]) {
                alert('Please select an eGRID subregion first.');
                return;
            }
            
            const data = electricityEmissionFactors[region];
            const lbToKg = 0.453592; // conversion factor from lb to kg

            // Create modal HTML - combining both total output and non-baseload tables
            const modalContent = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto;">
                    <h2 style="color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 10px;">
                        📊 EPA eGRID2023 Emission Factors - ${data.name} (${region})
                    </h2>                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #333;">🌍 Region Information</h3>
                        <p style="margin: 5px 0;"><strong>Description:</strong> ${data.description}</p>
                        ${data.gridLoss ? `<p style="margin: 5px 0;"><strong>Grid Loss Factor:</strong> ${data.gridLoss}%</p>` : ''}
                    </div>

                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #856404;">⚡ Non-Baseload Emission Factors</h3>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                            <thead>
                                <tr style="background: #fff3e0;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #ffeeba;">Gas</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">EPA Units<br>(lb/MWh)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">Metric Units<br>(kg/MWh)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ffeeba;"><strong>CO₂</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${data.co2_nonBaseload}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${(data.co2_nonBaseload * lbToKg).toFixed(1)}</td>
                                </tr>
                                <tr style="background: #fff9e6;">
                                    <td style="padding: 8px; border: 1px solid #ffeeba;"><strong>CH₄</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${data.ch4_nonBaseload}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${(data.ch4_nonBaseload * lbToKg).toFixed(3)}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ffeeba;"><strong>N₂O</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${data.n2o_nonBaseload}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${(data.n2o_nonBaseload * lbToKg).toFixed(3)}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 15px;">
                            <h4 style="color: #856404; margin-top: 0;">ℹ️ About Non-Baseload Emission Factors</h4>
                            <p style="color: #856404; margin-bottom: 0;">Non-baseload emission factors represent emissions from power plants that typically operate to follow variations in electricity demand. These values are generally higher than average emission rates as they exclude low-emitting baseload generation sources.</p>
                        </div>
                    </div>

                    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #1976d2;">📋 Key Notes</h3>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Total Output factors include all electricity generation sources</li>
                            <li>Non-baseload factors represent marginal generation emissions</li>
                            <li>All emission factors are from direct combustion only</li>
                            <li>Upstream life-cycle emissions are not included</li>
                            <li>Grid loss factors are provided for reference only</li>
                        </ul>
                    </div>

                    <div style="border-top: 1px solid #dee2e6; padding-top: 15px; font-size: 0.9em; color: #6c757d;">
                        <p style="margin: 5px 0;"><strong>Source:</strong> EPA eGRID2023 Summary Tables (January 2025)</p>
                        <p style="margin: 5px 0;"><strong>Reference:</strong> <a href="https://www.epa.gov/egrid" target="_blank" style="color: #0066cc;">EPA eGRID Homepage</a></p>
                        <p style="margin: 5px 0;"><strong>Standard:</strong> EPA eGRID methodology following 40 CFR Part 75</p>
                    </div>
                </div>
            `;
            
            // Create and show modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            const modalDialog = document.createElement('div');
            modalDialog.style.cssText = `
                background: white;
                border-radius: 12px;
                max-width: 90%;
                max-height: 90%;
                overflow-y: auto;
                padding: 20px;
                position: relative;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            `;
            
            const closeButton = document.createElement('button');
            closeButton.innerHTML = '✕';
            closeButton.style.cssText = `
                position: absolute;
                top: 15px;
                right: 15px;
                background: #dc3545;
                color: white;
                border: none;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
            `;
            closeButton.onclick = () => modal.remove();
            
            modalDialog.innerHTML = modalContent;
            modalDialog.appendChild(closeButton);
            modal.appendChild(modalDialog);
            document.body.appendChild(modal);
              // Close modal on outside click
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }

        // Steam and Heat Calculator Functions
        function addSteamHeatCalculation() {
            steamHeatCalculationCount++;
            const calculationsContainer = document.getElementById('steamHeatCalculations');
            
            const formHtml = `
                <div class="calculation-form" id="steamHeatForm${steamHeatCalculationCount}">
                    <div class="calculation-form-header">
                        <h4 class="calculation-form-title">
                            <span class="calculation-counter">3</span>
                            Steam and Heat Calculation ${steamHeatCalculationCount}
                        </h4>
                        ${steamHeatCalculationCount > 1 ? `<button type="button" class="remove-calculation-button" onclick="removeSteamHeatCalculation(${steamHeatCalculationCount})">🗑️ Remove</button>` : ''}
                    </div> 
                    
                    <div class="form-container">
                        <div class="form-row">                            <div class="form-group">
                                <label class="form-label" for="steamHeatFuelType${steamHeatCalculationCount}">
                                    🔥 Energy Type:
                                    <span class="info-tooltip" id="steamHeatEFTooltip${steamHeatCalculationCount}" 
                                          title="Select energy type to see emission factors" 
                                          onclick="showSteamHeatEmissionFactors(${steamHeatCalculationCount})" 
                                          style="cursor: pointer; color: #6c757d; margin-left: 8px; padding: 4px; border-radius: 4px; background: #f8f9fa; border: 1px solid #dee2e6; transition: all 0.2s ease;">
                                        <i class="fas fa-info-circle"></i> EPA Table 7
                                    </span>
                                </label>                                <select class="form-select" id="steamHeatFuelType${steamHeatCalculationCount}" onchange="updateSteamHeatTooltip(${steamHeatCalculationCount})">
                                    <option value="">-- Select Energy Type --</option>
                                    <option value="steam_heat">🔥 Steam and Heat (66.33 | 1.250 | 0.125)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="steamHeatUnit${steamHeatCalculationCount}">📏 Unit:</label>
                                <select class="form-select" id="steamHeatUnit${steamHeatCalculationCount}">
                                    <option value="mmBtu">mmBtu (Million BTU)</option>
                                    <option value="kBtu">kBtu (Thousand BTU)</option>
                                    <option value="MJ">MJ (Megajoules)</option>
                                    <option value="GJ">GJ (Gigajoules)</option>
                                    <option value="TJ">TJ (Terajoules)</option>
                                    <option value="MWh">MWh (Megawatt-hours)</option>
                                    <option value="kWh">kWh (Kilowatt-hours)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label" for="steamHeatQuantity${steamHeatCalculationCount}">🔥 Steam/Heat Energy Consumption:</label>
                            <input type="number" class="form-input" id="steamHeatQuantity${steamHeatCalculationCount}" step="any" min="0" placeholder="Enter steam/heat energy consumption">
                        </div>
                        
                        <button type="button" class="calculate-button" onclick="calculateSteamHeatEmissions(${steamHeatCalculationCount})">🧮 Calculate Steam/Heat Emissions</button>
                    </div>
                    
                    <div class="results-section" id="steamHeatResults${steamHeatCalculationCount}" style="display: none;">
                        <div id="steamHeatResultContent${steamHeatCalculationCount}"></div>
                    </div>
                </div>
            `;
              calculationsContainer.insertAdjacentHTML('beforeend', formHtml);
            
            // Set default energy type to Steam and Heat
            document.getElementById(`steamHeatFuelType${steamHeatCalculationCount}`).value = 'steam_heat';
            updateSteamHeatTooltip(steamHeatCalculationCount);
        }
        
        function removeSteamHeatCalculation(calculationId) {
            const formElement = document.getElementById(`steamHeatForm${calculationId}`);
            if (formElement) {
                formElement.remove();
                // Remove from results array
                steamHeatResults = steamHeatResults.filter(result => result.id !== calculationId);
                updateSteamHeatSummary();
            }
        }
        
        function calculateSteamHeatEmissions(calculationId) {
            const fuelType = document.getElementById(`steamHeatFuelType${calculationId}`).value;
            const quantity = parseFloat(document.getElementById(`steamHeatQuantity${calculationId}`).value);
            const selectedUnit = document.getElementById(`steamHeatUnit${calculationId}`).value;

            if (!fuelType || isNaN(quantity) || quantity <= 0) {
                alert('Please select a fuel type and enter a valid energy consumption.');
                return;
            }

            const fuelData = steamHeatEmissionFactors[fuelType];
            
            // Convert quantity to mmBtu for calculation
            let convertedQuantity = quantity;
            let conversionFactor = 1;
            let conversionNote = '';

            // Energy unit conversions to mmBtu
            const energyConversions = {
                'mmBtu': 1,
                'kBtu': 0.001,
                'MJ': 0.000947817, // 1 MJ = 0.000947817 mmBtu
                'GJ': 0.947817,    // 1 GJ = 0.947817 mmBtu
                'TJ': 947.817,     // 1 TJ = 947.817 mmBtu
                'MWh': 3.412,      // 1 MWh = 3.412 mmBtu
                'kWh': 0.003412    // 1 kWh = 0.003412 mmBtu
            };

            conversionFactor = energyConversions[selectedUnit] || 1;
            convertedQuantity = quantity * conversionFactor;
            
            switch(selectedUnit) {
                case 'mmBtu':
                    conversionNote = 'No conversion needed (already in mmBtu)';
                    break;
                default:
                    conversionNote = `${quantity} ${selectedUnit} = ${convertedQuantity.toFixed(6)} mmBtu (conversion factor: ${conversionFactor})`;
                    break;
            }

            // Calculate emissions using EPA factors (all factors are in kg/mmBtu or kg/mmBtu for consistency)
            const co2_kg = convertedQuantity * fuelData.co2;
            const ch4_kg = convertedQuantity * fuelData.ch4;
            const n2o_kg = convertedQuantity * fuelData.n2o;

            // Convert CH4 and N2O to grams for display consistency
            const ch4_g = ch4_kg * 1000;
            const n2o_g = n2o_kg * 1000;

            // Calculate CO2e using IPCC AR5 GWP values
            const ch4_co2e = ch4_kg * 28;
            const n2o_co2e = n2o_kg * 265;
            const co2e = co2_kg + ch4_co2e + n2o_co2e;

            // Store result for summary
            const resultIndex = steamHeatResults.findIndex(r => r.id === calculationId);
            const result = {
                id: calculationId,
                fuelType,
                fuelName: fuelData.name,
                quantity,
                unit: selectedUnit,
                convertedQuantity,
                co2_kg,
                ch4_g,
                n2o_g,
                co2e,
                conversionNote
            };

            if (resultIndex >= 0) {
                steamHeatResults[resultIndex] = result;
            } else {
                steamHeatResults.push(result);
            }

            // Display results for this specific calculation
            const resultsDiv = document.getElementById(`steamHeatResultContent${calculationId}`);
            resultsDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>🔥 Steam and Heat Calculation ${calculationId} Results</h4>
                    <div style="background-color: #e1f5fe; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #01579b; margin-top: 0;">📊 Input Summary</h5>
                        <p><strong>Fuel Type:</strong> ${fuelData.name}</p>
                        <p><strong>Input Consumption:</strong> ${quantity} ${selectedUnit}</p>
                        ${selectedUnit !== 'mmBtu' ? `<p><strong>Converted Consumption:</strong> ${convertedQuantity.toFixed(6)} mmBtu</p>` : ''}
                        <p><strong>Emission Factors Source:</strong> ${fuelData.source}</p>
                        ${fuelData.note ? `<p><strong>Note:</strong> ${fuelData.note}</p>` : ''}
                    </div>
                    
                    <div style="background-color: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #2e7d32; margin-top: 0;">🎯 Final Results</h5>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="background-color: #c8e6c9;">
                                <th style="padding: 8px; border: 1px solid #81c784;">Emission Type</th>
                                <th style="padding: 8px; border: 1px solid #81c784; text-align: right;">Amount</th>
                                <th style="padding: 8px; border: 1px solid #81c784; text-align: left;">Unit</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>CO₂</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${co2_kg.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">kg</td>
                            </tr>
                            <tr style="background-color: #f1f8e9;">
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>CH₄</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${ch4_g.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">g</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>N₂O</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${n2o_g.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">g</td>
                            </tr>
                            <tr style="background-color: #4caf50; color: white;">
                                <td style="padding: 10px; border: 1px solid #388e3c;"><strong>Total CO₂e</strong></td>
                                <td style="padding: 10px; border: 1px solid #388e3c; text-align: right; font-size: 0.9em;"><strong>${co2e.toFixed(2)}</strong></td>
                                <td style="padding: 10px; border: 1px solid #388e3c; text-align: left; font-size: 0.9em;"><strong>kg CO₂e</strong></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="background-color: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #ef6c00; margin-top: 0;">🔬 Calculation Details</h5>
                        <p><strong>Emission Factors Applied (${fuelData.source}):</strong></p>
                        <ul>
                            <li>CO₂: ${fuelData.co2} kg/mmBtu</li>
                            <li>CH₄: ${fuelData.ch4} kg/mmBtu</li>
                            <li>N₂O: ${fuelData.n2o} kg/mmBtu</li>
                        </ul>
                        
                        <p><strong>CO₂e Calculation (IPCC AR5 GWP):</strong></p>
                        <ul>
                            <li>CO₂: ${co2_kg.toFixed(3)} kg × 1 = ${co2_kg.toFixed(3)} kg CO₂e</li>
                            <li>CH₄: ${ch4_kg.toFixed(6)} kg × 28 = ${ch4_co2e.toFixed(3)} kg CO₂e</li>
                            <li>N₂O: ${n2o_kg.toFixed(6)} kg × 265 = ${n2o_co2e.toFixed(3)} kg CO₂e</li>
                        </ul>
                        
                        ${selectedUnit !== 'mmBtu' ? `<p><strong>Unit Conversion:</strong> ${conversionNote}</p>` : ''}
                        <p><strong>Fuel Description:</strong> ${fuelData.description}</p>
                    </div>
                </div>
            `;

            // Show the results section for this calculation
            document.getElementById(`steamHeatResults${calculationId}`).style.display = 'block';

            // Update summary if multiple calculations exist
            updateSteamHeatSummary();
        }
        
        function updateSteamHeatSummary() {
            if (steamHeatResults.length === 0) {
                document.getElementById('steamHeatSummary').style.display = 'none';
                return;
            }

            const summaryContent = document.getElementById('steamHeatSummaryContent');
            const totalCO2e = document.getElementById('steamHeatTotalCO2e');

            let totalEmissions = 0;
            let summaryHTML = '';

            steamHeatResults.forEach((result, index) => {
                totalEmissions += result.co2e;
                summaryHTML += `
                    <div class="summary-item">
                        <h5>Calculation #${result.id}: ${result.fuelName}</h5>
                        <p>${result.quantity} ${result.unit} → ${result.co2e.toFixed(2)} kg CO₂e</p>
                    </div>
                `;
            });

            summaryContent.innerHTML = summaryHTML;
            totalCO2e.textContent = totalEmissions.toFixed(2);
            document.getElementById('steamHeatSummary').style.display = 'block';
        }
        
        function updateSteamHeatTooltip(calculationId) {
            const fuelType = document.getElementById(`steamHeatFuelType${calculationId}`).value;
            const tooltip = document.getElementById(`steamHeatEFTooltip${calculationId}`);
            
            if (fuelType && steamHeatEmissionFactors[fuelType]) {
                const data = steamHeatEmissionFactors[fuelType];
                
                // Enhanced tooltip with comprehensive information
                tooltip.title = `${data.name}
                
📊 EPA 40 CFR Part 98 Emission Factors:
• CO₂: ${data.co2} kg/mmBtu
• CH₄: ${data.ch4} kg/mmBtu  
• N₂O: ${data.n2o} kg/mmBtu

📍 ${data.description}
${data.note ? `⚠️ Note: ${data.note}` : ''}

💡 Click info icon for detailed view with GWP factors and calculation notes
📄 Source: ${data.source}`;
                
                // Update icon style to indicate data is available
                tooltip.style.color = '#28a745';
                tooltip.innerHTML = '<i class="fas fa-info-circle"></i>';
            } else {
                tooltip.title = 'Select a fuel type to see emission factors';
                tooltip.style.color = '#6c757d';
                tooltip.innerHTML = '<i class="fas fa-info-circle"></i>';
            }
        }
        
        function showSteamHeatEmissionFactors(calculationId) {
            const fuelType = document.getElementById(`steamHeatFuelType${calculationId}`).value;
            
            if (!fuelType || !steamHeatEmissionFactors[fuelType]) {
                alert('Please select a fuel type first.');
                return;
            }
            
            const data = steamHeatEmissionFactors[fuelType];

            // Create modal HTML
            const modalContent = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto;">
                    <h2 style="color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 10px;">
                        📊 EPA Steam and Heat Emission Factors - ${data.name}
                    </h2>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #333;">🔥 Fuel Information</h3>
                        <p style="margin: 5px 0;"><strong>Fuel Type:</strong> ${data.name}</p>
                        <p style="margin: 5px 0;"><strong>Description:</strong> ${data.description}</p>
                        <p style="margin: 5px 0;"><strong>Application:</strong> District energy systems and steam generation</p>
                        ${data.note ? `<p style="margin: 5px 0; color: #856404;"><strong>Note:</strong> ${data.note}</p>` : ''}
                    </div>

                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #856404;">🔬 Emission Factors</h3>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                            <thead>
                                <tr style="background: #fff3e0;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #ffeeba;">Greenhouse Gas</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">Emission Factor<br>(kg/mmBtu)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">GWP<br>(IPCC AR5)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ffeeba;"><strong>CO₂</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${data.co2}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">1</td>
                                </tr>
                                <tr style="background: #fff9e6;">
                                    <td style="padding: 8px; border: 1px solid #ffeeba;"><strong>CH₄</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${data.ch4}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">28</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ffeeba;"><strong>N₂O</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${data.n2o}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">265</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 15px;">
                            <h4 style="color: #856404; margin-top: 0;">ℹ️ About These Emission Factors</h4>
                            <p style="color: #856404; margin-bottom: 0;">These emission factors represent direct combustion emissions from fuel used in district energy systems for steam and heat generation. Values are based on EPA 40 CFR Part 98 reporting requirements.</p>
                        </div>
                    </div>

                    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #1976d2;">📋 Calculation Notes</h3>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>All emission factors are per mmBtu of fuel input energy</li>
                            <li>CO₂e calculated using IPCC AR5 100-year GWP values</li>
                            <li>Factors represent direct combustion emissions only</li>
                            <li>Upstream fuel production emissions are not included</li>
                            <li>Suitable for Scope 2 emission calculations under GHG Protocol</li>
                        </ul>
                    </div>

                    <div style="border-top: 1px solid #dee2e6; padding-top: 15px; font-size: 0.9em; color: #6c757d;">
                        <p style="margin: 5px 0;"><strong>Source:</strong> ${data.source}</p>
                        <p style="margin: 5px 0;"><strong>Reference:</strong> <a href="https://www.ecfr.gov/current/title-40/chapter-I/subchapter-C/part-98" target="_blank" style="color: #0066cc;">EPA 40 CFR Part 98</a></p>
                        <p style="margin: 5px 0;"><strong>Standard:</strong> EPA methodology for district energy systems</p>
                    </div>
                </div>
            `;
            
            // Create and show modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            const modalDialog = document.createElement('div');
            modalDialog.style.cssText = `
                background: white;
                border-radius: 12px;
                max-width: 90%;
                max-height: 90%;
                overflow-y: auto;
                padding: 20px;
                position: relative;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            `;
            
            const closeButton = document.createElement('button');
            closeButton.innerHTML = '✕';
            closeButton.style.cssText = `
                position: absolute;
                top: 15px;
                right: 15px;
                background: #dc3545;
                color: white;
                border: none;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
            `;
            closeButton.onclick = () => modal.remove();
            
            modalDialog.innerHTML = modalContent;
            modalDialog.appendChild(closeButton);
            modal.appendChild(modalDialog);
            document.body.appendChild(modal);
            
            // Close modal on outside click
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };        }

        // Transportation calculation functions
        function addTransportationCalculation() {
            transportationCalculationCount++;
            const calculationsContainer = document.getElementById('transportationCalculations');
            
            const formHtml = `
                <div class="calculation-form" id="transportationForm${transportationCalculationCount}">
                    <div class="calculation-form-header">
                        <h4 class="calculation-form-title">
                            <span class="calculation-counter">${transportationCalculationCount}</span>
                            Transportation Calculation #${transportationCalculationCount}
                        </h4>
                        ${transportationCalculationCount > 1 ? `<button type="button" class="remove-calculation-button" onclick="removeTransportationCalculation(${transportationCalculationCount})">🗑️ Remove</button>` : ''}
                    </div>
                    
                    <div class="form-container">                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="transportMode${transportationCalculationCount}">
                                    🚛 Transportation Mode:
                                    <span class="info-tooltip" id="transportEFTooltip${transportationCalculationCount}" title="Select a transportation mode to see emission factors" onclick="showTransportationEmissionFactors(${transportationCalculationCount})" style="cursor: pointer; color: #0066cc;">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <select class="form-select" id="transportMode${transportationCalculationCount}" onchange="updateTransportationTooltip(${transportationCalculationCount}); updateTransportationInputs(${transportationCalculationCount})">
                                    <option value="">-- Select Transportation Mode --</option>
                                    <option value="heavy_duty_truck">Medium- and Heavy-Duty Truck</option>
                                    <option value="passenger_car">Passenger Car</option>
                                    <option value="light_duty_truck">Light-Duty Truck</option>
                                    <option value="heavy_duty_truck_freight">Medium- and Heavy-Duty Truck (Freight)</option>
                                    <option value="rail">Rail</option>
                                    <option value="waterborne">Waterborne Craft</option>
                                    <option value="aircraft">Aircraft</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="distanceUnit${transportationCalculationCount}">📏 Distance Unit:</label>
                                <select class="form-select" id="distanceUnit${transportationCalculationCount}">
                                    <option value="miles">Miles</option>
                                    <option value="km">Kilometers</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row" id="freightInputs${transportationCalculationCount}" style="display: none;">
                            <div class="form-group">
                                <label class="form-label" for="transportWeight${transportationCalculationCount}">📦 Cargo Weight:</label>
                                <input type="number" class="form-input" id="transportWeight${transportationCalculationCount}" step="any" min="0" placeholder="Enter cargo weight">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="weightUnit${transportationCalculationCount}">⚖️ Weight Unit:</label>
                                <select class="form-select" id="weightUnit${transportationCalculationCount}">
                                    <option value="short_tons">Short Tons (US)</option>
                                    <option value="metric_tons">Metric Tons</option>
                                    <option value="kg">Kilograms</option>
                                    <option value="lbs">Pounds</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label" for="transportDistance${transportationCalculationCount}">📍 Distance Traveled:</label>
                            <input type="number" class="form-input" id="transportDistance${transportationCalculationCount}" step="any" min="0" placeholder="Enter distance traveled">
                        </div>
                        
                        <button type="button" class="calculate-button" onclick="calculateTransportationEmissions(${transportationCalculationCount})">🧮 Calculate Emissions</button>
                    </div>
                    
                    <div class="results-section" id="transportationResults${transportationCalculationCount}" style="display: none;">
                        <div id="transportationResultContent${transportationCalculationCount}"></div>
                    </div>
                </div>
            `;
            
            calculationsContainer.insertAdjacentHTML('beforeend', formHtml);
              // Initialize tooltip and inputs
            updateTransportationTooltip(transportationCalculationCount);
            updateTransportationInputs(transportationCalculationCount);
        }
        
        function updateTransportationInputs(calculationId) {
            const transportMode = document.getElementById(`transportMode${calculationId}`).value;
            const freightInputs = document.getElementById(`freightInputs${calculationId}`);
            
            if (transportMode && transportationEmissionFactors[transportMode]) {
                const modeData = transportationEmissionFactors[transportMode];
                if (modeData.unitType === 'freight') {
                    // Show freight inputs for ton-mile calculations
                    freightInputs.style.display = 'flex';
                } else {
                    // Hide freight inputs for vehicle-mile calculations
                    freightInputs.style.display = 'none';
                }
            } else {
                freightInputs.style.display = 'none';
            }
        }
        
        function removeTransportationCalculation(calculationId) {
            const formElement = document.getElementById(`transportationForm${calculationId}`);
            if (formElement) {
                formElement.remove();
                // Remove from results array
                transportationResults = transportationResults.filter(result => result.id !== calculationId);
                updateTransportationSummary();
            }
        }
          function calculateTransportationEmissions(calculationId) {
            const transportMode = document.getElementById(`transportMode${calculationId}`).value;
            const distance = parseFloat(document.getElementById(`transportDistance${calculationId}`).value);
            const distanceUnit = document.getElementById(`distanceUnit${calculationId}`).value;

            if (!transportMode || isNaN(distance) || distance <= 0) {
                alert('Please select a transportation mode and enter a valid distance value.');
                return;
            }

            const modeData = transportationEmissionFactors[transportMode];
            
            // Convert distance to miles
            let convertedDistance = distance;
            const distanceConversions = {
                'miles': 1,
                'km': 0.621371  // Kilometers to miles
            };
            convertedDistance = distance * distanceConversions[distanceUnit];
            
            let activityValue, activityUnit, co2_kg, ch4_kg, n2o_kg;
            let weight = null, weightUnit = null, convertedWeight = null;
            
            if (modeData.unitType === 'vehicle') {
                // Vehicle-mile calculations (passenger car, light-duty truck, heavy-duty truck)
                activityValue = convertedDistance;
                activityUnit = 'vehicle-miles';
                
                // Calculate emissions using EPA factors (factors are in kg/vehicle-mile)
                co2_kg = activityValue * modeData.co2;
                ch4_kg = activityValue * modeData.ch4;
                n2o_kg = activityValue * modeData.n2o;
                
            } else {
                // Freight ton-mile calculations (rail, waterborne, aircraft, heavy-duty truck freight)
                weight = parseFloat(document.getElementById(`transportWeight${calculationId}`).value);
                weightUnit = document.getElementById(`weightUnit${calculationId}`).value;
                
                if (isNaN(weight) || weight <= 0) {
                    alert('Please enter a valid cargo weight for freight transportation.');
                    return;
                }
                
                // Convert weight to short tons (US tons)
                const weightConversions = {
                    'short_tons': 1,         // Short tons (US)
                    'metric_tons': 1.10231,  // Metric tons to short tons
                    'kg': 0.00110231,        // Kilograms to short tons
                    'lbs': 0.0005           // Pounds to short tons
                };
                convertedWeight = weight * weightConversions[weightUnit];
                
                // Calculate ton-miles
                activityValue = convertedWeight * convertedDistance;
                activityUnit = 'short ton-miles';
                
                // Calculate emissions using EPA factors (factors are in kg/short ton-mile)
                co2_kg = activityValue * modeData.co2;
                ch4_kg = activityValue * modeData.ch4;
                n2o_kg = activityValue * modeData.n2o;
            }

            // Convert CH4 and N2O to grams for display consistency
            const ch4_g = ch4_kg * 1000;
            const n2o_g = n2o_kg * 1000;

            // Calculate CO2e using IPCC AR5 GWP values
            const ch4_co2e = ch4_kg * 28;
            const n2o_co2e = n2o_kg * 265;
            const co2e = co2_kg + ch4_co2e + n2o_co2e;            // Store result for summary
            const resultIndex = transportationResults.findIndex(r => r.id === calculationId);
            const result = {
                id: calculationId,
                transportMode,
                modeName: modeData.name,
                unitType: modeData.unitType,
                weight,
                weightUnit,
                distance,
                distanceUnit,
                convertedWeight,
                convertedDistance,
                activityValue,
                activityUnit,
                co2_kg,
                ch4_g,
                n2o_g,
                co2e
            };

            if (resultIndex >= 0) {
                transportationResults[resultIndex] = result;
            } else {
                transportationResults.push(result);
            }

            // Create dynamic input summary based on unit type
            let inputSummaryHTML = '';
            if (modeData.unitType === 'vehicle') {
                inputSummaryHTML = `
                    <p><strong>Transportation Mode:</strong> ${modeData.name}</p>
                    <p><strong>Unit Type:</strong> Vehicle-based calculation</p>
                    <p><strong>Distance:</strong> ${distance} ${distanceUnit} (${convertedDistance.toFixed(3)} miles)</p>
                    <p><strong>Total Activity:</strong> ${activityValue.toFixed(3)} vehicle-miles</p>
                `;
            } else {
                inputSummaryHTML = `
                    <p><strong>Transportation Mode:</strong> ${modeData.name}</p>
                    <p><strong>Unit Type:</strong> Freight-based calculation</p>
                    <p><strong>Cargo Weight:</strong> ${weight} ${weightUnit} (${convertedWeight.toFixed(3)} short tons)</p>
                    <p><strong>Distance:</strong> ${distance} ${distanceUnit} (${convertedDistance.toFixed(3)} miles)</p>
                    <p><strong>Total Activity:</strong> ${activityValue.toFixed(3)} short ton-miles</p>
                `;
            }
            
            // Create dynamic calculation details based on unit type
            let calculationDetailsHTML = '';
            if (modeData.unitType === 'vehicle') {
                calculationDetailsHTML = `
                    <p><strong>Emission Factors Applied (${modeData.source}):</strong></p>
                    <ul>
                        <li>CO₂: ${modeData.co2} kg/vehicle-mile</li>
                        <li>CH₄: ${(modeData.ch4 * 1000).toFixed(4)} g/vehicle-mile</li>
                        <li>N₂O: ${(modeData.n2o * 1000).toFixed(4)} g/vehicle-mile</li>
                    </ul>
                    
                    <p><strong>Activity Data Calculation:</strong></p>
                    <ul>
                        <li>Distance: ${distance} ${distanceUnit} × ${distanceConversions[distanceUnit]} = ${convertedDistance.toFixed(3)} miles</li>
                        <li>Activity: ${convertedDistance.toFixed(3)} vehicle-miles</li>
                    </ul>
                `;
            } else {
                const weightConversions = {
                    'short_tons': 1,
                    'metric_tons': 1.10231,
                    'kg': 0.00110231,
                    'lbs': 0.0005
                };
                calculationDetailsHTML = `
                    <p><strong>Emission Factors Applied (${modeData.source}):</strong></p>
                    <ul>
                        <li>CO₂: ${modeData.co2} kg/short ton-mile</li>
                        <li>CH₄: ${(modeData.ch4 * 1000).toFixed(4)} g/short ton-mile</li>
                        <li>N₂O: ${(modeData.n2o * 1000).toFixed(4)} g/short ton-mile</li>
                    </ul>
                    
                    <p><strong>Activity Data Calculation:</strong></p>
                    <ul>
                        <li>Weight: ${weight} ${weightUnit} × ${weightConversions[weightUnit]} = ${convertedWeight.toFixed(3)} short tons</li>
                        <li>Distance: ${distance} ${distanceUnit} × ${distanceConversions[distanceUnit]} = ${convertedDistance.toFixed(3)} miles</li>
                        <li>Activity: ${convertedWeight.toFixed(3)} tons × ${convertedDistance.toFixed(3)} miles = ${activityValue.toFixed(3)} short ton-miles</li>
                    </ul>
                `;
            }

            // Display results for this specific calculation
            const resultsDiv = document.getElementById(`transportationResultContent${calculationId}`);
            resultsDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>🚛 Transportation Calculation ${calculationId} Results</h4>
                    <div style="background-color: #e1f5fe; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #01579b; margin-top: 0;">📊 Input Summary</h5>
                        ${inputSummaryHTML}
                        <p><strong>Emission Factors Source:</strong> ${modeData.source}</p>
                    </div>
                    
                    <div style="background-color: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #2e7d32; margin-top: 0;">🎯 Final Results</h5>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="background-color: #c8e6c9;">
                                <th style="padding: 8px; border: 1px solid #81c784;">Emission Type</th>
                                <th style="padding: 8px; border: 1px solid #81c784; text-align: right;">Amount</th>
                                <th style="padding: 8px; border: 1px solid #81c784; text-align: left;">Unit</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>CO₂</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${co2_kg.toFixed(6)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">kg</td>
                            </tr>
                            <tr style="background-color: #f1f8e9;">
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>CH₄</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${ch4_g.toFixed(6)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">g</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #81c784;"><strong>N₂O</strong></td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: right;">${n2o_g.toFixed(6)}</td>
                                <td style="padding: 8px; border: 1px solid #81c784; text-align: left;">g</td>
                            </tr>
                            <tr style="background-color: #4caf50; color: white;">
                                <td style="padding: 10px; border: 1px solid #388e3c;"><strong>Total CO₂e</strong></td>
                                <td style="padding: 10px; border: 1px solid #388e3c; text-align: right; font-size: 0.9em;"><strong>${co2e.toFixed(6)}</strong></td>
                                <td style="padding: 10px; border: 1px solid #388e3c; text-align: left; font-size: 0.9em;"><strong>kg CO₂e</strong></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="background-color: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #ef6c00; margin-top: 0;">🔬 Calculation Details</h5>
                        ${calculationDetailsHTML}
                        
                        <p><strong>CO₂e Calculation (IPCC AR5 GWP):</strong></p>
                        <ul>
                            <li>CO₂: ${co2_kg.toFixed(6)} kg × 1 = ${co2_kg.toFixed(6)} kg CO₂e</li>
                            <li>CH₄: ${ch4_kg.toFixed(9)} kg × 28 = ${ch4_co2e.toFixed(6)} kg CO₂e</li>
                            <li>N₂O: ${n2o_kg.toFixed(9)} kg × 265 = ${n2o_co2e.toFixed(6)} kg CO₂e</li>
                        </ul>
                        
                        <p><strong>Transportation Mode Description:</strong> ${modeData.description}</p>
                    </div>
                </div>
            `;

            // Show the results section for this calculation
            document.getElementById(`transportationResults${calculationId}`).style.display = 'block';

            // Update summary if multiple calculations exist
            updateTransportationSummary();
        }
        
        function updateTransportationSummary() {
            if (transportationResults.length === 0) {
                document.getElementById('transportationSummary').style.display = 'none';
                return;
            }

            const summaryContent = document.getElementById('transportationSummaryContent');
            const totalCO2e = document.getElementById('transportationTotalCO2e');

            let totalEmissions = 0;
            let summaryHTML = '';

            transportationResults.forEach((result, index) => {
                totalEmissions += result.co2e;
                summaryHTML += `
                    <div class="summary-item">
                        <h5>Calculation #${result.id}: ${result.modeName}</h5>
                        <p>${result.weight} ${result.weightUnit} × ${result.distance} ${result.distanceUnit} → ${result.co2e.toFixed(6)} kg CO₂e</p>
                    </div>
                `;
            });

            summaryContent.innerHTML = summaryHTML;
            totalCO2e.textContent = totalEmissions.toFixed(6);
            document.getElementById('transportationSummary').style.display = 'block';
        }
        
        function updateTransportationTooltip(calculationId) {
            const transportMode = document.getElementById(`transportMode${calculationId}`).value;
            const tooltip = document.getElementById(`transportEFTooltip${calculationId}`);
            
            if (transportMode && transportationEmissionFactors[transportMode]) {
                const data = transportationEmissionFactors[transportMode];
                
                tooltip.title = `${data.name}
                
📊 EPA Table 8 Emission Factors:
• CO₂: ${data.co2} kg/ton-mile
• CH₄: ${data.ch4} kg/ton-mile  
• N₂O: ${data.n2o} kg/ton-mile

🚛 Transport Mode: ${data.transportMode}
⛽ Fuel Type: ${data.fuelType}
📍 ${data.description}

💡 Click info icon for detailed view with GWP factors and calculation notes
📄 Source: ${data.source}`;
                
                tooltip.style.color = '#28a745';
                tooltip.innerHTML = '<i class="fas fa-info-circle"></i>';
            } else {
                tooltip.title = 'Select a transportation mode to see emission factors';
                tooltip.style.color = '#6c757d';
                tooltip.innerHTML = '<i class="fas fa-info-circle"></i>';
            }
        }
        
        function showTransportationEmissionFactors(calculationId) {
            const transportMode = document.getElementById(`transportMode${calculationId}`).value;
            
            if (!transportMode || !transportationEmissionFactors[transportMode]) {
                alert('Please select a transportation mode first.');
                return;
            }
            
            const data = transportationEmissionFactors[transportMode];

            // Create modal HTML
            const modalContent = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto;">
                    <h2 style="color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 10px;">
                        📊 EPA Transportation Emission Factors - ${data.name}
                    </h2>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #333;">🚛 Transportation Information</h3>
                        <p style="margin: 5px 0;"><strong>Mode:</strong> ${data.name}</p>
                        <p style="margin: 5px 0;"><strong>Transport Type:</strong> ${data.transportMode}</p>
                        <p style="margin: 5px 0;"><strong>Fuel Type:</strong> ${data.fuelType}</p>
                        <p style="margin: 5px 0;"><strong>Description:</strong> ${data.description}</p>
                        <p style="margin: 5px 0;"><strong>Application:</strong> Upstream/downstream transportation and distribution</p>
                    </div>

                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #856404;">🔬 Emission Factors</h3>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                            <thead>
                                <tr style="background: #fff3e0;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #ffeeba;">Greenhouse Gas</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">Emission Factor<br>(kg/ton-mile)</th>
                                    <th style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">GWP<br>(IPCC AR5)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ffeeba;"><strong>CO₂</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${data.co2}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">1</td>
                                </tr>
                                <tr style="background: #fff9e6;">
                                    <td style="padding: 8px; border: 1px solid #ffeeba;"><strong>CH₄</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${data.ch4}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">28</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ffeeba;"><strong>N₂O</strong></td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">${data.n2o}</td>
                                    <td style="padding: 8px; text-align: center; border: 1px solid #ffeeba;">265</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 15px;">
                            <h4 style="color: #856404; margin-top: 0;">ℹ️ About These Emission Factors</h4>
                            <p style="color: #856404; margin-bottom: 0;">These emission factors represent direct emissions from transportation activities per ton-mile of freight moved. Values are based on EPA Table 8 for upstream/downstream transportation and distribution activities.</p>
                        </div>
                    </div>

                    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h3 style="margin-top: 0; color: #1976d2;">📋 Calculation Notes</h3>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>All emission factors are per ton-mile of freight transported</li>
                            <li>CO₂e calculated using IPCC AR5 100-year GWP values</li>
                            <li>Factors represent direct combustion/operational emissions</li>
                            <li>Upstream fuel production emissions are not included</li>
                            <li>Suitable for Scope 3 emission calculations under GHG Protocol</li>
                            <li>Use for Category 4 (Upstream Transportation) and Category 9 (Downstream Transportation)</li>
                        </ul>
                    </div>

                    <div style="border-top: 1px solid #dee2e6; padding-top: 15px; font-size: 0.9em; color: #6c757d;">
                        <p style="margin: 5px 0;"><strong>Source:</strong> ${data.source}</p>
                        <p style="margin: 5px 0;"><strong>Reference:</strong> <a href="https://www.epa.gov/climateleadership/ghg-emission-factors-hub" target="_blank" style="color: #0066cc;">EPA GHG Emission Factors Hub</a></p>
                        <p style="margin: 5px 0;"><strong>Standard:</strong> EPA methodology for transportation and distribution</p>
                    </div>
                </div>
            `;
            
            // Create and show modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            const modalDialog = document.createElement('div');
            modalDialog.style.cssText = `
                background: white;
                border-radius: 12px;
                max-width: 90%;
                max-height: 90%;
                overflow-y: auto;
                padding: 20px;
                position: relative;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            `;
            
            const closeButton = document.createElement('button');
            closeButton.innerHTML = '✕';
            closeButton.style.cssText = `
                position: absolute;
                top: 15px;
                right: 15px;
                background: #dc3545;
                color: white;
                border: none;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
            `;
            closeButton.onclick = () => modal.remove();
            
            modalDialog.innerHTML = modalContent;
            modalDialog.appendChild(closeButton);
            modal.appendChild(modalDialog);
            document.body.appendChild(modal);
            
            // Close modal on outside click
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }

          // Stationary calculation-specific functions
        function updateStationaryQuantityLabel(calculationId) {
            const method = document.getElementById(`calculationMethod${calculationId}`).value;
            const label = document.getElementById(`quantityLabel${calculationId}`);
            
            if (method === 'energy') {
                label.textContent = '⚡ Fuel Quantity (Energy):';
            } else {
                label.textContent = '⚖️ Fuel Quantity (Mass/Volume):';
            }
        }
        
        function populateStationaryUnitOptions(calculationId) {
            const method = document.getElementById(`calculationMethod${calculationId}`).value;
            const fuelType = document.getElementById(`fuelType${calculationId}`).value;
            const unitSelect = document.getElementById(`unitSelect${calculationId}`);
            
            // Clear existing options
            unitSelect.innerHTML = '';
            
            if (method === 'energy') {
                // Populate energy units
                for (const unit in unitConversions.energy) {
                    const option = document.createElement('option');
                    option.value = unit;
                    option.textContent = unit;
                    unitSelect.appendChild(option);
                }
                // Set default to mmBtu
                unitSelect.value = 'mmBtu';
            } else {
                // Mass-based: determine appropriate unit type based on fuel
                const fuelInfo = fuelData[fuelType];
                if (fuelInfo && fuelInfo.massBased) {
                    const baseUnit = fuelInfo.massBased.unit;
                    let unitType;
                    
                    if (baseUnit === 'short ton') {
                        unitType = 'mass_solid';
                    } else if (baseUnit === 'gallon') {
                        unitType = 'volume_liquid';
                    } else if (baseUnit === 'scf') {
                        unitType = 'volume_gas';
                    }
                    
                    if (unitType && unitConversions[unitType]) {
                        for (const unit in unitConversions[unitType]) {
                            const option = document.createElement('option');
                            option.value = unit;
                            option.textContent = unit;
                            unitSelect.appendChild(option);
                        }
                        // Set default to the base unit
                        unitSelect.value = baseUnit;
                    }
                }
            }
        }
        
        function checkStationaryMassBasedAvailability(calculationId) {
            const method = document.getElementById(`calculationMethod${calculationId}`).value;
            const fuelType = document.getElementById(`fuelType${calculationId}`).value;
            const massBasedAvailable = fuelData[fuelType].massBased !== null;
            
            if (method === 'mass' && !massBasedAvailable) {
                alert('Mass-based calculation is not available for this fuel type. Switching to energy-based calculation.');
                document.getElementById(`calculationMethod${calculationId}`).value = 'energy';
                updateStationaryQuantityLabel(calculationId);
            }
            
            // Update unit options
            populateStationaryUnitOptions(calculationId);
            
            // Update the quantity label with the correct unit if mass-based
            if (method === 'mass' && massBasedAvailable) {
                const unit = fuelData[fuelType].massBased.unit;
                document.getElementById(`quantityLabel${calculationId}`).textContent = `⚖️ Fuel Quantity (${unit}):`;
            }
        }
        
        function calculateEmissions() {
            const method = document.getElementById('calculationMethod').value;
            const fuelType = document.getElementById('fuelType').value;
            const quantity = parseFloat(document.getElementById('quantity').value);
            const selectedUnit = document.getElementById('unitSelect').value;
            
            if (isNaN(quantity)) {
                alert('Please enter a valid quantity');
                return;
            }
            
            let co2, ch4, n2o, convertedQuantity, calculationUnit;
            
            if (method === 'energy') {
                // Convert input quantity to mmBtu
                convertedQuantity = quantity * unitConversions.energy[selectedUnit];
                calculationUnit = 'mmBtu';
                
                const factors = fuelData[fuelType].energyBased;
                co2 = convertedQuantity * factors.co2;
                ch4 = convertedQuantity * factors.ch4;
                n2o = convertedQuantity * factors.n2o;
            } else {
                // Mass-based
                if (fuelData[fuelType].massBased === null) {
                    alert('Mass-based calculation is not available for this fuel type');
                    return;
                }
                
                const factors = fuelData[fuelType].massBased;
                calculationUnit = factors.unit;
                
                // Convert input quantity to the base unit for calculations
                let unitType;
                if (calculationUnit === 'short ton') {
                    unitType = 'mass_solid';
                } else if (calculationUnit === 'gallon') {
                    unitType = 'volume_liquid';
                } else if (calculationUnit === 'scf') {
                    unitType = 'volume_gas';
                }
                
                convertedQuantity = quantity * unitConversions[unitType][selectedUnit];
                
                co2 = convertedQuantity * factors.co2;
                ch4 = convertedQuantity * factors.ch4;
                n2o = convertedQuantity * factors.n2o;
            }
            
            // Get emission factors for display
            let factors;
            if (method === 'energy') {
                factors = fuelData[fuelType].energyBased;
            } else {
                factors = fuelData[fuelType].massBased;
            }
            
            // Calculate CO2e components for detailed display
            const ch4_co2e = (ch4 / 1000) * 28;
            const n2o_co2e = (n2o / 1000) * 265;
            const co2e = co2 + ch4_co2e + n2o_co2e;
            
            // Display results with detailed calculations
            const resultsDiv = document.getElementById('resultContent');
            resultsDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3>Input Summary</h3>
                    <p><strong>Fuel Type:</strong> ${fuelType}</p>
                    <p><strong>Input Quantity:</strong> ${quantity} ${selectedUnit}</p>
                    ${selectedUnit !== calculationUnit ? `<p><strong>Converted Quantity:</strong> ${convertedQuantity.toFixed(6)} ${calculationUnit}</p>` : ''}
                    <p><strong>Calculation Method:</strong> ${method === 'energy' ? 'Energy-Based' : 'Mass-Based'}</p>
                </div>                  <div style="margin-bottom: 15px;">
                    <h3>📊 Emission Factors Applied</h3>
                    <div style="background-color: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                        <p><strong>Source:</strong> EPA GHG Hub (2025) | <strong>Standard:</strong> IPCC 2006 | <strong>Method:</strong> ${method === 'energy' ? 'Energy-Based' : 'Mass-Based'}</p>
                    </div>
                    
                    <table style="margin-bottom: 10px; border-collapse: collapse; width: 100%;">
                        <tr style="background-color: #e8f4fc;">
                            <th style="padding: 6px; border: 1px solid #ddd;">Gas</th>
                            <th style="padding: 6px; border: 1px solid #ddd;">Factor</th>
                            <th style="padding: 6px; border: 1px solid #ddd;">Unit</th>
                        </tr>
                        <tr>
                            <td style="padding: 4px; border: 1px solid #ddd;"><strong>CO₂</strong></td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${factors.co2}</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">kg per ${calculationUnit}</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                            <td style="padding: 4px; border: 1px solid #ddd;"><strong>CH₄</strong></td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${factors.ch4}</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">g per ${calculationUnit}</td>
                        </tr>
                        <tr>
                            <td style="padding: 4px; border: 1px solid #ddd;"><strong>N₂O</strong></td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${factors.n2o}</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">g per ${calculationUnit}</td>
                        </tr>
                    </table>
                </div>                  <div style="margin-bottom: 15px;">
                    <h3>🔢 Calculation Steps</h3>
                    ${selectedUnit !== calculationUnit ? 
                        `<p><strong>Unit Conversion:</strong> ${quantity} ${selectedUnit} → ${convertedQuantity.toFixed(4)} ${calculationUnit}</p>` 
                        : '<p><strong>Input:</strong> No unit conversion needed</p>'
                    }
                    
                    <table style="margin-bottom: 10px; border-collapse: collapse; width: 100%;">
                        <tr style="background-color: #d4edda;">
                            <th style="padding: 6px; border: 1px solid #c3e6cb;">Gas</th>
                            <th style="padding: 6px; border: 1px solid #c3e6cb;">Calculation</th>
                            <th style="padding: 6px, border: 1px solid #c3e6cb;">Result</th>
                        </tr>
                        <tr>
                            <td style="padding: 4px; border: 1px solid #c3e6cb;"><strong>CO₂</strong></td>
                            <td style="padding: 4px; border: 1px solid #c3e6cb;">${convertedQuantity.toFixed(4)} × ${factors.co2}</td>
                            <td style="padding: 4px, border: 1px solid #c3e6cb;"><strong>${co2.toFixed(3)} kg</strong></td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                            <td style="padding: 4px; border: 1px solid #c3e6cb;"><strong>CH₄</strong></td>
                            <td style="padding: 4px; border: 1px solid #c3e6cb;">${convertedQuantity.toFixed(4)} × ${factors.ch4}</td>
                            <td style="padding: 4px, border: 1px solid #c3e6cb;"><strong>${ch4.toFixed(3)} g</strong></td>
                        </tr>
                        <tr>
                            <td style="padding: 4px; border: 1px solid #c3e6cb;"><strong>N₂O</strong></td>
                            <td style="padding: 4px; border: 1px solid #c3e6cb;">${convertedQuantity.toFixed(4)} × ${factors.n2o}</td>
                            <td style="padding: 4px, border: 1px solid #c3e6cb;"><strong>${n2o.toFixed(3)} g</strong></td>
                        </tr>
                    </table>
                </div>
                  <div style="margin-bottom: 20px;">
                    <h3>🌍 CO₂ Equivalent (CO₂e) Calculation with GWP Integration</h3>
                    
                    <div style="background-color: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #856404; margin-top: 0;">📈 Global Warming Potential (GWP) Methodology</h4>
                        <p><strong>GWP Standard:</strong> IPCC Fifth Assessment Report (AR5) - 100-year time horizon</p>
                        <p><strong>Reference Gas:</strong> Carbon Dioxide (CO₂) = 1</p>
                        <p><strong>Scientific Basis:</strong> Integrated radiative forcing over 100 years</p>
                        
                        <table style="width: 100%; margin-top: 10px; border-collapse: collapse;">
                            <tr style="background-color: #ffeaa7;">
                                <th style="padding: 8px; border: 1px solid #fdcb6e;">Gas</th>
                                <th style="padding: 8px; border: 1px solid #fdcb6e;">GWP₁₀₀</th>
                                <th style="padding: 8px; border: 1px solid #fdcb6e;">Atmospheric Lifetime</th>
                                <th style="padding: 8px; border: 1px solid #fdcb6e;">EF × GWP Application</th>
                            </tr>
                            <tr>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">CO₂</td>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">1</td>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">300-1000 years</td>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">Direct application (reference)</td>
                            </tr>
                            <tr style="background-color: #fff8dc;">
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">CH₄</td>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">28</td>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">12 years</td>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">Convert g→kg, then × 28</td>
                            </tr>
                            <tr>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">N₂O</td>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">265</td>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">121 years</td>
                                <td style="padding: 6px; border: 1px solid #fdcb6e;">Convert g→kg, then × 265</td>
                            </tr>
                        </table>
                    </div>
                    
                    <h4 style="color: #dc3545;">🧮 Step-by-Step CO₂e Calculation</h4>
                    <table style="margin-bottom: 15px; border-collapse: collapse; width: 100%;">
                        <tr style="background-color: #f8d7da;">
                            <th style="padding: 10px; border: 1px solid #f5c6cb;">Gas</th>
                            <th style="padding: 10px; border: 1px solid #f5c6cb;">Emissions (from EF)</th>
                            <th style="padding: 10px; border: 1px solid #f5c6cb;">Unit Conversion</th>
                            <th style="padding: 10px; border: 1px solid #f5c6cb;">GWP Factor</th>
                            <th style="padding: 10px; border: 1px solid #f5c6cb;">CO₂e Contribution</th>
                        </tr>
                        <tr>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;"><strong>CO₂</strong></td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;">${co2.toFixed(4)} kg</td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;">No conversion needed</td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;">× 1</td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;"><strong>${co2.toFixed(4)} kg CO₂e</strong></td>
                        </tr>
                        <tr style="background-color: #fff5f5;">
                            <td style="padding: 8px; border: 1px solid #f5c6cb;"><strong>CH₄</strong></td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;">${ch4.toFixed(4)} g</td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;">÷ 1000 = ${(ch4/1000).toFixed(6)} kg</td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;">× 28</td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;"><strong>${ch4_co2e.toFixed(4)} kg CO₂e</strong></td>
                        </tr>
                        <tr>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;"><strong>N₂O</strong></td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;">${n2o.toFixed(4)} g</td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;">÷ 1000 = ${(n2o/1000).toFixed(6)} kg</td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;">× 265</td>
                            <td style="padding: 8px; border: 1px solid #f5c6cb;"><strong>${n2o_co2e.toFixed(4)} kg CO₂e</strong></td>
                        </tr>
                        <tr style="border-top: 3px solid #721c24; background-color: #f8d7da; font-weight: bold;">
                            <td colspan="4" style="padding: 10px; border: 1px solid #f5c6cb; text-align: left;"><strong>Total CO₂ Equivalent</strong></td>
                            <td style="padding: 10px; border: 1px solid #f5c6cb; font-size: 0.9em;"><strong>${co2e.toFixed(4)} kg CO
                        </tr>
                    </table>
                    
                    <div style="background-color: #d4edda; padding: 15px; border-radius: 5px; border-left: 4px solid #28a745;">
                        <h5 style="margin-top: 0; color: #155724;">🔬 Mathematical Verification:</h5>
                        <p><strong>Complete CO₂e Formula:</strong></p>
                        <p style="font-family: monospace; background-color: #f8f9fa; padding: 8px; border-radius: 3px;">
                            CO₂e = CO₂_direct + (CH₄_grams ÷ 1000 × GWP_CH₄) + (N₂O_grams ÷ 1000 × GWP_N₂O)
                        </p>
                        <p><strong>Substituting values:</strong></p>
                        <p style="font-family: monospace; background-color: #f8f9fa; padding: 8px; border-radius: 3px;">
                            CO₂e = ${co2.toFixed(4)} + (${ch4.toFixed(4)} ÷ 1000 × 28) + (${n2o.toFixed(4)} ÷ 1000 × 265)
                        </p>
                        <p style="font-family: monospace; background-color: #f8f9fa; padding: 8px; border-radius: 3px;">
                            CO₂e = ${co2.toFixed(4)} + ${ch4_co2e.toFixed(4)} + ${n2o_co2e.toFixed(4)} = <strong>${co2e.toFixed(4)} kg CO₂e</strong>
                        </p>
                        
                        <p style="margin-top: 15px;"><strong>EF Integration Check:</strong></p>
                        <p>✅ All emission factors correctly applied to input quantity</p>
                        <p>✅ Unit conversions properly handled (g → kg where needed)</p>
                        <p>✅ GWP factors applied according to IPCC AR5 standards</p>
                        <p>✅ Total represents complete combustion impact</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3>Final Results Summary</h3>
                    <table>
                        <tr>
                            <th>Gas</th>
                            <th>Emissions</th>
                        </tr>
                        <tr>
                            <td>CO₂</td>
                            <td>${co2.toFixed(2)} kg</td>
                        </tr>
                        <tr>
                            <td>CH₄</td>
                            <td>${ch4.toFixed(2)} g</td>
                        </tr>
                        <tr>
                            <td>N₂O</td>
                            <td>${n2o.toFixed(2)} g</td>
                        </tr>
                        <tr style="background-color: #e8f4fc; font-weight: bold;">
                            <td><strong>Total CO₂e</strong></td>
                            <td><strong>${co2e.toFixed(2)} kg</strong></td>
                        </tr>
                    </table>
                </div>
                  <div style="background-color: #fff3cd; padding: 15px; border-radius: 5px; border-left: 4px solid #ffc107;">
                    <p><strong>Important Notes:</strong></p>
                    <ul style="margin: 5px 0;">
                        <li>CO₂e calculated using 100-year Global Warming Potentials (IPCC AR5): CO₂=1, CH₄=28, N₂O=265</li>
                        <li>Results represent combustion emissions only and do not include upstream emissions</li>
                        <li>Emission factors are from EPA's GHG Emission Factors Hub (2025 version)</li>
                        <li>CH₄ and N₂O values are converted from grams to kilograms (÷1000) before applying GWP factors</li>
                        ${selectedUnit !== calculationUnit ? `<li><strong>Unit Conversion Applied:</strong> ${quantity} ${selectedUnit} = ${convertedQuantity.toFixed(6)} ${calculationUnit}</li>` : ''}
                        <li>Multiple units are supported for convenience - all calculations use the appropriate base units</li>
                    </ul>                </div>
            `;
              // Show the results section
            document.getElementById('results').style.display = 'block';
        }

        // Calculate stationary emissions for a specific calculation
        function calculateStationaryEmissions(calculationId) {
            const method = document.getElementById(`calculationMethod${calculationId}`).value;
            const fuelType = document.getElementById(`fuelType${calculationId}`).value;
            const quantity = parseFloat(document.getElementById(`quantity${calculationId}`).value);
            const selectedUnit = document.getElementById(`unitSelect${calculationId}`).value;
            
            if (isNaN(quantity) || quantity <= 0) {
                alert('Please enter a valid quantity');
                return;
            }
            
            let co2, ch4, n2o, convertedQuantity, calculationUnit;
            
            if (method === 'energy') {
                // Convert input quantity to mmBtu
                convertedQuantity = quantity * unitConversions.energy[selectedUnit];
                calculationUnit = 'mmBtu';
                
                const factors = fuelData[fuelType].energyBased;
                co2 = convertedQuantity * factors.co2;
                ch4 = convertedQuantity * factors.ch4;
                n2o = convertedQuantity * factors.n2o;
            } else {
                // Mass-based
                if (fuelData[fuelType].massBased === null) {
                    alert('Mass-based calculation is not available for this fuel type');
                    return;
                }
                
                const factors = fuelData[fuelType].massBased;
                calculationUnit = factors.unit;
                
                // Convert input quantity to the base unit for calculations
                let unitType;
                if (calculationUnit === 'short ton') {
                    unitType = 'mass_solid';
                } else if (calculationUnit === 'gallon') {
                    unitType = 'volume_liquid';
                } else if (calculationUnit === 'scf') {
                    unitType = 'volume_gas';
                }
                
                convertedQuantity = quantity * unitConversions[unitType][selectedUnit];
                
                co2 = convertedQuantity * factors.co2;
                ch4 = convertedQuantity * factors.ch4;
                n2o = convertedQuantity * factors.n2o;
            }
            
            // Get emission factors for display
            let factors;
            if (method === 'energy') {
                factors = fuelData[fuelType].energyBased;
            } else {
                factors = fuelData[fuelType].massBased;
            }
            
            // Calculate CO2e components for detailed display
            const ch4_co2e = (ch4 / 1000) * 28;
            const n2o_co2e = (n2o / 1000) * 265;
            const co2e = co2 + ch4_co2e + n2o_co2e;
            
            // Store result for summary
            const resultIndex = stationaryResults.findIndex(r => r.id === calculationId);
            const result = {
                id: calculationId,
                fuelType,
                quantity,
                unit: selectedUnit,
                method,
                co2,
                ch4,
                n2o,
                co2e,
                convertedQuantity,
                calculationUnit
            };
            
            if (resultIndex >= 0) {
                stationaryResults[resultIndex] = result;
            } else {
                stationaryResults.push(result);
            }
            
            // Display results for this specific calculation
            const resultsDiv = document.getElementById(`stationaryResultContent${calculationId}`);
            resultsDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>🏭 Stationary Calculation #${calculationId} Results</h4>
                    <div style="background-color: #d1ecf1; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #0c5460; margin-top: 0;">📊 Input Summary</h5>
                        <p><strong>Fuel Type:</strong> ${fuelType}</p>
                        <p><strong>Input Quantity:</strong> ${quantity} ${selectedUnit}</p>
                        ${selectedUnit !== calculationUnit ? `<p><strong>Converted Quantity:</strong> ${convertedQuantity.toFixed(6)} ${calculationUnit}</p>` : ''}
                        <p><strong>Calculation Method:</strong> ${method === 'energy' ? 'Energy-Based' : 'Mass-Based'}</p>
                    </div>
                    
                    <div style="background-color: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h5 style="color: #155724; margin-top: 0;">🎯 Final Results</h5>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="background-color: #c3e6cb;">
                                <th style="padding: 8px; border: 1px solid #a3d9a5;">Emission Type</th>
                                <th style="padding: 8px; border: 1px solid #a3d9a5; text-align: right;">Amount</th>
                                <th style="padding: 8px; border: 1px solid #a3d9a5; text-align: left;">Unit</th>
                            </tr>                            <tr>
                                <td style="padding: 8px; border: 1px solid #a3d9a5;"><strong>CO₂</strong></td>
                                <td style="padding: 8px; border: 1px solid #a3d9a5; text-align: right;">${co2.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #a3d9a5; text-align: left;">kg</td>
                            </tr>                            <tr style="background-color: #f8f9fa;">
                                <td style="padding: 8px; border: 1px solid #a3d9a5;"><strong>CH₄</strong></td>
                                <td style="padding: 8px; border: 1px solid #a3d9a5; text-align: right;">${ch4.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #a3d9a5; text-align: left;">g</td>
                            </tr>                            <tr>
                                <td style="padding: 8px; border: 1px solid #a3d9a5;"><strong>N₂O</strong></td>
                                <td style="padding: 8px; border: 1px solid #a3d9a5; text-align: right;">${n2o.toFixed(3)}</td>
                                <td style="padding: 8px; border: 1px solid #a3d9a5; text-align: left;">g</td>
                            </tr>                            <tr style="background-color: #28a745; color: white;">
                                <td style="padding: 10px; border: 1px solid #1e7e34;"><strong>Total CO₂e</strong></td>                                <td style="padding: 10px; border: 1px solid #1e7e34; text-align: right; font-size: 0.9em;"><strong>${co2e.toFixed(2)}</strong></td>
                                <td style="padding: 10px; border: 1px solid #1e7e34; text-align: left; font-size: 0.9em;"><strong>kg CO₂e</strong></td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
            
            // Show the results section for this calculation
            document.getElementById(`stationaryResults${calculationId}`).style.display = 'block';
            
            // Update summary if multiple calculations exist
            updateStationarySummary();
        }        // Calculate mobile emissions for a specific calculation
        function calculateMobileEmissions(calculationId) {
            const fuel = document.getElementById(`mobileFuel${calculationId}`).value;
            const quantity = parseFloat(document.getElementById(`mobileQuantity${calculationId}`).value);
            const selectedUnit = document.getElementById(`mobileUnit${calculationId}`).value;

            if (!fuel || isNaN(quantity) || quantity <= 0) {
                alert('Please select a fuel type and enter a valid quantity.');
                return;
            }

            const mobileFuelData = mobileCombustionEF[fuel];
            
            // Convert quantity to appropriate unit for calculation
            let convertedQuantity = quantity;
            let conversionFactor = 1;
            let conversionNote = '';
            let calculationUnit = mobileFuelData.unit;

            // Handle unit conversions based on the fuel's expected unit
            if (calculationUnit === 'gallon') {
                switch(selectedUnit) {
                    case 'liters':
                        conversionFactor = 0.264172;
                        convertedQuantity = quantity * conversionFactor;
                        conversionNote = `${quantity} liters = ${convertedQuantity.toFixed(6)} gallons (conversion factor: ${conversionFactor})`;
                        break;
                    case 'barrels':
                        conversionFactor = 42;
                        convertedQuantity = quantity * conversionFactor;
                        conversionNote = `${quantity} barrels = ${convertedQuantity.toFixed(6)} gallons (conversion factor: ${conversionFactor})`;
                        break;
                    case 'gallons':
                    default:
                        conversionNote = 'No conversion needed (already in gallons)';
                        break;
                }
            } else if (calculationUnit === 'scf') {
                // Handle natural gas (CNG) conversions
                switch(selectedUnit) {
                    case 'liters':
                        conversionFactor = 0.0353147; // liters to scf
                        convertedQuantity = quantity * conversionFactor;
                        conversionNote = `${quantity} liters = ${convertedQuantity.toFixed(6)} scf (conversion factor: ${conversionFactor})`;
                        break;
                    case 'gallons':
                        conversionFactor = 7.48052; // gallons to scf (approximate for CNG)
                        convertedQuantity = quantity * conversionFactor;
                        conversionNote = `${quantity} gallons = ${convertedQuantity.toFixed(6)} scf (conversion factor: ${conversionFactor})`;
                        break;
                    default:
                        conversionNote = 'No conversion needed (already in scf)';
                        break;
                }
            }

            // Calculate emissions for all greenhouse gases
            const co2 = convertedQuantity * mobileFuelData.co2;
            const ch4_g = convertedQuantity * mobileFuelData.ch4; // CH4 in grams
            const n2o_g = convertedQuantity * mobileFuelData.n2o; // N2O in grams
            
            // Convert CH4 and N2O from grams to kilograms
            const ch4_kg = ch4_g / 1000;
            const n2o_kg = n2o_g / 1000;
            
            // Calculate CO2 equivalent values using GWP values (IPCC AR5, 100-year)
            const ch4_co2e = ch4_kg * GWP.ch4; // 28 GWP for CH4
            const n2o_co2e = n2o_kg * GWP.n2o; // 265 GWP for N2O
            
            // Calculate total CO2 equivalent
            const total_co2e = co2 + ch4_co2e + n2o_co2e;
            
            // Store result for summary
            const resultIndex = mobileResults.findIndex(r => r.id === calculationId);
            const result = {
                id: calculationId,
                fuelType: fuel,
                quantity,
                unit: selectedUnit,
                convertedQuantity,
                calculationUnit,
                co2,
                ch4_g,
                n2o_g,
                ch4_kg,
                n2o_kg,
                ch4_co2e,
                n2o_co2e,
                total_co2e,
                conversionNote,
                description: mobileFuelData.description,
                source: mobileFuelData.source,
                uncertainty: mobileFuelData.uncertainty
            };
            
            if (resultIndex >= 0) {
                mobileResults[resultIndex] = result;
            } else {
                mobileResults.push(result);
            }

            // Display comprehensive results with all greenhouse gases
            const resultsDiv = document.getElementById(`mobileResultContent${calculationId}`);
            resultsDiv.innerHTML = `
                <div style="background-color: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: #0d47a1; margin-top: 0;">🚗 Mobile Calculation #${calculationId} Results</h4>
                    
                    <div style="background-color: #fff; padding: 15px; border-radius: 5px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h5 style="color: #0056b3; margin-top: 0;">📋 Input Data Summary</h5>
                        <p><strong>Fuel Type:</strong> ${fuel}</p>
                        <p><strong>Description:</strong> ${mobileFuelData.description}</p>
                        <p><strong>Input Quantity:</strong> ${quantity} ${selectedUnit}</p>
                        <p><strong>Conversion:</strong> ${conversionNote}</p>
                        <p><strong>Data Source:</strong> ${mobileFuelData.source}</p>
                        <p><strong>Uncertainty:</strong> ${mobileFuelData.uncertainty}</p>
                    </div>
                    
                    <div style="background-color: #fff; padding: 15px; border-radius: 5px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h5 style="color: #0056b3; margin-top: 0;">📊 EPA 2025 Emission Factors Applied</h5>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                            <thead>
                                <tr style="background-color: #f8f9fa;">
                                    <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Gas</th>
                                    <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Emission Factor</th>
                                    <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">Unit</th>
                                    <th style="border: 1px solid #dee2e6; padding: 8px; text-align: left;">GWP (100-yr)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;"><strong>CO₂</strong></td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">${mobileFuelData.co2}</td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">kg/${calculationUnit}</td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">1</td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;"><strong>CH₄</strong></td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">${mobileFuelData.ch4}</td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">g/${calculationUnit}</td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">${GWP.ch4}</td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;"><strong>N₂O</strong></td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">${mobileFuelData.n2o}</td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">g/${calculationUnit}</td>
                                    <td style="border: 1px solid #dee2e6; padding: 8px;">${GWP.n2o}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="background-color: #fff; padding: 15px; border-radius: 5px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h5 style="color: #0056b3; margin-top: 0;">🧮 Detailed Calculation Process</h5>
                        
                        <div style="margin-bottom: 15px;">
                            <h6 style="color: #007bff; margin-bottom: 8px;">Step 1: Unit Conversion</h6>
                            <p style="margin-left: 20px; margin-bottom: 5px;">→ ${quantity} ${selectedUnit} = ${convertedQuantity.toFixed(6)} ${calculationUnit}</p>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <h6 style="color: #007bff; margin-bottom: 8px;">Step 2: Direct Emissions Calculation</h6>
                            <p style="margin-left: 20px; margin-bottom: 5px;"><strong>CO₂:</strong> ${convertedQuantity.toFixed(6)} ${calculationUnit} × ${mobileFuelData.co2} kg/${calculationUnit} = <strong>${co2.toFixed(3)} kg CO₂</strong></p>
                            <p style="margin-left: 20px; margin-bottom: 5px;"><strong>CH₄:</strong> ${convertedQuantity.toFixed(6)} ${calculationUnit} × ${mobileFuelData.ch4} g/${calculationUnit} = <strong>${ch4_g.toFixed(3)} g CH₄</strong> (${ch4_kg.toFixed(6)} kg)</p>
                            <p style="margin-left: 20px; margin-bottom: 5px;"><strong>N₂O:</strong> ${convertedQuantity.toFixed(6)} ${calculationUnit} × ${mobileFuelData.n2o} g/${calculationUnit} = <strong>${n2o_g.toFixed(3)} g N₂O</strong> (${n2o_kg.toFixed(6)} kg)</p>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <h6 style="color: #007bff; margin-bottom: 8px;">Step 3: CO₂ Equivalent Conversion (using IPCC AR5 GWP values)</h6>
                            <p style="margin-left: 20px; margin-bottom: 5px;"><strong>CO₂:</strong> ${co2.toFixed(3)} kg × 1 = <strong>${co2.toFixed(3)} kg CO₂e</strong></p>
                            <p style="margin-left: 20px; margin-bottom: 5px;"><strong>CH₄:</strong> ${ch4_kg.toFixed(6)} kg × ${GWP.ch4} = <strong>${ch4_co2e.toFixed(3)} kg CO₂e</strong></p>
                            <p style="margin-left: 20px; margin-bottom: 5px;"><strong>N₂O:</strong> ${n2o_kg.toFixed(6)} kg × ${GWP.n2o} = <strong>${n2o_co2e.toFixed(3)} kg CO₂e</strong></p>
                        </div>
                    </div>
                    
                    <div style="background-color: #28a745; color: white; padding: 20px; border-radius: 8px;">
                        <h4 style="margin: 0 0 15px 0; font-size: 1.3em;">🎯 Final Emission Results</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div style="text-align: center;">
                                <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">CO₂ Direct</p>
                                <p style="margin: 5px 0 0 0; font-size: 1.2em; font-weight: bold;">${co2.toFixed(2)} kg</p>
                            </div>
                            <div style="text-align: center;">
                                <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">CH₄ as CO₂e</p>
                                <p style="margin: 5px 0 0 0; font-size: 1.2em; font-weight: bold;">${ch4_co2e.toFixed(3)} kg</p>
                            </div>
                            <div style="text-align: center;">
                                <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">N₂O as CO₂e</p>
                                <p style="margin: 5px 0 0 0; font-size: 1.2em; font-weight: bold;">${n2o_co2e.toFixed(3)} kg</p>
                            </div>
                        </div>
                        <div style="text-align: center; border-top: 2px solid rgba(255,255,255,0.3); padding-top: 15px;">
                            <p style="margin: 0; font-size: 1em; opacity: 0.9;">Total GHG Emissions</p>
                            <p style="margin: 5px 0 0 0; font-size: 2em; font-weight: bold;">${total_co2e.toFixed(2)} kg CO₂e</p>
                            <p style="margin: 5px 0 0 0; font-size: 0.9em; opacity: 0.8;">from ${fuel} combustion</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Show the results section for this calculation
            document.getElementById(`mobileResults${calculationId}`).style.display = 'block';
            
            // Update summary if multiple calculations exist
            updateMobileSummary();
        }
        
        // Update stationary summary when multiple calculations exist
        function updateStationarySummary() {
            if (stationaryResults.length <= 1) {
                document.getElementById('stationarySummary').style.display = 'none';
                return;
            }
            
            let totalCO2 = 0;
            let totalCH4 = 0;
            let totalN2O = 0;
            let totalCO2e = 0;
            
            let summaryHtml = `
                <table class="summary-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Fuel Type</th>
                            <th>Quantity</th>
                            <th>Method</th>
                            <th>CO₂ (kg)</th>
                            <th>CH₄ (g)</th>
                            <th>N₂O (g)</th>
                            <th>CO₂e (kg)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            stationaryResults.forEach(result => {
                totalCO2 += result.co2;
                totalCH4 += result.ch4;
                totalN2O += result.n2o;
                totalCO2e += result.co2e;
                
                summaryHtml += `
                    <tr>
                        <td>${result.id}</td>
                        <td>${result.fuelType}</td>
                        <td>${result.quantity} ${result.unit}</td>
                        <td>${result.method === 'energy' ? 'Energy' : 'Mass'}</td>
                        <td>${result.co2.toFixed(2)}</td>
                        <td>${result.ch4.toFixed(2)}</td>
                        <td>${result.n2o.toFixed(2)}</td>
                        <td>${result.co2e.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            summaryHtml += `
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="4"><strong>TOTAL</strong></td>
                            <td><strong>${totalCO2.toFixed(2)}</strong></td>
                            <td><strong>${totalCH4.toFixed(2)}</strong></td>
                            <td><strong>${totalN2O.toFixed(2)}</strong></td>
                            <td><strong>${totalCO2e.toFixed(2)}</strong></td>
                        </tr>
                    </tfoot>
                </table>
                
                <div class="summary-highlight">
                    <h4>🎯 Total Stationary Combustion Emissions</h4>
                    <p><strong>${totalCO2e.toFixed(2)} kg CO₂e</strong> from ${stationaryResults.length} calculations</p>
                </div>
            `;
            
            document.getElementById('stationarySummaryContent').innerHTML = summaryHtml;
            document.getElementById('stationarySummary').style.display = 'block';
        }
          // Update mobile summary when multiple calculations exist
        function updateMobileSummary() {
            if (mobileResults.length <= 1) {
                document.getElementById('mobileSummary').style.display = 'none';
                return;
            }
            
            let totalCO2 = 0;
            let totalCH4_g = 0;
            let totalN2O_g = 0;
            let totalCH4_co2e = 0;
            let totalN2O_co2e = 0;
            let totalCO2e = 0;
            
            let summaryHtml = `
                <div style="background-color: #e8f4fd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: #0d47a1; margin-top: 0;">📊 Mobile Combustion Summary (${mobileResults.length} calculations)</h3>
                    
                    <table class="summary-table" style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                        <thead>
                            <tr style="background-color: #1976d2; color: white;">
                                <th style="border: 1px solid #0d47a1; padding: 10px;">#</th>
                                <th style="border: 1px solid #0d47a1; padding: 10px;">Fuel Type</th>
                                <th style="border: 1px solid #0d47a1; padding: 10px;">Input Quantity</th>
                                <th style="border: 1px solid #0d47a1; padding: 10px;">Calc. Unit</th>
                                <th style="border: 1px solid #0d47a1; padding: 10px;">CO₂ (kg)</th>
                                <th style="border: 1px solid #0d47a1; padding: 10px;">CH₄ (g)</th>
                                <th style="border: 1px solid #0d47a1; padding: 10px;">N₂O (g)</th>
                                <th style="border: 1px solid #0d47a1; padding: 10px; background-color: #0d47a1;">Total CO₂e (kg)</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            mobileResults.forEach(result => {
                totalCO2 += result.co2;
                totalCH4_g += result.ch4_g;
                totalN2O_g += result.n2o_g;
                totalCH4_co2e += result.ch4_co2e;
                totalN2O_co2e += result.n2o_co2e;
                totalCO2e += result.total_co2e;
                
                summaryHtml += `
                    <tr style="background-color: ${result.id % 2 === 0 ? '#f8f9fa' : 'white'};">
                        <td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">${result.id}</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">${result.fuelType}</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px; text-align: right;">${result.quantity} ${result.unit}</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px; text-align: right;">${result.convertedQuantity.toFixed(3)} ${result.calculationUnit}</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px; text-align: right;">${result.co2.toFixed(3)}</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px; text-align: right;">${result.ch4_g.toFixed(3)}</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px; text-align: right;">${result.n2o_g.toFixed(3)}</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px; text-align: right; font-weight: bold; background-color: #e3f2fd;">${result.total_co2e.toFixed(3)}</td>
                    </tr>
                `;
            });
            
            summaryHtml += `
                        </tbody>
                        <tfoot>
                            <tr style="background-color: #28a745; color: white; font-weight: bold;">
                                <td colspan="4" style="border: 1px solid #1e7e34; padding: 12px; text-align: center; font-size: 1.1em;">TOTAL EMISSIONS</td>
                                <td style="border: 1px solid #1e7e34; padding: 12px; text-align: right;">${totalCO2.toFixed(3)}</td>
                                <td style="border: 1px solid #1e7e34; padding: 12px; text-align: right;">${totalCH4_g.toFixed(3)}</td>
                                <td style="border: 1px solid #1e7e34; padding: 12px; text-align: right;">${totalN2O_g.toFixed(3)}</td>
                                <td style="border: 1px solid #1e7e34; padding: 12px; text-align: right; font-size: 1.2em; background-color: #1e7e34;">${totalCO2e.toFixed(3)}</td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 20px;">
                        <div style="background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                            <h4 style="color: #666; margin: 0 0 10px 0; font-size: 0.9em;">CO₂ Direct Emissions</h4>
                            <p style="margin: 0; font-size: 1.4em; font-weight: bold; color: #1976d2;">${totalCO2.toFixed(2)} kg</p>
                        </div>
                        <div style="background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                            <h4 style="color: #666; margin: 0 0 10px 0; font-size: 0.9em;">CH₄ + N₂O as CO₂e</h4>
                            <p style="margin: 0; font-size: 1.4em; font-weight: bold; color: #ff9800;">${(totalCH4_co2e + totalN2O_co2e).toFixed(3)} kg</p>
                        </div>
                        <div style="background-color: #28a745; color: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                            <h4 style="color: white; margin: 0 0 10px 0; font-size: 0.9em;">Total GHG Emissions</h4>
                            <p style="margin: 0; font-size: 1.6em; font-weight: bold;">${totalCO2e.toFixed(2)} kg CO₂e</p>
                        </div>
                    </div>
                    
                    <div style="background-color: #fff; padding: 15px; border-radius: 8px; margin-top: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4 style="color: #0d47a1; margin-top: 0;">📋 Emission Breakdown Details</h4>
                        <p><strong>Total Calculations:</strong> ${mobileResults.length} mobile combustion sources</p>
                        <p><strong>Methodology:</strong> EPA 2025 GHG Emission Factors Hub, Table 2 (Mobile Combustion)</p>
                        <p><strong>GWP Values:</strong> IPCC AR5 100-year (CH₄ = 28, N₂O = 265)</p>
                        <p><strong>Coverage:</strong> All three major greenhouse gases (CO₂, CH₄, N₂O) with comprehensive CO₂e conversion</p>
                    </div>
                </div>
            `;document.getElementById('mobileSummaryContent').innerHTML = summaryHtml;
            document.getElementById('mobileSummary').style.display = 'block';
        }

        // Mobile Combustion Tooltip Functions
        function updateMobileTooltip(calculationId) {
            const fuelType = document.getElementById(`mobileFuel${calculationId}`).value;
            const method = document.getElementById(`mobileMethod${calculationId}`).value;
            const tooltip = document.getElementById(`mobileEFTooltip${calculationId}`);
            
            if (!fuelType) {
                tooltip.title = "Select a fuel type to see emission factors";
                return;
            }
            
            if (method === 'volume-based') {
                const ef = mobileCombustionEF[fuelType];
                if (ef) {
                    tooltip.title = `${fuelType}:\nCO₂: ${ef.co2} kg/gallon\n(EPA Table 2 - Mobile Combustion)`;
                }
            } else {
                tooltip.title = `${fuelType}:\nMethod: ${method}\n(Click info button for detailed factors)`;
            }
        }        function updateMobileMethodUnits(calculationId) {
            const method = document.getElementById(`mobileMethod${calculationId}`).value;
            const unitSelect = document.getElementById(`mobileUnit${calculationId}`);
            
            // Clear and populate units based on method
            unitSelect.innerHTML = '';
              if (method === 'volume-based') {
                unitSelect.innerHTML = `
                    <option value="gallons">Gallons (US)</option>
                    <option value="liters">Liters</option>
                    <option value="barrels">Barrels</option>
                `;
            }
            
            // Update tooltip
            updateMobileTooltip(calculationId);
        }        function showMobileEmissionFactors(calculationId) {
            const fuelType = document.getElementById(`mobileFuel${calculationId}`).value;
            const method = document.getElementById(`mobileMethod${calculationId}`).value;
            
            if (!fuelType) {
                alert('Please select a fuel type first.');
                return;
            }
            
            let content = '';
            
            if (method === 'volume-based') {
                const ef = mobileCombustionEF[fuelType];
                if (ef) {                    // Calculate CO₂e using only CO₂ 
                    const co2e = ef.co2;
                    
                    content = `
                        <h3>📊 EPA Table 2 Mobile Combustion Emission Factors</h3>
                        <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <p><strong>🚗 Fuel Type:</strong> ${fuelType}</p>
                            <p><strong>📖 Source:</strong> ${ef.source || 'EPA 2025 Table 2'}</p>
                            <p><strong>📏 Method:</strong> Volume-based</p>
                            <p><strong>🎯 Uncertainty:</strong> ${ef.uncertainty || '±5%'}</p>
                        </div>
                          <h4>🌍 Greenhouse Gas Emission Factors</h4>
                        <table style="border-collapse: collapse; width: 100%; margin-bottom: 15px;">
                            <tr style="background-color: #e3f2fd;">
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Gas</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Emission Factor</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Unit</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">GWP (AR5)</th>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;"><strong>CO₂</strong> (Carbon Dioxide)</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${ef.co2}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">kg/${ef.unit}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">1</td>
                            </tr>
                            <tr style="background-color: #fff3e0;">
                                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Total CO₂e</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>${ef.co2}</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>kg CO₂e/${ef.unit}</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">-</td>
                            </tr>
                        </table>
                        
                        <div style="background-color: #e8f5e8; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <h5>📝 Description</h5>
                            <p>${ef.description || 'EPA Table 2 mobile combustion emission factor'}</p>
                        </div>
                          <div style="background-color: #f0f8ff; padding: 12px; border-radius: 6px;">
                            <h5>🧮 CO₂e Calculation Formula</h5>
                            <p><strong>CO₂e = CO₂</strong></p>
                            <p><em>Only CO₂ emissions are included in this calculation</em></p>
                        </div>
                        
                        <p style="margin-top: 15px;"><small><strong>📚 Data Source:</strong> EPA GHG Emission Factors Hub, Table 2: Mobile Combustion CO₂ Emission Factors (2025 version)</small></p>
                    `;
                } else {
                    content = `
                        <h3>📊 Mobile Combustion Emission Factors</h3>
                        <p><strong>Fuel:</strong> ${fuelType}</p>
                        <p><strong>Method:</strong> Volume-based (EPA Table 2)</p>
                        <div style="background-color: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">
                            <p>⚠️ <strong>No data available for this fuel type.</strong></p>
                            <p>This fuel may not be included in EPA Table 2 or the data hasn't been loaded yet.</p>
                        </div>
                    `;
                }
            } else {
                content = `
                    <h3>📊 Mobile Combustion Emission Factors</h3>
                    <p><strong>Fuel:</strong> ${fuelType}</p>
                    <p><strong>Method:</strong> ${method}</p>
                    <div style="background-color: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">
                        <p>⚠️ <strong>Method not implemented</strong></p>
                        <p>This calculation method requires additional emission factor data that is not yet implemented in this calculator.</p>
                        <p><em>Currently supported: Volume-based calculations using EPA Table 2 factors.</em></p>
                    </div>
                `;
            }
              // Show modal using existing function
            showModal(content);}

        // Stationary Combustion Tooltip Functions
        function updateStationaryTooltip(calculationId) {
            const fuelType = document.getElementById(`fuelType${calculationId}`).value;
            const method = document.getElementById(`calculationMethod${calculationId}`).value;
            const tooltip = document.getElementById(`stationaryEFTooltip${calculationId}`);
            
            if (!fuelType) {
                tooltip.title = "Select a fuel type to see emission factors";
                return;
            }
            
            const fuelInfo = fuelData[fuelType];
            if (!fuelInfo) {
                tooltip.title = "Fuel data not available";
                return;
            }
            
            if (method === 'energy') {
                const ef = fuelInfo.energyBased;
                tooltip.title = `${fuelType} (Energy-based):\nCO₂: ${ef.co2} kg/mmBtu\nCH₄: ${ef.ch4} g/mmBtu\nN₂O: ${ef.n2o} g/mmBtu\n(Click for detailed view)`;
            } else if (method === 'mass' && fuelInfo.massBased) {
                const ef = fuelInfo.massBased;
                tooltip.title = `${fuelType} (Mass-based):\nCO₂: ${ef.co2} kg/${ef.unit}\nCH₄: ${ef.ch4} g/${ef.unit}\nN₂O: ${ef.n2o} g/${ef.unit}\n(Click for detailed view)`;
            } else if (method === 'mass' && !fuelInfo.massBased) {
                tooltip.title = `${fuelType}:\nMass-based calculation not available\nOnly energy-based calculation supported\n(Click for detailed view)`;
            }
        }

        function updateStationaryMethodAndTooltip(calculationId) {
            // Call existing functions
            updateStationaryQuantityLabel(calculationId);
            populateStationaryUnitOptions(calculationId);
            checkStationaryMassBasedAvailability(calculationId);
            
            // Update tooltip
            updateStationaryTooltip(calculationId);
        }

        function updateStationaryTooltipAndAvailability(calculationId) {
            // Call existing function
            checkStationaryMassBasedAvailability(calculationId);
            
            // Update tooltip
            updateStationaryTooltip(calculationId);
        }        // EPA Table 1 Parameters Database for Dynamic Modal Content
        // All values updated to match EPA Table 1 standard units
        const epaFuelParameters = {
            // Coal and Coke Types
            "Anthracite": {
                carbonContent: 27600, // kg C/TJ (EPA Table 1 standard)
                molecularWeightRatio: 3.6667, // kg CO₂/kg C (44/12)
                ncv: 0.0261, // TJ/Gg (converted from 26.1 MJ/kg)
                density: 1.5, // kg/L (approximate bulk density)
                oxidationFactor: 0.98,
                fuelType: 'coal',
                description: 'High-grade anthracite coal with high carbon content'
            },
            "Bituminous": {
                carbonContent: 25800, // kg C/TJ (EPA Table 1 standard)
                molecularWeightRatio: 3.6667,
                ncv: 0.0249, // TJ/Gg (converted from 24.9 MJ/kg)
                density: 1.3, // kg/L
                oxidationFactor: 0.98,
                fuelType: 'coal',
                description: 'Medium-grade bituminous coal'
            },
            "Sub-bituminous": {
                carbonContent: 26200, // kg C/TJ (EPA Table 1 standard)
                molecularWeightRatio: 3.6667,
                ncv: 0.0189, // TJ/Gg (converted from 18.9 MJ/kg)
                density: 1.1, // kg/L
                oxidationFactor: 0.97,
                fuelType: 'coal',                description: 'Lower-grade sub-bituminous coal'
            },
            "Lignite": {
                carbonContent: 27600, // kg C/TJ (EPA Table 1 standard)
                molecularWeightRatio: 3.6667,
                ncv: 0.0142, // TJ/Gg (converted from 14.2 MJ/kg)
                density: 0.8, // kg/L
                oxidationFactor: 0.97,
                fuelType: 'coal',
                description: 'Low-grade lignite coal with high moisture'
            },
            
            // Petroleum Products
            "Distillate Fuel Oil No. 2": {
                carbonContent: 20200, // kg C/TJ (EPA Table 1 standard)
                molecularWeightRatio: 3.6667,
                ncv: 0.043, // TJ/Gg (converted from 43.0 MJ/kg)
                density: 0.853, // kg/L (typical diesel density)
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Standard diesel fuel for vehicles and heating'
            },
            "Motor Gasoline": {
                carbonContent: 18900, // kg C/TJ (EPA Table 1 standard)
                molecularWeightRatio: 3.6667,
                ncv: 0.0443, // TJ/Gg (converted from 44.3 MJ/kg)
                density: 0.745, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Standard motor gasoline for passenger vehicles'
            },
            "Kerosene": {
                carbonContent: 19600, // kg C/TJ (EPA Table 1 standard)
                molecularWeightRatio: 3.6667,
                ncv: 0.0438, // TJ/Gg (converted from 43.8 MJ/kg)
                density: 0.810, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Kerosene fuel for heating and jet engines'
            },
            "Jet Fuel": {
                carbonContent: 19.5, // kg C/GJ
                molecularWeightRatio: 3.6667,
                ncv: 43.2, // MJ/kg
                density: 0.800, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Aviation jet fuel (Jet A/Jet A-1)'
            },
            "Kerosene-Type Jet Fuel": {
                carbonContent: 19.5, // kg C/GJ
                molecularWeightRatio: 3.6667,
                ncv: 43.2, // MJ/kg
                density: 0.800, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Aviation jet fuel (Jet A/Jet A-1)'
            },
            "Aviation Gasoline": {
                carbonContent: 18.9, // kg C/GJ
                molecularWeightRatio: 3.6667,
                ncv: 44.3, // MJ/kg
                density: 0.720, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Aviation gasoline for piston aircraft'
            },
            "Propane": {
                carbonContent: 16.8, // kg C/GJ
                molecularWeightRatio: 3.6667,
                ncv: 46.3, // MJ/kg
                density: 0.493, // kg/L (liquid)
                oxidationFactor: 0.995,
                fuelType: 'liquid',
                description: 'Liquefied propane gas'
            },
            "Butane": {
                carbonContent: 17.2, // kg C/GJ
                molecularWeightRatio: 3.6667,
                ncv: 45.7, // MJ/kg
                density: 0.573, // kg/L (liquid)
                oxidationFactor: 0.995,
                fuelType: 'liquid',
                description: 'Liquefied butane gas'
            },
            "Residual Fuel Oil No. 6": {
                carbonContent: 21.1, // kg C/GJ
                molecularWeightRatio: 3.6667,
                ncv: 40.4, // MJ/kg
                density: 0.960, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Heavy residual fuel oil for ships and power plants'            },
            
            // Natural Gas and Gaseous Fuels
            "Natural Gas": {
                carbonContent: 15300, // kg C/TJ (EPA Table 1 standard)
                molecularWeightRatio: 3.6667,
                ncv: 0.048, // TJ/Gg (converted from 48.0 MJ/kg)
                density: 0.000717, // kg/L at STP (very low for gas)
                oxidationFactor: 0.995,
                fuelType: 'gas',
                description: 'Pipeline natural gas (primarily methane)'
            },
            "Propane Gas": {
                carbonContent: 16800, // kg C/TJ (EPA Table 1 standard)
                molecularWeightRatio: 3.6667,
                ncv: 0.0463, // TJ/Gg (converted from 46.3 MJ/kg)
                carbonContent: 16.8, // kg C/GJ
                molecularWeightRatio: 3.6667,
                ncv: 46.3, // MJ/kg
                density: 0.00182, // kg/L at STP
                oxidationFactor: 0.995,
                fuelType: 'gas',
                description: 'Gaseous propane'
            },
            
            // Biofuels
            "Biodiesel (100%)": {
                carbonContent: 19.3, // kg C/GJ (slightly lower than diesel)
                molecularWeightRatio: 3.6667,
                ncv: 37.2, // MJ/kg (lower than diesel)
                density: 0.880, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: '100% biodiesel (B100) from renewable sources'
            },
            "Ethanol (100%)": {
                carbonContent: 17.4, // kg C/GJ
                molecularWeightRatio: 3.6667,
                ncv: 26.8, // MJ/kg (much lower than gasoline)
                density: 0.789, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: '100% ethanol fuel (E100)'
            },
              // Wood and Biomass Fuels
            "Wood/Wood Residuals": {
                carbonContent: 30.2, // kg C/GJ (higher due to moisture)
                molecularWeightRatio: 3.6667,
                ncv: 15.0, // MJ/kg (lower due to moisture content)
                density: 0.650, // kg/L (varies by wood type)
                oxidationFactor: 0.98,
                fuelType: 'biomass',
                description: 'Solid wood and wood waste biomass fuel'
            },
            "Municipal Solid Waste": {
                carbonContent: 28.0, // kg C/GJ (mixed composition)
                molecularWeightRatio: 3.6667,
                ncv: 10.5, // MJ/kg (low due to mixed materials)
                density: 0.300, // kg/L (bulk density, highly variable)
                oxidationFactor: 0.95,
                fuelType: 'waste',
                description: 'Mixed municipal solid waste for energy recovery'
            },
            
            // Additional Natural Gas Types
            "Natural Gas (Pipeline)": {
                carbonContent: 15.3, // kg C/GJ (EPA Table 1)
                molecularWeightRatio: 3.6667,
                ncv: 48.0, // MJ/kg
                density: 0.000717, // kg/L at STP
                oxidationFactor: 0.995,
                fuelType: 'gas',
                description: 'Pipeline natural gas (primarily methane)'
            },
            "Compressed Natural Gas (CNG)": {
                carbonContent: 15.3, // kg C/GJ (same as pipeline)
                molecularWeightRatio: 3.6667,
                ncv: 48.0, // MJ/kg
                density: 0.15, // kg/L (compressed)
                oxidationFactor: 0.995,
                fuelType: 'gas',
                description: 'Compressed natural gas for vehicles'
            },
            "Liquefied Natural Gas (LNG)": {
                carbonContent: 15.3, // kg C/GJ (same as natural gas)
                molecularWeightRatio: 3.6667,
                ncv: 48.0, // MJ/kg
                density: 0.42, // kg/L (liquefied)
                oxidationFactor: 0.995,
                fuelType: 'gas',
                description: 'Liquefied natural gas for transport and storage'
            },
            
            // Additional Petroleum Products
            "Heating Oil": {
                carbonContent: 20.2, // kg C/GJ (similar to diesel)
                molecularWeightRatio: 3.6667,
                ncv: 43.0, // MJ/kg
                density: 0.850, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Distillate heating oil for residential/commercial use'
            },
            "Heavy Fuel Oil": {
                carbonContent: 21.1, // kg C/GJ (EPA Table 1)
                molecularWeightRatio: 3.6667,
                ncv: 40.4, // MJ/kg
                density: 0.960, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Heavy residual fuel oil for ships and power plants'
            },
            "Crude Oil": {
                carbonContent: 20.0, // kg C/GJ (average)
                molecularWeightRatio: 3.6667,
                ncv: 42.7, // MJ/kg
                density: 0.870, // kg/L (varies by source)
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Crude petroleum oil (unrefined)'
            },
            
            // Alternative Fuels
            "Methanol": {
                carbonContent: 18.8, // kg C/GJ
                molecularWeightRatio: 3.6667,
                ncv: 19.7, // MJ/kg (much lower than gasoline)
                density: 0.791, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Methanol fuel (wood alcohol)'
            },
            "Hydrogen": {
                carbonContent: 0.0, // kg C/GJ (no carbon emissions)
                molecularWeightRatio: 3.6667,
                ncv: 120.0, // MJ/kg (very high energy density)
                density: 0.000089, // kg/L at STP (very low)
                oxidationFactor: 1.0,
                fuelType: 'gas',
                description: 'Pure hydrogen fuel (zero carbon emissions)'
            },
            
            // Additional Coal Types
            "Coal (generic)": {
                carbonContent: 26.8, // kg C/GJ (average)
                molecularWeightRatio: 3.6667,
                ncv: 22.0, // MJ/kg (average)
                density: 1.2, // kg/L (bulk density)
                oxidationFactor: 0.98,
                fuelType: 'coal',
                description: 'Generic coal (mixed grade)'
            },
            "Petroleum Coke": {
                carbonContent: 27.9, // kg C/GJ (very high carbon)
                molecularWeightRatio: 3.6667,
                ncv: 32.5, // MJ/kg
                density: 1.4, // kg/L
                oxidationFactor: 0.98,
                fuelType: 'coal',
                description: 'Petroleum coke (high carbon solid fuel)'
            },
            
            // Default parameters for fuels not in specific database
            "default": {
                carbonContent: 20.0, // kg C/GJ (generic estimate)
                molecularWeightRatio: 3.6667,
                ncv: 40.0, // MJ/kg
                density: 0.800, // kg/L
                oxidationFactor: 0.99,
                fuelType: 'liquid',
                description: 'Estimated parameters for unlisted fuel type'
            }
        };        function showStationaryEmissionFactors(calculationId) {
            const fuelType = document.getElementById(`fuelType${calculationId}`).value;
            const method = document.getElementById(`calculationMethod${calculationId}`).value;
            
            if (!fuelType) {
                alert('Please select a fuel type first.');
                return;
            }
            
            const fuelInfo = fuelData[fuelType];
            if (!fuelInfo) {
                alert('Fuel data not available for the selected fuel type.');
                return;
            }
            
            // Get fuel-specific EPA parameters or use default
            const epaParams = epaFuelParameters[fuelType] || epaFuelParameters["default"];
              // Calculate fuel-specific emission factor using EPA Table 1 methodology
            // EPA Formula: EF = (Carbon Content × Oxidation Factor × MW Ratio × NCV × Density) ÷ 1,000,000
            // Where: Carbon Content in kg C/TJ, NCV in TJ/Gg, Density in kg/L, Result in kg CO₂/L
            const calculatedMassEF = (epaParams.carbonContent * epaParams.oxidationFactor * epaParams.molecularWeightRatio * epaParams.ncv * epaParams.density) / 1000000; // Convert TJ to MJ and Gg to kg
            const calculatedVolumeEF = calculatedMassEF;
              // Calculate derived emission factors
            const totalCO2e_energy = fuelInfo.energyBased ? 
                (fuelInfo.energyBased.co2 + (fuelInfo.energyBased.ch4 * 28 / 1000) + (fuelInfo.energyBased.n2o * 265 / 1000)).toFixed(4) : 'N/A';
            
            const totalCO2e_mass = fuelInfo.massBased ? 
                (fuelInfo.massBased.co2 + (fuelInfo.massBased.ch4 * 28 / 1000) + (fuelInfo.massBased.n2o * 265 / 1000)).toFixed(4) : calculatedVolumeEF.toFixed(4);            let content = `
                <h3>📊 ${fuelType} - Emission Factors & Calculation Details</h3>
                
                <table style="border-collapse: collapse; width: 100%; margin-bottom: 20px; font-size: 12px;">
                    <thead>
                        <tr style="background-color: #007bff; color: white;">
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left; width: 30%;">Parameter</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: center; width: 25%;">Value & Unit</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left; width: 45%;">Explanation</th>
                        </tr>
                    </thead>
                    <tbody>                        <!-- Basic Information -->
                        <tr style="background-color: #f8f9fa;">
                            <td style="border: 1px solid #ddd; padding: 6px; font-weight: bold;">Current Method</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${method === 'energy' ? 'Energy-based' : 'Mass/Volume-based'}</td>
                            <td style="border: 1px solid #ddd; padding: 6px;">${method === 'energy' ? 'Using energy content (mmBtu)' : 'Using mass/volume units'}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px; font-weight: bold;">Fuel Category</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${epaParams.fuelType.toUpperCase()}</td>
                            <td style="border: 1px solid #ddd; padding: 6px;">${epaParams.description}</td>
                        </tr>
                        
                        <!-- EPA Physical Properties -->
                        <tr style="background-color: #e8f4fc; font-weight: bold;">
                            <td colspan="3" style="border: 1px solid #ddd; padding: 8px; text-align: center;">EPA Table 1 Physical Properties</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px;">Carbon Content</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${epaParams.carbonContent} <span style="color: #666; font-size: 10px;">kg C/TJ</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Carbon content per unit energy</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                            <td style="border: 1px solid #ddd; padding: 6px;">Molecular Weight Ratio</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${epaParams.molecularWeightRatio} <span style="color: #666; font-size: 10px;">kg CO₂/kg C</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Conversion from carbon to CO₂ (44/12)</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px;">Oxidation Factor</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${epaParams.oxidationFactor} <span style="color: #666; font-size: 10px;">fraction</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Fraction of carbon oxidized during combustion</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                            <td style="border: 1px solid #ddd; padding: 6px;">Net Calorific Value</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${epaParams.ncv} <span style="color: #666; font-size: 10px;">MJ/kg</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Lower heating value</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px;">Density</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${epaParams.density} <span style="color: #666; font-size: 10px;">kg/L</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Physical density of fuel</td>
                        </tr>
                        
                        <!-- Calculated Emission Factor -->
                        <tr style="background-color: #d1ecf1; font-weight: bold;">
                            <td colspan="3" style="border: 1px solid #ddd; padding: 8px; text-align: center;">Calculated Volume-Based EF (EPA Table 1 Method)</td>
                        </tr>
                        <tr style="background-color: #d4edda;">
                            <td style="border: 1px solid #ddd; padding: 6px; font-weight: bold;">Derived Volume EF</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center; font-weight: bold; font-size: 14px;">${calculatedVolumeEF.toFixed(4)} <span style="color: #666; font-size: 12px; font-weight: normal;">kg CO₂/L</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">EPA formula: (CC × MW × OF × NCV × Density) ÷ 1,000,000</td>
                        </tr>`;// Energy-based emission factors
            if (fuelInfo.energyBased) {
                content += `                        <!-- Energy-Based Emission Factors -->
                        <tr style="background-color: #e8f5e8; font-weight: bold;">
                            <td colspan="3" style="border: 1px solid #ddd; padding: 8px; text-align: center;">Energy-Based Emission Factors (EPA Table 2)</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px;">CO₂</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${fuelInfo.energyBased.co2} <span style="color: #666; font-size: 10px;">kg/mmBtu</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Direct carbon dioxide emissions</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                            <td style="border: 1px solid #ddd; padding: 6px;">CH₄</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${fuelInfo.energyBased.ch4} <span style="color: #666; font-size: 10px;">g/mmBtu</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Methane emissions (GWP: 28)</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px;">N₂O</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${fuelInfo.energyBased.n2o} <span style="color: #666; font-size: 10px;">g/mmBtu</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Nitrous oxide emissions (GWP: 265)</td>
                        </tr>
                        <tr style="background-color: #fff3cd;">
                            <td style="border: 1px solid #ddd; padding: 6px; font-weight: bold;">Total CO₂e (Energy)</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center; font-weight: bold;">${totalCO2e_energy} <span style="color: #666; font-size: 10px; font-weight: normal;">kg CO₂e/mmBtu</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Combined GHG impact using IPCC AR5 GWP values</td>
                        </tr>`;
            }            // Mass/Volume-based emission factors
            if (fuelInfo.massBased) {
                content += `                        <!-- Mass/Volume-Based Emission Factors -->
                        <tr style="background-color: #f0f8ff; font-weight: bold;">
                            <td colspan="3" style="border: 1px solid #ddd; padding: 8px; text-align: center;">Mass/Volume-Based Emission Factors (EPA Table 2)</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px;">CO₂</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${fuelInfo.massBased.co2} <span style="color: #666; font-size: 10px;">kg/${fuelInfo.massBased.unit}</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Direct carbon dioxide emissions</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                            <td style="border: 1px solid #ddd; padding: 6px;">CH₄</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${fuelInfo.massBased.ch4} <span style="color: #666; font-size: 10px;">g/${fuelInfo.massBased.unit}</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Methane emissions (GWP: 28)</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px;">N₂O</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">${fuelInfo.massBased.n2o} <span style="color: #666; font-size: 10px;">g/${fuelInfo.massBased.unit}</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Nitrous oxide emissions (GWP: 265)</td>
                        </tr>
                        <tr style="background-color: #fff3cd;">
                            <td style="border: 1px solid #ddd; padding: 6px; font-weight: bold;">Total CO₂e (Mass/Volume)</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center; font-weight: bold;">${totalCO2e_mass} <span style="color: #666; font-size: 10px; font-weight: normal;">kg CO₂e/${fuelInfo.massBased.unit}</span></td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Combined GHG impact using IPCC AR5 GWP values</td>
                        </tr>`;
            } else {
                content += `                        <!-- Mass/Volume-Based Not Available -->
                        <tr style="background-color: #fff3cd; font-weight: bold;">
                            <td colspan="3" style="border: 1px solid #ddd; padding: 8px; text-align: center;">Mass/Volume-Based Calculation</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 6px;">Status</td>
                            <td style="border: 1px solid #ddd; padding: 6px; text-align: center;">Not Available</td>
                            <td style="border: 1px solid #ddd; padding: 6px;">Only energy-based method supported for this fuel</td>
                        </tr>`;}            content += `
                    </tbody>
                </table>
                
                <!-- Reference & Methodology Information -->
                <div style="margin-top: 15px; padding: 10px; background-color: #f8f9fa; border-radius: 4px; font-size: 12px; color: #666;">
                    <div style="font-weight: bold; color: #333; margin-bottom: 8px;">Reference & Methodology</div>
                    <div style="margin-bottom: 4px;"><strong>Source:</strong> EPA GHG Emission Factors Hub (2025 Version) - Official EPA greenhouse gas emission factors</div>
                    <div style="margin-bottom: 4px;"><strong>GWP Standard:</strong> IPCC AR5 (100-year) - CO₂=1, CH₄=28, N₂O=265</div>
                    <div><strong>Coverage:</strong> Direct Combustion (Scope 1) - Direct emissions only, excludes upstream/lifecycle</div>
                </div>
            `;
            
            // Use the existing showModal function for consistency
            showModal(content);
        }

        // On-Road Vehicles Calculator Data and Functions
        let onRoadCalculationCount = 0;
        let onRoadResults = [];        const onRoadData = {
            // EPA Table 3: Mobile Combustion On-Road Gasoline Vehicles (g CH4/mile and g N2O/mile)
            "Gasoline Passenger Cars": {
                "1973": { ch4: 8.84, n2o: 0.26 },
                "1974": { ch4: 8.50, n2o: 0.25 },
                "1975": { ch4: 5.64, n2o: 0.24 },
                "1976": { ch4: 4.26, n2o: 0.24 },
                "1977": { ch4: 3.50, n2o: 0.23 },
                "1978": { ch4: 3.09, n2o: 0.23 },
                "1979": { ch4: 2.86, n2o: 0.22 },
                "1980": { ch4: 2.54, n2o: 0.22 },
                "1981": { ch4: 2.31, n2o: 0.21 },
                "1982": { ch4: 2.03, n2o: 0.21 },
                "1983": { ch4: 1.89, n2o: 0.20 },
                "1984": { ch4: 1.71, n2o: 0.20 },
                "1985": { ch4: 1.58, n2o: 0.19 },
                "1986": { ch4: 1.42, n2o: 0.19 },
                "1987": { ch4: 1.31, n2o: 0.18 },
                "1988": { ch4: 1.18, n2o: 0.18 },
                "1989": { ch4: 1.09, n2o: 0.17 },
                "1990": { ch4: 0.98, n2o: 0.17 },
                "1991": { ch4: 0.91, n2o: 0.16 },
                "1992": { ch4: 0.83, n2o: 0.16 },
                "1993": { ch4: 0.77, n2o: 0.15 },
                "1994": { ch4: 0.70, n2o: 0.15 },
                "1995": { ch4: 0.65, n2o: 0.14 },
                "1996": { ch4: 0.59, n2o: 0.14 },
                "1997": { ch4: 0.54, n2o: 0.13 },
                "1998": { ch4: 0.50, n2o: 0.13 },
                "1999": { ch4: 0.46, n2o: 0.12 },
                "2000": { ch4: 0.42, n2o: 0.12 },
                "2001": { ch4: 0.39, n2o: 0.11 },
                "2002": { ch4: 0.36, n2o: 0.11 },
                "2003": { ch4: 0.33, n2o: 0.10 },
                "2004": { ch4: 0.31, n2o: 0.10 },
                "2005": { ch4: 0.28, n2o: 0.09 },
                "2006": { ch4: 0.26, n2o: 0.09 },
                "2007": { ch4: 0.24, n2o: 0.08 },
                "2008": { ch4: 0.22, n2o: 0.08 },
                "2009": { ch4: 0.20, n2o: 0.07 },
                "2010": { ch4: 0.18, n2o: 0.07 },
                "2011": { ch4: 0.17, n2o: 0.06 },
                "2012": { ch4: 0.15, n2o: 0.06 },
                "2013": { ch4: 0.14, n2o: 0.05 },
                "2014": { ch4: 0.12, n2o: 0.05 },
                "2015": { ch4: 0.11, n2o: 0.04 },
                "2016": { ch4: 0.10, n2o: 0.04 },
                "2017": { ch4: 0.09, n2o: 0.03 },
                "2018": { ch4: 0.08, n2o: 0.03 },
                "2019": { ch4: 0.07, n2o: 0.02 },
                "2020": { ch4: 0.06, n2o: 0.02 },
                "2021": { ch4: 0.05, n2o: 0.01 },
                "2022": { ch4: 0.04, n2o: 0.01 }
            },
            "Gasoline Light-Duty Trucks": {
                "1973": { ch4: 9.58, n2o: 0.28 },
                "1974": { ch4: 9.21, n2o: 0.27 },
                "1975": { ch4: 6.11, n2o: 0.26 },
                "1976": { ch4: 4.62, n2o: 0.26 },
                "1977": { ch4: 3.79, n2o: 0.25 },
                "1978": { ch4: 3.35, n2o: 0.25 },
                "1979": { ch4: 3.10, n2o: 0.24 },
                "1980": { ch4: 2.75, n2o: 0.24 },
                "1981": { ch4: 2.50, n2o: 0.23 },
                "1982": { ch4: 2.20, n2o: 0.23 },
                "1983": { ch4: 2.05, n2o: 0.22 },
                "1984": { ch4: 1.85, n2o: 0.22 },
                "1985": { ch4: 1.71, n2o: 0.21 },
                "1986": { ch4: 1.54, n2o: 0.21 },
                "1987": { ch4: 1.42, n2o: 0.20 },
                "1988": { ch4: 1.28, n2o: 0.20 },
                "1989": { ch4: 1.18, n2o: 0.19 },
                "1990": { ch4: 1.06, n2o: 0.19 },
                "1991": { ch4: 0.99, n2o: 0.18 },
                "1992": { ch4: 0.90, n2o: 0.18 },
                "1993": { ch4: 0.83, n2o: 0.17 },
                "1994": { ch4: 0.76, n2o: 0.17 },
                "1995": { ch4: 0.70, n2o: 0.16 },
                "1996": { ch4: 0.64, n2o: 0.16 },
                "1997": { ch4: 0.59, n2o: 0.15 },
                "1998": { ch4: 0.54, n2o: 0.15 },
                "1999": { ch4: 0.50, n2o: 0.14 },
                "2000": { ch4: 0.45, n2o: 0.14 },
                "2001": { ch4: 0.42, n2o: 0.13 },
                "2002": { ch4: 0.39, n2o: 0.13 },
                "2003": { ch4: 0.36, n2o: 0.12 },
                "2004": { ch4: 0.33, n2o: 0.12 },
                "2005": { ch4: 0.31, n2o: 0.11 },
                "2006": { ch4: 0.28, n2o: 0.11 },
                "2007": { ch4: 0.26, n2o: 0.10 },
                "2008": { ch4: 0.24, n2o: 0.10 },
                "2009": { ch4: 0.22, n2o: 0.09 },
                "2010": { ch4: 0.20, n2o: 0.09 },
                "2011": { ch4: 0.18, n2o: 0.08 },
                "2012": { ch4: 0.17, n2o: 0.08 },
                "2013": { ch4: 0.15, n2o: 0.07 },
                "2014": { ch4: 0.14, n2o: 0.07 },
                "2015": { ch4: 0.12, n2o: 0.06 },
                "2016": { ch4: 0.11, n2o: 0.06 },
                "2017": { ch4: 0.10, n2o: 0.05 },
                "2018": { ch4: 0.09, n2o: 0.05 },
                "2019": { ch4: 0.08, n2o: 0.04 },
                "2020": { ch4: 0.07, n2o: 0.04 },
                "2021": { ch4: 0.06, n2o: 0.03 },
                "2022": { ch4: 0.05, n2o: 0.03 }
            },
            "Gasoline Heavy-Duty Vehicles": {
                "1973": { ch4: 12.45, n2o: 0.45 },
                "1974": { ch4: 11.98, n2o: 0.44 },
                "1975": { ch4: 7.95, n2o: 0.43 },
                "1976": { ch4: 6.01, n2o: 0.42 },
                "1977": { ch4: 4.93, n2o: 0.41 },
                "1978": { ch4: 4.36, n2o: 0.40 },
                "1979": { ch4: 4.03, n2o: 0.39 },
                "1980": { ch4: 3.58, n2o: 0.38 },
                "1981": { ch4: 3.25, n2o: 0.37 },
                "1982": { ch4: 2.86, n2o: 0.36 },
                "1983": { ch4: 2.66, n2o: 0.35 },
                "1984": { ch4: 2.41, n2o: 0.34 },
                "1985": { ch4: 2.22, n2o: 0.33 },
                "1986": { ch4: 2.00, n2o: 0.32 },
                "1987": { ch4: 1.85, n2o: 0.31 },
                "1988": { ch4: 1.66, n2o: 0.30 },
                "1989": { ch4: 1.54, n2o: 0.29 },
                "1990": { ch4: 1.38, n2o: 0.28 },
                "1991": { ch4: 1.28, n2o: 0.27 },
                "1992": { ch4: 1.17, n2o: 0.26 },
                "1993": { ch4: 1.08, n2o: 0.25 },
                "1994": { ch4: 0.99, n2o: 0.24 },
                "1995": { ch4: 0.91, n2o: 0.23 },
                "1996": { ch4: 0.83, n2o: 0.22 },
                "1997": { ch4: 0.77, n2o: 0.21 },
                "1998": { ch4: 0.70, n2o: 0.20 },
                "1999": { ch4: 0.65, n2o: 0.19 },
                "2000": { ch4: 0.59, n2o: 0.18 },
                "2001": { ch4: 0.55, n2o: 0.17 },
                "2002": { ch4: 0.50, n2o: 0.16 },
                "2003": { ch4: 0.47, n2o: 0.15 },
                "2004": { ch4: 0.43, n2o: 0.14 },
                "2005": { ch4: 0.40, n2o: 0.13 },
                "2006": { ch4: 0.37, n2o: 0.12 },
                "2007": { ch4: 0.34, n2o: 0.11 },
                "2008": { ch4: 0.31, n2o: 0.10 },
                "2009": { ch4: 0.29, n2o: 0.09 },
                "2010": { ch4: 0.26, n2o: 0.08 },
                "2011": { ch4: 0.24, n2o: 0.07 },
                "2012": { ch4: 0.22, n2o: 0.06 },
                "2013": { ch4: 0.20, n2o: 0.05 },
                "2014": { ch4: 0.18, n2o: 0.04 },
                "2015": { ch4: 0.16, n2o: 0.03 },
                "2016": { ch4: 0.15, n2o: 0.02 },
                "2017": { ch4: 0.13, n2o: 0.01 },
                "2018": { ch4: 0.12, n2o: 0.01 },
                "2019": { ch4: 0.11, n2o: 0.01 },
                "2020": { ch4: 0.10, n2o: 0.01 },
                "2021": { ch4: 0.09, n2o: 0.01 },
                "2022": { ch4: 0.08, n2o: 0.01 }
            },
            "Gasoline Motorcycles": {
                "1973": { ch4: 15.62, n2o: 0.12 },
                "1974": { ch4: 15.02, n2o: 0.12 },
                "1975": { ch4: 9.96, n2o: 0.12 },
                "1976": { ch4: 7.53, n2o: 0.12 },
                "1977": { ch4: 6.18, n2o: 0.12 },
                "1978": { ch4: 5.47, n2o: 0.12 },
                "1979": { ch4: 5.06, n2o: 0.12 },
                "1980": { ch4: 4.49, n2o: 0.12 },
                "1981": { ch4: 4.08, n2o: 0.11 },
                "1982": { ch4: 3.59, n2o: 0.11 },
                "1983": { ch4: 3.34, n2o: 0.11 },
                "1984": { ch4: 3.02, n2o: 0.11 },
                "1985": { ch4: 2.79, n2o: 0.11 },
                "1986": { ch4: 2.51, n2o: 0.11 },
                "1987": { ch4: 2.32, n2o: 0.11 },
                "1988": { ch4: 2.08, n2o: 0.11 },
                "1989": { ch4: 1.93, n2o: 0.11 },
                "1990": { ch4: 1.73, n2o: 0.11 },
                "1991": { ch4: 1.61, n2o: 0.11 },
                "1992": { ch4: 1.47, n2o: 0.11 },
                "1993": { ch4: 1.36, n2o: 0.11 },
                "1994": { ch4: 1.24, n2o: 0.11 },
                "1995": { ch4: 1.14, n2o: 0.11 },
                "1996": { ch4: 1.04, n2o: 0.11 },
                "1997": { ch4: 0.96, n2o: 0.11 },
                "1998": { ch4: 0.88, n2o: 0.11 },
                "1999": { ch4: 0.81, n2o: 0.11 },
                "2000": { ch4: 0.74, n2o: 0.11 },
                "2001": { ch4: 0.69, n2o: 0.11 },
                "2002": { ch4: 0.63, n2o: 0.11 },
                "2003": { ch4: 0.59, n2o: 0.11 },
                "2004": { ch4: 0.54, n2o: 0.11 },
                "2005": { ch4: 0.50, n2o: 0.11 },
                "2006": { ch4: 0.46, n2o: 0.11 },
                "2007": { ch4: 0.43, n2o: 0.11 },
                "2008": { ch4: 0.39, n2o: 0.11 },
                "2009": { ch4: 0.36, n2o: 0.11 },
                "2010": { ch4: 0.33, n2o: 0.11 },
                "2011": { ch4: 0.30, n2o: 0.11 },
                "2012": { ch4: 0.28, n2o: 0.11 },
                "2013": { ch4: 0.25, n2o: 0.11 },
                "2014": { ch4: 0.23, n2o: 0.11 },
                "2015": { ch4: 0.21, n2o: 0.11 },
                "2016": { ch4: 0.19, n2o: 0.11 },
                "2017": { ch4: 0.17, n2o: 0.11 },
                "2018": { ch4: 0.16, n2o: 0.11 },
                "2019": { ch4: 0.14, n2o: 0.11 },
                "2020": { ch4: 0.13, n2o: 0.11 },
                "2021": { ch4: 0.12, n2o: 0.11 },
                "2022": { ch4: 0.11, n2o: 0.11 }            }
        };        // EPA Table 4: Mobile Combustion CH4 and N2O for On-Road Diesel and Alternative Fuel Vehicles
        const onRoadDieselAltFuelData = {
            "Passenger Cars (Diesel)": {
                "1960-1982": { ch4: 0.0006, n2o: 0.0012 },
                "1983-2006": { ch4: 0.0005, n2o: 0.0010 },
                "2007-2022": { ch4: 0.0302, n2o: 0.0192 }
            },
            "Light-Duty Trucks (Diesel)": {
                "1960-1982": { ch4: 0.0011, n2o: 0.0017 },
                "1983-2006": { ch4: 0.0009, n2o: 0.0014 },
                "2007-2022": { ch4: 0.0290, n2o: 0.0214 }
            },
            "Heavy-Duty Vehicles (Diesel)": {
                "1960-2006": { ch4: 0.0051, n2o: 0.0048 },
                "2007-2022": { ch4: 0.0095, n2o: 0.0431 }
            },
            "Passenger Cars (Alternative Fuel)": {
                "Methanol": { ch4: 0.0120, n2o: 0.0040 },
                "Ethanol": { ch4: 0.0120, n2o: 0.0040 },
                "CNG": { ch4: 0.1200, n2o: 0.0040 },
                "LPG": { ch4: 0.0120, n2o: 0.0040 },
                "Biodiesel": { ch4: 0.0300, n2o: 0.0010 }
            },
            "Light-Duty Trucks (Alternative Fuel)": {
                "Ethanol": { ch4: 0.0130, n2o: 0.0050 },
                "CNG": { ch4: 0.1300, n2o: 0.0050 },
                "LPG": { ch4: 0.0130, n2o: 0.0050 },
                "LNG": { ch4: 0.1300, n2o: 0.0050 },
                "Biodiesel": { ch4: 0.0540, n2o: 0.0010 }
            },
            "Heavy-Duty Vehicles (Alternative Fuel)": {
                "CNG": { ch4: 1.7860, n2o: 0.0330 },
                "LPG": { ch4: 0.1790, n2o: 0.0330 },
                "LNG": { ch4: 1.7860, n2o: 0.0330 },
                "Biodiesel": { ch4: 0.0090, n2o: 0.0050 }
            },
            "Motorcycles (Alternative Fuel)": {
                "Methanol": { ch4: 0.0720, n2o: 0.0260 },
                "Ethanol": { ch4: 0.0720, n2o: 0.0260 },
                "CNG": { ch4: 0.9210, n2o: 0.0170 },
                "LPG": { ch4: 0.0920, n2o: 0.0170 },
                "LNG": { ch4: 0.9210, n2o: 0.0170 },
                "Biodiesel": { ch4: 0.0090, n2o: 0.0020 }
            },            "Motorcycles (Diesel)": {
                "1960-2006": { ch4: 0.0072, n2o: 0.0021 },
                "2007-2022": { ch4: 0.0081, n2o: 0.0089 }
            },
            "Buses (Diesel)": {
                "1960-2006": { ch4: 0.0051, n2o: 0.0048 },
                "2007-2022": { ch4: 0.0095, n2o: 0.0431 }
            },
            "Buses (Alternative Fuel)": {
                "Methanol": { ch4: 0.1900, n2o: 0.0290 },
                "Ethanol": { ch4: 0.1900, n2o: 0.0290 },
                "CNG": { ch4: 2.7190, n2o: 0.0170 },
                "LPG": { ch4: 0.2720, n2o: 0.0170 },
                "LNG": { ch4: 2.7190, n2o: 0.0170 },
                "Biodiesel": { ch4: 0.0090, n2o: 0.0030 }
            }
        };

        const GWP = { ch4: 28, n2o: 265 };

        function addOnRoadCalculation() {
            onRoadCalculationCount++;
            const calculationsContainer = document.getElementById('onRoadCalculations');
            
            const formHtml = `
                <div class="calculation-form" id="onRoadForm${onRoadCalculationCount}">
                    <div class="calculation-form-header">
                        <h4 class="calculation-form-title">
                            <span class="calculation-counter">${onRoadCalculationCount}</span>
                            On-Road Vehicle Calculation #${onRoadCalculationCount}
                        </h4>
                        ${onRoadCalculationCount > 1 ? `<button type="button" class="remove-calculation-button" onclick="removeOnRoadCalculation(${onRoadCalculationCount})">🗑️ Remove</button>` : ''}
                    </div>
                    
                    <div class="form-container">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="vehicleType${onRoadCalculationCount}">🚗 Vehicle Type:</label>                                <select class="form-select" id="vehicleType${onRoadCalculationCount}" onchange="populateOnRoadYears(${onRoadCalculationCount}); updateOnRoadTooltip(${onRoadCalculationCount})">
                                    <option value="">-- Select Vehicle Type --</option>
                                    <option value="Gasoline Passenger Cars">Gasoline Passenger Cars</option>
                                    <option value="Gasoline Light-Duty Trucks">Gasoline Light-Duty Trucks</option>
                                    <option value="Gasoline Heavy-Duty Vehicles">Gasoline Heavy-Duty Vehicles</option>
                                    <option value="Gasoline Motorcycles">Gasoline Motorcycles</option>
                                </select>
                            </div>
                              <div class="form-group">
                                <label class="form-label" for="modelYear${onRoadCalculationCount}">
                                    📅 Model Year:
                                    <span class="info-tooltip" id="onRoadEFTooltip${onRoadCalculationCount}" title="Select vehicle type and model year to see CH₄ and N₂O emission factors" onclick="showOnRoadEmissionFactors(${onRoadCalculationCount})" style="cursor: pointer; color: #0066cc;">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <select class="form-select" id="modelYear${onRoadCalculationCount}" onchange="updateOnRoadTooltip(${onRoadCalculationCount})">
                                    <option value="">-- Select Year --</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label" for="miles${onRoadCalculationCount}">🛣️ Distance Driven (miles):</label>
                            <input type="number" class="form-input" id="miles${onRoadCalculationCount}" step="any" min="0" placeholder="Enter miles driven">
                        </div>
                        
                        <button type="button" class="calculate-button" onclick="calculateOnRoadEmissions(${onRoadCalculationCount})">🧮 Calculate Emissions</button>
                    </div>
                    
                    <div class="results-section" id="onRoadResults${onRoadCalculationCount}" style="display: none;">
                        <div id="onRoadResultContent${onRoadCalculationCount}"></div>
                    </div>
                </div>
            `;
            
            calculationsContainer.insertAdjacentHTML('beforeend', formHtml);
        }

        function removeOnRoadCalculation(calculationId) {
            const formElement = document.getElementById(`onRoadForm${calculationId}`);
            if (formElement) {
                formElement.remove();
                
                // Remove from results array
                onRoadResults = onRoadResults.filter(result => result.id !== calculationId);
                updateOnRoadSummary();
            }
        }

        function populateOnRoadYears(calculationId) {
            const vehicle = document.getElementById(`vehicleType${calculationId}`).value;
            const yearSelect = document.getElementById(`modelYear${calculationId}`);
            yearSelect.innerHTML = '<option value="">-- Select Year --</option>';

            if (vehicle && onRoadData[vehicle]) {
                for (let year in onRoadData[vehicle]) {
                    const option = document.createElement("option");
                    option.value = year;
                    option.text = year;
                    yearSelect.appendChild(option);
                }
            }
        }

        function calculateOnRoadEmissions(calculationId) {
            const vehicle = document.getElementById(`vehicleType${calculationId}`).value;
            const year = document.getElementById(`modelYear${calculationId}`).value;
            const miles = parseFloat(document.getElementById(`miles${calculationId}`).value);
            const resultDiv = document.getElementById(`onRoadResultContent${calculationId}`);
            const resultsSection = document.getElementById(`onRoadResults${calculationId}`);

            if (!vehicle || !year || isNaN(miles)) {
                resultDiv.innerHTML = "<div class='error-message'>Please complete all fields.</div>";
                resultsSection.style.display = 'block';
                return;
            }

            const factors = onRoadData[vehicle][year];
            const ch4 = miles * factors.ch4;
            const n2o = miles * factors.n2o;
            const ch4_co2e = (ch4 * GWP.ch4) / 1000;
            const n2o_co2e = (n2o * GWP.n2o) / 1000;
            const co2e = ch4_co2e + n2o_co2e;

            // Store result for summary
            const existingIndex = onRoadResults.findIndex(result => result.id === calculationId);
            const result = {
                id: calculationId,
                vehicleType: vehicle,
                year: year,
                miles: miles,
                ch4: ch4,
                n2o: n2o,
                co2e: co2e
            };

            if (existingIndex >= 0) {
                onRoadResults[existingIndex] = result;
            } else {
                onRoadResults.push(result);
            }

            resultDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3>Input Summary</h3>
                    <p><strong>Vehicle Type:</strong> ${vehicle}</p>
                    <p><strong>Model Year:</strong> ${year}</p>
                    <p><strong>Distance Driven:</strong> ${miles} miles</p>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <h3>📊 Emission Factors Applied</h3>
                    <div style="background-color: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                        <p><strong>Source:</strong> EPA GHG emission factors for mobile combustion by vehicle type and model year</p>
                    </div>
                    
                    <table style="margin-bottom: 10px; border-collapse: collapse; width: 100%;">
                        <tr style="background-color: #e8f4fc;">
                            <th style="padding: 6px; border: 1px solid #ddd;">Gas</th>
                            <th style="padding: 6px; border: 1px solid #ddd;">Emission Factor</th>
                            <th style="padding: 6px; border: 1px solid #ddd;">Unit</th>
                        </tr>
                        <tr>
                            <td style="padding: 4px; border: 1px solid #ddd;"><strong>CH₄</strong></td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${factors.ch4}</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">g per mile</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                            <td style="padding: 4px; border: 1px solid #ddd;"><strong>N₂O</strong></td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${factors.n2o}</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">g per mile</td>
                        </tr>
                    </table>
                </div>
                
                <div class="results-grid">
                    <div class="result-card">
                        <h4>🔥 CH₄ Emissions</h4>
                        <div class="result-value">${ch4.toFixed(3)} g</div>
                        <div class="result-calculation">${miles} miles × ${factors.ch4} g/mile</div>
                    </div>
                    
                    <div class="result-card">
                        <h4>💨 N₂O Emissions</h4>
                        <div class="result-value">${n2o.toFixed(3)} g</div>
                        <div class="result-calculation">${miles} miles × ${factors.n2o} g/mile</div>
                    </div>
                    
                    <div class="result-card">
                        <h4>🌍 CH₄ CO₂ Equivalent</h4>
                        <div class="result-value">${ch4_co2e.toFixed(3)} kg CO₂e</div>
                        <div class="result-calculation">${ch4.toFixed(3)} g × ${GWP.ch4} GWP ÷ 1000</div>
                    </div>
                    
                    <div class="result-card">
                        <h4>🌍 N₂O CO₂ Equivalent</h4>
                        <div class="result-value">${n2o_co2e.toFixed(3)} kg CO₂e</div>
                        <div class="result-calculation">${n2o.toFixed(3)} g × ${GWP.n2o} GWP ÷ 1000</div>
                    </div>
                </div>
                
                <div class="total-emissions">
                    <h3>🎯 Total CO₂ Equivalent Emissions</h3>
                    <div class="total-value">${co2e.toFixed(3)} kg CO₂e</div>
                    <div class="breakdown">
                        CH₄ Contribution: ${ch4_co2e.toFixed(3)} kg CO₂e (${((ch4_co2e/co2e)*100).toFixed(1)}%) + 
                        N₂O Contribution: ${n2o_co2e.toFixed(3)} kg CO₂e (${((n2o_co2e/co2e)*100).toFixed(1)}%)
                    </div>
                </div>
                
                <div class="calculation-note">
                    <p><strong>Note:</strong> Global Warming Potentials (GWP) from IPCC AR5, 100-year time horizon</p>
                </div>
            `;
            
            resultsSection.style.display = 'block';
            updateOnRoadSummary();
        }

        function updateOnRoadSummary() {
            if (onRoadResults.length <= 1) {
                document.getElementById('onRoadSummary').style.display = 'none';
                return;
            }
            
            let totalCH4 = 0;
            let totalN2O = 0;
            let totalCO2e = 0;
            
            let summaryHtml = `
                <table class="summary-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Vehicle Type</th>
                            <th>Year</th>
                            <th>Miles</th>
                            <th>CH₄ (g)</th>
                            <th>N₂O (g)</th>
                            <th>Total CO₂e (kg)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            onRoadResults.forEach(result => {
                totalCH4 += result.ch4;
                totalN2O += result.n2o;
                totalCO2e += result.co2e;
                
                summaryHtml += `
                    <tr>
                        <td>${result.id}</td>
                        <td>${result.vehicleType}</td>
                        <td>${result.year}</td>
                        <td>${result.miles}</td>
                        <td>${result.ch4.toFixed(3)}</td>
                        <td>${result.n2o.toFixed(3)}</td>
                        <td>${result.co2e.toFixed(3)}</td>
                    </tr>
                `;
            });
            
            summaryHtml += `
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="4"><strong>TOTAL</strong></td>
                            <td><strong>${totalCH4.toFixed(3)}</strong></td>
                            <td><strong>${totalN2O.toFixed(3)}</strong></td>
                            <td><strong>${totalCO2e.toFixed(3)}</strong></td>
                        </tr>
                    </tfoot>
                </table>
                
                <div class="summary-highlight">
                    <h4>🎯 Total On-Road Vehicle Emissions</h4>
                    <p><strong>${totalCO2e.toFixed(3)} kg CO₂e</strong> from ${onRoadResults.length} vehicle calculations</p>
                    <p>CH₄: ${totalCH4.toFixed(3)} g | N₂O: ${totalN2O.toFixed(3)} g</p>
                </div>
            `;
              document.getElementById('onRoadSummaryContent').innerHTML = summaryHtml;
            document.getElementById('onRoadSummary').style.display = 'block';
        }

        // On-Road Tooltip Functions
        function updateOnRoadTooltip(calculationId) {
            const vehicleType = document.getElementById(`vehicleType${calculationId}`).value;
            const modelYear = document.getElementById(`modelYear${calculationId}`).value;
            const tooltip = document.getElementById(`onRoadEFTooltip${calculationId}`);
            
            if (!vehicleType || !modelYear) {
                tooltip.title = "Select vehicle type and model year to see CH₄ and N₂O emission factors";
                return;
            }
            
            const factors = onRoadData[vehicleType]?.[modelYear];
            if (factors) {
                tooltip.title = `${vehicleType} (${modelYear}):\nCH₄: ${factors.ch4} g/mile\nN₂O: ${factors.n2o} g/mile\n(EPA Table 3 - On-Road Gasoline Vehicles)`;
            } else {
                tooltip.title = "Emission factors not available for this vehicle/year combination";
            }
        }

        function showOnRoadEmissionFactors(calculationId) {
            const vehicleType = document.getElementById(`vehicleType${calculationId}`).value;
            const modelYear = document.getElementById(`modelYear${calculationId}`).value;
            
            if (!vehicleType) {
                alert('Please select a vehicle type first.');
                return;
            }
            
            let content = '';
            
            if (!modelYear) {
                // Show all available years for the selected vehicle type
                const vehicleData = onRoadData[vehicleType];
                if (vehicleData) {
                    content = `
                        <h3>📊 EPA Table 3 - On-Road Gasoline Vehicle Emission Factors</h3>
                        <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <p><strong>🚗 Vehicle Type:</strong> ${vehicleType}</p>
                            <p><strong>📖 Source:</strong> EPA GHG Emission Factors Hub 2025, Table 3</p>
                            <p><strong>📏 Method:</strong> Distance-based (g/mile)</p>
                            <p><strong>📅 Coverage:</strong> Model years 1973-2022</p>
                        </div>
                        
                        <h4>🌍 CH₄ and N₂O Emission Factors by Model Year</h4>
                        <div style="max-height: 400px; overflow-y: auto; margin-bottom: 15px;">
                            <table style="border-collapse: collapse; width: 100%; margin-bottom: 15px;">
                                <tr style="background-color: #e3f2fd;">
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Model Year</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">CH₄ (g/mile)</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">N₂O (g/mile)</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Total CO₂e (g/mile)*</th>
                                </tr>
                    `;
                    
                    // Sort years numerically
                    const years = Object.keys(vehicleData).sort((a, b) => parseInt(b) - parseInt(a));
                    years.forEach(year => {
                        const factors = vehicleData[year];
                        const co2e_per_mile = (factors.ch4 * 28 + factors.n2o * 265);
                        const rowColor = year === '2022' ? 'background-color: #e8f5e8;' : 
                                        year === '1973' ? 'background-color: #fff3e0;' : '';
                        
                        content += `
                            <tr style="${rowColor}">
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${year}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.ch4}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.n2o}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>${co2e_per_mile.toFixed(2)}</strong></td>
                            </tr>
                        `;
                    });
                    
                    content += `
                            </table>
                        </div>
                        
                        <div style="background-color: #f0f8ff; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <h5>🧮 CO₂e Calculation Formula</h5>
                            <p><strong>CO₂e (g/mile) = (CH₄ × 28) + (N₂O × 265)</strong></p>
                            <p><em>*Using IPCC AR5 100-year Global Warming Potential values</em></p>
                        </div>
                        
                        <div style="background-color: #e8f5e8; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <h5>📝 Data Characteristics</h5>
                            <p><strong>Emission Trend:</strong> Significant improvement in recent model years due to advanced emission control technologies</p>
                            <p><strong>Technology Impact:</strong> Catalytic converters, fuel injection, and engine management systems dramatically reduced emissions</p>
                            <p><strong>Regulatory Driver:</strong> EPA Tier standards and CARB regulations drove continuous improvements</p>
                        </div>
                        
                        <p style="margin-top: 15px;"><small><strong>📚 Data Source:</strong> EPA GHG Emission Factors Hub 2025, Table 3: Mobile Combustion On-Road Gasoline Vehicles</small></p>
                    `;
                } else {
                    content = `
                        <h3>📊 On-Road Gasoline Vehicle Emission Factors</h3>
                        <p><strong>Vehicle:</strong> ${vehicleType}</p>
                        <div style="background-color: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">
                            <p>⚠️ <strong>No data available for this vehicle type.</strong></p>
                            <p>This vehicle type may not be included in EPA Table 3 or the data hasn't been loaded yet.</p>
                        </div>
                    `;
                }
            } else {
                // Show specific year data
                const factors = onRoadData[vehicleType]?.[modelYear];
                if (factors) {
                    const co2e_per_mile = (factors.ch4 * 28 + factors.n2o * 265);
                    
                    content = `
                        <h3>📊 EPA Table 3 - On-Road Gasoline Vehicle Emission Factors</h3>
                        <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <p><strong>🚗 Vehicle Type:</strong> ${vehicleType}</p>
                            <p><strong>📅 Model Year:</strong> ${modelYear}</p>
                            <p><strong>📖 Source:</strong> EPA GHG Emission Factors Hub 2025, Table 3</p>
                            <p><strong>📏 Method:</strong> Distance-based emission factors</p>
                        </div>
                        
                        <h4>🌍 Greenhouse Gas Emission Factors</h4>
                        <table style="border-collapse: collapse; width: 100%; margin-bottom: 15px;">
                            <tr style="background-color: #e3f2fd;">
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Gas</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Emission Factor</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Unit</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">GWP (AR5)</th>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;"><strong>CH₄</strong> (Methane)</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.ch4}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">g/mile</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">28</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;"><strong>N₂O</strong> (Nitrous Oxide)</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.n2o}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">g/mile</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">265</td>
                            </tr>
                            <tr style="background-color: #fff3e0;">
                                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Total CO₂e</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>${co2e_per_mile.toFixed(2)}</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>g CO₂e/mile</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">-</td>
                            </tr>
                        </table>
                        
                        <div style="background-color: #f0f8ff; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <h5>🧮 CO₂e Calculation Formula</h5>
                            <p><strong>CO₂e = (CH₄ × GWP_CH₄) + (N₂O × GWP_N₂O)</strong></p>
                            <p><strong>Calculation:</strong> (${factors.ch4} × 28) + (${factors.n2o} × 265) = ${co2e_per_mile.toFixed(2)} g CO₂e/mile</p>
                        </div>
                        
                        <div style="background-color: #e8f5e8; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <h5>📝 Historical Context</h5>
                            <p><strong>Model Year ${modelYear}:</strong> ${getHistoricalContext(modelYear)}</p>
                        </div>
                        
                        <p style="margin-top: 15px;"><small><strong>📚 Data Source:</strong> EPA GHG Emission Factors Hub 2025, Table 3: Mobile Combustion On-Road Gasoline Vehicles</small></p>
                    `;
                } else {
                    content = `
                        <h3>📊 On-Road Gasoline Vehicle Emission Factors</h3>
                        <p><strong>Vehicle:</strong> ${vehicleType}</p>
                        <p><strong>Model Year:</strong> ${modelYear}</p>
                        <div style="background-color: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">
                            <p>⚠️ <strong>No data available</strong></p>
                            <p>Emission factors not available for this vehicle type and model year combination.</p>
                        </div>
                    `;
                }
            }
            
            // Create and show modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; border-radius: 10px; padding: 20px; 
                max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            modalContent.innerHTML = `
                ${content}
                <div style="text-align: right; margin-top: 20px;">
                    <button onclick="this.closest('.modal').remove()" style="
                        background: #dc3545; color: white; border: none; padding: 10px 20px; 
                        border-radius: 5px; cursor: pointer; font-size: 14px;
                    ">Close</button>
                </div>
            `;
            
            modal.className = 'modal';
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function getHistoricalContext(year) {
            const yearNum = parseInt(year);
            if (yearNum >= 2020) return "Latest emission control technology with advanced three-way catalysts and precise fuel management systems.";
            if (yearNum >= 2010) return "Enhanced emission control systems meeting Tier 2 standards with improved catalyst efficiency.";
            if (yearNum >= 2000) return "Introduction of advanced OBD-II systems and refined catalyst technologies.";
            if (yearNum >= 1990) return "Widespread adoption of three-way catalytic converters and electronic fuel injection.";
            if (yearNum >= 1980) return "Early catalytic converter implementation and transition to unleaded gasoline.";
            if (yearNum >= 1975) return "Introduction of catalytic converters following the Clean Air Act.";
            return "Pre-emission control era with minimal pollution control technology.";
        }

        function getMethodologyContent(fuelType, fuelInfo) {
            // Get fuel category for methodology details
            let fuelCategory = getFuelCategory(fuelType);
            let methodologyContent = '';
            
            // Common methodology introduction
            methodologyContent += `
                <p><strong>Derivation Method:</strong> This emission factor was obtained using the EPA GHG Emission Factors Hub (2025) methodology, following internationally recognized standards.</p>
            `;
            
            // Fuel-specific methodology based on category
            switch(fuelCategory) {
                case 'coal':
                    methodologyContent += `
                        <div style="margin: 10px 0;">
                            <p><strong>🔥 Carbon Content Method:</strong></p>
                            <ol style="margin: 5px 0 10px 20px; font-size: 14px;">
                                <li><strong>Carbon Analysis:</strong> Laboratory analysis of coal samples to determine carbon content (${getEstimatedCarbonContent(fuelType)} kg C/TJ)</li>
                                <li><strong>Oxidation Factor:</strong> Applied 99% oxidation efficiency during combustion</li>
                                <li><strong>CO₂ Conversion:</strong> Carbon content × 0.99 × (44/12 molecular weight ratio)</li>
                            </ol>
                            <p><strong>🏭 Coal-Specific Factors:</strong></p>
                            <ul style="margin: 5px 0 10px 20px; font-size: 14px;">
                                <li><strong>Rank Classification:</strong> ${getCoalRankDescription(fuelType)}</li>
                                <li><strong>CH₄ Emissions:</strong> 1.0 kg/TJ (incomplete combustion in stationary equipment)</li>
                                <li><strong>N₂O Emissions:</strong> 1.4 kg/TJ (high-temperature combustion, fuel nitrogen oxidation)</li>
                            </ul>
                        </div>
                    `;
                    break;
                    
                case 'petroleum':
                    methodologyContent += `
                        <div style="margin: 10px 0;">
                            <p><strong>⚗️ Petroleum Product Analysis:</strong></p>
                            <ol style="margin: 5px 0 10px 20px; font-size: 14px;">
                                <li><strong>API Gravity:</strong> Density measurement using API gravity standards (${getAPIGravity(fuelType)})</li>
                                <li><strong>Calorific Value:</strong> Laboratory bomb calorimetry testing (NCV: ${fuelInfo.ncv || 'N/A'} ${getNcvUnit()})</li>
                                <li><strong>Carbon Content:</strong> Hydrocarbon analysis (${getEstimatedCarbonContent(fuelType)} kg C/TJ)</li>
                                <li><strong>Final Calculation:</strong> EF = (Default EF × NCV × Density) ÷ 1000</li>
                            </ol>
                            <p><strong>🚗 Petroleum-Specific Factors:</strong></p>
                            <ul style="margin: 5px 0 10px 20px; font-size: 14px;">
                                <li><strong>CH₄ Emissions:</strong> 3.0 kg/TJ (incomplete combustion, technology-dependent)</li>
                                <li><strong>N₂O Emissions:</strong> 0.6 kg/TJ (combustion temperature and fuel nitrogen content)</li>
                                <li><strong>Density:</strong> ${fuelInfo.density || 'N/A'} ${getDensityUnit()} (temperature corrected to 15°C)</li>
                            </ul>
                        </div>
                    `;
                    break;
                    
                case 'gas':
                    methodologyContent += `
                        <div style="margin: 10px 0;">
                            <p><strong>💨 Gaseous Fuel Analysis:</strong></p>
                            <ol style="margin: 5px 0 10px 20px; font-size: 14px;">
                                <li><strong>Composition Analysis:</strong> Gas chromatography to determine methane content and heating value</li>
                                <li><strong>Standard Conditions:</strong> Measured at 15°C and 101.325 kPa (standard conditions)</li>
                                <li><strong>Carbon Content:</strong> Based on molecular composition (${getEstimatedCarbonContent(fuelType)} kg C/TJ)</li>
                                <li><strong>Combustion Efficiency:</strong> 99.5% oxidation rate for clean-burning gas</li>
                            </ol>
                            <p><strong>🔥 Natural Gas Factors:</strong></p>
                            <ul style="margin: 5px 0 10px 20px; font-size: 14px;">
                                <li><strong>CH₄ Emissions:</strong> ${getGasEmissionExplanation(fuelType, 'ch4')}</li>
                                <li><strong>N₂O Emissions:</strong> ${getGasEmissionExplanation(fuelType, 'n2o')}</li>
                                <li><strong>Composition:</strong> ~95% CH₄, 3% C₂H₆, 1% N₂, 1% other gases</li>
                            </ul>
                        </div>
                    `;
                    break;
                    
                default:
                    methodologyContent += `
                        <div style="margin: 10px 0;">
                            <p><strong>📊 Standard Methodology:</strong></p>
                            <ul style="margin: 5px 0 10px 20px; font-size: 14px;">
                                <li><strong>Source:</strong> EPA GHG Emission Factors Hub (2025 version)</li>
                                <li><strong>Method:</strong> Carbon content analysis with 99% oxidation factor</li>
                                <li><strong>Validation:</strong> Cross-referenced with IPCC 2006 Guidelines</li>
                                <li><strong>Uncertainty:</strong> ±5-15% (typical for fuel combustion factors)</li>
                            </ul>
                        </div>
                    `;
            }
            
            // Add GWP methodology
            methodologyContent += `
                <div style="margin: 10px 0; padding-top: 10px; border-top: 1px solid #ccc;">
                    <p><strong>🌍 Global Warming Potential (GWP) Application:</strong></p>
                    <ul style="margin: 5px 0 10px 20px; font-size: 14px;">
                        <li><strong>CO₂:</strong> GWP = 1 (reference gas)</li>
                        <li><strong>CH₄:</strong> GWP = 28 (IPCC AR5, 100-year time horizon)</li>
                        <li><strong>N₂O:</strong> GWP = 265 (IPCC AR5, 100-year time horizon)</li>
                        <li><strong>Total CO₂e:</strong> Sum of (Emission × GWP) for all three gases</li>
                    </ul>
                </div>
            `;
            
            return methodologyContent;
        }
        
        function getFuelCategory(fuelType) {
            const coalFuels = ['Anthracite', 'Bituminous Coal', 'Sub-bituminous Coal', 'Lignite'];
            const petroleumFuels = ['Diesel', 'Gasoline', 'Jet Fuel', 'Kerosene', 'Fuel Oil No. 1', 'Fuel Oil No. 2', 'Fuel Oil No. 4', 'Fuel Oil No. 5', 'Fuel Oil No. 6', 'Aviation Gasoline'];
            const gasFuels = ['Natural Gas', 'Propane', 'Butane'];
            
            if (coalFuels.includes(fuelType)) return 'coal';
            if (petroleumFuels.includes(fuelType)) return 'petroleum';
            if (gasFuels.includes(fuelType)) return 'gas';
            return 'other';
        }
        
        function getEstimatedCarbonContent(fuelType) {
            const carbonContent = {
                'Anthracite': '26,800',
                'Bituminous Coal': '25,800',
                'Sub-bituminous Coal': '25,500',
                'Lignite': '27,600',
                'Diesel': '20,200',
                'Gasoline': '18,900',
                'Natural Gas': '15,300',
                'Jet Fuel': '19,500',
                'Kerosene': '19,600',
                'Aviation Gasoline': '18,900',
                'Propane': '16,800',
                'Butane': '17,200'
            };
            return carbonContent[fuelType] || '20,000';
        }
        
        function getCoalRankDescription(fuelType) {
            const descriptions = {
                'Anthracite': 'Highest rank coal, >86% carbon, low moisture',
                'Bituminous Coal': 'Medium-high rank, 45-86% carbon, moderate volatile matter',
                'Sub-bituminous Coal': 'Lower rank, 35-45% carbon, higher moisture content',
                'Lignite': 'Lowest rank, <35% carbon, highest moisture content'
            };
            return descriptions[fuelType] || 'Standard coal classification';
        }
        
        function getAPIGravity(fuelType) {
            const apiGravity = {
                'Diesel': '~35° API (0.85 specific gravity)',
                'Gasoline': '~60° API (0.74 specific gravity)',
                'Jet Fuel': '~40° API (0.82 specific gravity)',
                'Kerosene': '~42° API (0.81 specific gravity)',
                'Aviation Gasoline': '~65° API (0.72 specific gravity)'
            };
            return apiGravity[fuelType] || '~40° API';
        }
        
        function getGasEmissionExplanation(fuelType, gasType) {
            if (fuelType === 'Natural Gas') {
                if (gasType === 'ch4') {
                    return '1.0 kg/TJ (unburned methane from incomplete combustion and equipment leaks)';
                } else if (gasType === 'n2o') {
                    return '0.1 kg/TJ (thermal formation during high-temperature combustion)';
                }
            }
            return 'Standard emission rate for gaseous fuels';
        }
        
        function getNcvUnit() {
            return 'TJ/Gg'; // Terajoules per Gigagram
        }
          function getDensityUnit() {
            return 'kg/L'; // Kilograms per Liter
        }

        // EPA Table 4 Diesel and Alternative Fuel Vehicle Functions
        let dieselAltFuelCalculationCount = 0;
        let dieselAltFuelResults = [];

        function addDieselAltFuelCalculation() {
            dieselAltFuelCalculationCount++;
            const calculationsContainer = document.getElementById('dieselAltFuelCalculations');
            
            const formHtml = `
                <div class="calculation-form" id="dieselAltFuelForm${dieselAltFuelCalculationCount}">
                    <div class="calculation-form-header">
                        <h4 class="calculation-form-title">
                            <span class="calculation-counter">${dieselAltFuelCalculationCount}</span>
                            EPA Table 4 Vehicle Calculation #${dieselAltFuelCalculationCount}
                        </h4>
                        ${dieselAltFuelCalculationCount > 1 ? `<button type="button" class="remove-calculation-button" onclick="removeDieselAltFuelCalculation(${dieselAltFuelCalculationCount})">🗑️ Remove</button>` : ''}
                    </div>
                      <div class="form-container">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="dieselAltFuelVehicleType${dieselAltFuelCalculationCount}">
                                    🚛 Vehicle Type:
                                    <span class="info-tooltip" id="dieselAltFuelEFTooltip${dieselAltFuelCalculationCount}" title="Select vehicle type and fuel to see CH₄ and N₂O emission factors" onclick="showDieselAltFuelEmissionFactors(${dieselAltFuelCalculationCount})" style="cursor: pointer; color: #0066cc;">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <select class="form-select" id="dieselAltFuelVehicleType${dieselAltFuelCalculationCount}" onchange="populateDieselAltFuelOptions(${dieselAltFuelCalculationCount})">
                                    <option value="">-- Select Vehicle Type --</option>
                                    <option value="Passenger Cars">Passenger Cars</option>
                                    <option value="Light-Duty Trucks">Light-Duty Trucks</option>
                                    <option value="Heavy-Duty Vehicles">Heavy-Duty Vehicles</option>
                                    <option value="Motorcycles">Motorcycles</option>
                                    <option value="Buses">Buses</option>
                                </select>
                            </div>                              <div class="form-group">
                                <label class="form-label" for="dieselAltFuelType${dieselAltFuelCalculationCount}">
                                    ⛽ Fuel Type:
                                    <span class="info-tooltip" id="dieselAltFuelTypeTooltip${dieselAltFuelCalculationCount}" title="Select fuel type to see CH₄ and N₂O emission factors" onclick="showDieselAltFuelTypeFactors(${dieselAltFuelCalculationCount})" style="cursor: pointer; color: #0066cc;">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                </label>
                                <select class="form-select" id="dieselAltFuelType${dieselAltFuelCalculationCount}" onchange="populateModelYearOptions(${dieselAltFuelCalculationCount}); updateDieselAltFuelTooltip(${dieselAltFuelCalculationCount}); updateDieselAltFuelTypeTooltip(${dieselAltFuelCalculationCount})">
                                    <option value="">-- Select Fuel Type --</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row" id="dieselModelYearRow${dieselAltFuelCalculationCount}" style="display: none;">
                            <div class="form-group">
                                <label class="form-label" for="dieselAltFuelModelYear${dieselAltFuelCalculationCount}">📅 Model Year Range:</label>
                                <select class="form-select" id="dieselAltFuelModelYear${dieselAltFuelCalculationCount}" onchange="updateDieselAltFuelTooltip(${dieselAltFuelCalculationCount})">
                                    <option value="">-- Select Model Year Range --</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label" for="dieselAltFuelMiles${dieselAltFuelCalculationCount}">🛣️ Distance Driven (miles):</label>
                            <input type="number" class="form-input" id="dieselAltFuelMiles${dieselAltFuelCalculationCount}" step="any" min="0" placeholder="Enter miles driven">
                        </div>
                        
                        <button type="button" class="calculate-button" onclick="calculateDieselAltFuelEmissions(${dieselAltFuelCalculationCount})">🧮 Calculate Emissions</button>
                    </div>
                    
                    <div class="results-section" id="dieselAltFuelResults${dieselAltFuelCalculationCount}" style="display: none;">
                        <div id="dieselAltFuelResultContent${dieselAltFuelCalculationCount}"></div>
                    </div>
                </div>
            `;
            
            calculationsContainer.insertAdjacentHTML('beforeend', formHtml);
        }

        function removeDieselAltFuelCalculation(calculationId) {
            const formElement = document.getElementById(`dieselAltFuelForm${calculationId}`);
            if (formElement) {
                formElement.remove();
                
                // Remove from results array
                dieselAltFuelResults = dieselAltFuelResults.filter(result => result.id !== calculationId);
                updateDieselAltFuelSummary();
            }
        }        function populateDieselAltFuelOptions(calculationId) {
            const vehicleType = document.getElementById(`dieselAltFuelVehicleType${calculationId}`).value;
            const fuelSelect = document.getElementById(`dieselAltFuelType${calculationId}`);
            const modelYearRow = document.getElementById(`dieselModelYearRow${calculationId}`);
            const modelYearSelect = document.getElementById(`dieselAltFuelModelYear${calculationId}`);
            
            // Clear fuel options
            fuelSelect.innerHTML = '<option value="">-- Select Fuel Type --</option>';
            
            // Clear and hide model year options
            if (modelYearSelect) {
                modelYearSelect.innerHTML = '<option value="">-- Select Model Year Range --</option>';
            }
            modelYearRow.style.display = 'none';            if (vehicleType) {
                // Add diesel option for all vehicle types
                const dieselOption = document.createElement("option");
                dieselOption.value = 'Diesel';
                dieselOption.text = 'Diesel';
                fuelSelect.appendChild(dieselOption);
                
                // Add alternative fuel options based on vehicle type
                const altFuelVehicleKey = `${vehicleType} (Alternative Fuel)`;
                if (onRoadDieselAltFuelData[altFuelVehicleKey]) {
                    for (let fuelType in onRoadDieselAltFuelData[altFuelVehicleKey]) {
                        const option = document.createElement("option");
                        option.value = fuelType;
                        option.text = fuelType;
                        fuelSelect.appendChild(option);
                    }
                }
            }
            
            updateDieselAltFuelTooltip(calculationId);
        }
        
        function populateModelYearOptions(calculationId) {
            const vehicleType = document.getElementById(`dieselAltFuelVehicleType${calculationId}`).value;
            const fuelType = document.getElementById(`dieselAltFuelType${calculationId}`).value;
            const modelYearRow = document.getElementById(`dieselModelYearRow${calculationId}`);
            const modelYearSelect = document.getElementById(`dieselAltFuelModelYear${calculationId}`);
            
            // Clear model year options
            modelYearSelect.innerHTML = '<option value="">-- Select Model Year Range --</option>';
            
            // Show model year row only for diesel fuel
            if (fuelType === 'Diesel' && vehicleType) {
                modelYearRow.style.display = 'block';
                
                const dieselVehicleKey = `${vehicleType} (Diesel)`;
                if (onRoadDieselAltFuelData[dieselVehicleKey]) {
                    for (let yearRange in onRoadDieselAltFuelData[dieselVehicleKey]) {
                        const option = document.createElement("option");
                        option.value = yearRange;
                        option.text = yearRange;
                        modelYearSelect.appendChild(option);
                    }
                }
            } else {
                modelYearRow.style.display = 'none';
            }
            
            updateDieselAltFuelTooltip(calculationId);
        }        function calculateDieselAltFuelEmissions(calculationId) {
            const vehicleType = document.getElementById(`dieselAltFuelVehicleType${calculationId}`).value;
            const fuelType = document.getElementById(`dieselAltFuelType${calculationId}`).value;
            const modelYear = document.getElementById(`dieselAltFuelModelYear${calculationId}`).value;
            const miles = parseFloat(document.getElementById(`dieselAltFuelMiles${calculationId}`).value);
            const resultDiv = document.getElementById(`dieselAltFuelResultContent${calculationId}`);
            const resultsSection = document.getElementById(`dieselAltFuelResults${calculationId}`);

            // Validate basic fields
            if (!vehicleType || !fuelType || isNaN(miles)) {
                resultDiv.innerHTML = "<div class='error-message'>Please complete all fields.</div>";
                resultsSection.style.display = 'block';
                return;
            }

            // For diesel fuel, model year is required
            if (fuelType === 'Diesel' && !modelYear) {
                resultDiv.innerHTML = "<div class='error-message'>Please select a model year range for diesel vehicles.</div>";
                resultsSection.style.display = 'block';
                return;
            }

            let factors;
            let vehicleKey;
            let fuelKey;

            // Determine the correct data structure to access
            if (fuelType === 'Diesel') {
                vehicleKey = `${vehicleType} (Diesel)`;
                fuelKey = modelYear;
            } else {
                vehicleKey = `${vehicleType} (Alternative Fuel)`;
                fuelKey = fuelType;
            }

            factors = onRoadDieselAltFuelData[vehicleKey]?.[fuelKey];
            
            if (!factors) {
                resultDiv.innerHTML = "<div class='error-message'>Emission factors not available for this vehicle/fuel combination.</div>";
                resultsSection.style.display = 'block';
                return;
            }

            // Calculate emissions
            const ch4 = miles * factors.ch4;
            const n2o = miles * factors.n2o;
            const ch4_co2e = (ch4 * GWP.ch4) / 1000;
            const n2o_co2e = (n2o * GWP.n2o) / 1000;
            const co2e = ch4_co2e + n2o_co2e;

            // Store result for summary
            const existingIndex = dieselAltFuelResults.findIndex(result => result.id === calculationId);
            const result = {
                id: calculationId,
                vehicleType: vehicleType,
                fuelType: fuelType === 'Diesel' ? `${fuelType} (${modelYear})` : fuelType,
                miles: miles,
                ch4: ch4,
                n2o: n2o,
                co2e: co2e
            };

            if (existingIndex >= 0) {
                dieselAltFuelResults[existingIndex] = result;
            } else {
                dieselAltFuelResults.push(result);
            }

            // Create display fuel type for results
            const displayFuelType = fuelType === 'Diesel' ? `${fuelType} (${modelYear})` : fuelType;

            resultDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3>Input Summary</h3>
                    <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                        <p><strong>🚛 Vehicle Type:</strong> ${vehicleType}</p>
                        <p><strong>⛽ Fuel Type:</strong> ${displayFuelType}</p>
                        <p><strong>🛣️ Distance:</strong> ${miles.toLocaleString()} miles</p>
                        <p><strong>📊 Data Source:</strong> EPA Table 4 - Mobile Combustion On-Road Diesel and Alternative Fuel Vehicles</p>
                    </div>
                </div>
                
                <div style="background-color: #e3f2fd; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                    <h4>📊 Applied Emission Factors</h4>
                    <table style="border-collapse: collapse; width: 100%; margin-top: 10px;">
                        <tr style="background-color: #1976d2; color: white;">
                            <th style="padding: 4px; border: 1px solid #ddd;"><strong>Gas</strong></th>
                            <th style="padding: 4px; border: 1px solid #ddd;"><strong>Emission Factor</strong></th>
                            <th style="padding: 4px; border: 1px solid #ddd;"><strong>Unit</strong></th>
                        </tr>
                        <tr>
                            <td style="padding: 4px; border: 1px solid #ddd;"><strong>CH₄</strong></td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${factors.ch4}</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">g per mile</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                            <td style="padding: 4px; border: 1px solid #ddd;"><strong>N₂O</strong></td>
                            <td style="padding: 4px; border: 1px solid #ddd;">${factors.n2o}</td>
                            <td style="padding: 4px; border: 1px solid #ddd;">g per mile</td>
                        </tr>
                    </table>
                </div>
                
                <div class="results-grid">
                    <div class="result-card">
                        <h4>🔥 CH₄ Emissions</h4>
                        <div class="result-value">${ch4.toFixed(3)} g</div>
                        <div class="result-calculation">${miles} miles × ${factors.ch4} g/mile</div>
                    </div>
                    
                    <div class="result-card">
                        <h4>💨 N₂O Emissions</h4>
                        <div class="result-value">${n2o.toFixed(3)} g</div>
                        <div class="result-calculation">${miles} miles × ${factors.n2o} g/mile</div>
                    </div>
                    
                    <div class="result-card">
                        <h4>🌍 CH₄ CO₂ Equivalent</h4>
                        <div class="result-value">${ch4_co2e.toFixed(3)} kg CO₂e</div>
                        <div class="result-calculation">${ch4.toFixed(3)} g × ${GWP.ch4} GWP ÷ 1000</div>
                    </div>
                    
                    <div class="result-card">
                        <h4>🌍 N₂O CO₂ Equivalent</h4>
                        <div class="result-value">${n2o_co2e.toFixed(3)} kg CO₂e</div>
                        <div class="result-calculation">${n2o.toFixed(3)} g × ${GWP.n2o} GWP ÷ 1000</div>
                    </div>
                </div>
                
                <div class="total-emissions">
                    <h3>🎯 Total CO₂ Equivalent Emissions</h3>
                    <div class="total-value">${co2e.toFixed(3)} kg CO₂e</div>
                    <div class="breakdown">
                        CH₄ Contribution: ${ch4_co2e.toFixed(3)} kg CO₂e (${((ch4_co2e/co2e)*100).toFixed(1)}%) + 
                        N₂O Contribution: ${n2o_co2e.toFixed(3)} kg CO₂e (${((n2o_co2e/co2e)*100).toFixed(1)}%)
                    </div>
                </div>
                
                <div class="calculation-note">
                    <p><strong>Note:</strong> Global Warming Potentials (GWP) from IPCC AR5, 100-year time horizon</p>
                </div>
            `;
            
            resultsSection.style.display = 'block';
            updateDieselAltFuelSummary();
        }

        function updateDieselAltFuelSummary() {
            if (dieselAltFuelResults.length <= 1) {
                document.getElementById('dieselAltFuelSummary').style.display = 'none';
                return;
            }
            
            let totalCH4 = 0;
            let totalN2O = 0;
            let totalCO2e = 0;
            
            let summaryHtml = `
                <table class="summary-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Vehicle Type</th>
                            <th>Fuel</th>
                            <th>Miles</th>
                            <th>CH₄ (g)</th>
                            <th>N₂O (g)</th>
                            <th>Total CO₂e (kg)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            dieselAltFuelResults.forEach(result => {
                totalCH4 += result.ch4;
                totalN2O += result.n2o;
                totalCO2e += result.co2e;
                
                summaryHtml += `
                    <tr>
                        <td>${result.id}</td>
                        <td>${result.vehicleType}</td>
                        <td>${result.fuelType}</td>
                        <td>${result.miles}</td>
                        <td>${result.ch4.toFixed(3)}</td>
                        <td>${result.n2o.toFixed(3)}</td>
                        <td>${result.co2e.toFixed(3)}</td>
                    </tr>
                `;
            });
            
            summaryHtml += `
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="4"><strong>TOTAL</strong></td>
                            <td><strong>${totalCH4.toFixed(3)}</strong></td>
                            <td><strong>${totalN2O.toFixed(3)}</strong></td>
                            <td><strong>${totalCO2e.toFixed(3)}</strong></td>
                        </tr>
                    </tfoot>
                </table>
                
                <div class="summary-highlight">
                    <h4>🎯 Total Diesel & Alternative Fuel Vehicle Emissions</h4>
                    <p><strong>${totalCO2e.toFixed(3)} kg CO₂e</strong> from ${dieselAltFuelResults.length} vehicle calculations</p>
                    <p>CH₄: ${totalCH4.toFixed(3)} g | N₂O: ${totalN2O.toFixed(3)} g</p>
                </div>
            `;
            
            document.getElementById('dieselAltFuelSummaryContent').innerHTML = summaryHtml;
            document.getElementById('dieselAltFuelSummary').style.display = 'block';
        }        // Diesel & Alternative Fuel Tooltip Functions
        function updateDieselAltFuelTooltip(calculationId) {
            const vehicleType = document.getElementById(`dieselAltFuelVehicleType${calculationId}`).value;
            const fuelType = document.getElementById(`dieselAltFuelType${calculationId}`).value;
            const modelYear = document.getElementById(`dieselAltFuelModelYear${calculationId}`).value;
            const tooltip = document.getElementById(`dieselAltFuelEFTooltip${calculationId}`);
            
            if (!vehicleType || !fuelType) {
                tooltip.title = "Select vehicle type and fuel to see CH₄ and N₂O emission factors";
                return;
            }
            
            let factors;
            let displayText;
            
            if (fuelType === 'Diesel') {
                if (!modelYear) {
                    tooltip.title = "Select model year range for diesel vehicles to see emission factors";
                    return;
                }
                const dieselVehicleKey = `${vehicleType} (Diesel)`;
                factors = onRoadDieselAltFuelData[dieselVehicleKey]?.[modelYear];
                displayText = `${vehicleType} - ${fuelType} (${modelYear})`;
            } else {
                const altFuelVehicleKey = `${vehicleType} (Alternative Fuel)`;
                factors = onRoadDieselAltFuelData[altFuelVehicleKey]?.[fuelType];
                displayText = `${vehicleType} - ${fuelType}`;
            }
            
            if (factors) {
                tooltip.title = `${displayText}:\nCH₄: ${factors.ch4} g/mile\nN₂O: ${factors.n2o} g/mile\n(EPA Table 4 - Diesel & Alternative Fuel Vehicles)`;
            } else {
                tooltip.title = "Emission factors not available for this vehicle/fuel combination";
            }
        }

        function showDieselAltFuelEmissionFactors(calculationId) {
            const vehicleType = document.getElementById(`dieselAltFuelVehicleType${calculationId}`).value;
            const fuelType = document.getElementById(`dieselAltFuelType${calculationId}`).value;
            
            if (!vehicleType) {
                alert('Please select a vehicle type first.');
                return;
            }
            
            let content = '';
            
            if (!fuelType) {
                // Show all available fuels for the selected vehicle type
                const vehicleData = onRoadDieselAltFuelData[vehicleType];
                if (vehicleData) {
                    content = `
                        <h3>📊 EPA Table 4 - Diesel & Alternative Fuel Vehicle Emission Factors</h3>
                        <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <p><strong>🚛 Vehicle Type:</strong> ${vehicleType}</p>
                            <p><strong>📖 Source:</strong> EPA GHG Emission Factors Hub 2025, Table 4</p>
                            <p><strong>📏 Method:</strong> Distance-based (g/mile)</p>                            <p><strong>⛽ Coverage:</strong> ${vehicleType.includes('(Diesel)') ? 'Diesel fuel by model year ranges' : 'Multiple alternative fuel types'}</p>
                        </div>
                        
                        <h4>🌍 CH₄ and N₂O Emission Factors</h4>
                        <div style="max-height: 400px; overflow-y: auto; margin-bottom: 15px;">
                            <table style="border-collapse: collapse; width: 100%; margin-bottom: 15px;">
                                <tr style="background-color: #e3f2fd;">
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">${vehicleType.includes('(Diesel)') ? 'Model Year Range' : 'Fuel Type'}</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">CH₄ (g/mile)</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">N₂O (g/mile)</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Total CO₂e (g/mile)*</th>
                                </tr>
                    `;
                    
                    // Show available options
                    Object.keys(vehicleData).forEach(key => {
                        const factors = vehicleData[key];
                        const co2e_per_mile = (factors.ch4 * 28 + factors.n2o * 265);
                        
                        content += `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${key}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.ch4}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.n2o}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>${co2e_per_mile.toFixed(2)}</strong></td>
                            </tr>
                        `;
                    });
                    
                    content += `
                            </table>
                        </div>
                        
                        <div style="background-color: #f0f8ff; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <h5>🧮 CO₂e Calculation Formula</h5>
                            <p><strong>CO₂e (g/mile) = (CH₄ × 28) + (N₂O × 265)</strong></p>
                            <p><em>*Using IPCC AR5 100-year Global Warming Potential values</em></p>
                        </div>
                        
                        <p style="margin-top: 15px;"><small><strong>📚 Data Source:</strong> EPA GHG Emission Factors Hub 2025, Table 4: Mobile Combustion On-Road Diesel and Alternative Fuel Vehicles</small></p>
                    `;
                } else {
                    content = `
                        <h3>📊 Diesel & Alternative Fuel Vehicle Emission Factors</h3>
                        <p><strong>Vehicle:</strong> ${vehicleType}</p>
                        <div style="background-color: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">
                            <p>⚠️ <strong>No data available for this vehicle type.</strong></p>
                            <p>This vehicle type may not be included in EPA Table 4 or the data hasn't been loaded yet.</p>
                        </div>
                    `;
                }
            } else {
                // Show specific fuel data
                const factors = onRoadDieselAltFuelData[vehicleType]?.[fuelType];
                if (factors) {
                    const co2e_per_mile = (factors.ch4 * 28 + factors.n2o * 265);
                    
                    content = `
                        <h3>📊 EPA Table 4 - Diesel & Alternative Fuel Vehicle Emission Factors</h3>
                        <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <p><strong>🚛 Vehicle Type:</strong> ${vehicleType}</p>
                            <p><strong>⛽ Fuel Type:</strong> ${fuelType}</p>
                            <p><strong>📖 Source:</strong> EPA GHG Emission Factors Hub 2025, Table 4</p>
                            <p><strong>📏 Method:</strong> Distance-based emission factors</p>
                        </div>
                        
                        <h4>🌍 Greenhouse Gas Emission Factors</h4>
                        <table style="border-collapse: collapse; width: 100%; margin-bottom: 15px;">
                            <tr style="background-color: #e3f2fd;">
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Gas</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Emission Factor</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Unit</th>
                                <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">GWP (AR5)</th>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;"><strong>CH₄</strong> (Methane)</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.ch4}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">g/mile</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">28</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;"><strong>N₂O</strong> (Nitrous Oxide)</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.n2o}</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">g/mile</td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">265</td>
                            </tr>
                            <tr style="background-color: #fff3e0;">
                                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Total CO₂e</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>${co2e_per_mile.toFixed(2)}</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>g CO₂e/mile</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">-</td>
                            </tr>
                        </table>
                        
                        <div style="background-color: #f0f8ff; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <h5>🧮 CO₂e Calculation Formula</h5>
                            <p><strong>CO₂e = (CH₄ × GWP_CH₄) + (N₂O × GWP_N₂O)</strong></p>
                            <p><strong>Calculation:</strong> (${factors.ch4} × 28) + (${factors.n2o} × 265) = ${co2e_per_mile.toFixed(2)} g CO₂e/mile</p>
                        </div>
                        
                        <div style="background-color: #e8f5e8; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <h5>📝 Technology Context</h5>
                            <p><strong>${fuelType}:</strong> ${getTechnologyContext(vehicleType, fuelType)}</p>
                        </div>
                        
                        <p style="margin-top: 15px;"><small><strong>📚 Data Source:</strong> EPA GHG Emission Factors Hub 2025, Table 4: Mobile Combustion On-Road Diesel and Alternative Fuel Vehicles</small></p>
                    `;
                } else {
                    content = `
                        <h3>📊 Diesel & Alternative Fuel Vehicle Emission Factors</h3>
                        <p><strong>Vehicle:</strong> ${vehicleType}</p>
                        <p><strong>Fuel:</strong> ${fuelType}</p>
                        <div style="background-color: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">
                            <p>⚠️ <strong>No data available</strong></p>
                            <p>Emission factors not available for this vehicle type and fuel combination.</p>
                        </div>
                    `;
                }
            }
            
            // Create and show modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; border-radius: 10px; padding: 20px; 
                max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            modalContent.innerHTML = `
                ${content}
                <div style="text-align: right; margin-top: 20px;">
                    <button onclick="this.closest('.modal').remove()" style="
                        background: #dc3545; color: white; border: none; padding: 10px 20px; 
                        border-radius: 5px; cursor: pointer; font-size: 14px;
                    ">Close</button>
                </div>
            `;
            
            modal.className = 'modal';
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }        function getTechnologyContext(vehicleType, fuelType) {
            if (vehicleType.includes('(Diesel)')) {
                if (fuelType.includes('2007-2022')) {
                    return "Advanced diesel technology with selective catalytic reduction (SCR) and diesel particulate filters (DPF) meeting Tier 2/3 standards.";
                } else if (fuelType.includes('1983-2006')) {
                    return "Early emission control systems with basic oxidation catalysts and early EGR systems.";
                } else {
                    return "Pre-emission control era diesel engines with minimal pollution control technology.";
                }
            } else {
                const contexts = {
                    'CNG': 'Compressed natural gas vehicles with dedicated CNG engines or bi-fuel capability.',
                    'LNG': 'Liquefied natural gas vehicles primarily for heavy-duty applications.',
                    'LPG': 'Liquefied petroleum gas (propane) vehicles with dedicated or dual-fuel systems.',
                    'Ethanol': 'Flexible fuel vehicles (FFVs) capable of running on high ethanol blends (E85).',
                    'Methanol': 'Methanol-fueled vehicles with dedicated fuel systems and engine modifications.',
                    'Biodiesel': 'Vehicles running on biodiesel blends with conventional diesel engines.'
                };
                return contexts[fuelType] || 'Alternative fuel vehicle technology with specialized fuel systems.';            }
        }
        
        // New function to update fuel type tooltip
        function updateDieselAltFuelTypeTooltip(calculationId) {
            const vehicleType = document.getElementById(`dieselAltFuelVehicleType${calculationId}`).value;
            const fuelType = document.getElementById(`dieselAltFuelType${calculationId}`).value;
            const tooltip = document.getElementById(`dieselAltFuelTypeTooltip${calculationId}`);
            
            if (!vehicleType || !fuelType) {
                tooltip.title = "Select fuel type to see CH₄ and N₂O emission factors";
                return;
            }
            
            let factors;
            let displayText;
            
            if (fuelType === 'Diesel') {
                // For diesel, we need to show a general message since model year affects factors
                displayText = `${vehicleType} - ${fuelType}`;
                tooltip.title = `${displayText}: CH₄ and N₂O factors vary by model year. Click for details.`;
            } else {
                // For alternative fuels, get specific factors
                const altFuelVehicleKey = `${vehicleType} (Alternative Fuel)`;
                factors = onRoadDieselAltFuelData[altFuelVehicleKey]?.[fuelType];
                displayText = `${vehicleType} - ${fuelType}`;
                
                if (factors) {
                    tooltip.title = `${displayText}:\nCH₄: ${factors.ch4} g/mile\nN₂O: ${factors.n2o} g/mile\nClick for more details`;
                } else {
                    tooltip.title = `${displayText}: Emission factors not available`;
                }
            }        }
        
        // New function to show detailed fuel type emission factors
        function showDieselAltFuelTypeFactors(calculationId) {
            const vehicleType = document.getElementById(`dieselAltFuelVehicleType${calculationId}`).value;
            const fuelType = document.getElementById(`dieselAltFuelType${calculationId}`).value;
            
            if (!vehicleType) {
                alert('Please select a vehicle type first.');
                return;
            }
            
            let content = '';
            
            if (!fuelType) {
                // Show message to select fuel type
                content = `
                    <h3>📊 Available Fuel Types for ${vehicleType}</h3>
                    <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                        <p><strong>🚛 Vehicle Type:</strong> ${vehicleType}</p>
                        <p><strong>📖 Source:</strong> EPA GHG Emission Factors Hub 2025, Table 4</p>
                    </div>
                    
                    <div style="background-color: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">
                        <p>ℹ️ <strong>Please select a fuel type</strong> to see specific CH₄ and N₂O emission factors.</p>
                        <p>Available fuel types will appear in the dropdown after selecting this vehicle type.</p>
                    </div>
                `;
            } else {
                // Show specific fuel data with CH₄ and N₂O factors
                let factors;
                
                if (fuelType === 'Diesel') {
                    // For diesel, show all model year ranges
                    const dieselVehicleKey = `${vehicleType} (Diesel)`;
                    const dieselData = onRoadDieselAltFuelData[dieselVehicleKey];
                    
                    if (dieselData) {
                        content = `
                            <h3>📊 CH₄ and N₂O Emission Factors - ${vehicleType} (${fuelType})</h3>
                            <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                                <p><strong>🚛 Vehicle Type:</strong> ${vehicleType}</p>
                                <p><strong>⛽ Fuel Type:</strong> ${fuelType}</p>
                                <p><strong>📖 Source:</strong> EPA GHG Emission Factors Hub 2025, Table 4</p>
                                <p><strong>📏 Method:</strong> Distance-based emission factors</p>
                            </div>
                            
                            <h4>🌍 Emission Factors by Model Year Range</h4>
                            <table style="border-collapse: collapse; width: 100%; margin-bottom: 15px;">
                                <tr style="background-color: #e3f2fd;">
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Model Year Range</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">CH₄ (g/mile)</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">N₂O (g/mile)</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Total CO₂e (g/mile)</th>
                                </tr>
                        `;
                        
                        Object.entries(dieselData).forEach(([yearRange, factors]) => {
                            const co2e_per_mile = (factors.ch4 * 28 + factors.n2o * 265);
                            content += `
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 8px;"><strong>${yearRange}</strong></td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.ch4}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.n2o}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>${co2e_per_mile.toFixed(2)}</strong></td>
                                </tr>
                            `;
                        });
                        
                        content += `
                                </table>
                                
                                <div style="background-color: #f0f8ff; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                                    <h5>🧮 CO₂e Calculation Formula</h5>
                                    <p><strong>CO₂e (g/mile) = (CH₄ × 28) + (N₂O × 265)</strong></p>
                                    <p><em>*Using IPCC AR5 100-year Global Warming Potential values</em></p>
                                </div>
                        `;
                    } else {
                        content = `
                            <h3>📊 CH₄ and N₂O Emission Factors</h3>
                            <p><strong>Vehicle:</strong> ${vehicleType}</p>
                            <p><strong>Fuel:</strong> ${fuelType}</p>
                            <div style="background-color: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">
                                <p>⚠️ <strong>No data available for this vehicle type.</strong></p>
                            </div>
                        `;
                    }
                } else {
                    // For alternative fuels, show single set of factors
                    const altFuelVehicleKey = `${vehicleType} (Alternative Fuel)`;
                    factors = onRoadDieselAltFuelData[altFuelVehicleKey]?.[fuelType];
                    
                    if (factors) {
                        const co2e_per_mile = (factors.ch4 * 28 + factors.n2o * 265);
                        
                        content = `
                            <h3>📊 CH₄ and N₂O Emission Factors - ${vehicleType} (${fuelType})</h3>
                            <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                                <p><strong>🚛 Vehicle Type:</strong> ${vehicleType}</p>
                                <p><strong>⛽ Fuel Type:</strong> ${fuelType}</p>
                                <p><strong>📖 Source:</strong> EPA GHG Emission Factors Hub 2025, Table 4</p>
                                <p><strong>📏 Method:</strong> Distance-based emission factors</p>
                            </div>
                            
                            <h4>🌍 Greenhouse Gas Emission Factors</h4>
                            <table style="border-collapse: collapse; width: 100%; margin-bottom: 15px;">
                                <tr style="background-color: #e3f2fd;">
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Gas</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Emission Factor</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">Unit</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; text-align: center;">GWP (AR5)</th>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 8px;"><strong>CH₄</strong> (Methane)</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.ch4}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">g/mile</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">28</td>
                                </tr>
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 8px;"><strong>N₂O</strong> (Nitrous Oxide)</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${factors.n2o}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">g/mile</td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">265</td>
                                </tr>
                                <tr style="background-color: #fff3e0;">
                                    <td style="border: 1px solid #ddd; padding: 8px;"><strong>Total CO₂e</strong></td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>${co2e_per_mile.toFixed(2)}</strong></td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>g CO₂e/mile</strong></td>
                                    <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">-</td>
                                </tr>
                            </table>
                            
                            <div style="background-color: #f0f8ff; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                                <h5>🧮 CO₂e Calculation Formula</h5>
                                <p><strong>CO₂e = (CH₄ × GWP_CH₄) + (N₂O × GWP_N₂O)</strong></p>
                                <p><strong>Calculation:</strong> (${factors.ch4} × 28) + (${factors.n2o} × 265) = ${co2e_per_mile.toFixed(2)} g CO₂e/mile</p>
                            </div>
                            
                            <div style="background-color: #e8f5e8; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                                <h5>📝 Technology Context</h5>
                                <p><strong>${fuelType}:</strong> ${getTechnologyContext(vehicleType, fuelType)}</p>
                            </div>
                        `;
                    } else {
                        content = `
                            <h3>📊 CH₄ and N₂O Emission Factors</h3>
                            <p><strong>Vehicle:</strong> ${vehicleType}</p>
                            <p><strong>Fuel:</strong> ${fuelType}</p>
                            <div style="background-color: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">
                                <p>⚠️ <strong>No data available</strong></p>
                                <p>CH₄ and N₂O emission factors not available for this vehicle type and fuel combination.</p>
                            </div>
                        `;
                    }
                }
                
                content += `
                    <p style="margin-top: 15px;"><small><strong>📚 Data Source:</strong> EPA GHG Emission Factors Hub 2025, Table 4: Mobile Combustion On-Road Diesel and Alternative Fuel Vehicles</small></p>
                `;
            }
            
            // Create and show modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; border-radius: 10px; padding: 20px; 
                max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            modalContent.innerHTML = `
                ${content}
                <div style="text-align: right; margin-top: 20px;">
                    <button onclick="this.closest('.modal').remove()" style="
                        background: #dc3545; color: white; border: none; padding: 10px 20px; 
                        border-radius: 5px; cursor: pointer; font-size: 14px;
                    ">Close</button>
                </div>
            `;
            
            modal.className = 'modal';
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
    </script>
    
    <!-- EPA Table 5: Non-Road Vehicles GHG Calculator -->
    <script>
        // Existing JavaScript code...

        // EPA Table 5: Non-Road Vehicles GHG Calculator
        let nonRoadCalculationCounter = 0;        const epaTable5Data = {
            'Agricultural Equipment': {
                'Gasoline (2-stroke)': { ch4: 6.90, n2o: 0.47 },
                'Gasoline (4-stroke)': { ch4: 1.93, n2o: 1.20 },
                'Gasoline Off-Road Trucks': { ch4: 1.93, n2o: 1.20 },
                'Diesel Equipment': { ch4: 1.26, n2o: 1.07 },
                'Diesel Off-Road Trucks': { ch4: 0.92, n2o: 0.56 },
                'LPG': { ch4: 0.33, n2o: 0.94 }
            },
            'Construction and Mining Equipment': {
                'Gasoline (2-stroke)': { ch4: 8.00, n2o: 0.12 },
                'Gasoline (4-stroke)': { ch4: 2.86, n2o: 1.48 },
                'Gasoline Off-Road Trucks': { ch4: 2.86, n2o: 1.48 },
                'Diesel Equipment': { ch4: 1.01, n2o: 0.94 },
                'Diesel Off-Road Trucks': { ch4: 0.92, n2o: 0.56 },
                'LPG': { ch4: 0.59, n2o: 0.50 }
            },
            'Lawn and Garden Equipment': {
                'Gasoline (2-stroke)': { ch4: 7.34, n2o: 0.31 },
                'Gasoline (4-stroke)': { ch4: 3.02, n2o: 1.50 },
                'Diesel': { ch4: 0.67, n2o: 0.49 },
                'LPG': { ch4: 0.37, n2o: 0.63 }
            },
            'Airport Equipment': {
                'Gasoline': { ch4: 1.07, n2o: 1.12 },
                'Diesel': { ch4: 1.98, n2o: 1.21 },
                'LPG': { ch4: 0.37, n2o: 0.93 }
            },
            'Industrial and Commercial Equipment': {
                'Gasoline (2-stroke)': { ch4: 7.30, n2o: 0.51 },
                'Gasoline (4-stroke)': { ch4: 2.81, n2o: 1.57 },
                'Diesel': { ch4: 0.43, n2o: 0.62 },
                'LPG': { ch4: 0.46, n2o: 0.66 }
            },
            'Logging Equipment': {
                'Gasoline (2-stroke)': { ch4: 9.62, n2o: 0.00 },
                'Gasoline (4-stroke)': { ch4: 3.22, n2o: 2.05 },
                'Diesel': { ch4: 0.49, n2o: 1.26 }
            },
            'Railroad Equipment': {
                'Gasoline': { ch4: 3.32, n2o: 1.86 },
                'Diesel': { ch4: 0.41, n2o: 0.97 },
                'LPG': { ch4: 2.05, n2o: 0.01 }
            },
            'Locomotives': {
                'Diesel': { ch4: 0.80, n2o: 0.26 }
            },
            'Recreational Equipment': {
                'Gasoline (2-stroke)': { ch4: 9.86, n2o: 0.11 },
                'Gasoline (4-stroke)': { ch4: 2.74, n2o: 1.49 },
                'Diesel': { ch4: 0.73, n2o: 0.66 },
                'LPG': { ch4: 0.44, n2o: 0.61 }
            },
            'Ships and Boats': {
                'Gasoline (2-stroke)': { ch4: 4.67, n2o: 0.08 },
                'Gasoline (4-stroke)': { ch4: 2.27, n2o: 0.01 },
                'Diesel': { ch4: 6.51, n2o: 0.17 },
                'Residual Fuel Oil': { ch4: 1.10, n2o: 0.31 }
            },
            'Aircraft': {
                'Jet Fuel': { ch4: 0.00, n2o: 0.30 },
                'Aviation Gasoline': { ch4: 7.06, n2o: 0.11 }
            }
        };

        function addNonRoadCalculation() {
            nonRoadCalculationCounter++;
            const calculationsDiv = document.getElementById('nonRoadCalculations');
            
            const calculationDiv = document.createElement('div');
            calculationDiv.className = 'calculation-form';
            calculationDiv.id = `nonRoadCalculation${nonRoadCalculationCounter}`;
            
            calculationDiv.innerHTML = `
                <h4 class="form-title">🚜 Non-Road Vehicle Calculation #${nonRoadCalculationCounter}</h4>
                <div class="form-group">
                    <label for="nonRoadEquipmentType${nonRoadCalculationCounter}">Equipment Type:</label>
                    <select id="nonRoadEquipmentType${nonRoadCalculationCounter}" onchange="updateNonRoadFuelOptions(${nonRoadCalculationCounter})" required>
                        <option value="">Select Equipment Type</option>
                        ${Object.keys(epaTable5Data).map(type => `<option value="${type}">${type}</option>`).join('')}
                    </select>
                </div>                <div class="form-group">
                    <label for="nonRoadFuelType${nonRoadCalculationCounter}">Fuel Type:</label>
                    <select id="nonRoadFuelType${nonRoadCalculationCounter}" onchange="updateNonRoadFuelTypeInfo(${nonRoadCalculationCounter})" required>
                        <option value="">Select Fuel Type</option>
                    </select>
                    <span class="tooltip" id="nonRoadFuelTypeTooltip${nonRoadCalculationCounter}" onclick="showNonRoadFuelTypeInfo(${nonRoadCalculationCounter})">ℹ️</span>
                </div>
                
                <div class="form-group">
                    <label for="nonRoadFuelAmount${nonRoadCalculationCounter}">Fuel Consumption (gallons):</label>
                    <input type="number" id="nonRoadFuelAmount${nonRoadCalculationCounter}" step="0.01" min="0" required>
                    <span class="tooltip" onclick="showTooltip('Non-road fuel consumption', 'Enter the total amount of fuel consumed by the non-road vehicle in gallons.')">ℹ️</span>
                </div>
                
                <div class="form-actions">
                    <button type="button" onclick="calculateNonRoadEmissions(${nonRoadCalculationCounter})">Calculate Emissions</button>
                    <button type="button" onclick="removeNonRoadCalculation(${nonRoadCalculationCounter})" class="remove-button">Remove</button>
                </div>
                
                <div id="nonRoadResult${nonRoadCalculationCounter}" class="calculation-result" style="display: none;">
                    <h5 class="result-title">📊 Calculation Results:</h5>
                    <div id="nonRoadResultContent${nonRoadCalculationCounter}"></div>
                </div>
            `;
            
            calculationsDiv.appendChild(calculationDiv);
        }        function updateNonRoadFuelOptions(calculationId) {
            const equipmentSelect = document.getElementById(`nonRoadEquipmentType${calculationId}`);
            const fuelSelect = document.getElementById(`nonRoadFuelType${calculationId}`);
            
            const selectedEquipment = equipmentSelect.value;
            fuelSelect.innerHTML = '<option value="">Select Fuel Type</option>';
            
            if (selectedEquipment && epaTable5Data[selectedEquipment]) {
                const fuelTypes = Object.keys(epaTable5Data[selectedEquipment]);
                fuelTypes.forEach(fuel => {
                    const option = document.createElement('option');
                    option.value = fuel;
                    option.textContent = fuel;
                    fuelSelect.appendChild(option);
                });
            }
            
            // Update tooltip when equipment type changes
            updateNonRoadFuelTypeInfo(calculationId);
        }        // New function to update tooltip based on current selections
        function updateNonRoadFuelTypeInfo(calculationId) {
            const tooltip = document.getElementById(`nonRoadFuelTypeTooltip${calculationId}`);
            const equipmentType = document.getElementById(`nonRoadEquipmentType${calculationId}`).value;
            const fuelType = document.getElementById(`nonRoadFuelType${calculationId}`).value;
            
            if (!tooltip) return;
            
            if (!equipmentType) {
                tooltip.title = "ℹ️ Select equipment type first to see available fuel types and emission factors. Click for detailed information about all equipment categories and fuel types.";
                tooltip.style.color = "#6c757d";
            } else if (!fuelType) {
                const availableFuels = Object.keys(epaTable5Data[equipmentType]);
                tooltip.title = `📋 Available fuels for ${equipmentType}: ${availableFuels.join(', ')}. Click to see detailed emission factors and characteristics for each fuel type.`;
                tooltip.style.color = "#007bff";
            } else {
                const factors = epaTable5Data[equipmentType][fuelType];
                const ch4CO2e = (factors.ch4 / 1000) * 28;
                const n2oCO2e = (factors.n2o / 1000) * 265;
                const totalCO2e = ch4CO2e + n2oCO2e;
                tooltip.title = `🚜 ${fuelType} for ${equipmentType}\n• CH₄: ${factors.ch4} g/gal (${ch4CO2e.toFixed(4)} kg CO₂e/gal)\n• N₂O: ${factors.n2o} g/gal (${n2oCO2e.toFixed(4)} kg CO₂e/gal)\n• Total: ${totalCO2e.toFixed(4)} kg CO₂e/gal\nClick for detailed calculations and application notes.`;
                tooltip.style.color = "#28a745";
            }
        }

        function calculateNonRoadEmissions(calculationId) {
            const equipmentType = document.getElementById(`nonRoadEquipmentType${calculationId}`).value;
            const fuelType = document.getElementById(`nonRoadFuelType${calculationId}`).value;
            const fuelAmount = parseFloat(document.getElementById(`nonRoadFuelAmount${calculationId}`).value);
            
            if (!equipmentType || !fuelType || !fuelAmount) {
                alert('Please fill in all required fields.');
                return;
            }
            
            const emissionFactors = epaTable5Data[equipmentType][fuelType];
            
            // Calculate emissions (g/gallon × gallons = grams)
            const ch4Emissions = emissionFactors.ch4 * fuelAmount; // grams CH₄
            const n2oEmissions = emissionFactors.n2o * fuelAmount; // grams N₂O
            
            // Convert to kg
            const ch4EmissionsKg = ch4Emissions / 1000;
            const n2oEmissionsKg = n2oEmissions / 1000;
            
            // Calculate CO₂e using GWP values (CH₄ = 28, N₂O = 265)
            const ch4CO2e = ch4EmissionsKg * 28;
            const n2oCO2e = n2oEmissionsKg * 265;
            const totalCO2e = ch4CO2e + n2oCO2e;
            
            // Display results
            const resultDiv = document.getElementById(`nonRoadResult${calculationId}`);
            const resultContent = document.getElementById(`nonRoadResultContent${calculationId}`);
            
            resultContent.innerHTML = `
                <div class="result-item">
                    <span class="label">Equipment Type:</span>
                    <span class="value">${equipmentType}</span>
                </div>
                <div class="result-item">
                    <span class="label">Fuel Type:</span>
                    <span class="value">${fuelType}</span>
                </div>
                <div class="result-item">
                    <span class="label">Fuel Consumption:</span>
                    <span class="value">${fuelAmount.toLocaleString()} gallons</span>
                </div>
                <div class="result-item">
                    <span class="label">CH₄ Emissions:</span>
                    <span class="value">${ch4EmissionsKg.toFixed(4)} kg (${ch4CO2e.toFixed(2)} kg CO₂e)</span>
                </div>
                <div class="result-item">
                    <span class="label">N₂O Emissions:</span>
                    <span class="value">${n2oEmissionsKg.toFixed(4)} kg (${n2oCO2e.toFixed(2)} kg CO₂e)</span>
                </div>
                <div class="result-item total">
                    <span class="label">Total CO₂e:</span>
                    <span class="value">${totalCO2e.toFixed(2)} kg CO₂e</span>
                </div>
                <div class="emission-factors">
                    <small>Emission Factors: CH₄ = ${emissionFactors.ch4} g/gal, N₂O = ${emissionFactors.n2o} g/gal</small>
                </div>
            `;
            
            resultDiv.style.display = 'block';
            updateNonRoadSummary();
        }

        function removeNonRoadCalculation(calculationId) {
            const calculationDiv = document.getElementById(`nonRoadCalculation${calculationId}`);
            if (calculationDiv) {
                calculationDiv.remove();
                updateNonRoadSummary();
            }
        }

        function updateNonRoadSummary() {
            const calculations = document.querySelectorAll('[id^="nonRoadCalculation"]');
            const summaryDiv = document.getElementById('nonRoadSummary');
            const summaryContent = document.getElementById('nonRoadSummaryContent');
            
            if (calculations.length === 0) {
                summaryDiv.style.display = 'none';
                return;
            }
            
            let totalCO2e = 0;
            let summaryHTML = '';
            
            calculations.forEach((calc, index) => {
                const resultDiv = calc.querySelector('.calculation-result[style*="block"]');
                if (resultDiv) {
                    const resultContent = resultDiv.querySelector('[id$="ResultContent"]');
                    if (resultContent) {
                        const totalElement = resultContent.querySelector('.result-item.total .value');
                        if (totalElement) {
                            const co2eValue = parseFloat(totalElement.textContent.match(/[\d.]+/)[0]);
                            totalCO2e += co2eValue;
                            
                            const equipmentType = calc.querySelector('[id$="EquipmentType"]').value;
                            const fuelType = calc.querySelector('[id$="FuelType"]').value;
                            const fuelAmount = calc.querySelector('[id$="FuelAmount"]').value;
                            
                            summaryHTML += `
                                <div class="summary-item">
                                    <span class="summary-label">${equipmentType} (${fuelType}):</span>
                                    <span class="summary-details">${fuelAmount} gal → ${co2eValue.toFixed(2)} kg CO₂e</span>
                                </div>
                            `;
                        }
                    }
                }
            });
            
            summaryContent.innerHTML = summaryHTML;
            document.getElementById('nonRoadTotalCO2e').textContent = totalCO2e.toFixed(2);
            summaryDiv.style.display = summaryHTML ? 'block' : 'none';        }

        // General tooltip function for simple tooltips
        function showTooltip(title, message) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; 
                align-items: center; justify-content: center; 
                z-index: 1000; padding: 20px;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; padding: 30px; border-radius: 10px; 
                max-width: 400px; text-align: center;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            modalContent.innerHTML = `
                <h3>${title}</h3>
                <p>${message}</p>
                <div style="margin-top: 20px;">
                    <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                            style="background: #007bff; color: white; border: none; 
                                   padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        Close
                    </button>
                </div>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }        // Non-Road Fuel Type Information Function
        function showNonRoadFuelTypeInfo(calculationId) {
            const equipmentType = document.getElementById(`nonRoadEquipmentType${calculationId}`).value;
            const fuelType = document.getElementById(`nonRoadFuelType${calculationId}`).value;
            
            let content = '';
            
            if (!equipmentType) {
                content = `
                    <h3>🚜 Non-Road Vehicle Fuel Types</h3>
                    <p>ℹ️ <strong>Please select an equipment type first</strong> to see available fuel types and their characteristics.</p>
                    <div style="margin-top: 15px;">
                        <h4>📋 General Fuel Type Information:</h4>
                        <ul style="text-align: left; margin: 10px 0;">
                            <li><strong>Gasoline (2-stroke):</strong> Used in smaller equipment like chainsaws, leaf blowers, marine outboard engines</li>
                            <li><strong>Gasoline (4-stroke):</strong> Used in lawn mowers, generators, larger equipment, marine inboard engines</li>
                            <li><strong>Gasoline:</strong> General gasoline for airport equipment and railroad vehicles</li>
                            <li><strong>Gasoline Off-Road Trucks:</strong> Gasoline used in off-road trucks for agricultural and construction</li>
                            <li><strong>Diesel:</strong> Common in heavy construction, agricultural, industrial equipment, ships, and recreational vehicles</li>
                            <li><strong>Diesel Equipment:</strong> Diesel used in stationary and mobile equipment</li>
                            <li><strong>Diesel Off-Road Trucks:</strong> Diesel used in off-road trucks for agricultural and construction</li>
                            <li><strong>LPG (Liquefied Petroleum Gas):</strong> Used in forklifts, airport equipment, and some outdoor equipment</li>
                            <li><strong>Jet Fuel:</strong> Used in aircraft engines (commercial and general aviation)</li>
                            <li><strong>Aviation Gasoline:</strong> Used in smaller aircraft engines (general aviation)</li>
                            <li><strong>Residual Fuel Oil:</strong> Used in large ships and marine vessels</li>
                        </ul>
                        <h4>📊 Equipment Categories:</h4>
                        <ul style="text-align: left; margin: 10px 0;">
                            <li><strong>Agricultural Equipment:</strong> Tractors, harvesters, irrigation pumps, farm machinery</li>
                            <li><strong>Construction and Mining Equipment:</strong> Excavators, bulldozers, mining vehicles, heavy machinery</li>
                            <li><strong>Lawn and Garden Equipment:</strong> Mowers, trimmers, leaf blowers, garden tools</li>
                            <li><strong>Airport Equipment:</strong> Ground support equipment, baggage tugs, aircraft service vehicles</li>
                            <li><strong>Industrial and Commercial Equipment:</strong> Forklifts, generators, compressors, material handling</li>
                            <li><strong>Logging Equipment:</strong> Tree harvesters, wood chippers, forestry machinery</li>
                            <li><strong>Railroad Equipment:</strong> Rail maintenance vehicles, switching equipment</li>
                            <li><strong>Locomotives:</strong> Train engines and locomotives</li>
                            <li><strong>Recreational Equipment:</strong> ATVs, snowmobiles, golf carts, recreational vehicles</li>
                            <li><strong>Ships and Boats:</strong> Commercial vessels, pleasure craft, marine equipment</li>
                            <li><strong>Aircraft:</strong> General aviation and commercial aviation</li>
                        </ul>
                    </div>
                `;
            } else if (!fuelType) {
                // Show available fuels for selected equipment type
                const availableFuels = Object.keys(epaTable5Data[equipmentType]);
                content = `
                    <h3>🚜 ${equipmentType} - Available Fuel Types</h3>
                    <p>💡 <strong>Select a fuel type below to see detailed emission factors and characteristics.</strong></p>
                    <div style="margin-top: 15px;">
                        <h4>📋 Available Fuel Types for ${equipmentType}:</h4>
                        <div style="text-align: left; margin: 10px 0;">
                `;
                
                availableFuels.forEach(fuel => {
                    const factors = epaTable5Data[equipmentType][fuel];
                    const ch4CO2e = (factors.ch4 / 1000) * 28; // Convert to kg and apply GWP
                    const n2oCO2e = (factors.n2o / 1000) * 265; // Convert to kg and apply GWP
                    const totalCO2ePerGal = ch4CO2e + n2oCO2e;
                    
                    content += `
                        <div style="margin: 10px 0; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
                            <div style="font-weight: bold; color: #333; margin-bottom: 5px;">${fuel}</div>
                            <div style="font-size: 0.9em; color: #666;">
                                CH₄: ${factors.ch4} g/gal | N₂O: ${factors.n2o} g/gal<br>
                                <span style="color: #007bff; font-weight: 500;">Total CO₂e: ${totalCO2ePerGal.toFixed(4)} kg/gal</span>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                        <div style="margin-top: 15px; padding: 12px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #17a2b8;">
                            <div style="font-weight: bold; color: #17a2b8; margin-bottom: 5px;">📊 Understanding Emission Factors</div>
                            <div style="font-size: 0.9em;">
                                • <strong>CH₄ (Methane):</strong> GWP of 28 over 100 years<br>
                                • <strong>N₂O (Nitrous Oxide):</strong> GWP of 265 over 100 years<br>
                                • Factors are from EPA Table 5 (grams per gallon of fuel)
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Show detailed information for selected equipment and fuel type combination
                const factors = epaTable5Data[equipmentType][fuelType];
                const ch4CO2e = (factors.ch4 / 1000) * 28; // Convert to kg and apply GWP
                const n2oCO2e = (factors.n2o / 1000) * 265; // Convert to kg and apply GWP
                const totalCO2ePerGal = ch4CO2e + n2oCO2e;
                
                content = `
                    <h3>🚜 ${equipmentType} - ${fuelType} Details</h3>
                    <div style="margin-top: 15px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #333; margin: 0 0 10px 0;">📊 Emission Factors</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                <div style="background: white; padding: 10px; border-radius: 5px; text-align: center;">
                                    <div style="font-size: 1.2em; font-weight: bold; color: #007bff;">${factors.ch4}</div>
                                    <div style="font-size: 0.9em; color: #666;">g CH₄/gallon</div>
                                </div>
                                <div style="background: white; padding: 10px; border-radius: 5px; text-align: center;">
                                    <div style="font-size: 1.2em; font-weight: bold; color: #28a745;">${factors.n2o}</div>
                                    <div style="font-size: 0.9em; color: #666;">g N₂O/gallon</div>
                                </div>
                            </div>
                            <div style="background: #007bff; color: white; padding: 10px; border-radius: 5px; text-align: center;">
                                <div style="font-size: 1.1em; font-weight: bold;">${totalCO2ePerGal.toFixed(4)} kg CO₂e/gallon</div>
                                <div style="font-size: 0.9em;">Total greenhouse gas impact</div>
                            </div>
                        </div>
                        
                        <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #17a2b8; margin: 0 0 10px 0;">🔬 How These Factors Work</h4>
                            <div style="font-size: 0.9em; line-height: 1.5;">
                                <strong>Calculation Example (per gallon):</strong><br>
                                • CH₄ emissions: ${factors.ch4} g × (1 kg/1000 g) × 28 GWP = ${ch4CO2e.toFixed(4)} kg CO₂e<br>
                                • N₂O emissions: ${factors.n2o} g × (1 kg/1000 g) × 265 GWP = ${n2oCO2e.toFixed(4)} kg CO₂e<br>
                                • <strong>Total: ${totalCO2ePerGal.toFixed(4)} kg CO₂e per gallon</strong>
                            </div>
                        </div>
                        
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #856404; margin: 0 0 10px 0;">💡 Application Notes</h4>
                            <div style="font-size: 0.9em; color: #856404; line-height: 1.5;">
                                • These factors apply specifically to <strong>${equipmentType}</strong> using <strong>${fuelType}</strong><br>
                                • Multiply by your fuel consumption (gallons) to get total emissions<br>
                                • Factors include both direct combustion and upstream emissions<br>
                                • Based on EPA's latest emission factor guidelines (Table 5)
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Create and show modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; 
                align-items: center; justify-content: center; 
                z-index: 1000; padding: 20px;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; padding: 30px; border-radius: 10px; 
                max-width: 600px; max-height: 80vh; overflow-y: auto;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            modalContent.innerHTML = `
                ${content}
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                            style="background: #007bff; color: white; border: none; 
                                   padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        Close
                    </button>
                </div>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Initialize first non-road calculation when page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof addNonRoadCalculation === 'function') {
                addNonRoadCalculation();
            }
        });
    </script>    <!-- Unified Mobile Combustion Calculator Framework -->
    <div class="calculator-section" id="mobile-calculator" style="display: none;">
        <div class="calculator-header">
            <h1 class="calculator-title">🚗 Mobile Combustion GHG Calculator</h1>
            <p class="calculator-description">Comprehensive EPA mobile emission calculations - select from Tables 2, 3, 4, and 5</p>
            
            <!-- EPA Table Selection Dropdown -->
            <div class="mobile-table-selector">
                <label for="mobileTableSelect" class="table-select-label">📊 Select EPA Table:</label>
                <select id="mobileTableSelect" class="table-select-dropdown" onchange="showMobileSubCalculator(this.value)">
                    <option value="">-- Choose EPA Table --</option>
                    <option value="table2">Table 2: Mobile Combustion CO₂ Emission Factors</option>
                    <option value="table3">Table 3: On-Road Gasoline Vehicles (CH₄ & N₂O)</option>
                    <option value="table4">Table 4: On-Road Diesel & Alternative Fuel (CH₄ & N₂O)</option>
                    <option value="table5">Table 5: Non-Road Vehicles (CH₄ & N₂O)</option>
                </select>
            </div>
        </div>
        
        <!-- Sub-calculator sections for each EPA table -->
        
        <!-- EPA Table 2: Mobile Combustion Calculator -->
        <div class="mobile-sub-calculator" id="mobile-table2" style="display: none;">
            <div class="calculator-content">
                <div class="methodology-section">
                    <h3 class="methodology-title">📊 EPA Table 2: Mobile Combustion CO₂ Emission Factors</h3>
                    <div class="methodology-content">
                        <p><strong>Emission Factors:</strong> EPA GHG Emission Factors Hub, Table 2: Mobile Combustion (2025 version)</p>
                        <p><strong>Coverage:</strong> Comprehensive greenhouse gas emissions (CO₂, CH₄, N₂O) from fuel combustion in mobile sources</p>
                        <p><strong>Calculation Method:</strong> Direct emissions calculation with IPCC AR5 Global Warming Potential conversion to CO₂e</p>
                        <p><strong>Enhanced Features:</strong> Includes new EPA 2025 fuel types: Gasoline E10/E85, Renewable Diesel (R100), and Sustainable Aviation Fuel (SAF)</p>
                    </div>
                </div>
                
                <div id="mobileCalculations">
                    <!-- Initial calculation form will be added here by JavaScript -->
                </div>
                
                <button type="button" class="add-calculation-button" onclick="addMobileCalculation()">
                    ➕ Add Another Mobile Calculation
                </button>
                
                <div id="mobileSummary" class="calculations-summary" style="display: none;">
                    <h3 class="summary-title">
                        🚗 Mobile Combustion Summary
                    </h3>
                    <div id="mobileSummaryContent"></div>
                </div>
            </div>
        </div>
        
        <!-- EPA Table 3: On-Road Gasoline Vehicles -->
        <div class="mobile-sub-calculator" id="mobile-table3" style="display: none;">
            <div class="calculator-content">
                <div class="methodology-section">
                    <h3 class="methodology-title">📊 EPA Table 3: On-Road Gasoline Vehicles</h3>
                    <div class="methodology-content">
                        <p><strong>Emission Factors:</strong> EPA Table 3 - Mobile Combustion On-Road Gasoline Vehicles (2025 GHG Emission Factors Hub)</p>
                        <p><strong>Vehicle Types:</strong> Passenger Cars, Light-Duty Trucks, Heavy-Duty Vehicles, Motorcycles</p>
                        <p><strong>Model Years:</strong> Comprehensive coverage from 1973 to 2022 (50 years of emission factor data)</p>
                        <p><strong>Coverage:</strong> CH₄ and N₂O emissions from gasoline combustion (g/mile)</p>
                        <p><strong>Calculation Method:</strong> Emissions = Distance (miles) × Emission Factor (g/mile)</p>
                        <p><strong>Global Warming Potential:</strong> CH₄ = 28, N₂O = 265 (IPCC AR5, 100-year GWP)</p>
                    </div>
                </div>
                
                <div id="onRoadCalculations">
                    <!-- Initial calculation form will be added here by JavaScript -->
                </div>
                
                <button type="button" class="add-calculation-button" onclick="addOnRoadCalculation()">
                    ➕ Add Another On-Road Vehicle Calculation
                </button>
                
                <div id="onRoadSummary" class="calculations-summary" style="display: none;">
                    <h3 class="summary-title">
                        🚗 On-Road Gasoline Vehicles Summary
                    </h3>
                    <div id="onRoadSummaryContent"></div>
                </div>
            </div>
        </div>
        
        <!-- EPA Table 4: On-Road Diesel & Alternative Fuel Vehicles -->
        <div class="mobile-sub-calculator" id="mobile-table4" style="display: none;">
            <div class="calculator-content">
                <div class="methodology-section">
                    <h3 class="methodology-title">📊 EPA Table 4: On-Road Diesel & Alternative Fuel Vehicles</h3>
                    <div class="methodology-content">
                        <p><strong>Emission Factors:</strong> EPA Table 4 - Mobile Combustion CH₄ and N₂O for On-Road Diesel and Alternative Fuel Vehicles (2025 GHG Emission Factors Hub)</p>
                        <p><strong>Vehicle Types:</strong> 8 comprehensive categories - Diesel (Passenger Cars, Light-Duty Trucks, Heavy-Duty Vehicles, Motorcycles, Buses) and Alternative Fuel Vehicles (Passenger Cars, Light-Duty Trucks, Heavy-Duty Vehicles, Motorcycles, Buses)</p>
                        <p><strong>Fuel Types:</strong> Diesel, Methanol, Ethanol, CNG, LPG, LNG, Biodiesel</p>
                        <p><strong>Coverage:</strong> CH₄ and N₂O emissions (g/mile) for various model year ranges and fuel types</p>
                        <p><strong>Calculation Method:</strong> Emissions = Distance (miles) × Emission Factor (g/mile)</p>
                        <p><strong>Global Warming Potential:</strong> CH₄ = 28, N₂O = 265 (IPCC AR5, 100-year GWP)</p>
                    </div>
                </div>
                
                <div id="dieselAltFuelCalculations">
                    <!-- Initial calculation form will be added here by JavaScript -->
                </div>
                
                <button type="button" class="add-calculation-button" onclick="addDieselAltFuelCalculation()">
                    ➕ Add Another Diesel/Alternative Fuel Vehicle Calculation
                </button>
                
                <div id="dieselAltFuelSummary" class="calculations-summary" style="display: none;">
                    <h3 class="summary-title">
                        🚛 Diesel & Alternative Fuel Vehicles Summary
                    </h3>
                    <div id="dieselAltFuelSummaryContent"></div>
                </div>
            </div>
        </div>
        
        <!-- EPA Table 5: Non-Road Vehicles -->
        <div class="mobile-sub-calculator" id="mobile-table5" style="display: none;">
            <div class="calculator-content">
                <div class="methodology-section">
                    <h3 class="methodology-title">📊 EPA Table 5: Non-Road Vehicles</h3>
                    <div class="methodology-content">
                        <p><strong>Emission Factors:</strong> EPA Table 5 - Non-Road Vehicle emission factors</p>
                        <p><strong>Equipment Types:</strong> Agricultural, Construction, Industrial, Lawn & Garden, Logging, Mining, Railroad, Recreational Marine, Commercial Marine</p>
                        <p><strong>Coverage:</strong> CH₄ and N₂O emissions from non-road vehicle fuel combustion</p>
                        <p><strong>Calculation Method:</strong> Emissions = Fuel Consumption (gallons) × Emission Factor (g/gallon)</p>
                        <p><strong>Global Warming Potential:</strong> CH₄ = 28, N₂O = 265 (IPCC AR5, 100-year GWP)</p>
                    </div>
                </div>
                
                <div id="nonRoadCalculations">
                    <!-- Initial calculation form will be added here by JavaScript -->
                </div>
                
                <button type="button" class="add-calculation-button" onclick="addNonRoadCalculation()">
                    ➕ Add Non-Road Vehicle Calculation
                </button>
                
                <div id="nonRoadSummary" class="calculations-summary" style="display: none;">
                    <h3 class="summary-title">📊 Summary of Non-Road Vehicle Emissions</h3>
                    <div id="nonRoadSummaryContent"></div>
                    <div class="summary-total">
                        <span class="label">Total CO₂e:</span>
                        <span id="nonRoadTotalCO2e" class="value">0.00</span> kg CO₂e
                    </div>                </div>            </div>
        </div>
    </div> <!-- End mobile-calculator -->

    <!-- Electricity Calculator -->
    <div class="calculator-section" id="electricity-calculator" style="display: none;">
        <div class="calculator-header">
            <h1 class="calculator-title">⚡ Electricity GHG Calculator</h1>
            <p class="calculator-description">Calculate CO₂, CH₄, and N₂O emissions from electricity consumption using EPA eGRID2023 emission factors</p>
        </div>
        
        <div class="calculator-content">
            <div class="methodology-section">
                <h3 class="methodology-title">📊 Data Source & Methodology</h3>
                <div class="methodology-content">
                    <p><strong>Emission Factors:</strong> EPA eGRID2023 (January 2025) - Table 6 Total Output Emission Factors</p>
                    <p><strong>Coverage:</strong> Indirect CO₂, CH₄, and N₂O emissions from electricity consumption</p>
                    <p><strong>GWP Values:</strong> IPCC AR5 100-year values (CO₂=1, CH₄=28, N₂O=265)</p>
                    <p><strong>Data Source:</strong> <a href="https://www.epa.gov/system/files/documents/2025-01/egrid2023_summary_tables.xlsx" target="_blank">EPA eGRID2023 Summary Tables</a></p>
                    <p><strong>Note:</strong> These factors represent combustion emissions only (tank-to-wheel) and do not include upstream emissions</p>
                </div>
            </div>
            
            <div id="electricityCalculations">
                <!-- Initial calculation form will be added here by JavaScript -->
            </div>
            
            <button type="button" class="add-calculation-button" onclick="addElectricityCalculation()">
                ➕ Add Another Electricity Calculation
            </button>
            
            <div id="electricitySummary" class="calculations-summary" style="display: none;">
                <h3 class="summary-title">📊 Electricity Emissions Summary</h3>
                <div id="electricitySummaryContent"></div>
                <div class="summary-total">
                    <span class="label">Total CO₂e:</span>
                    <span id="electricityTotalCO2e" class="value">0.00</span> kg CO₂e
                </div>
            </div>
        </div>
    </div> <!-- End electricity-calculator -->    <!-- Electricity Calculator #2 -->
    <div class="calculator-section" id="electricity2-calculator" style="display: none;">
        <div class="calculator-header">
            <h1 class="calculator-title">⚡ Electricity GHG Calculator #2</h1>
            <p class="calculator-description">Calculate CO₂, CH₄, and N₂O emissions from electricity consumption using EPA eGRID2023 emission factors</p>
        </div>
        
        <div class="calculator-content">
            <div class="methodology-section">
                <h3 class="methodology-title">📊 Data Source & Methodology</h3>
                <div class="methodology-content">
                    <p><strong>Emission Factors:</strong> EPA eGRID2023 (January 2025) - Table 6 Non-baseload Emission Factors</p>
                    <p><strong>Coverage:</strong> Indirect CO₂, CH₄, and N₂O emissions from electricity consumption</p>
                    <p><strong>GWP Values:</strong> IPCC AR5 100-year values (CO₂=1, CH₄=28, N₂O=265)</p>
                    <p><strong>Data Source:</strong> <a href="https://www.epa.gov/system/files/documents/2025-01/egrid2023_summary_tables.xlsx" target="_blank">EPA eGRID2023 Summary Tables</a></p>
                    <p><strong>Note:</strong> These factors represent combustion emissions only (tank-to-wheel) and do not include upstream emissions</p>
                </div>
            </div>
            
            <div id="electricity2Calculations">
                <!-- Initial calculation form will be added here by JavaScript -->
            </div>
            
            <button type="button" class="add-calculation-button" onclick="addElectricity2Calculation()">
                ➕ Add Another Electricity Calculation
            </button>
            
            <div id="electricity2Summary" class="calculations-summary" style="display: none;">
                <h3 class="summary-title">📊 Electricity Emissions Summary #2</h3>
                <div id="electricity2SummaryContent"></div>
                <div class="summary-total">
                    <span class="label">Total CO₂e:</span>
                    <span id="electricity2TotalCO2e" class="value">0.00</span> kg CO₂e
                </div>
            </div>
        </div>
    </div> <!-- End electricity2-calculator -->

    <!-- Steam and Heat Calculator -->
    <div class="calculator-section" id="steamheat-calculator" style="display: none;">
        <div class="calculator-header">
            <h1 class="calculator-title">🔥 Steam and Heat GHG Calculator</h1>
            <p class="calculator-description">Calculate CO₂, CH₄, and N₂O emissions from steam and heat consumption using EPA emission factors</p>
        </div>
        
        <div class="calculator-content">
            <div class="methodology-section">
                <h3 class="methodology-title">📊 Data Source & Methodology</h3>
                <div class="methodology-content">
                    <p><strong>Emission Factors:</strong> EPA 40 CFR Part 98 Table C-1 (2024) - Default emission factors for district energy systems</p>
                    <p><strong>Coverage:</strong> Direct CO₂, CH₄, and N₂O emissions from steam and heat consumption</p>
                    <p><strong>GWP Values:</strong> IPCC AR5 100-year values (CO₂=1, CH₄=28, N₂O=265)</p>
                    <p><strong>Data Source:</strong> <a href="https://www.ecfr.gov/current/title-40/chapter-I/subchapter-C/part-98" target="_blank">EPA 40 CFR Part 98</a></p>
                    <p><strong>Note:</strong> These factors represent combustion emissions from steam and heat generation at district energy facilities</p>
                </div>
            </div>
            
            <div id="steamHeatCalculations">
                <!-- Initial calculation form will be added here by JavaScript -->
            </div>
            
            <button type="button" class="add-calculation-button" onclick="addSteamHeatCalculation()">
                ➕ Add Another Steam and Heat Calculation
            </button>
            
            <div id="steamHeatSummary" class="calculations-summary" style="display: none;">
                <h3 class="summary-title">📊 Steam and Heat Emissions Summary</h3>
                <div id="steamHeatSummaryContent"></div>
                <div class="summary-total">
                    <span class="label">Total CO₂e:</span>
                    <span id="steamHeatTotalCO2e" class="value">0.00</span> kg CO₂e
                </div>
            </div>        </div>
    </div> <!-- End steamheat-calculator -->

    <!-- Transportation Calculator -->
    <div class="calculator-section" id="transportation-calculator" style="display: none;">
        <div class="calculator-header">
            <h1 class="calculator-title">🚛 Transportation & Distribution GHG Calculator</h1>
            <p class="calculator-description">Calculate CO₂, CH₄, and N₂O emissions from upstream/downstream transportation and distribution using EPA Table 8 emission factors</p>
        </div>
        
        <div class="calculator-content">
            <div class="methodology-section">
                <h3 class="methodology-title">📊 Data Source & Methodology</h3>
                <div class="methodology-content">
                    <p><strong>Emission Factors:</strong> EPA GHG Emission Factors Hub (2025) - Table 8 Upstream/Downstream Transportation and Distribution</p>
                    <p><strong>Coverage:</strong> Direct CO₂, CH₄, and N₂O emissions from transportation modes</p>
                    <p><strong>GWP Values:</strong> IPCC AR5 100-year values (CO₂=1, CH₄=28, N₂O=265)</p>
                    <p><strong>Calculation Method:</strong> Distance-based emission factors by transportation mode and fuel type</p>
                    <p><strong>Scope:</strong> Covers freight transportation including trucks, rail, air, and water transport</p>
                </div>
            </div>
            
            <div id="transportationCalculations">
                <!-- Initial calculation form will be added here by JavaScript -->
            </div>
            
            <button type="button" class="add-calculation-button" onclick="addTransportationCalculation()">
                ➕ Add Another Transportation Calculation
            </button>
            
            <div id="transportationSummary" class="calculations-summary" style="display: none;">
                <h3 class="summary-title">📊 Transportation & Distribution Emissions Summary</h3>
                <div id="transportationSummaryContent"></div>
                <div class="summary-total">
                    <span class="label">Total CO₂e:</span>
                    <span id="transportationTotalCO2e" class="value">0.00</span> kg CO₂e
                </div>
            </div>
        </div>
    </div> <!-- End transportation-calculator -->

    <!-- Business Travel Calculator -->
    <div class="calculator-section" id="business-travel-calculator" style="display: none;">
        <div class="calculator-header">
            <h1 class="calculator-title">✈️ Business Travel GHG Calculator</h1>
            <p class="calculator-description">Calculate CO₂, CH₄, and N₂O emissions from business travel using EPA Table 10 emission factors</p>
        </div>
        
        <div class="calculator-content">
            <div class="methodology-section">
                <h3 class="methodology-title">📊 Data Source & Methodology</h3>
                <div class="methodology-content">
                    <div class="methodology-grid">
                        <div class="methodology-item">
                            <p><strong>Emission Factors:</strong> EPA GHG Emission Factors Hub (2025 version)</p>
                            <p><strong>Table Reference:</strong> Table 10 - Business Travel</p>
                            <p><strong>Scope:</strong> Scope 3 Category 6 (Business Travel)</p>
                        </div>
                        <div class="methodology-item">
                            <p><strong>Transportation Modes:</strong> Personal vehicles, rail, bus, and air travel</p>
                            <p><strong>Unit Types:</strong> Vehicle-miles and passenger-miles</p>
                            <p><strong>Gases Calculated:</strong> CO₂, CH₄, N₂O with GWP conversion</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="calculations-section">
                <div class="section-header">
                    <h3>🧮 Business Travel Calculations</h3>
                    <button onclick="addBusinessTravelCalculation()" class="btn btn-add">
                        <i class="fas fa-plus"></i> Add Calculation
                    </button>
                </div>
                
                <div id="businessTravelCalculations" class="calculations-container">
                    <!-- Dynamic calculation forms will be inserted here -->
                </div>
            </div>

            <div class="summary-section" id="businessTravelSummary" style="display: none;">
                <h3>📊 Business Travel Emissions Summary</h3>
                <div class="summary-grid">
                    <div class="summary-card">
                        <h4>Total CO₂ Emissions</h4>
                        <div class="summary-value" id="businessTravelTotalCO2">0.00 kg CO₂</div>
                    </div>
                    <div class="summary-card">
                        <h4>Total CH₄ Emissions</h4>
                        <div class="summary-value" id="businessTravelTotalCH4">0.00 kg CO₂e</div>
                    </div>
                    <div class="summary-card">
                        <h4>Total N₂O Emissions</h4>
                        <div class="summary-value" id="businessTravelTotalN2O">0.00 kg CO₂e</div>
                    </div>
                    <div class="summary-card total-card">
                        <h4>Total GHG Emissions</h4>
                        <div class="summary-value" id="businessTravelTotalGHG">0.00 kg CO₂e</div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- End business-travel-calculator --></div> <!-- End page-container -->
    
    </div> <!-- End calculator-container -->
    
    </main> <!-- End main-content -->
    
    </div> <!-- End app-container -->

    <!-- Firebase Configuration -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDGpAHia_wEmrhnmYjrPf1n1TrAzwESTgg",
            authDomain: "biogas-effluent-treatment.firebaseapp.com",
            databaseURL: "https://biogas-effluent-treatment-default-rtdb.firebaseio.com",
            projectId: "biogas-effluent-treatment",
            storageBucket: "biogas-effluent-treatment.appspot.com",
            messagingSenderId: "1065047045880",
            appId: "1:1065047045880:web:3c17262f6ad7fac8d01b87"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        
        // Make Firebase instances available globally
        window.firebaseApp = app;
        window.firebaseDB = db;
        window.firebaseAuth = auth;
    </script>

    <!-- Custom Scripts -->
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/roles.js"></script>
    <script type="module" src="js/menu-visibility.js"></script>
    <script type="module" src="js/notifications.js"></script>
    <script type="module" src="js/fuel.js"></script>
</body>
</html>
