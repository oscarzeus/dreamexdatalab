<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiement RÃ©ussi - Votre Entreprise</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>
<body>
    <div class="container">
        <div class="success-container" style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 4rem; margin-bottom: 20px;">âœ…</div>
            <h1 style="color: var(--success-color); margin-bottom: 20px;">Paiement RÃ©ussi!</h1>
            
            <div style="background: var(--card-bg); padding: 30px; border-radius: var(--radius); 
                        box-shadow: var(--shadow); max-width: 500px; margin: 0 auto 30px;">
                <h3 style="margin-bottom: 15px;">ðŸŽ‰ FÃ©licitations !</h3>
                <p style="margin-bottom: 15px;">Votre paiement a Ã©tÃ© traitÃ© avec succÃ¨s.</p>
                <p style="margin-bottom: 15px; color: var(--success-color); font-weight: 600;">
                    Code OTP validÃ© avec succÃ¨s
                </p>
                <p style="font-size: 0.875rem; color: var(--text-light);">
                    Vous recevrez une confirmation par SMS de Orange Money.
                </p>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <a id="backToMerchant" href="/company-complete-registration.html?payment=success" class="pay-button" style="width: auto; padding: 12px 24px;">
                    Retour Ã  l'accueil
                </a>
                <button onclick="window.print()" class="pay-button" 
                        style="width: auto; padding: 12px 24px; background: var(--text-light);">
                    ðŸ“„ Imprimer le reÃ§u
                </button>
            </div>
        </div>
    </div>
        <script>
            // Stay on this dedicated success page.
            // If you ever want to auto-redirect back to the registration flow,
            // append ?auto=1 to the URL or set FRONTEND_DOMAIN and enable the redirect below.
            (function(){
                try {
                    const params = new URLSearchParams(location.search);
                    const orderId = params.get('order_id') || params.get('orderId') || '';

                    // Determine the correct FRONTEND base URL.
                    // Priority:
                    // 1) window.FRONTEND_DOMAIN if provided (e.g., set by server)
                    // 2) If current host starts with api., drop the prefix (api.example.com -> example.com)
                    // 3) Fallback to the known public site
                    // 4) Otherwise, current origin
                    function computeFrontendBase() {
                        try {
                            const explicit = (typeof window.FRONTEND_DOMAIN === 'string' && window.FRONTEND_DOMAIN.trim()) ? window.FRONTEND_DOMAIN.trim() : '';
                            if (explicit) return explicit.replace(/\/$/, '');

                            const { protocol, hostname } = window.location;
                            if (/^api\./i.test(hostname)) {
                                return `${protocol}//${hostname.replace(/^api\./i, '')}`;
                            }
                            // When using the Render/onrender host, send users to the public site
                            if (/onrender\.com$/i.test(hostname)) {
                                return 'https://dreamexdatalab.com';
                            }
                            return window.location.origin;
                        } catch {
                            return 'https://dreamexdatalab.com';
                        }
                    }

                    const base = computeFrontendBase();
                    const target = `${base}/company-complete-registration.html?payment=success${orderId ? `&order_id=${encodeURIComponent(orderId)}` : ''}`;

                    // Ensure the button goes back to the registration wizard and unlocks Next
                    var back = document.getElementById('backToMerchant');
                    if (back) back.href = target;

                    // Optional auto-redirect if explicitly requested
                    const auto = params.get('auto');
                    if (auto === '1') setTimeout(() => { window.location.href = target; }, 1200);
                } catch(e) { /* no-op */ }
            })();
        </script>
</body>
</html>
